{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"Soliplex Documentation","text":"<p>Welcome to the Soliplex ecosystem documentation. Soliplex provides AI-powered retrieval-augmented generation capabilities for intelligent document search and question answering.</p>"},{"location":"#core-components","title":"Core Components","text":""},{"location":"#soliplex-platform","title":"Soliplex Platform","text":"<p>The main Soliplex RAG system with FastAPI backend and Flutter frontend.</p> <p>Quick Links: - Overview - Server Setup - Client Setup - RAG Database - Configuration Guide - Usage</p>"},{"location":"#ingester","title":"Ingester","text":"<p>Robust document ingestion system for loading content into RAG databases.</p> <p>Quick Links: - Getting Started - Architecture - API Reference - CLI Reference - Configuration - Database Schema - Workflows</p>"},{"location":"#user-interfaces","title":"User Interfaces","text":""},{"location":"#flutter-client","title":"Flutter Client","text":"<p>Cross-platform mobile and desktop client application for Soliplex.</p> <p>Quick Links: - Developer Setup Guide - Flutter Development Rules - Client Summary</p>"},{"location":"#chatbot-widget","title":"Chatbot Widget","text":"<p>Embeddable Next.js chat widget for integrating Soliplex into web applications.</p> <p>Quick Links: - Documentation - Usage Guide</p>"},{"location":"#supporting-tools","title":"Supporting Tools","text":""},{"location":"#ingester-agents","title":"Ingester Agents","text":"<p>Agents for ingesting documents from various sources (filesystem, GitHub, Gitea) into the Soliplex Ingester.</p> <p>Quick Links: - Documentation</p>"},{"location":"#pdf-splitter","title":"PDF Splitter","text":"<p>Utility for splitting and processing PDF documents for ingestion.</p> <p>Quick Links: - Documentation</p>"},{"location":"#getting-started","title":"Getting Started","text":""},{"location":"#for-new-users","title":"For New Users","text":"<ol> <li>Core Platform Overview - Understanding the Soliplex system</li> <li>Server Setup - Set up the backend server</li> <li>Client Setup - Configure the client application</li> <li>Getting Started with Ingester - Document ingestion basics</li> </ol>"},{"location":"#for-developers","title":"For Developers","text":"<ol> <li>Core Platform Architecture - System design and components</li> <li>Ingester Architecture - Ingestion pipeline design</li> <li>API References - REST API documentation</li> </ol>"},{"location":"#for-operations","title":"For Operations","text":"<ol> <li>Configuration Guide - Installation configuration</li> <li>Environment Setup - Environment variables</li> <li>Secrets Management - Handling sensitive configuration</li> <li>Ingester CLI Reference - Command-line tool usage</li> </ol>"},{"location":"#what-is-soliplex","title":"What is Soliplex?","text":"<p>Soliplex combines the power of retrieval systems with generative AI to provide accurate, contextual responses based on your document collections. The system indexes your documents and uses them to enhance AI responses with relevant, up-to-date information.</p>"},{"location":"#key-features","title":"Key Features","text":"<ul> <li>RAG-Powered Search: Semantic document retrieval using LanceDB vector database</li> <li>Multi-Room Architecture: Independent chat environments with separate configurations</li> <li>Multiple LLM Providers: OpenAI, Ollama, and compatible APIs</li> <li>Document Ingestion: Robust pipeline for loading and processing documents</li> <li>Real-time Communication: WebSocket-based conversation streams</li> <li>OIDC Authentication: Enterprise SSO with Keycloak integration</li> </ul>"},{"location":"#documentation-updates","title":"Documentation Updates","text":"<p>This documentation is automatically synchronized from multiple repositories:</p> <ul> <li>Core Platform: soliplex/soliplex</li> <li>Ingester: soliplex/ingester</li> <li>Flutter Client: soliplex/flutter</li> <li>Chatbot Widget: soliplex/chatbot</li> <li>Ingester Agents: soliplex/ingester-agents</li> <li>PDF Splitter: soliplex/pdf-splitter</li> </ul> <p>Documentation is updated automatically when changes are made to the source repositories via git submodules.</p> <p>Last Updated: This site is automatically updated when documentation changes are pushed to the main branch of each repository.</p>"},{"location":"chatbot/readme/","title":"Chatbot Widget","text":"<p>Live Demo</p>"},{"location":"chatbot/readme/#soliplex-chat-widget","title":"Soliplex Chat Widget","text":"<p>A React-based embeddable chat widget that connects to a Soliplex/PydanticAI backend using the AG-UI protocol.</p>"},{"location":"chatbot/readme/#project-structure","title":"Project Structure","text":"<pre><code>/\n\u251c\u2500\u2500 app/                    # Next.js app router pages\n\u2502   \u251c\u2500\u2500 page.tsx           # Main page (standalone chat UI)\n\u2502   \u251c\u2500\u2500 layout.tsx         # Root layout\n\u2502   \u2514\u2500\u2500 globals.css        # Global styles (Tailwind)\n\u251c\u2500\u2500 components/\n\u2502   \u251c\u2500\u2500 Chat.tsx           # Core chat component\n\u2502   \u2514\u2500\u2500 ChatWidget.tsx     # Floating widget wrapper\n\u251c\u2500\u2500 hooks/\n\u2502   \u2514\u2500\u2500 useAGUIChat.ts     # Chat state management hook\n\u251c\u2500\u2500 lib/\n\u2502   \u2514\u2500\u2500 agui-client.ts     # AG-UI protocol client\n\u251c\u2500\u2500 widget/\n\u2502   \u2514\u2500\u2500 index.tsx          # Embeddable widget entry point\n\u251c\u2500\u2500 public/\n\u2502   \u251c\u2500\u2500 soliplex-chat.js   # Built widget bundle (after build)\n\u2502   \u2514\u2500\u2500 embed-example.html # Example embed page\n\u251c\u2500\u2500 docs/\n\u2502   \u251c\u2500\u2500 readme.md          # This file\n\u2502   \u2514\u2500\u2500 usage.md           # Widget usage guide\n\u251c\u2500\u2500 esbuild.config.mjs     # Widget build configuration\n\u251c\u2500\u2500 package.json\n\u251c\u2500\u2500 tsconfig.json\n\u251c\u2500\u2500 tailwind.config.js\n\u2514\u2500\u2500 next.config.js\n</code></pre>"},{"location":"chatbot/readme/#prerequisites","title":"Prerequisites","text":"<ul> <li>Node.js 18+</li> <li>npm or yarn</li> <li>A running Soliplex backend (default: <code>http://localhost:8000</code>)</li> </ul>"},{"location":"chatbot/readme/#development-setup","title":"Development Setup","text":""},{"location":"chatbot/readme/#1-install-dependencies","title":"1. Install Dependencies","text":"<pre><code>npm install\n</code></pre>"},{"location":"chatbot/readme/#2-configure-environment","title":"2. Configure Environment","text":"<p>Create a <code>.env.local</code> file:</p> <pre><code># Backend API URL\nNEXT_PUBLIC_AGUI_BASE_URL=http://localhost:8000\n</code></pre>"},{"location":"chatbot/readme/#3-start-development-server","title":"3. Start Development Server","text":"<pre><code>npm run dev\n</code></pre> <p>This starts the Next.js development server at <code>http://localhost:3000</code>.</p>"},{"location":"chatbot/readme/#4-start-the-backend","title":"4. Start the Backend","text":"<p>In a separate terminal, start your Soliplex backend:</p> <pre><code>cd /path/to/soliplex\nuvicorn soliplex.main:app --reload --port 8000\n</code></pre>"},{"location":"chatbot/readme/#5-open-in-browser","title":"5. Open in Browser","text":"<p>Navigate to <code>http://localhost:3000</code> to see the standalone chat interface.</p>"},{"location":"chatbot/readme/#development-commands","title":"Development Commands","text":"Command Description <code>npm run dev</code> Start Next.js dev server with hot reload <code>npm run build</code> Build Next.js app for production <code>npm run start</code> Start production Next.js server <code>npm run lint</code> Run ESLint <code>npm run build:widget</code> Build embeddable widget bundle <code>npm run build:widget:watch</code> Build widget with watch mode"},{"location":"chatbot/readme/#building-for-production","title":"Building for Production","text":""},{"location":"chatbot/readme/#option-1-nextjs-app","title":"Option 1: Next.js App","text":"<p>Build and deploy as a standard Next.js application:</p> <pre><code>npm run build\nnpm run start\n</code></pre>"},{"location":"chatbot/readme/#option-2-embeddable-widget","title":"Option 2: Embeddable Widget","text":"<p>Build a standalone JavaScript bundle that can be embedded in any website:</p> <pre><code>npm run build:widget\n</code></pre> <p>This creates <code>public/soliplex-chat.js</code> (~200KB minified).</p>"},{"location":"chatbot/readme/#widget-build-output","title":"Widget Build Output","text":"<pre><code>public/\n\u251c\u2500\u2500 soliplex-chat.js      # Main bundle (minified)\n\u2514\u2500\u2500 soliplex-chat.js.map  # Source map (for debugging)\n</code></pre>"},{"location":"chatbot/readme/#serving-the-widget","title":"Serving the Widget","text":"<p>You can serve the widget from:</p> <ol> <li>Your CDN - Upload to S3, CloudFront, Cloudflare, etc.</li> <li>Your backend - Serve from your FastAPI static files</li> <li>npm package - Publish as an npm package</li> </ol> <p>Example FastAPI static file serving:</p> <pre><code>from fastapi.staticfiles import StaticFiles\n\napp.mount(\"/static\", StaticFiles(directory=\"static\"), name=\"static\")\n# Widget available at: https://your-api.com/static/soliplex-chat.js\n</code></pre>"},{"location":"chatbot/readme/#widget-development","title":"Widget Development","text":""},{"location":"chatbot/readme/#watch-mode","title":"Watch Mode","text":"<p>For rapid widget development:</p> <pre><code>npm run build:widget:watch\n</code></pre> <p>Then serve the <code>public/</code> directory and open <code>embed-example.html</code>:</p> <pre><code># In another terminal\ncd public\npython -m http.server 8080\n# Open http://localhost:8080/embed-example.html\n</code></pre>"},{"location":"chatbot/readme/#testing-changes","title":"Testing Changes","text":"<ol> <li>Make changes to widget code</li> <li>Watch mode rebuilds automatically</li> <li>Refresh the embed example page</li> </ol>"},{"location":"chatbot/readme/#architecture","title":"Architecture","text":""},{"location":"chatbot/readme/#ag-ui-protocol-flow","title":"AG-UI Protocol Flow","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510     \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510     \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502   Browser   \u2502     \u2502   Backend   \u2502     \u2502   LLM API   \u2502\n\u2502  (Widget)   \u2502     \u2502  (FastAPI)  \u2502     \u2502  (Claude)   \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518     \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518     \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n       \u2502                   \u2502                   \u2502\n       \u2502 POST /agui       \u2502                   \u2502\n       \u2502 (create thread)   \u2502                   \u2502\n       \u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500&gt;\u2502                   \u2502\n       \u2502&lt;\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2502                   \u2502\n       \u2502 { thread_id, run_id }                 \u2502\n       \u2502                   \u2502                   \u2502\n       \u2502 POST /agui/{thread}/{run}             \u2502\n       \u2502 (RunAgentInput)   \u2502                   \u2502\n       \u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500&gt;\u2502                   \u2502\n       \u2502                   \u2502 Stream request    \u2502\n       \u2502                   \u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500&gt;\u2502\n       \u2502                   \u2502                   \u2502\n       \u2502    SSE Stream     \u2502&lt;\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2502\n       \u2502&lt;\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2502  Stream response  \u2502\n       \u2502                   \u2502                   \u2502\n       \u2502 TEXT_MESSAGE_START\u2502                   \u2502\n       \u2502 TEXT_MESSAGE_CONTENT (delta)          \u2502\n       \u2502 TEXT_MESSAGE_END  \u2502                   \u2502\n       \u2502 TOOL_CALL_START   \u2502                   \u2502\n       \u2502 TOOL_CALL_ARGS    \u2502                   \u2502\n       \u2502 TOOL_CALL_END     \u2502                   \u2502\n       \u2502 RUN_FINISHED      \u2502                   \u2502\n       \u2502                   \u2502                   \u2502\n</code></pre>"},{"location":"chatbot/readme/#client-side-tool-execution","title":"Client-Side Tool Execution","text":"<p>When the AI requests a tool call:</p> <ol> <li><code>TOOL_CALL_START</code> - Widget receives tool name and ID</li> <li><code>TOOL_CALL_ARGS</code> - Widget accumulates JSON arguments</li> <li><code>TOOL_CALL_END</code> - Widget executes the local handler</li> <li>Result is displayed in chat (future: sent back to continue conversation)</li> </ol>"},{"location":"chatbot/readme/#key-files","title":"Key Files","text":"<ul> <li><code>lib/agui-client.ts</code> - Low-level AG-UI protocol implementation</li> <li><code>hooks/useAGUIChat.ts</code> - React hook managing chat state and streaming</li> <li><code>components/Chat.tsx</code> - Chat UI with message rendering</li> <li><code>components/ChatWidget.tsx</code> - Floating bubble wrapper</li> <li><code>widget/index.tsx</code> - Standalone bundle entry point</li> </ul>"},{"location":"chatbot/readme/#customization","title":"Customization","text":""},{"location":"chatbot/readme/#styling","title":"Styling","text":"<p>The widget includes embedded CSS to work without external dependencies. To customize:</p> <ol> <li>Widget bundle - Modify styles in <code>widget/index.tsx</code> <code>injectStyles()</code> function</li> <li>Next.js app - Edit <code>app/globals.css</code> and Tailwind config</li> </ol>"},{"location":"chatbot/readme/#adding-built-in-tools","title":"Adding Built-in Tools","text":"<p>Edit <code>components/Chat.tsx</code> <code>useClientTools()</code> to add tools available to all users:</p> <pre><code>function useClientTools(): ToolDefinition[] {\n  return useMemo(() =&gt; [\n    // Existing get_current_time tool...\n    {\n      name: \"my_new_tool\",\n      description: \"Description for the AI\",\n      parameters: { /* JSON Schema */ },\n      handler: async (args) =&gt; {\n        // Implementation\n        return { result: \"...\" };\n      }\n    }\n  ], []);\n}\n</code></pre>"},{"location":"chatbot/readme/#theming","title":"Theming","text":"<p>The widget accepts a <code>bubbleColor</code> prop. For deeper theming, modify the <code>ChatWidget.tsx</code> component or extend the configuration.</p>"},{"location":"chatbot/readme/#troubleshooting","title":"Troubleshooting","text":""},{"location":"chatbot/readme/#failed-to-create-thread-error","title":"\"Failed to create thread\" Error","text":"<ul> <li>Verify backend is running at the configured <code>baseUrl</code></li> <li>Check CORS settings on the backend</li> <li>Ensure the room exists and user has access</li> </ul>"},{"location":"chatbot/readme/#no-messages-appearing","title":"No Messages Appearing","text":"<ul> <li>Check browser console for event type mismatches</li> <li>Verify backend sends UPPERCASE event types (<code>TEXT_MESSAGE_START</code>, not <code>text_message_start</code>)</li> <li>Check that <code>messageId</code> field exists in events (not <code>message_id</code>)</li> </ul>"},{"location":"chatbot/readme/#widget-not-rendering","title":"Widget Not Rendering","text":"<ul> <li>Ensure <code>SoliplexChat.init()</code> is called after the script loads</li> <li>Check for JavaScript errors in console</li> <li>Verify container element doesn't have conflicting CSS</li> </ul>"},{"location":"chatbot/readme/#tool-not-executing","title":"Tool Not Executing","text":"<ul> <li>Confirm handler function exists before <code>init()</code> is called</li> <li>Check the handler path is correct (e.g., <code>\"window.myTools.func\"</code> vs <code>\"myTools.func\"</code>)</li> <li>Ensure handler is async or returns a Promise</li> </ul>"},{"location":"chatbot/readme/#related-documentation","title":"Related Documentation","text":"<ul> <li>Widget Usage Guide - Embedding and tool examples</li> <li>AG-UI Protocol - Protocol specification</li> <li>PydanticAI - Backend agent framework</li> </ul>"},{"location":"chatbot/usage/","title":"Soliplex Chat Widget - Usage Guide","text":"<p>This guide explains how to embed the Soliplex Chat widget into any website.</p>"},{"location":"chatbot/usage/#quick-start","title":"Quick Start","text":"<p>Add the following to your HTML page:</p> <pre><code>&lt;script src=\"https://your-domain.com/soliplex-chat.js\"&gt;&lt;/script&gt;\n&lt;script&gt;\n  SoliplexChat.init({\n    baseUrl: \"http://localhost:8000\"\n  });\n&lt;/script&gt;\n</code></pre> <p>That's it! A chat bubble will appear in the bottom-right corner of your page. When clicked, users will see a list of available chat rooms to choose from.</p>"},{"location":"chatbot/usage/#configuration-options","title":"Configuration Options","text":"Option Type Default Description <code>baseUrl</code> string required Backend API URL (e.g., <code>http://localhost:8000</code>) <code>roomIds</code> string[] <code>[]</code> Room IDs to show; empty or omit to show all available rooms <code>autoHideSeconds</code> number <code>0</code> Seconds until bubble auto-hides (0 = never hide) <code>position</code> string <code>\"bottom-right\"</code> <code>\"bottom-right\"</code> or <code>\"bottom-left\"</code> <code>bubbleColor</code> string <code>\"#2563eb\"</code> CSS color for the chat bubble <code>title</code> string <code>\"Chat with us\"</code> Title shown in the chat header (room selector screen) <code>placeholder</code> string - Placeholder text for empty chat (overrides room's welcome message) <code>tools</code> array <code>[]</code> Custom client-side tools (see below) <code>containerId</code> string <code>\"soliplex-chat-widget\"</code> DOM element ID for the widget container <p>Note: The <code>roomId</code> option is still supported for backwards compatibility and will be converted to <code>roomIds: [roomId]</code>.</p>"},{"location":"chatbot/usage/#example-with-all-options","title":"Example with All Options","text":"<pre><code>&lt;script src=\"https://your-domain.com/soliplex-chat.js\"&gt;&lt;/script&gt;\n&lt;script&gt;\n  SoliplexChat.init({\n    baseUrl: \"https://api.example.com\",\n    roomIds: [\"support\", \"sales\"],  // Only show these rooms\n    autoHideSeconds: 30,\n    position: \"bottom-left\",\n    bubbleColor: \"#10b981\",\n    title: \"Need help?\",\n    containerId: \"my-chat-widget\"\n  });\n&lt;/script&gt;\n</code></pre>"},{"location":"chatbot/usage/#room-selection-behavior","title":"Room Selection Behavior","text":"<p>The widget fetches available rooms from <code>GET /api/v1/rooms</code> when opened:</p> <ul> <li>No <code>roomIds</code> specified: Shows all available rooms from the backend</li> <li><code>roomIds</code> with multiple IDs: Shows only those rooms, user picks one</li> <li><code>roomIds</code> with single ID: Auto-selects that room, skips room selection</li> <li><code>roomIds</code> with IDs not in backend: Those rooms are filtered out</li> </ul> <p>Once a room is selected, the header shows the room's name and a back button (if multiple rooms are available) to return to room selection.</p>"},{"location":"chatbot/usage/#api-methods","title":"API Methods","text":""},{"location":"chatbot/usage/#soliplexchatinitconfig","title":"<code>SoliplexChat.init(config)</code>","text":"<p>Initializes the widget with the given configuration. Can only be called once. Call <code>destroy()</code> first if you need to reinitialize.</p>"},{"location":"chatbot/usage/#soliplexchatopen","title":"<code>SoliplexChat.open()</code>","text":"<p>Programmatically opens the chat panel.</p> <pre><code>document.getElementById('help-button').addEventListener('click', () =&gt; {\n  SoliplexChat.open();\n});\n</code></pre>"},{"location":"chatbot/usage/#soliplexchatclose","title":"<code>SoliplexChat.close()</code>","text":"<p>Programmatically closes the chat panel.</p>"},{"location":"chatbot/usage/#soliplexchatdestroy","title":"<code>SoliplexChat.destroy()</code>","text":"<p>Completely removes the widget from the page. Useful for cleanup or reinitializing with different config.</p> <pre><code>// Change configuration\nSoliplexChat.destroy();\nSoliplexChat.init({ ...newConfig });\n</code></pre>"},{"location":"chatbot/usage/#auto-hide-feature","title":"Auto-Hide Feature","text":"<p>Set <code>autoHideSeconds</code> to automatically hide the bubble after a period of inactivity:</p> <pre><code>SoliplexChat.init({\n  baseUrl: \"http://localhost:8000\",\n  autoHideSeconds: 15  // Hide after 15 seconds if user hasn't interacted\n});\n</code></pre> <p>The bubble will reappear when the user moves their mouse near the corner where it was positioned.</p>"},{"location":"chatbot/usage/#client-side-tools","title":"Client-Side Tools","text":"<p>Tools allow the AI agent to execute JavaScript functions in the user's browser. This is useful for:</p> <ul> <li>Getting information from the current page</li> <li>Interacting with your application's state</li> <li>Performing client-side actions</li> </ul>"},{"location":"chatbot/usage/#tool-definition-structure","title":"Tool Definition Structure","text":"<pre><code>{\n  name: \"tool_name\",           // Unique identifier (snake_case recommended)\n  description: \"...\",          // What the tool does (helps the AI decide when to use it)\n  parameters: {                // JSON Schema for the tool's arguments\n    type: \"object\",\n    properties: {\n      param1: { type: \"string\", description: \"...\" },\n      param2: { type: \"number\", description: \"...\" }\n    },\n    required: [\"param1\"]       // Optional: list of required parameters\n  },\n  handler: \"path.to.function\"  // String path OR inline function\n}\n</code></pre>"},{"location":"chatbot/usage/#handler-types","title":"Handler Types","text":"<p>String Reference - Points to a function on the <code>window</code> object:</p> <pre><code>window.myApp = {\n  tools: {\n    getUser: async () =&gt; ({ name: \"John\", email: \"john@example.com\" })\n  }\n};\n\n// In config:\nhandler: \"myApp.tools.getUser\"\n</code></pre> <p>Inline Function - Define the handler directly:</p> <pre><code>handler: async (args) =&gt; {\n  return { result: args.value * 2 };\n}\n</code></pre>"},{"location":"chatbot/usage/#examples","title":"Examples","text":""},{"location":"chatbot/usage/#example-1-page-information-tool","title":"Example 1: Page Information Tool","text":"<p>Get information about the current page:</p> <pre><code>&lt;script src=\"soliplex-chat.js\"&gt;&lt;/script&gt;\n&lt;script&gt;\n  window.pageTools = {\n    getPageInfo: async () =&gt; ({\n      title: document.title,\n      url: window.location.href,\n      referrer: document.referrer,\n      scrollPosition: window.scrollY,\n      viewportHeight: window.innerHeight,\n      documentHeight: document.documentElement.scrollHeight\n    })\n  };\n\n  SoliplexChat.init({\n    baseUrl: \"http://localhost:8000\",\n    roomIds: [\"support\"],\n    tools: [\n      {\n        name: \"get_page_info\",\n        description: \"Get information about the current page including URL, title, and scroll position\",\n        parameters: { type: \"object\", properties: {} },\n        handler: \"pageTools.getPageInfo\"\n      }\n    ]\n  });\n&lt;/script&gt;\n</code></pre>"},{"location":"chatbot/usage/#example-2-e-commerce-tools","title":"Example 2: E-commerce Tools","text":"<p>Tools for an e-commerce site:</p> <pre><code>&lt;script src=\"soliplex-chat.js\"&gt;&lt;/script&gt;\n&lt;script&gt;\n  window.shopTools = {\n    getCart: async () =&gt; {\n      // Your cart implementation\n      const cart = JSON.parse(localStorage.getItem('cart') || '[]');\n      return {\n        items: cart,\n        itemCount: cart.length,\n        total: cart.reduce((sum, item) =&gt; sum + item.price * item.quantity, 0)\n      };\n    },\n\n    addToCart: async ({ productId, quantity = 1 }) =&gt; {\n      const cart = JSON.parse(localStorage.getItem('cart') || '[]');\n      const existing = cart.find(item =&gt; item.productId === productId);\n\n      if (existing) {\n        existing.quantity += quantity;\n      } else {\n        // Fetch product details from your API\n        cart.push({ productId, quantity, price: 29.99, name: `Product ${productId}` });\n      }\n\n      localStorage.setItem('cart', JSON.stringify(cart));\n      return { success: true, cartSize: cart.length };\n    },\n\n    searchProducts: async ({ query, category }) =&gt; {\n      // Mock search - replace with your API\n      return {\n        results: [\n          { id: \"1\", name: \"Blue T-Shirt\", price: 29.99, category: \"clothing\" },\n          { id: \"2\", name: \"Red Sneakers\", price: 89.99, category: \"shoes\" }\n        ].filter(p =&gt;\n          p.name.toLowerCase().includes(query.toLowerCase()) &amp;&amp;\n          (!category || p.category === category)\n        )\n      };\n    }\n  };\n\n  SoliplexChat.init({\n    baseUrl: \"http://localhost:8000\",\n    roomIds: [\"shop-assistant\"],\n    bubbleColor: \"#f97316\",\n    title: \"Shopping Assistant\",\n    tools: [\n      {\n        name: \"get_cart\",\n        description: \"Get the current shopping cart contents and total\",\n        parameters: { type: \"object\", properties: {} },\n        handler: \"shopTools.getCart\"\n      },\n      {\n        name: \"add_to_cart\",\n        description: \"Add a product to the shopping cart\",\n        parameters: {\n          type: \"object\",\n          properties: {\n            productId: {\n              type: \"string\",\n              description: \"The product ID to add\"\n            },\n            quantity: {\n              type: \"number\",\n              description: \"Quantity to add (default: 1)\"\n            }\n          },\n          required: [\"productId\"]\n        },\n        handler: \"shopTools.addToCart\"\n      },\n      {\n        name: \"search_products\",\n        description: \"Search for products by name or category\",\n        parameters: {\n          type: \"object\",\n          properties: {\n            query: {\n              type: \"string\",\n              description: \"Search query\"\n            },\n            category: {\n              type: \"string\",\n              description: \"Optional category filter\"\n            }\n          },\n          required: [\"query\"]\n        },\n        handler: \"shopTools.searchProducts\"\n      }\n    ]\n  });\n&lt;/script&gt;\n</code></pre>"},{"location":"chatbot/usage/#example-3-form-helper-tools","title":"Example 3: Form Helper Tools","text":"<p>Tools to help users fill out forms:</p> <pre><code>&lt;script src=\"soliplex-chat.js\"&gt;&lt;/script&gt;\n&lt;script&gt;\n  window.formTools = {\n    getFormFields: async () =&gt; {\n      const form = document.querySelector('form');\n      if (!form) return { error: \"No form found on page\" };\n\n      const fields = Array.from(form.elements)\n        .filter(el =&gt; el.name)\n        .map(el =&gt; ({\n          name: el.name,\n          type: el.type,\n          label: document.querySelector(`label[for=\"${el.id}\"]`)?.textContent || el.name,\n          value: el.value,\n          required: el.required\n        }));\n\n      return { fields };\n    },\n\n    fillField: async ({ fieldName, value }) =&gt; {\n      const field = document.querySelector(`[name=\"${fieldName}\"]`);\n      if (!field) return { error: `Field \"${fieldName}\" not found` };\n\n      field.value = value;\n      field.dispatchEvent(new Event('input', { bubbles: true }));\n      field.dispatchEvent(new Event('change', { bubbles: true }));\n\n      return { success: true, field: fieldName, newValue: value };\n    },\n\n    validateForm: async () =&gt; {\n      const form = document.querySelector('form');\n      if (!form) return { error: \"No form found\" };\n\n      const errors = [];\n      form.querySelectorAll('[required]').forEach(field =&gt; {\n        if (!field.value.trim()) {\n          errors.push({\n            field: field.name,\n            message: `${field.name} is required`\n          });\n        }\n      });\n\n      return {\n        valid: errors.length === 0,\n        errors\n      };\n    }\n  };\n\n  SoliplexChat.init({\n    baseUrl: \"http://localhost:8000\",\n    roomIds: [\"form-helper\"],\n    title: \"Form Assistant\",\n    tools: [\n      {\n        name: \"get_form_fields\",\n        description: \"Get all form fields on the current page with their labels and values\",\n        parameters: { type: \"object\", properties: {} },\n        handler: \"formTools.getFormFields\"\n      },\n      {\n        name: \"fill_field\",\n        description: \"Fill a form field with a value\",\n        parameters: {\n          type: \"object\",\n          properties: {\n            fieldName: { type: \"string\", description: \"The name attribute of the field\" },\n            value: { type: \"string\", description: \"The value to set\" }\n          },\n          required: [\"fieldName\", \"value\"]\n        },\n        handler: \"formTools.fillField\"\n      },\n      {\n        name: \"validate_form\",\n        description: \"Check if all required form fields are filled\",\n        parameters: { type: \"object\", properties: {} },\n        handler: \"formTools.validateForm\"\n      }\n    ]\n  });\n&lt;/script&gt;\n</code></pre>"},{"location":"chatbot/usage/#example-4-user-context-tools","title":"Example 4: User Context Tools","text":"<p>Tools that provide user context to the AI:</p> <pre><code>&lt;script src=\"soliplex-chat.js\"&gt;&lt;/script&gt;\n&lt;script&gt;\n  window.userTools = {\n    getUserInfo: async () =&gt; {\n      // Get from your auth system\n      const user = JSON.parse(localStorage.getItem('user') || 'null');\n      return user ? {\n        loggedIn: true,\n        name: user.name,\n        email: user.email,\n        memberSince: user.createdAt,\n        plan: user.subscription\n      } : {\n        loggedIn: false\n      };\n    },\n\n    getPreferences: async () =&gt; {\n      return {\n        theme: localStorage.getItem('theme') || 'light',\n        language: navigator.language,\n        timezone: Intl.DateTimeFormat().resolvedOptions().timeZone,\n        notifications: localStorage.getItem('notifications') === 'true'\n      };\n    },\n\n    getBrowserInfo: async () =&gt; ({\n      userAgent: navigator.userAgent,\n      platform: navigator.platform,\n      language: navigator.language,\n      cookiesEnabled: navigator.cookieEnabled,\n      screenSize: `${screen.width}x${screen.height}`,\n      windowSize: `${window.innerWidth}x${window.innerHeight}`\n    })\n  };\n\n  SoliplexChat.init({\n    baseUrl: \"http://localhost:8000\",\n    roomIds: [\"support\"],\n    tools: [\n      {\n        name: \"get_user_info\",\n        description: \"Get information about the currently logged in user\",\n        parameters: { type: \"object\", properties: {} },\n        handler: \"userTools.getUserInfo\"\n      },\n      {\n        name: \"get_preferences\",\n        description: \"Get the user's preferences and settings\",\n        parameters: { type: \"object\", properties: {} },\n        handler: \"userTools.getPreferences\"\n      },\n      {\n        name: \"get_browser_info\",\n        description: \"Get technical information about the user's browser for debugging\",\n        parameters: { type: \"object\", properties: {} },\n        handler: \"userTools.getBrowserInfo\"\n      }\n    ]\n  });\n&lt;/script&gt;\n</code></pre>"},{"location":"chatbot/usage/#example-5-navigation-tools","title":"Example 5: Navigation Tools","text":"<p>Tools to help users navigate your site:</p> <pre><code>&lt;script src=\"soliplex-chat.js\"&gt;&lt;/script&gt;\n&lt;script&gt;\n  window.navTools = {\n    navigateTo: async ({ path }) =&gt; {\n      window.location.href = path;\n      return { navigating: true, destination: path };\n    },\n\n    scrollToSection: async ({ sectionId }) =&gt; {\n      const element = document.getElementById(sectionId);\n      if (!element) return { error: `Section \"${sectionId}\" not found` };\n\n      element.scrollIntoView({ behavior: 'smooth' });\n      return { success: true, scrolledTo: sectionId };\n    },\n\n    getSiteMap: async () =&gt; {\n      // Return your site structure\n      return {\n        pages: [\n          { path: \"/\", name: \"Home\" },\n          { path: \"/products\", name: \"Products\" },\n          { path: \"/about\", name: \"About Us\" },\n          { path: \"/contact\", name: \"Contact\" },\n          { path: \"/faq\", name: \"FAQ\" }\n        ]\n      };\n    },\n\n    highlightElement: async ({ selector }) =&gt; {\n      const element = document.querySelector(selector);\n      if (!element) return { error: \"Element not found\" };\n\n      const originalOutline = element.style.outline;\n      element.style.outline = \"3px solid #2563eb\";\n      element.scrollIntoView({ behavior: 'smooth', block: 'center' });\n\n      setTimeout(() =&gt; {\n        element.style.outline = originalOutline;\n      }, 3000);\n\n      return { success: true, highlighted: selector };\n    }\n  };\n\n  SoliplexChat.init({\n    baseUrl: \"http://localhost:8000\",\n    roomIds: [\"navigator\"],\n    title: \"Site Guide\",\n    tools: [\n      {\n        name: \"navigate_to\",\n        description: \"Navigate to a different page on the site\",\n        parameters: {\n          type: \"object\",\n          properties: {\n            path: { type: \"string\", description: \"The URL path to navigate to\" }\n          },\n          required: [\"path\"]\n        },\n        handler: \"navTools.navigateTo\"\n      },\n      {\n        name: \"scroll_to_section\",\n        description: \"Scroll to a specific section on the current page\",\n        parameters: {\n          type: \"object\",\n          properties: {\n            sectionId: { type: \"string\", description: \"The ID of the section to scroll to\" }\n          },\n          required: [\"sectionId\"]\n        },\n        handler: \"navTools.scrollToSection\"\n      },\n      {\n        name: \"get_site_map\",\n        description: \"Get a list of all pages on the site\",\n        parameters: { type: \"object\", properties: {} },\n        handler: \"navTools.getSiteMap\"\n      },\n      {\n        name: \"highlight_element\",\n        description: \"Highlight an element on the page to show the user where something is\",\n        parameters: {\n          type: \"object\",\n          properties: {\n            selector: { type: \"string\", description: \"CSS selector for the element to highlight\" }\n          },\n          required: [\"selector\"]\n        },\n        handler: \"navTools.highlightElement\"\n      }\n    ]\n  });\n&lt;/script&gt;\n</code></pre>"},{"location":"chatbot/usage/#built-in-tools","title":"Built-in Tools","text":"<p>The widget includes a built-in <code>get_current_time</code> tool that returns the current time in the user's local timezone. This is automatically available without any configuration.</p>"},{"location":"chatbot/usage/#troubleshooting","title":"Troubleshooting","text":""},{"location":"chatbot/usage/#widget-doesnt-appear","title":"Widget doesn't appear","text":"<ol> <li>Check browser console for errors</li> <li>Verify <code>baseUrl</code> is correct and the backend is running</li> <li>Ensure the script is loaded before calling <code>init()</code></li> </ol>"},{"location":"chatbot/usage/#tools-not-working","title":"Tools not working","text":"<ol> <li>Check that the handler path is correct (e.g., <code>\"myApp.tools.myFunction\"</code>)</li> <li>Verify the function exists on the <code>window</code> object before <code>init()</code> is called</li> <li>Check browser console for \"Handler not found\" errors</li> <li>Ensure your handler returns a Promise or is an async function</li> </ol>"},{"location":"chatbot/usage/#cors-errors","title":"CORS errors","text":"<p>Ensure your backend allows requests from your frontend domain:</p> <pre><code># FastAPI example\nfrom fastapi.middleware.cors import CORSMiddleware\n\napp.add_middleware(\n    CORSMiddleware,\n    allow_origins=[\"http://localhost:3000\", \"https://yourdomain.com\"],\n    allow_methods=[\"*\"],\n    allow_headers=[\"*\"],\n)\n</code></pre>"},{"location":"flutter/","title":"Soliplex Flutter Documentation","text":"<p>This documentation covers the Soliplex Flutter frontend - a cross-platform chat application with AG-UI streaming protocol support.</p> <p>The current frontend focuses on core chat functionality with essential features implemented.</p>"},{"location":"flutter/#quick-links","title":"Quick Links","text":"Area Description Developer Setup Environment setup and getting started Codebase Analysis Project structure and architecture Flutter Rules Development conventions and best practices Client Package Pure Dart client library documentation"},{"location":"flutter/#documentation-sections","title":"Documentation Sections","text":""},{"location":"flutter/#guides","title":"Guides","text":"<ul> <li>Developer Setup - Environment setup, dependencies, and build instructions</li> </ul>"},{"location":"flutter/#rules-standards","title":"Rules &amp; Standards","text":"<ul> <li>Flutter Rules - Flutter development conventions and best practices</li> </ul>"},{"location":"flutter/#package-documentation","title":"Package Documentation","text":"<ul> <li>Client Package - soliplex_client architecture and usage</li> </ul>"},{"location":"flutter/#project-overview","title":"Project Overview","text":""},{"location":"flutter/#architecture","title":"Architecture","text":"<p>The project follows a three-layer architecture:</p> <pre><code>flowchart TD\n    A[\"UI Components&lt;br/&gt;(Chat, History, HttpInspector)\"]\n    B[\"Core Frontend&lt;br/&gt;Providers | Navigation | AG-UI Processing\"]\n    C[\"soliplex_client&lt;br/&gt;(Pure Dart package)\"]\n\n    A --&gt; B\n    B --&gt; C\n\n    style A fill:#e1f5ff\n    style B fill:#fff4e1\n    style C fill:#e8f5e9</code></pre>"},{"location":"flutter/#packages","title":"Packages","text":"Package Type Status Description <code>soliplex_client</code> Pure Dart Implemented HTTP/AG-UI client, models, sessions <code>soliplex_client_native</code> Flutter Implemented Native HTTP adapters (iOS/macOS via Cupertino)"},{"location":"flutter/#implemented-features","title":"Implemented Features","text":"<ul> <li>Chat with streaming AI responses</li> <li>Thread history with management</li> <li>HTTP traffic inspector</li> <li>OIDC authentication</li> <li>Multi-room support</li> <li>Quiz feature</li> <li>Responsive layout (desktop/mobile)</li> </ul>"},{"location":"flutter/APPSHELL_EXTRACTION/","title":"AppShell Extraction Branch","text":"<p>Branch: <code>feat/appshell-extraction</code></p> <p>This branch extracts the Soliplex Flutter app into a reusable white-label shell that external teams can customize with their own branding, features, and backend.</p>"},{"location":"flutter/APPSHELL_EXTRACTION/#what-this-branch-does","title":"What This Branch Does","text":""},{"location":"flutter/APPSHELL_EXTRACTION/#before-main-branch","title":"Before (main branch)","text":"<p>The Soliplex app was a monolithic Flutter application with hardcoded:</p> <ul> <li>App name (\"Soliplex\")</li> <li>Backend URL (<code>https://api.soliplex.ai</code>)</li> <li>Theme colors</li> <li>Feature availability</li> <li>Global state scattered throughout</li> </ul>"},{"location":"flutter/APPSHELL_EXTRACTION/#after-this-branch","title":"After (this branch)","text":"<p>The app is now a configurable shell that:</p> <ol> <li>Exports a single entry point: <code>runSoliplexApp(config: SoliplexConfig(...))</code></li> <li>Accepts all customization via <code>SoliplexConfig</code></li> <li>Uses no global state - configuration flows through Riverpod providers</li> <li>Can be imported as a package dependency</li> </ol>"},{"location":"flutter/APPSHELL_EXTRACTION/#architecture","title":"Architecture","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                     White-Label App (e.g., ACME Box)            \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u2502\n\u2502  \u2502  main.dart                                                 \u2502  \u2502\n\u2502  \u2502    runSoliplexApp(config: SoliplexConfig(...))            \u2502  \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2502\n\u2502                              \u2502                                   \u2502\n\u2502                              \u25bc                                   \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u2502\n\u2502  \u2502  soliplex_frontend (this package)                         \u2502  \u2502\n\u2502  \u2502    - SoliplexConfig (branding, features, theme, routes)   \u2502  \u2502\n\u2502  \u2502    - SoliplexApp (MaterialApp + router)                   \u2502  \u2502\n\u2502  \u2502    - All screens, widgets, providers                      \u2502  \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2502\n\u2502                              \u2502                                   \u2502\n\u2502                              \u25bc                                   \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u2502\n\u2502  \u2502  soliplex_client (pure Dart)                              \u2502  \u2502\n\u2502  \u2502    - REST API client                                       \u2502  \u2502\n\u2502  \u2502    - AG-UI protocol                                        \u2502  \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"flutter/APPSHELL_EXTRACTION/#configuration-options","title":"Configuration Options","text":""},{"location":"flutter/APPSHELL_EXTRACTION/#soliplexconfig","title":"SoliplexConfig","text":"<pre><code>const config = SoliplexConfig(\n  appName: 'ACME Box',                           // Display name\n  defaultBackendUrl: 'https://api.acme.com',     // API endpoint\n  features: Features(...),                        // Feature flags\n  theme: ThemeConfig(...),                        // Custom colors\n  routes: RouteConfig(...),                       // Navigation\n);\n</code></pre>"},{"location":"flutter/APPSHELL_EXTRACTION/#features","title":"Features","text":"Flag Default Description <code>enableHttpInspector</code> <code>true</code> Show HTTP traffic inspector <code>enableQuizzes</code> <code>true</code> Enable quiz feature <code>enableSettings</code> <code>true</code> Show settings screen <code>showVersionInfo</code> <code>true</code> Display version in settings"},{"location":"flutter/APPSHELL_EXTRACTION/#themeconfig","title":"ThemeConfig","text":"<pre><code>ThemeConfig(\n  lightColors: SoliplexColors(\n    background: Color(0xFFFFFFFF),\n    foreground: Color(0xFF000000),\n    primary: Color(0xFF6200EE),\n    // ... 15 color tokens total\n  ),\n  darkColors: SoliplexColors(...),\n)\n</code></pre>"},{"location":"flutter/APPSHELL_EXTRACTION/#routeconfig","title":"RouteConfig","text":"<pre><code>RouteConfig(\n  showHomeRoute: true,      // Show home/connect screen\n  showRoomsRoute: true,     // Show rooms list\n  initialRoute: '/rooms',   // Starting route\n)\n</code></pre>"},{"location":"flutter/APPSHELL_EXTRACTION/#file-organization","title":"File Organization","text":"<pre><code>lib/\n\u251c\u2500\u2500 soliplex_frontend.dart      # Public API exports\n\u251c\u2500\u2500 run_soliplex_app.dart       # Entry point function\n\u251c\u2500\u2500 app.dart                    # SoliplexApp widget\n\u251c\u2500\u2500 core/\n\u2502   \u251c\u2500\u2500 models/\n\u2502   \u2502   \u251c\u2500\u2500 soliplex_config.dart   # Root config\n\u2502   \u2502   \u251c\u2500\u2500 features.dart          # Feature flags\n\u2502   \u2502   \u251c\u2500\u2500 theme_config.dart      # Theme wrapper\n\u2502   \u2502   \u2514\u2500\u2500 route_config.dart      # Navigation config\n\u2502   \u251c\u2500\u2500 providers/\n\u2502   \u2502   \u251c\u2500\u2500 shell_config_provider.dart  # Injected config\n\u2502   \u2502   \u2514\u2500\u2500 config_provider.dart        # Runtime state\n\u2502   \u2514\u2500\u2500 router/\n\u2502       \u2514\u2500\u2500 app_router.dart        # GoRouter setup\n\u251c\u2500\u2500 design/\n\u2502   \u2514\u2500\u2500 tokens/\n\u2502       \u2514\u2500\u2500 colors.dart            # SoliplexColors\n\u2514\u2500\u2500 features/                      # Screen implementations\n</code></pre>"},{"location":"flutter/APPSHELL_EXTRACTION/#testing-with-whitelabel","title":"Testing with Whitelabel","text":"<p>The soliplex/whitelabel repository provides an example white-label app that consumes this package.</p>"},{"location":"flutter/APPSHELL_EXTRACTION/#local-development-setup","title":"Local Development Setup","text":"<ol> <li>Clone both repositories side-by-side:</li> </ol> <pre><code>cd ~/dev\ngit clone https://github.com/soliplex/flutter.git soliplex-flutter\ngit clone https://github.com/soliplex/whitelabel.git whitelabel\n</code></pre> <ol> <li>Checkout the appshell branch:</li> </ol> <pre><code>cd soliplex-flutter\ngit checkout feat/appshell-extraction\n</code></pre> <ol> <li>Configure whitelabel to use local path:</li> </ol> <pre><code># ~/dev/whitelabel/pubspec.yaml\ndependencies:\n  soliplex_frontend:\n    path: ../soliplex-flutter\n</code></pre> <ol> <li>Run the whitelabel app:</li> </ol> <pre><code>cd ~/dev/whitelabel\nflutter pub get\nflutter run -d macos   # or -d chrome --web-port 59003\n</code></pre>"},{"location":"flutter/APPSHELL_EXTRACTION/#running-integration-tests","title":"Running Integration Tests","text":"<p>Integration tests require a running Soliplex backend:</p> <pre><code># Terminal 1: Start backend\ncd ~/path/to/soliplex-backend\nsoliplex-cli serve example/minimal.yaml --no-auth-mode\n\n# Terminal 2: Run integration tests\ncd ~/dev/soliplex-flutter\nSOLIPLEX_BACKEND_URL=http://localhost:8000 \\\n  flutter test integration_tests/ -d macos\n</code></pre>"},{"location":"flutter/APPSHELL_EXTRACTION/#verifying-white-label-customization","title":"Verifying White-Label Customization","text":"<ol> <li>Custom branding: The whitelabel app shows \"ACME Box\" in titles</li> <li>Custom colors: Uses DOS-green terminal theme</li> <li>Feature flags: HTTP inspector disabled</li> <li>Backend URL: Points to custom API endpoint</li> </ol>"},{"location":"flutter/APPSHELL_EXTRACTION/#testing-configuration-changes","title":"Testing Configuration Changes","text":"<p>Edit <code>~/dev/whitelabel/lib/main.dart</code>:</p> <pre><code>runSoliplexApp(\n  config: const SoliplexConfig(\n    appName: 'Test Brand',\n    defaultBackendUrl: 'http://localhost:8000',\n    features: Features(\n      enableHttpInspector: true,  // Enable for debugging\n      enableQuizzes: false,       // Disable quizzes\n    ),\n  ),\n);\n</code></pre> <p>Hot reload preserves the config changes.</p>"},{"location":"flutter/APPSHELL_EXTRACTION/#key-commits","title":"Key Commits","text":"Commit Description <code>1d888e0</code> Initial extraction - <code>runSoliplexApp</code>, <code>SoliplexConfig</code> <code>a54e81b</code> Remove global state from shell config provider <code>9b1d81d</code> Wire <code>defaultBackendUrl</code>, remove remaining global state <code>f0c22a0</code> Simplify route config, enhance router tests"},{"location":"flutter/APPSHELL_EXTRACTION/#production-deployment","title":"Production Deployment","text":"<p>For production, switch to git dependency:</p> <pre><code># pubspec.yaml\ndependencies:\n  soliplex_frontend:\n    git:\n      url: https://github.com/soliplex/flutter.git\n      ref: feat/appshell-extraction  # or main after merge\n</code></pre>"},{"location":"flutter/APPSHELL_EXTRACTION/#whats-not-included-v1","title":"What's NOT Included (v1)","text":"<p>This branch focuses on the shell extraction. The following are out of scope:</p> <ul> <li>Documentation generation (dartdoc)</li> <li>Example app within this repo</li> <li>Custom route injection</li> <li>Screen replacement via builders</li> <li>Provider injection for analytics/services</li> </ul>"},{"location":"flutter/APPSHELL_EXTRACTION/#roadmap-configuration-vs-composition","title":"Roadmap: Configuration vs Composition","text":""},{"location":"flutter/APPSHELL_EXTRACTION/#current-v1-configuration-based-skinning","title":"Current: v1 Configuration-Based (Skinning)","text":"<p>The current architecture is configuration-based whitelabeling. Consumers can:</p> <ul> <li>Customize branding (app name, colors, theme)</li> <li>Toggle features on/off</li> <li>Configure backend URL</li> <li>Control which routes are visible</li> </ul> <p>This covers ~80% of typical whitelabel needs.</p>"},{"location":"flutter/APPSHELL_EXTRACTION/#future-v2-composition-based-framework","title":"Future: v2 Composition-Based (Framework)","text":"<p>If customer demand requires it, v2 will evolve to composition-based whitelabeling where consumers can inject custom functionality:</p> Capability v1 (Current) v2 (Future) Custom theme/colors \u2705 \u2705 Feature toggles \u2705 \u2705 Backend URL \u2705 \u2705 Hide/show routes \u2705 \u2705 Add custom routes \u274c \u2705 Replace core screens \u274c \u2705 Inject providers (analytics, etc.) \u274c \u2705 Own <code>runApp()</code> entry point \u274c \u2705"},{"location":"flutter/APPSHELL_EXTRACTION/#v2-migration-path","title":"v2 Migration Path","text":"<p>When v2 is needed, the changes involve:</p> <ol> <li>Invert control: Return <code>Widget</code> instead of calling <code>runApp()</code>, letting    consumers wrap with their own <code>ProviderScope</code></li> <li>Open the router: Add <code>additionalRoutes</code> parameter to <code>SoliplexConfig</code></li> <li>Widget builders: Add <code>ScreenBuilders</code> for replacing Login, Home, etc.</li> <li>Provider injection: Define interfaces (e.g., <code>AnalyticsService</code>) that    consumers can override</li> </ol>"},{"location":"flutter/CODEBASE_ANALYSIS/","title":"Soliplex Frontend Codebase Analysis","text":"<p>Last updated: January 2026</p> <p>Note: File counts and structure in this document reflect the codebase as of the last update. Run <code>find lib -name \"*.dart\" | wc -l</code> to get current counts.</p>"},{"location":"flutter/CODEBASE_ANALYSIS/#1-project-structure","title":"1. Project Structure","text":"<pre><code>frontend/\n\u251c\u2500\u2500 lib/                              # Main Flutter app (~79 Dart files)\n\u2502   \u251c\u2500\u2500 main.dart                     # Entry point with ProviderScope\n\u2502   \u251c\u2500\u2500 app.dart                      # Root SoliplexApp widget\n\u2502   \u251c\u2500\u2500 core/                         # Infrastructure layer\n\u2502   \u2502   \u251c\u2500\u2500 auth/                     # Authentication (14 files)\n\u2502   \u2502   \u2502   \u251c\u2500\u2500 auth_state.dart       # Sealed class: Unauthenticated|Authenticated|AuthLoading|NoAuthRequired\n\u2502   \u2502   \u2502   \u251c\u2500\u2500 auth_provider.dart    # Main auth notifier provider\n\u2502   \u2502   \u2502   \u251c\u2500\u2500 auth_notifier.dart    # Auth state management\n\u2502   \u2502   \u2502   \u251c\u2500\u2500 auth_flow*.dart       # Platform-specific OAuth flows (native, web)\n\u2502   \u2502   \u2502   \u251c\u2500\u2500 auth_storage*.dart    # Platform-specific token storage (native, web)\n\u2502   \u2502   \u2502   \u2514\u2500\u2500 oidc_issuer.dart      # OIDC issuer management\n\u2502   \u2502   \u251c\u2500\u2500 models/                   # Core data models\n\u2502   \u2502   \u2502   \u251c\u2500\u2500 active_run_state.dart # Sealed class: IdleState|RunningState|CompletedState\n\u2502   \u2502   \u2502   \u2514\u2500\u2500 app_config.dart       # App configuration (baseUrl)\n\u2502   \u2502   \u251c\u2500\u2500 providers/                # Riverpod state management (12 providers)\n\u2502   \u2502   \u2502   \u251c\u2500\u2500 api_provider.dart     # SoliplexApi with HTTP transport\n\u2502   \u2502   \u2502   \u251c\u2500\u2500 active_run_provider.dart\n\u2502   \u2502   \u2502   \u251c\u2500\u2500 active_run_notifier.dart\n\u2502   \u2502   \u2502   \u251c\u2500\u2500 config_provider.dart\n\u2502   \u2502   \u2502   \u251c\u2500\u2500 rooms_provider.dart\n\u2502   \u2502   \u2502   \u251c\u2500\u2500 threads_provider.dart\n\u2502   \u2502   \u2502   \u251c\u2500\u2500 thread_message_cache.dart\n\u2502   \u2502   \u2502   \u251c\u2500\u2500 backend_health_provider.dart\n\u2502   \u2502   \u2502   \u251c\u2500\u2500 backend_version_provider.dart\n\u2502   \u2502   \u2502   \u251c\u2500\u2500 http_log_provider.dart\n\u2502   \u2502   \u2502   \u251c\u2500\u2500 package_info_provider.dart\n\u2502   \u2502   \u2502   \u2514\u2500\u2500 quiz_provider.dart\n\u2502   \u2502   \u251c\u2500\u2500 router/\n\u2502   \u2502   \u2502   \u2514\u2500\u2500 app_router.dart       # GoRouter (8 routes)\n\u2502   \u2502   \u2514\u2500\u2500 constants/\n\u2502   \u2502       \u2514\u2500\u2500 breakpoints.dart      # Responsive breakpoints\n\u2502   \u251c\u2500\u2500 features/                     # Feature screens\n\u2502   \u2502   \u251c\u2500\u2500 auth/                     # OAuth callback handler\n\u2502   \u2502   \u251c\u2500\u2500 home/                     # Backend URL configuration\n\u2502   \u2502   \u251c\u2500\u2500 login/                    # OIDC login UI\n\u2502   \u2502   \u251c\u2500\u2500 rooms/                    # Room list\n\u2502   \u2502   \u251c\u2500\u2500 room/                     # Room view with threads\n\u2502   \u2502   \u251c\u2500\u2500 chat/                     # Chat messaging (4 files)\n\u2502   \u2502   \u251c\u2500\u2500 history/                  # Thread list sidebar (3 files)\n\u2502   \u2502   \u251c\u2500\u2500 inspector/                # HTTP traffic debugger (5 files)\n\u2502   \u2502   \u2514\u2500\u2500 settings/                 # Settings screen\n\u2502   \u2514\u2500\u2500 shared/                       # Reusable components\n\u2502       \u251c\u2500\u2500 widgets/                  # AppShell, AsyncValueHandler, etc.\n\u2502       \u2514\u2500\u2500 utils/                    # Date formatting, utilities\n\u2502\n\u251c\u2500\u2500 packages/soliplex_client/         # Pure Dart package (NO Flutter, ~34 files)\n\u2502   \u251c\u2500\u2500 lib/src/\n\u2502   \u2502   \u251c\u2500\u2500 api/                      # REST API client\n\u2502   \u2502   \u251c\u2500\u2500 application/              # AG-UI application facade\n\u2502   \u2502   \u251c\u2500\u2500 auth/                     # OIDC discovery, token refresh\n\u2502   \u2502   \u251c\u2500\u2500 domain/                   # Data models\n\u2502   \u2502   \u251c\u2500\u2500 http/                     # HTTP abstraction layer\n\u2502   \u2502   \u251c\u2500\u2500 errors/                   # Exception hierarchy\n\u2502   \u2502   \u2514\u2500\u2500 utils/                    # Utilities\n\u2502   \u2514\u2500\u2500 test/                         # ~23 test files\n\u2502\n\u251c\u2500\u2500 packages/soliplex_client_native/  # Flutter package - Native HTTP (~8 files)\n\u2502   \u2514\u2500\u2500 lib/src/\n\u2502       \u251c\u2500\u2500 platform/                 # Platform-specific factory\n\u2502       \u2514\u2500\u2500 clients/                  # CupertinoHttpClient for iOS/macOS\n\u2502\n\u251c\u2500\u2500 test/                             # Widget and unit tests (~42 files)\n\u251c\u2500\u2500 android/, ios/, macos/, web/      # Platform-specific code\n\u2514\u2500\u2500 pubspec.yaml\n</code></pre>"},{"location":"flutter/CODEBASE_ANALYSIS/#2-architecture","title":"2. Architecture","text":""},{"location":"flutter/CODEBASE_ANALYSIS/#21-three-layer-design","title":"2.1 Three-Layer Design","text":"<pre><code>flowchart TD\n    A[\"UI Components&lt;br/&gt;(Chat, History, HttpInspector)\"]\n    B[\"Core Frontend&lt;br/&gt;Providers | Navigation | AG-UI Processing\"]\n    C[\"soliplex_client&lt;br/&gt;(Pure Dart package)\"]\n\n    A --&gt; B\n    B --&gt; C\n\n    style A fill:#e1f5ff\n    style B fill:#fff4e1\n    style C fill:#e8f5e9</code></pre>"},{"location":"flutter/CODEBASE_ANALYSIS/#22-state-management-riverpod","title":"2.2 State Management: Riverpod","text":"<p>Provider Hierarchy:</p> <pre><code>flowchart TD\n    config[\"configProvider&lt;br/&gt;(StateProvider)\"]\n    url[\"urlBuilderProvider\"]\n    transport[\"httpTransportProvider\"]\n    api[\"apiProvider\"]\n    rooms[\"roomsProvider\"]\n    threads[\"threadsProvider(roomId)\"]\n    current[\"currentRoomIdProvider /&lt;br/&gt;currentThreadIdProvider\"]\n    activeRun[\"activeRunNotifierProvider&lt;br/&gt;(Main streaming orchestration)\"]\n    derived[\"Derived: canSendMessageProvider,&lt;br/&gt;allMessagesProvider, isStreamingProvider\"]\n\n    config --&gt; url\n    config --&gt; transport\n    transport --&gt; api\n    api --&gt; rooms\n    api --&gt; threads\n    rooms --&gt; current\n    threads --&gt; current\n    current --&gt; activeRun\n    activeRun --&gt; derived\n\n    style config fill:#e1f5ff\n    style api fill:#fff4e1\n    style activeRun fill:#ffe1f5\n    style derived fill:#e8f5e9</code></pre>"},{"location":"flutter/CODEBASE_ANALYSIS/#23-http-layer-architecture","title":"2.3 HTTP Layer Architecture","text":"<pre><code>flowchart TD\n    api[\"SoliplexApi (REST client)&lt;br/&gt;Layer 3: Business Logic\"]\n    transport[\"HttpTransport&lt;br/&gt;(JSON + Error Mapping)&lt;br/&gt;Layer 2: Transport\"]\n    client[\"SoliplexHttpClient&lt;br/&gt;(Platform abstractions)&lt;br/&gt;Layer 1: Clients\"]\n    dart[\"DartHttpClient (dart:http)\"]\n    cupertino[\"CupertinoHttpClient (NSURLSession)\"]\n\n    api --&gt; transport\n    transport --&gt; client\n    client --&gt; dart\n    client --&gt; cupertino\n\n    style api fill:#e1f5ff\n    style transport fill:#fff4e1\n    style client fill:#ffe1f5\n    style dart fill:#e8f5e9\n    style cupertino fill:#e8f5e9</code></pre>"},{"location":"flutter/CODEBASE_ANALYSIS/#24-navigation-gorouter","title":"2.4 Navigation: GoRouter","text":"Route Screen Description <code>/</code> HomeScreen Backend URL configuration <code>/login</code> LoginScreen OIDC provider selection <code>/auth/callback</code> AuthCallbackScreen OAuth callback handler <code>/rooms</code> RoomsScreen List all rooms <code>/rooms/:roomId</code> RoomScreen Room view with thread selection <code>/rooms/:roomId/thread/:threadId</code> (redirect) Redirects to <code>/rooms/:roomId?thread=:threadId</code> <code>/settings</code> SettingsScreen App config and auth status <p>Responsive Layout:</p> <ul> <li>Desktop (\u2265600px): Sidebar history panel + chat panel side-by-side</li> <li>Mobile (&lt;600px): Chat panel only</li> </ul>"},{"location":"flutter/CODEBASE_ANALYSIS/#3-key-components","title":"3. Key Components","text":""},{"location":"flutter/CODEBASE_ANALYSIS/#31-data-models","title":"3.1 Data Models","text":"<p>ChatMessage:</p> <pre><code>- id: String\n- user: ChatUser (user | assistant | system)\n- type: MessageType (text | error | toolCall | genUi | loading)\n- text: String?\n- isStreaming: bool\n- thinkingText: String?\n- toolCalls: List&lt;ToolCallInfo&gt;?\n- errorMessage: String?\n- createdAt: DateTime\n</code></pre> <p>ActiveRunState (sealed class hierarchy):</p> <pre><code>sealed class ActiveRunState {\n  Conversation get conversation;\n  StreamingState get streaming;\n  List&lt;ChatMessage&gt; get messages;\n  bool get isRunning;\n}\n\nclass IdleState extends ActiveRunState { }      // No active run\nclass RunningState extends ActiveRunState {     // Run executing\n  String get threadId;\n  String get runId;\n  bool get isStreaming;\n}\nclass CompletedState extends ActiveRunState {   // Run finished\n  CompletionResult result;  // Success | FailedResult | CancelledResult\n}\n</code></pre>"},{"location":"flutter/CODEBASE_ANALYSIS/#32-ag-ui-protocol","title":"3.2 AG-UI Protocol","text":"<p>Event Types (sealed class hierarchy):</p> <ul> <li>Run lifecycle: <code>RunStartedEvent</code>, <code>RunFinishedEvent</code>, <code>RunErrorEvent</code></li> <li>Message streaming: <code>TextMessageStartEvent</code>, <code>TextMessageContentEvent</code>, <code>TextMessageEndEvent</code></li> <li>Tool calls: <code>ToolCallStartEvent</code>, <code>ToolCallArgsEvent</code>, <code>ToolCallEndEvent</code>, <code>ToolCallResultEvent</code></li> <li>State: <code>StateSnapshotEvent</code>, <code>StateDeltaEvent</code></li> <li>Activity: <code>ActivitySnapshotEvent</code>, <code>ActivityDeltaEvent</code></li> <li>Messages: <code>MessagesSnapshotEvent</code></li> <li>Custom: <code>CustomEvent</code>, <code>UnknownEvent</code></li> </ul> <p>Streaming Pipeline:</p> <pre><code>flowchart LR\n    A[SSE Stream] --&gt; B[Thread.run]\n    B --&gt; C[Event parsing]\n    C --&gt; D[Buffers]\n    D --&gt; E[ActiveRunNotifier]\n    E --&gt; F[UI]\n\n    style A fill:#e1f5ff\n    style F fill:#e8f5e9</code></pre>"},{"location":"flutter/CODEBASE_ANALYSIS/#33-chat-flow","title":"3.3 Chat Flow","text":"<pre><code>flowchart TD\n    A[User types message]\n    B[ChatInput.onSend text]\n    C[ChatPanel._handleSend]\n    D[Create thread if needed&lt;br/&gt;api.createThread]\n    E[activeRunNotifier.startRun&lt;br/&gt;roomId, threadId, userMessage]\n    F[Creates Thread]\n    G[Subscribes to eventStream]\n    H[Updates ActiveRunState]\n    I[MessageList watches&lt;br/&gt;allMessagesProvider]\n    J[Merges history + run messages]\n    K[Auto-scrolls to bottom]\n\n    A --&gt; B\n    B --&gt; C\n    C --&gt; D\n    C --&gt; E\n    E --&gt; F\n    E --&gt; G\n    E --&gt; H\n    H --&gt; I\n    I --&gt; J\n    I --&gt; K\n\n    style A fill:#e1f5ff\n    style E fill:#ffe1f5\n    style I fill:#fff4e1\n    style K fill:#e8f5e9</code></pre>"},{"location":"flutter/CODEBASE_ANALYSIS/#4-soliplex_client-package","title":"4. soliplex_client Package","text":"<p>Pure Dart - no Flutter dependency. Reusable on web, server, or desktop.</p> <p>Implemented Components:</p> <ul> <li>Models &amp; errors</li> <li>HTTP adapter interface + DartHttpAdapter</li> <li>HttpObserver + ObservableHttpAdapter</li> <li>HttpTransport, UrlBuilder, CancelToken</li> <li>API layer (SoliplexApi)</li> <li>AG-UI protocol (Thread, buffers, tool registry)</li> </ul> <p>Test Coverage: ~600 tests, near 100% coverage</p>"},{"location":"flutter/CODEBASE_ANALYSIS/#5-ui-components","title":"5. UI Components","text":""},{"location":"flutter/CODEBASE_ANALYSIS/#screens","title":"Screens","text":"Screen Purpose HomeScreen Backend URL configuration LoginScreen OIDC provider selection AuthCallbackScreen OAuth callback handler RoomsScreen List rooms from API RoomScreen Room view with thread selection SettingsScreen App config and auth status BackendVersionsScreen Backend version information QuizScreen Quiz feature"},{"location":"flutter/CODEBASE_ANALYSIS/#panels","title":"Panels","text":"Panel Purpose ChatPanel Message list + input, send/cancel/error handling HistoryPanel Thread list, new conversation, auto-selection HttpInspectorPanel HTTP traffic debugging with request grouping"},{"location":"flutter/CODEBASE_ANALYSIS/#shared-widgets","title":"Shared Widgets","text":"<ul> <li><code>AppShell</code>: Main scaffold with AppBar/Sidebar</li> <li><code>AsyncValueHandler</code>: Wraps AsyncValue with error handling</li> <li><code>ErrorDisplay</code>: Exception-aware error UI with retry</li> <li><code>LoadingIndicator</code>: Spinner with optional message</li> <li><code>EmptyState</code>: Icon + message for empty lists</li> </ul>"},{"location":"flutter/CODEBASE_ANALYSIS/#6-testing","title":"6. Testing","text":"<p>Test Coverage:</p> <ul> <li>Frontend: ~42 test files covering auth, providers, features, widgets</li> <li>soliplex_client: ~23 test files</li> <li>Zero analyzer issues</li> </ul> <p>Test Structure:</p> <pre><code>test/\n\u251c\u2500\u2500 core/\n\u2502   \u251c\u2500\u2500 auth/              # Auth layer tests (9 files)\n\u2502   \u251c\u2500\u2500 models/            # Model tests\n\u2502   \u2514\u2500\u2500 providers/         # Provider tests (7 files)\n\u251c\u2500\u2500 features/              # Screen and widget tests\n\u2502   \u251c\u2500\u2500 auth/\n\u2502   \u251c\u2500\u2500 chat/\n\u2502   \u251c\u2500\u2500 history/\n\u2502   \u251c\u2500\u2500 home/\n\u2502   \u251c\u2500\u2500 inspector/\n\u2502   \u251c\u2500\u2500 login/\n\u2502   \u251c\u2500\u2500 room/\n\u2502   \u251c\u2500\u2500 rooms/\n\u2502   \u2514\u2500\u2500 settings/\n\u251c\u2500\u2500 shared/                # Shared widget tests\n\u2514\u2500\u2500 helpers/               # Mocks and utilities\n</code></pre> <p>Key Utilities:</p> <ul> <li><code>MockSoliplexApi</code>: Mock API for testing</li> <li><code>MockActiveRunNotifier</code>: Mock notifier with initial state</li> <li><code>createTestApp()</code>: Helper to create testable app</li> </ul>"},{"location":"flutter/CODEBASE_ANALYSIS/#7-code-quality","title":"7. Code Quality","text":"<p>Analyzer: Zero tolerance - no errors, warnings, or hints</p> <p>Linting:</p> <ul> <li><code>very_good_analysis</code> (strict rules)</li> <li><code>dart format lib test</code> before commits</li> <li><code>markdownlint-cli</code> for markdown</li> </ul> <p>Conventions:</p> <ul> <li>PascalCase: Classes, enums, types</li> <li>camelCase: Variables, functions</li> <li><code>_privateMethod</code>: Private members prefixed</li> </ul>"},{"location":"flutter/CODEBASE_ANALYSIS/#8-notable-patterns","title":"8. Notable Patterns","text":""},{"location":"flutter/CODEBASE_ANALYSIS/#sealed-classes-for-events","title":"Sealed Classes for Events","text":"<pre><code>sealed class AgUiEvent { ... }\nfinal class RunStartedEvent extends AgUiEvent { ... }\n// Enables exhaustive pattern matching\n</code></pre>"},{"location":"flutter/CODEBASE_ANALYSIS/#builder-pattern-for-models","title":"Builder Pattern for Models","text":"<pre><code>ChatMessage.text(...)\nChatMessage.error(...)\nChatMessage.toolCall(...)\n</code></pre>"},{"location":"flutter/CODEBASE_ANALYSIS/#observer-pattern-for-http","title":"Observer Pattern for HTTP","text":"<p><code>ObservableHttpAdapter</code> wraps adapters for request inspection/logging.</p>"},{"location":"flutter/CODEBASE_ANALYSIS/#cancel-token","title":"Cancel Token","text":"<p>Graceful SSE stream cancellation via <code>Completer</code> pattern.</p>"},{"location":"flutter/CODEBASE_ANALYSIS/#responsive-breakpoint","title":"Responsive Breakpoint","text":"<p>600px mobile/desktop boundary in ThreadScreen.</p>"},{"location":"flutter/CODEBASE_ANALYSIS/#9-dependencies","title":"9. Dependencies","text":"<p>Frontend App:</p> <pre><code>flutter_riverpod: ^3.1.0       # State management\ngo_router: ^17.0.0             # Navigation\nflutter_appauth: ^11.0.0       # OIDC flows\nflutter_secure_storage: ^10.0.0 # Secure token storage\nshared_preferences: ^2.5.4     # Config persistence\npackage_info_plus: ^9.0.0      # App version info\nhttp: ^1.2.0                   # HTTP client\nflutter_markdown: ^0.7.4+1     # Message rendering\nflutter_highlight: ^0.7.0      # Code highlighting\nintl: ^0.20.1                  # Localization\nmeta: ^1.15.0                  # Annotations\nsoliplex_client: path          # Pure Dart client\nsoliplex_client_native: path   # Native adapters\n</code></pre> <p>soliplex_client:</p> <pre><code>http: ^1.2.0\nmeta: ^1.9.0\n</code></pre> <p>soliplex_client_native:</p> <pre><code>cupertino_http: ^2.0.0      # NSURLSession\nflutter: &gt;= 3.10.0\nhttp: ^1.2.0\n</code></pre>"},{"location":"flutter/CODEBASE_ANALYSIS/#10-key-architectural-decisions","title":"10. Key Architectural Decisions","text":"<ol> <li>Pure Dart client package - Reusable across platforms without Flutter dependency</li> <li>Sealed classes for state - Type-safe exhaustive pattern matching (ActiveRunState, AuthState, CompletionResult)</li> <li>3-layer HTTP abstraction - Testable adapters, transport, and API layers</li> <li>Platform-optimized adapters - NSURLSession on iOS/macOS for better performance</li> <li>Platform-specific auth - Native Keychain/SecureStorage vs Web localStorage</li> <li>Manual Riverpod providers - Explicit control over provider lifecycle</li> <li>Responsive dual-panel layout - Desktop sidebar with mobile fallback</li> </ol>"},{"location":"flutter/CODEBASE_ANALYSIS/#11-summary","title":"11. Summary","text":"<p>This is a well-architected, production-quality Flutter frontend featuring:</p> <ul> <li>\u2705 Clean 3-layer HTTP abstraction with platform adapters</li> <li>\u2705 Pure Dart client package reusable across platforms</li> <li>\u2705 Sophisticated AG-UI event streaming protocol</li> <li>\u2705 Responsive dual-panel desktop + mobile chat</li> <li>\u2705 OIDC authentication with platform-specific flows</li> <li>\u2705 HTTP traffic inspector for debugging</li> <li>\u2705 Comprehensive error handling with exception hierarchy</li> <li>\u2705 Strict code quality (zero analyzer issues)</li> <li>\u2705 Riverpod state management with clear provider hierarchy</li> <li>\u2705 Sealed classes for type-safe state handling</li> <li>\u2705 Platform-optimized native HTTP adapters</li> </ul>"},{"location":"flutter/adr/001-whitelabel-architecture/","title":"ADR-001: White-Label Architecture for Soliplex Frontend","text":"<p>Status: Accepted</p> <p>Date: 2025-01-21</p> <p>Branch: <code>feat/appshell-extraction</code></p>"},{"location":"flutter/adr/001-whitelabel-architecture/#context","title":"Context","text":"<p>The Soliplex Flutter app was a monolithic application with hardcoded branding, backend URL, and feature configuration. External teams needed to create white-label versions with their own branding and backend, but this required forking the entire codebase.</p> <p>We needed to make the app reusable as a library while:</p> <ul> <li>Minimizing API surface area for maintainability</li> <li>Avoiding breaking changes that would disrupt consumers</li> <li>Supporting future extensibility without over-engineering now</li> </ul>"},{"location":"flutter/adr/001-whitelabel-architecture/#decisions","title":"Decisions","text":""},{"location":"flutter/adr/001-whitelabel-architecture/#1-configuration-based-whitelabeling-v1-scope","title":"1. Configuration-Based Whitelabeling (v1 Scope)","text":"<p>Decision: Implement v1 (configuration-driven) whitelabeling only. Defer v2 (composition-based framework with custom routes, screen replacement, provider injection) until customer demand requires it.</p> <p>Rationale: YAGNI. Configuration covers ~80% of typical whitelabel needs: app name, colors, feature flags, backend URL, route visibility. Building extension points before knowing real requirements leads to wrong abstractions.</p> <p>What consumers CAN customize (v1):</p> <ul> <li>App name and branding</li> <li>Theme colors (15 semantic tokens)</li> <li>Feature flags (HTTP inspector, quizzes, settings, version info)</li> <li>Default backend URL</li> <li>Route visibility (home, rooms)</li> <li>Initial route</li> </ul> <p>What consumers CANNOT customize (deferred to v2):</p> <ul> <li>Add custom routes</li> <li>Replace core screens</li> <li>Inject custom providers</li> <li>Own the <code>runApp()</code> entry point</li> </ul>"},{"location":"flutter/adr/001-whitelabel-architecture/#2-single-entry-point-function","title":"2. Single Entry Point Function","text":"<p>Decision: Expose <code>runSoliplexApp({SoliplexConfig config})</code> as the only entry point. The function calls <code>runApp()</code> internally.</p> <p>Rationale:</p> <ul> <li>Simplest possible API for consumers</li> <li>Encapsulates initialization complexity (OAuth capture, auth storage, package   info loading)</li> <li>Prevents consumers from misconfiguring the <code>ProviderScope</code></li> </ul> <p>Trade-off: Consumers cannot wrap the app with their own providers. This is acceptable for v1; if needed, v2 can return a <code>Widget</code> instead.</p>"},{"location":"flutter/adr/001-whitelabel-architecture/#3-no-global-state","title":"3. No Global State","text":"<p>Decision: All configuration flows through Riverpod providers via <code>ProviderScope.overrides</code>. No static variables, singletons, or global config.</p> <p>Rationale:</p> <ul> <li>Testability: Tests can override any configuration</li> <li>Predictability: No hidden state that varies between runs</li> <li>Hot reload: Config changes apply immediately</li> </ul> <p>Implementation:</p> <pre><code>runApp(\n  ProviderScope(\n    overrides: [\n      shellConfigProvider.overrideWithValue(config),\n      // ... other injected values\n    ],\n    child: const SoliplexApp(),\n  ),\n);\n</code></pre>"},{"location":"flutter/adr/001-whitelabel-architecture/#4-minimal-public-api-surface","title":"4. Minimal Public API Surface","text":"<p>Decision: Export only what external consumers need via <code>lib/soliplex_frontend.dart</code>. Internal implementation details remain private.</p> <p>Exports:</p> <ul> <li><code>runSoliplexApp</code> - Entry point</li> <li><code>SoliplexConfig</code>, <code>Features</code>, <code>RouteConfig</code>, <code>ThemeConfig</code> - Configuration</li> <li><code>SoliplexColors</code>, <code>lightSoliplexColors</code>, <code>darkSoliplexColors</code> - Theming</li> </ul> <p>Rationale: Smaller API surface = fewer breaking changes = happier consumers. Internal refactoring doesn't affect external code.</p>"},{"location":"flutter/adr/001-whitelabel-architecture/#5-api-contract-tests","title":"5. API Contract Tests","text":"<p>Decision: Add compilation-based contract tests that verify every public export can be instantiated with expected parameters. Tests fail to compile if signatures change.</p> <p>Rationale: Breaking changes to public API must be intentional and versioned. Contract tests catch accidental breaks before they reach consumers.</p> <p>Convention: Contract test files include a prominent header:</p> <pre><code>// !! MAJOR VERSION BUMP REQUIRED !!\n//\n// If these tests fail or need modification due to codebase changes, it means\n// the public API has changed in a breaking way. You MUST:\n//\n//   1. Increment the MAJOR version in pubspec.yaml\n//   2. Use a conventional commit with \"BREAKING CHANGE:\" in the footer\n//   3. Update these tests to reflect the new API\n</code></pre>"},{"location":"flutter/adr/001-whitelabel-architecture/#consequences","title":"Consequences","text":""},{"location":"flutter/adr/001-whitelabel-architecture/#positive","title":"Positive","text":"<ul> <li>External teams can create white-label apps with a single function call</li> <li>Public API is small and stable</li> <li>Breaking changes are caught by contract tests before release</li> <li>No global state simplifies testing and debugging</li> <li>Clear upgrade path to v2 if needed</li> </ul>"},{"location":"flutter/adr/001-whitelabel-architecture/#negative","title":"Negative","text":"<ul> <li>Consumers wanting deep customization must wait for v2</li> <li><code>runSoliplexApp()</code> controlling <code>runApp()</code> limits some advanced use cases</li> <li>Contract tests add maintenance overhead when API intentionally changes</li> </ul>"},{"location":"flutter/adr/001-whitelabel-architecture/#neutral","title":"Neutral","text":"<ul> <li>Three-package structure remains: <code>soliplex_frontend</code>, <code>soliplex_client</code>,   <code>soliplex_client_native</code></li> <li>Each package has its own contract tests and versioning</li> </ul>"},{"location":"flutter/adr/001-whitelabel-architecture/#future-considerations-v2","title":"Future Considerations (v2)","text":"<p>If customer demand requires it, v2 migration involves:</p> <ol> <li>Invert control: Return <code>Widget</code> instead of calling <code>runApp()</code></li> <li>Open the router: Add <code>additionalRoutes</code> to <code>SoliplexConfig</code></li> <li>Widget builders: Add <code>ScreenBuilders</code> for replacing Login, Home, etc.</li> <li>Provider injection: Define interfaces consumers can override</li> </ol> <p>These changes would be breaking and require a major version bump.</p>"},{"location":"flutter/adr/001-whitelabel-architecture/#implementation-reference","title":"Implementation Reference","text":"<p>See APPSHELL_EXTRACTION.md for:</p> <ul> <li>Architecture diagrams</li> <li>File organization details</li> <li>Testing and verification procedures</li> <li>Local development setup</li> </ul>"},{"location":"flutter/guides/developer-setup/","title":"Developer Setup Guide","text":"<p>Platform-specific setup instructions for building and running the Soliplex Flutter frontend.</p>"},{"location":"flutter/guides/developer-setup/#prerequisites","title":"Prerequisites","text":"<ul> <li>Flutter SDK (stable channel)</li> <li>Xcode (for iOS/macOS)</li> <li>CocoaPods (<code>gem install cocoapods</code>)</li> </ul>"},{"location":"flutter/guides/developer-setup/#quick-start","title":"Quick Start","text":"<pre><code># Install dependencies\nflutter pub get\n\n# Install iOS/macOS pods\ncd ios &amp;&amp; pod install &amp;&amp; cd ..\ncd macos &amp;&amp; pod install &amp;&amp; cd ..\n\n# Run the app\nflutter run -d macos   # or: -d ios, -d chrome\n</code></pre>"},{"location":"flutter/guides/developer-setup/#platform-setup","title":"Platform Setup","text":""},{"location":"flutter/guides/developer-setup/#macos","title":"macOS","text":""},{"location":"flutter/guides/developer-setup/#code-signing-required-for-keychain","title":"Code Signing (Required for Keychain)","text":"<p>macOS apps require code signing to access Keychain for secure token storage. Each developer must configure their own Apple Developer Team ID:</p> <pre><code># 1. Copy the template\ncp macos/Runner/Configs/Local.xcconfig.template macos/Runner/Configs/Local.xcconfig\n\n# 2. Edit Local.xcconfig and add your Team ID\n</code></pre> <p>Your <code>Local.xcconfig</code> should contain:</p> <pre><code>DEVELOPMENT_TEAM = YOUR_TEAM_ID_HERE\n</code></pre> <p>Both iOS and macOS use Xcode's automatic signing, which selects the correct identity based on build type (development vs release).</p> <p>Finding your Team ID:</p> <ol> <li>Go to https://developer.apple.com/account</li> <li>Click \"Membership details\"</li> <li>Copy the 10-character Team ID (e.g., <code>XXXXXXXXXX</code>)</li> </ol> <p>Verification:</p> <pre><code>flutter build macos --debug\n</code></pre> <p>If configured correctly, Keychain operations succeed and auth tokens persist across app restarts.</p> <p>Without code signing: The app runs but Keychain fails silently. Auth works per-session but tokens don't persist, requiring re-login on each launch.</p>"},{"location":"flutter/guides/developer-setup/#ios","title":"iOS","text":""},{"location":"flutter/guides/developer-setup/#code-signing-required-for-physical-devices","title":"Code Signing (Required for Physical Devices)","text":"<p>iOS uses the same xcconfig pattern as macOS:</p> <pre><code># 1. Copy the template\ncp ios/Runner/Configs/Local.xcconfig.template ios/Runner/Configs/Local.xcconfig\n\n# 2. Edit Local.xcconfig and add your Team ID\n</code></pre> <p>Your <code>Local.xcconfig</code> should contain:</p> <pre><code>DEVELOPMENT_TEAM = YOUR_TEAM_ID_HERE\n</code></pre>"},{"location":"flutter/guides/developer-setup/#simulator-vs-device","title":"Simulator vs Device","text":"<ul> <li>Simulator: No signing required for debug builds</li> <li>Physical device: Requires <code>Local.xcconfig</code> with valid <code>DEVELOPMENT_TEAM</code></li> </ul>"},{"location":"flutter/guides/developer-setup/#building-for-testflightapp-store","title":"Building for TestFlight/App Store","text":"<p>CRITICAL: Use Flutter stable channel for production builds. Beta/dev channels can produce binaries that fail App Store validation.</p> <pre><code># Verify you're on stable channel\nflutter channel stable\nflutter upgrade\n\n# Build release IPA\nflutter build ipa --release\n\n# Upload using Transporter app\nopen -a Transporter build/ios/ipa/soliplex_frontend.ipa\n\n# Or use command line (requires API key)\nxcrun altool --upload-app --type ios -f build/ios/ipa/soliplex_frontend.ipa \\\n  --apiKey YOUR_API_KEY --apiIssuer YOUR_ISSUER_ID\n</code></pre> <p>The <code>flutter build ipa --release</code> command automatically:</p> <ul> <li>Uses <code>Apple Distribution</code> signing identity</li> <li>Includes debug symbols (dSYM files)</li> <li>Creates properly encrypted binary for App Store submission</li> </ul> <p>Troubleshooting validation errors: If you get \"binary not built with Apple's linker\" errors, ensure you're on Flutter stable channel, not beta or dev.</p>"},{"location":"flutter/guides/developer-setup/#web","title":"Web","text":"<p>No special setup required. Run with:</p> <pre><code>flutter run -d chrome\n</code></pre>"},{"location":"flutter/guides/developer-setup/#troubleshooting","title":"Troubleshooting","text":""},{"location":"flutter/guides/developer-setup/#entitlements-require-signing","title":"Entitlements require signing","text":"<pre><code>\"Runner\" has entitlements that require signing with a development certificate\n</code></pre> <p>Cause: Missing <code>Local.xcconfig</code> or <code>DEVELOPMENT_TEAM</code> not set.</p> <p>Fix: Create <code>Local.xcconfig</code> with <code>DEVELOPMENT_TEAM</code> as shown above.</p>"},{"location":"flutter/guides/developer-setup/#keychain-errors-on-macos","title":"Keychain errors on macOS","text":"<pre><code>OSStatus error -25293\n</code></pre> <p>Cause: Missing or invalid code signing configuration.</p> <p>Fix: Follow the macOS code signing setup above.</p>"},{"location":"flutter/guides/developer-setup/#pod-install-fails","title":"Pod install fails","text":"<pre><code># Clean and reinstall\ncd ios &amp;&amp; pod deintegrate &amp;&amp; pod install &amp;&amp; cd ..\ncd macos &amp;&amp; pod deintegrate &amp;&amp; pod install &amp;&amp; cd ..\n</code></pre>"},{"location":"flutter/guides/developer-setup/#flutter-version-issues","title":"Flutter version issues","text":"<pre><code># Check version\nflutter --version\n\n# Upgrade if needed\nflutter upgrade\n</code></pre>"},{"location":"flutter/guides/developer-setup/#related-files","title":"Related Files","text":"File Purpose <code>macos/Runner/Configs/Local.xcconfig.template</code> Template for macOS signing <code>macos/Runner/Configs/Local.xcconfig</code> Your macOS signing config (gitignored) <code>ios/Runner/Configs/Local.xcconfig.template</code> Template for iOS signing <code>ios/Runner/Configs/Local.xcconfig</code> Your iOS signing config (gitignored) <code>.gitignore</code> Excludes <code>**/Local.xcconfig</code>"},{"location":"flutter/rules/flutter_rules/","title":"Flutter Development Rules","text":"<p>Expert Flutter/Dart development guide emphasizing performance, maintainability, and modern best practices.</p>"},{"location":"flutter/rules/flutter_rules/#core-principles","title":"Core Principles","text":"<ul> <li>SOLID - Apply throughout the codebase</li> <li>Composition over inheritance - Build complex widgets from smaller ones</li> <li>Immutability - Prefer immutable data structures; widgets should be immutable</li> <li>Separation of concerns - UI logic separate from business logic</li> </ul>"},{"location":"flutter/rules/flutter_rules/#code-style","title":"Code Style","text":"<pre><code>PascalCase  \u2192 classes\ncamelCase   \u2192 members, variables, functions, enums\nsnake_case  \u2192 file names\n</code></pre> <ul> <li>Line length: 80 characters max</li> <li>Functions: single purpose, &lt;20 lines</li> <li>Names: meaningful, descriptive, no abbreviations</li> <li>Comments: explain why, not what</li> <li>No trailing comments</li> </ul>"},{"location":"flutter/rules/flutter_rules/#dart-best-practices","title":"Dart Best Practices","text":"<p>Null Safety:</p> <ul> <li>Write soundly null-safe code</li> <li>Avoid <code>!</code> unless value is guaranteed non-null</li> <li>Use pattern matching to simplify null handling</li> </ul> <p>Async:</p> <ul> <li>Use <code>Future</code>/<code>async</code>/<code>await</code> for single async operations</li> <li>Use <code>Stream</code> for sequences of async events</li> <li>Always handle errors in async code</li> </ul> <p>Modern Features:</p> <ul> <li>Use pattern matching where it simplifies code</li> <li>Use records for returning multiple values</li> <li>Use exhaustive <code>switch</code> expressions (no <code>break</code> needed)</li> <li>Use arrow syntax for one-line functions</li> </ul> <p>Class Organization:</p> <ul> <li>Related classes in same library file</li> <li>Group related libraries in same folder</li> <li>Document all public APIs with <code>///</code> comments</li> </ul>"},{"location":"flutter/rules/flutter_rules/#flutter-best-practices","title":"Flutter Best Practices","text":"<p>Widgets:</p> <ul> <li><code>StatelessWidget</code> must be immutable</li> <li>Prefer small, private Widget classes over helper methods returning Widget</li> <li>Break large <code>build()</code> methods into smaller widget classes</li> <li>Use <code>const</code> constructors whenever possible</li> </ul> <p>Performance:</p> <ul> <li>Use <code>ListView.builder</code> / <code>SliverList</code> for long lists (lazy loading)</li> <li>Use <code>compute()</code> for expensive calculations (separate isolate)</li> <li>Never do network calls or heavy computation in <code>build()</code></li> </ul> <p>State Management (this project uses Riverpod):</p> <ul> <li>Separate ephemeral state from app state</li> <li>Use manual constructor dependency injection</li> <li>Abstract data sources with repositories for testability</li> </ul> <p>Navigation:</p> <ul> <li>Use <code>go_router</code> for declarative routing and deep linking</li> <li>Use <code>Navigator</code> only for dialogs/temporary views</li> </ul>"},{"location":"flutter/rules/flutter_rules/#architecture","title":"Architecture","text":"<p>Layers:</p> <pre><code>Presentation  \u2192 widgets, screens\nDomain        \u2192 business logic\nData          \u2192 models, API clients\nCore          \u2192 shared utilities, extensions\n</code></pre> <p>Feature-based Organization:</p> <p>Each feature has its own presentation, domain, and data subfolders.</p>"},{"location":"flutter/rules/flutter_rules/#testing","title":"Testing","text":"<p>Patterns:</p> <ul> <li>Arrange-Act-Assert (Given-When-Then)</li> <li>Prefer fakes/stubs over mocks</li> <li>Use <code>mockito</code> or <code>mocktail</code> only when necessary</li> </ul> <p>Types:</p> <ul> <li>Unit tests (<code>package:test</code>) \u2192 domain logic, data layer, state</li> <li>Widget tests (<code>package:flutter_test</code>) \u2192 UI components</li> <li>Integration tests (<code>package:integration_test</code>) \u2192 end-to-end flows</li> </ul> <p>Assertions:</p> <p>Prefer <code>package:checks</code> for expressive, readable assertions.</p>"},{"location":"flutter/rules/flutter_rules/#theming","title":"Theming","text":"<p>Material 3:</p> <ul> <li>Use <code>ColorScheme.fromSeed()</code> for harmonious palettes</li> <li>Provide both <code>theme</code> and <code>darkTheme</code> to MaterialApp</li> <li>Centralize component styles in <code>ThemeData</code></li> </ul> <p>Custom Tokens:</p> <p>Use <code>ThemeExtension&lt;T&gt;</code> for styles not in standard ThemeData.</p> <p>Accessibility:</p> <ul> <li>Text contrast ratio: 4.5:1 minimum (3:1 for large text)</li> <li>Test with increased system font size</li> <li>Use <code>Semantics</code> widget for screen reader labels</li> </ul>"},{"location":"flutter/rules/flutter_rules/#layout","title":"Layout","text":"<p>Overflow Prevention:</p> <ul> <li><code>Expanded</code> - fill remaining space</li> <li><code>Flexible</code> - shrink to fit (don't mix with Expanded)</li> <li><code>Wrap</code> - move to next line when overflowing</li> <li><code>SingleChildScrollView</code> - fixed content larger than viewport</li> <li><code>ListView.builder</code> - long lists</li> </ul> <p>Responsiveness:</p> <p>Use <code>LayoutBuilder</code> or <code>MediaQuery</code> for responsive layouts.</p>"},{"location":"flutter/rules/flutter_rules/#code-generation","title":"Code Generation","text":"<p>When using <code>json_serializable</code> or similar:</p> <pre><code>dart run build_runner build --delete-conflicting-outputs\n</code></pre>"},{"location":"flutter/rules/flutter_rules/#logging","title":"Logging","text":"<p>Use <code>dart:developer</code> log instead of <code>print</code>:</p> <pre><code>import 'dart:developer' as developer;\n\ndeveloper.log('Message', name: 'myapp.module', error: e, stackTrace: s);\n</code></pre>"},{"location":"flutter/rules/flutter_rules/#quick-reference","title":"Quick Reference","text":"Do Don't <code>const</code> constructors Mutable widgets Small, focused, reusable Widget classes Giant <code>build()</code> methods Pattern matching Excessive null checks with <code>!</code> <code>ListView.builder</code> <code>ListView</code> with large lists Fakes/stubs in tests Heavy mock usage <code>Theme.of(context)</code> Hardcoded colors/styles"},{"location":"flutter/summary/client/","title":"soliplex_client Package","text":"<p>Pure Dart client library for the Soliplex backend. No Flutter dependencies - can be used in any Dart environment (CLI, server, Flutter).</p>"},{"location":"flutter/summary/client/#package-structure","title":"Package Structure","text":"<pre><code>soliplex_client/lib/src/\n\u251c\u2500\u2500 agui/              # AG-UI streaming protocol\n\u2502   \u251c\u2500\u2500 agui_event.dart\n\u2502   \u251c\u2500\u2500 text_message_buffer.dart\n\u2502   \u251c\u2500\u2500 tool_call_buffer.dart\n\u2502   \u251c\u2500\u2500 tool_registry.dart\n\u2502   \u2514\u2500\u2500 thread.dart\n\u251c\u2500\u2500 api/               # REST API client\n\u2502   \u2514\u2500\u2500 soliplex_api.dart\n\u251c\u2500\u2500 errors/            # Exception hierarchy\n\u2502   \u2514\u2500\u2500 exceptions.dart\n\u251c\u2500\u2500 http/              # HTTP transport layer\n\u2502   \u251c\u2500\u2500 dart_http_client.dart\n\u2502   \u251c\u2500\u2500 http_client_adapter.dart\n\u2502   \u251c\u2500\u2500 http_observer.dart\n\u2502   \u251c\u2500\u2500 http_response.dart\n\u2502   \u251c\u2500\u2500 http_transport.dart\n\u2502   \u251c\u2500\u2500 observable_http_client.dart\n\u2502   \u2514\u2500\u2500 soliplex_http_client.dart\n\u251c\u2500\u2500 models/            # Data models\n\u2502   \u251c\u2500\u2500 chat_message.dart\n\u2502   \u251c\u2500\u2500 models.dart\n\u2502   \u251c\u2500\u2500 room.dart\n\u2502   \u251c\u2500\u2500 run_info.dart\n\u2502   \u2514\u2500\u2500 thread_info.dart\n\u2514\u2500\u2500 utils/             # Utilities\n    \u251c\u2500\u2500 cancel_token.dart\n    \u2514\u2500\u2500 url_builder.dart\n</code></pre>"},{"location":"flutter/summary/client/#architecture-overview","title":"Architecture Overview","text":""},{"location":"flutter/summary/client/#layered-design","title":"Layered Design","text":"<p>The package follows a layered architecture with clear separation of concerns:</p> <pre><code>flowchart TD\n    app[\"Application Layer&lt;br/&gt;(Flutter app consumes SoliplexApi and Thread)\"]\n\n    subgraph client[\"Client Layer\"]\n        api[\"SoliplexApi&lt;br/&gt;(REST CRUD)\"]\n        thread[\"Thread&lt;br/&gt;(AG-UI orchestration)\"]\n    end\n\n    subgraph transport[\"Transport Layer\"]\n        httpTransport[\"HttpTransport&lt;br/&gt;- JSON encode/decode&lt;br/&gt;- Exception mapping&lt;br/&gt;- CancelToken support\"]\n    end\n\n    subgraph adapter[\"Adapter Layer\"]\n        observable[\"ObservableHttpClient&lt;br/&gt;(optional decorator)\"]\n        interface[\"SoliplexHttpClient&lt;br/&gt;(interface)\"]\n        dart[\"DartHttpClient&lt;br/&gt;(default)\"]\n        cupertino[\"CupertinoHttpClient&lt;br/&gt;(iOS/macOS)*\"]\n    end\n\n    app --&gt; api\n    app --&gt; thread\n    api --&gt; httpTransport\n    thread --&gt; httpTransport\n    httpTransport --&gt; observable\n    observable --&gt; interface\n    interface --&gt; dart\n    interface --&gt; cupertino\n\n    style app fill:#e1f5ff\n    style client fill:#fff4e1\n    style transport fill:#ffe1f5\n    style adapter fill:#e8f5e9</code></pre> <p>Note: CupertinoHttpClient is in the soliplex_client_native package</p>"},{"location":"flutter/summary/client/#key-design-decisions","title":"Key Design Decisions","text":"<p>1. Pluggable HTTP Clients</p> <p>The <code>SoliplexHttpClient</code> interface allows different HTTP implementations:</p> <ul> <li><code>DartHttpClient</code> - Default pure-Dart implementation using <code>package:http</code></li> <li>Platform clients (in <code>soliplex_client_native</code>) - CupertinoHttpClient for iOS/macOS</li> <li><code>ObservableHttpClient</code> - Wraps any client to add monitoring</li> </ul> <p>2. Sealed Class Hierarchies</p> <p>Used extensively for type safety and exhaustive pattern matching:</p> <ul> <li><code>ChatMessage</code> - Different message types (text, error, tool call, etc.)</li> <li><code>RunState</code> - Run lifecycle states (no active, active, completed, failed)</li> <li><code>TextMessageBuffer</code> - Buffer states (inactive vs active)</li> <li><code>AgUiEvent</code> - 19 event types from the backend</li> </ul> <p>3. Immutable Data Models</p> <p>All models are <code>@immutable</code> with <code>copyWith()</code> methods:</p> <ul> <li>Prevents accidental mutation</li> <li>Thread-safe by design</li> <li>Enables value equality</li> </ul> <p>4. Event-Driven Streaming</p> <p>AG-UI uses Server-Sent Events (SSE) for real-time updates:</p> <pre><code>flowchart TD\n    sse[Backend SSE Stream]\n    byte[Byte Stream]\n    parser[SSE Parser]\n    event[AgUiEvent]\n    text[TextMessageBuffer]\n    tool[ToolCallBuffer]\n    state[State Map]\n    ui[UI Updates]\n\n    sse --&gt; byte\n    byte --&gt; parser\n    parser --&gt; event\n    event --&gt; text\n    event --&gt; tool\n    event --&gt; state\n    text --&gt; ui\n    tool --&gt; ui\n    state --&gt; ui\n\n    style sse fill:#e1f5ff\n    style event fill:#fff4e1\n    style ui fill:#e8f5e9</code></pre>"},{"location":"flutter/summary/client/#core-components","title":"Core Components","text":""},{"location":"flutter/summary/client/#soliplexapi","title":"SoliplexApi","text":"<p>High-level REST client for CRUD operations. Wraps <code>HttpTransport</code> and normalizes backend responses.</p> <pre><code>final api = SoliplexApi(\n  transport: HttpTransport(client: DartHttpClient()),\n  urlBuilder: UrlBuilder('https://api.example.com/api/v1'),\n);\n\n// Room operations\nfinal rooms = await api.getRooms();\nfinal room = await api.getRoom('room-123');\n\n// Thread operations\nfinal threads = await api.getThreads('room-123');\nfinal thread = await api.createThread('room-123');\nawait api.deleteThread('room-123', 'thread-456');\n\n// Run operations\nfinal run = await api.createRun('room-123', 'thread-456');\n</code></pre>"},{"location":"flutter/summary/client/#thread","title":"Thread","text":"<p>Orchestrates AG-UI streaming. Manages buffers, state, and tool execution.</p> <pre><code>final thread = Thread(\n  transport: httpTransport,\n  urlBuilder: urlBuilder,\n  roomId: 'room-123',\n  threadId: 'thread-456',\n  toolRegistry: registry,  // Optional client-side tools\n);\n\n// Stream events from a run\nawait for (final event in thread.run(\n  runId: 'run-789',\n  userMessage: 'Hello!',\n  cancelToken: cancelToken,\n)) {\n  // Events are processed internally; yielded for observation\n}\n\n// Access accumulated state\nprint(thread.messages);  // List&lt;ChatMessage&gt;\nprint(thread.state);     // Map&lt;String, dynamic&gt;\nprint(thread.runState);  // RunState (sealed class)\n</code></pre> <p>RunState sealed class:</p> <pre><code>sealed class RunState {\n  NoActiveRun()                      // No run executing\n  ActiveRun(runId)                   // Run in progress\n  CompletedRun(runId)                // Run finished successfully\n  FailedRun(runId, errorMessage)     // Run encountered error\n}\n</code></pre>"},{"location":"flutter/summary/client/#httptransport","title":"HttpTransport","text":"<p>JSON serialization and exception mapping layer.</p> <pre><code>final transport = HttpTransport(\n  client: DartHttpClient(),\n  defaultTimeout: Duration(seconds: 30),\n);\n\n// Request with automatic JSON handling\nfinal data = await transport.request&lt;Map&lt;String, dynamic&gt;&gt;(\n  'POST',\n  uri,\n  body: {'message': 'Hello'},  // Auto-encoded to JSON\n  fromJson: Room.fromJson,     // Auto-decoded response\n  cancelToken: token,\n);\n\n// SSE streaming\nfinal stream = transport.requestStream('POST', uri, body: body);\n</code></pre> <p>Exception mapping:</p> Status Code Exception 401, 403 <code>AuthException</code> 404 <code>NotFoundException</code> Other 4xx/5xx <code>ApiException</code> Network errors <code>NetworkException</code> Cancelled <code>CancelledException</code>"},{"location":"flutter/summary/client/#buffers","title":"Buffers","text":"<p>Accumulate streaming content with immutable state transitions.</p> <p>TextMessageBuffer:</p> <pre><code>// Start inactive\nTextMessageBuffer buffer = TextMessageBuffer.empty;\n\n// TEXT_MESSAGE_START event\nbuffer = buffer.start(messageId: 'msg-123');\n\n// TEXT_MESSAGE_CONTENT events\nif (buffer case ActiveTextBuffer active) {\n  buffer = active.append('Hello, ');\n  buffer = (buffer as ActiveTextBuffer).append('world!');\n}\n\n// TEXT_MESSAGE_END event\nif (buffer case ActiveTextBuffer active) {\n  final (newBuffer, message) = active.complete();\n  buffer = newBuffer;  // Back to InactiveTextBuffer\n  // message.text == 'Hello, world!'\n}\n</code></pre> <p>ToolCallBuffer:</p> <pre><code>final buffer = ToolCallBuffer();\n\n// TOOL_CALL_START event\nbuffer.startToolCall(callId: 'call-1', name: 'calculator');\n\n// TOOL_CALL_ARGS events (streaming)\nbuffer.appendArgs(callId: 'call-1', delta: '{\"a\":');\nbuffer.appendArgs(callId: 'call-1', delta: '1,\"b\":2}');\n\n// TOOL_CALL_END event\nfinal toolCall = buffer.completeToolCall(callId: 'call-1');\n\n// TOOL_CALL_RESULT event\nbuffer.setResult(callId: 'call-1', result: '3');\n</code></pre>"},{"location":"flutter/summary/client/#toolregistry","title":"ToolRegistry","text":"<p>Client-side tool execution for AG-UI.</p> <pre><code>final registry = ToolRegistry();\n\n// Register a tool\nregistry.register(\n  name: 'calculator',\n  executor: (call) async {\n    final args = jsonDecode(call.arguments);\n    return ((args['a'] as num) + (args['b'] as num)).toString();\n  },\n);\n\n// Fire-and-forget tool (side effects, no result needed)\nregistry.register(\n  name: 'analytics',\n  executor: (call) async { /* log event */ return ''; },\n  fireAndForget: true,\n);\n\n// Execute\nfinal result = await registry.execute(toolCallInfo);\n</code></pre>"},{"location":"flutter/summary/client/#data-models","title":"Data Models","text":""},{"location":"flutter/summary/client/#chatmessage-sealed-hierarchy","title":"ChatMessage (Sealed Hierarchy)","text":"<pre><code>sealed class ChatMessage {\n  TextMessage       // Regular text, with streaming support\n  ErrorMessage      // System-generated errors\n  ToolCallMessage   // Contains List&lt;ToolCallInfo&gt;\n  GenUiMessage      // Widget render data\n  LoadingMessage    // Progress indicator\n}\n\n// TextMessage has streaming fields\nTextMessage(\n  text: 'Hello',\n  isStreaming: true,       // Currently streaming\n  thinkingText: '...',     // Reasoning content\n  isThinkingStreaming: false,\n);\n\n// ToolCallInfo tracks status\nToolCallInfo(\n  id: 'call-1',\n  name: 'search',\n  arguments: '{\"query\":\"...\"}',\n  status: ToolCallStatus.executing,  // pending/executing/completed/failed\n  result: '',\n);\n</code></pre>"},{"location":"flutter/summary/client/#room-threadinfo-runinfo","title":"Room, ThreadInfo, RunInfo","text":"<p>Simple immutable data classes with <code>fromJson()</code>, <code>toJson()</code>, <code>copyWith()</code>.</p> <pre><code>Room(id: 'room-1', name: 'General', description: '...', metadata: {});\n\nThreadInfo(\n  id: 'thread-1',\n  roomId: 'room-1',\n  name: 'Thread',\n  createdAt: DateTime.now(),\n);\n\nRunInfo(\n  id: 'run-1',\n  threadId: 'thread-1',\n  status: RunStatus.running,  // pending/running/completed/failed/cancelled\n);\n</code></pre>"},{"location":"flutter/summary/client/#ag-ui-events","title":"AG-UI Events","text":"<p>19 event types from the backend SSE stream:</p> <p>Run Lifecycle:</p> <ul> <li><code>RunStartedEvent</code> - Run began</li> <li><code>RunFinishedEvent</code> - Run completed successfully</li> <li><code>RunErrorEvent</code> - Run encountered error</li> </ul> <p>Steps:</p> <ul> <li><code>StepStartedEvent</code> - Step began</li> <li><code>StepFinishedEvent</code> - Step completed</li> </ul> <p>Text Messages (streaming):</p> <ul> <li><code>TextMessageStartEvent</code> - Begin streaming message</li> <li><code>TextMessageContentEvent</code> - Text chunk (delta)</li> <li><code>TextMessageEndEvent</code> - Message complete</li> </ul> <p>Tool Calls (streaming):</p> <ul> <li><code>ToolCallStartEvent</code> - Tool call began</li> <li><code>ToolCallArgsEvent</code> - Arguments chunk (delta)</li> <li><code>ToolCallEndEvent</code> - Arguments complete</li> <li><code>ToolCallResultEvent</code> - Result available</li> </ul> <p>State Management:</p> <ul> <li><code>StateSnapshotEvent</code> - Complete state replacement</li> <li><code>StateDeltaEvent</code> - JSON Patch operations</li> </ul> <p>Activity:</p> <ul> <li><code>ActivitySnapshotEvent</code> - Complete activity state</li> <li><code>ActivityDeltaEvent</code> - Activity JSON Patch</li> </ul> <p>Other:</p> <ul> <li><code>MessagesSnapshotEvent</code> - Replace all messages</li> <li><code>CustomEvent</code> - Application-specific events</li> <li><code>UnknownEvent</code> - Unrecognized event types</li> </ul>"},{"location":"flutter/summary/client/#http-observability","title":"HTTP Observability","text":""},{"location":"flutter/summary/client/#observablehttpclient","title":"ObservableHttpClient","text":"<p>The <code>ObservableHttpClient</code> is a decorator that wraps any <code>SoliplexHttpClient</code> to enable monitoring. It does not wrap clients automatically - you must explicitly compose it:</p> <pre><code>// Without observation (default)\nfinal transport = HttpTransport(client: DartHttpClient());\n\n// With observation (explicit wrapping required)\nfinal observable = ObservableHttpClient(\n  client: DartHttpClient(),\n  observers: [LoggingObserver(), MetricsObserver()],\n);\nfinal transport = HttpTransport(client: observable);\n</code></pre>"},{"location":"flutter/summary/client/#observer-interface","title":"Observer Interface","text":"<pre><code>abstract class HttpObserver {\n  void onRequest(HttpRequestEvent event);\n  void onResponse(HttpResponseEvent event);\n  void onError(HttpErrorEvent event);\n  void onStreamStart(HttpStreamStartEvent event);\n  void onStreamEnd(HttpStreamEndEvent event);\n}\n</code></pre>"},{"location":"flutter/summary/client/#what-gets-observed","title":"What Gets Observed","text":"<p>For regular requests (<code>request()</code>):</p> Event When <code>onRequest()</code> Before request starts <code>onResponse()</code> After successful response <code>onError()</code> When <code>SoliplexException</code> is thrown <p>For streaming (<code>requestStream()</code>):</p> Event When <code>onStreamStart()</code> When stream begins <code>onStreamEnd()</code> When stream completes or errors (includes byte count)"},{"location":"flutter/summary/client/#observability-with-darthttpclient","title":"Observability with DartHttpClient","text":"<p>When <code>ObservableHttpClient</code> wraps <code>DartHttpClient</code>, all real-world network transactions are visible because <code>DartHttpClient</code> converts network errors to <code>SoliplexException</code> subtypes:</p> Original Exception Converted To <code>TimeoutException</code> <code>NetworkException(isTimeout: true)</code> <code>SocketException</code> <code>NetworkException</code> <code>HttpException</code> <code>NetworkException</code> <code>http.ClientException</code> <code>NetworkException</code> <p>Since <code>ObservableHttpClient</code> catches <code>SoliplexException</code>, all these trigger <code>onError()</code>.</p> <p>Edge cases not observed:</p> <ol> <li><code>StateError</code> from using a closed client (programming error)</li> <li>Non-<code>SocketException</code> errors during streaming that aren't wrapped    (rare edge case in <code>DartHttpClient.requestStream()</code>)</li> </ol> <p>These are programming errors or rare edge cases, not normal network operations.</p>"},{"location":"flutter/summary/client/#request-correlation","title":"Request Correlation","text":"<p>Each request gets a unique ID for correlating request/response/error events:</p> <pre><code>class MyObserver extends HttpObserver {\n  @override\n  void onRequest(HttpRequestEvent event) {\n    print('[${event.requestId}] ${event.method} ${event.uri}');\n  }\n\n  @override\n  void onResponse(HttpResponseEvent event) {\n    print('[${event.requestId}] ${event.statusCode} '\n        'in ${event.duration.inMilliseconds}ms');\n  }\n}\n</code></pre>"},{"location":"flutter/summary/client/#exception-hierarchy","title":"Exception Hierarchy","text":"<pre><code>SoliplexException (abstract)\n\u251c\u2500\u2500 AuthException        - 401/403, redirect to login\n\u251c\u2500\u2500 NetworkException     - Connection failed, show retry\n\u251c\u2500\u2500 ApiException         - 4xx/5xx, show error message\n\u251c\u2500\u2500 NotFoundException    - 404, navigate away\n\u2514\u2500\u2500 CancelledException   - User cancelled, handle silently\n</code></pre> <p>All exceptions preserve <code>originalError</code> and <code>stackTrace</code> for debugging.</p>"},{"location":"flutter/summary/client/#data-flow-examples","title":"Data Flow Examples","text":""},{"location":"flutter/summary/client/#rest-api-call","title":"REST API Call","text":"<pre><code>api.getRoom('room-123')\n  \u2193\nHttpTransport.request&lt;Room&gt;()\n  \u2193\n[ObservableHttpClient.request() - if wrapped]\n  \u2193\nDartHttpClient.request()\n  \u2193\nNetwork request\n  \u2193\nHttpResponse\n  \u2193\nStatus code check \u2192 throw if error\n  \u2193\nJSON decode\n  \u2193\nRoom.fromJson()\n  \u2193\nRoom object\n</code></pre>"},{"location":"flutter/summary/client/#ag-ui-streaming","title":"AG-UI Streaming","text":"<pre><code>thread.run(runId, userMessage)\n  \u2193\nPOST /rooms/{roomId}/agui/{threadId}\n  \u2193\nSSE byte stream\n  \u2193\nUTF-8 decode \u2192 buffer until \\n\\n\n  \u2193\nParse \"data: {...}\" lines\n  \u2193\nAgUiEvent.fromJson() \u2192 typed event\n  \u2193\nthread.processEvent()\n  \u251c\u2500\u2500 TextMessage* \u2192 TextMessageBuffer \u2192 TextMessage\n  \u251c\u2500\u2500 ToolCall* \u2192 ToolCallBuffer \u2192 ToolCallInfo \u2192 execute\n  \u251c\u2500\u2500 State* \u2192 JSON Patch \u2192 _state map\n  \u2514\u2500\u2500 RunFinished/Error \u2192 RunState update\n  \u2193\nyield event to consumer\n</code></pre>"},{"location":"flutter/summary/client/#design-patterns-summary","title":"Design Patterns Summary","text":"Pattern Usage Adapter <code>SoliplexHttpClient</code> interface with <code>DartHttpClient</code> implementation Decorator <code>ObservableHttpClient</code> wraps clients with monitoring (manual) Factory <code>AgUiEvent.fromJson()</code> creates appropriate event subclass Repository <code>SoliplexApi</code> abstracts backend communication State Machine <code>RunState</code> sealed class for run lifecycle Buffer/Accumulator <code>TextMessageBuffer</code>, <code>ToolCallBuffer</code> for streaming Registry <code>ToolRegistry</code> for client-side tool registration Observer <code>HttpObserver</code> for HTTP monitoring"},{"location":"flutter/summary/client/#dependencies","title":"Dependencies","text":"<ul> <li>http (^1.2.0) - Pure Dart HTTP client</li> <li>meta (^1.9.0) - <code>@immutable</code> annotation</li> </ul>"},{"location":"ingester/API/","title":"Soliplex Ingester API Reference","text":""},{"location":"ingester/API/#base-url","title":"Base URL","text":"<p>All API endpoints are prefixed with <code>/api/v1/</code>.</p>"},{"location":"ingester/API/#authentication","title":"Authentication","text":"<p>Authentication is enforced when <code>API_KEY_ENABLED=true</code> or <code>AUTH_TRUST_PROXY_HEADERS=true</code> in environment settings. All endpoints require the <code>get_current_user</code> dependency.</p>"},{"location":"ingester/API/#document-endpoints","title":"Document Endpoints","text":""},{"location":"ingester/API/#get-apiv1document","title":"GET /api/v1/document/","text":"<p>Get documents by source or batch ID.</p> <p>Query Parameters: - <code>source</code> (string, optional) - Source identifier to filter documents - <code>batch_id</code> (integer, optional) - Batch ID to filter documents</p> <p>Response: - <code>200 OK</code> - Array of DocumentURI objects - <code>400 Bad Request</code> - Neither source nor batch_id provided</p> <p>Example: <pre><code>curl \"http://localhost:8000/api/v1/document/?batch_id=1\"\n</code></pre></p>"},{"location":"ingester/API/#post-apiv1documentingest-document","title":"POST /api/v1/document/ingest-document","text":"<p>Ingest a new document into the system.</p> <p>Content-Type: <code>multipart/form-data</code></p> <p>Form Parameters: - <code>file</code> (file, optional) - Document file to upload - <code>input_uri</code> (string, optional) - URI to fetch document from - <code>mime_type</code> (string, optional) - MIME type of the document - <code>source_uri</code> (string, required) - Source URI/path identifier - <code>source</code> (string, required) - Source system identifier - <code>batch_id</code> (integer, required) - Batch ID to assign document - <code>doc_meta</code> (string, optional) - JSON string of metadata (default: <code>{}</code>) - <code>priority</code> (integer, optional) - Processing priority (default: 0)</p> <p>Response: - <code>201 Created</code> - Document ingested successfully (new document) - <code>203 Non-Authoritative Information</code> - Document already exists in a different batch - <code>400 Bad Request</code> - Invalid parameters or metadata - <code>500 Internal Server Error</code> - Processing error</p> <p>Success Response Body: <pre><code>{\n  \"batch_id\": 1,\n  \"document_uri\": \"/path/to/doc.pdf\",\n  \"document_hash\": \"sha256-abc123...\",\n  \"source\": \"filesystem\",\n  \"uri_id\": 42\n}\n</code></pre></p> <p>Notes: - The <code>batch_id</code> in the response reflects the batch where the document URI actually resides - If a document with the same hash already exists in a different batch, the response returns <code>203</code> with the original batch ID - This prevents duplicate processing while informing the caller that the document was previously ingested</p> <p>Example: <pre><code>curl -X POST \"http://localhost:8000/api/v1/document/ingest-document\" \\\n  -F \"file=@document.pdf\" \\\n  -F \"source_uri=/documents/report.pdf\" \\\n  -F \"source=filesystem\" \\\n  -F \"batch_id=1\" \\\n  -F \"doc_meta={\\\"author\\\":\\\"John Doe\\\"}\"\n</code></pre></p>"},{"location":"ingester/API/#post-apiv1documentcleanup-orphans","title":"POST /api/v1/document/cleanup-orphans","text":"<p>Delete orphaned documents with no URI references.</p> <p>Response: - <code>200 OK</code> - Cleanup successful with statistics - <code>500 Internal Server Error</code> - Processing error</p> <p>Success Response Body: <pre><code>{\n  \"message\": \"Orphaned documents cleaned up\",\n  \"statistics\": {\n    \"deleted_documents\": 5,\n    \"deleted_history\": 12\n  }\n}\n</code></pre></p> <p>Example: <pre><code>curl -X POST \"http://localhost:8000/api/v1/document/cleanup-orphans\"\n</code></pre></p>"},{"location":"ingester/API/#delete-apiv1documentby-uri","title":"DELETE /api/v1/document/by-uri","text":"<p>Delete a DocumentURI by URI and source with cascading deletion.</p> <p>If only one DocumentURI references the underlying document, all associated records are deleted including workflow runs, steps, lifecycle history, artifacts, and the document itself.</p> <p>If multiple DocumentURIs reference the same document, only the specified DocumentURI and its history are deleted; the document is preserved.</p> <p>Query Parameters: - <code>uri</code> (string, required) - The document URI to delete - <code>source</code> (string, required) - The source system identifier</p> <p>Response: - <code>200 OK</code> - Deletion successful with statistics - <code>404 Not Found</code> - DocumentURI not found - <code>500 Internal Server Error</code> - Processing error</p> <p>Success Response Body: <pre><code>{\n  \"message\": \"DocumentURI deleted successfully\",\n  \"uri\": \"/documents/report.pdf\",\n  \"source\": \"filesystem\",\n  \"statistics\": {\n    \"deleted_document_uris\": 1,\n    \"deleted_uri_history\": 3,\n    \"deleted_documents\": 1,\n    \"deleted_workflow_runs\": 2,\n    \"deleted_run_steps\": 10,\n    \"deleted_lifecycle_history\": 6,\n    \"total_deleted\": 23\n  }\n}\n</code></pre></p> <p>Notes: - When <code>deleted_documents</code> is 0, other DocumentURIs still reference the document - All deletions occur within a single transaction for atomicity - File artifacts are also deleted from configured storage (filesystem, S3, or database)</p> <p>Example: <pre><code>curl -X DELETE \"http://localhost:8000/api/v1/document/by-uri?uri=/documents/report.pdf&amp;source=filesystem\"\n</code></pre></p>"},{"location":"ingester/API/#batch-endpoints","title":"Batch Endpoints","text":""},{"location":"ingester/API/#get-apiv1batch","title":"GET /api/v1/batch/","text":"<p>List all document batches.</p> <p>Response: - <code>200 OK</code> - Array of DocumentBatch objects</p> <p>Example: <pre><code>curl \"http://localhost:8000/api/v1/batch/\"\n</code></pre></p>"},{"location":"ingester/API/#post-apiv1batch","title":"POST /api/v1/batch/","text":"<p>Create a new document batch.</p> <p>Content-Type: <code>application/x-www-form-urlencoded</code></p> <p>Form Parameters: - <code>source</code> (string, required) - Source system identifier - <code>name</code> (string, required) - Human-readable batch name</p> <p>Response: - <code>201 Created</code> - Batch created successfully</p> <p>Response Body: <pre><code>{\n  \"batch_id\": 1\n}\n</code></pre></p> <p>Example: <pre><code>curl -X POST \"http://localhost:8000/api/v1/batch/\" \\\n  -d \"source=filesystem\" \\\n  -d \"name=Q4 Reports\"\n</code></pre></p>"},{"location":"ingester/API/#post-apiv1batchstart-workflows","title":"POST /api/v1/batch/start-workflows","text":"<p>Start workflow processing for all documents in a batch.</p> <p>Content-Type: <code>application/x-www-form-urlencoded</code></p> <p>Form Parameters: - <code>batch_id</code> (integer, required) - Batch ID to process - <code>workflow_definition_id</code> (string, optional) - Workflow to use (default: from config) - <code>priority</code> (integer, optional) - Processing priority (default: 0) - <code>param_id</code> (string, optional) - Parameter set ID (default: from config)</p> <p>Response: - <code>201 Created</code> - Workflows started successfully - <code>404 Not Found</code> - Batch not found - <code>500 Internal Server Error</code> - Processing error</p> <p>Response Body: <pre><code>{\n  \"message\": \"Workflows started\",\n  \"workflows\": 10,\n  \"run_group\": 5\n}\n</code></pre></p> <p>Example: <pre><code>curl -X POST \"http://localhost:8000/api/v1/batch/start-workflows\" \\\n  -d \"batch_id=1\" \\\n  -d \"workflow_definition_id=batch\" \\\n  -d \"param_id=default\"\n</code></pre></p>"},{"location":"ingester/API/#get-apiv1batchstatus","title":"GET /api/v1/batch/status","text":"<p>Get detailed status for a batch.</p> <p>Query Parameters: - <code>batch_id</code> (integer, required) - Batch ID</p> <p>Response: - <code>200 OK</code> - Batch status details - <code>404 Not Found</code> - Batch not found</p> <p>Response Body: <pre><code>{\n  \"batch\": {\n    \"id\": 1,\n    \"name\": \"Q4 Reports\",\n    \"source\": \"filesystem\",\n    \"start_date\": \"2025-01-15T10:00:00\",\n    \"completed_date\": null\n  },\n  \"document_count\": 10,\n  \"workflow_count\": {\n    \"COMPLETED\": 7,\n    \"RUNNING\": 2,\n    \"PENDING\": 1\n  },\n  \"workflows\": [...],\n  \"parsed\": 7,\n  \"remaining\": 3\n}\n</code></pre></p> <p>Example: <pre><code>curl \"http://localhost:8000/api/v1/batch/status?batch_id=1\"\n</code></pre></p>"},{"location":"ingester/API/#get-apiv1batchbatch_idsteps","title":"GET /api/v1/batch/{batch_id}/steps","text":"<p>Get all workflow steps for a batch.</p> <p>Path Parameters: - <code>batch_id</code> (integer, required) - Batch ID</p> <p>Response: - <code>200 OK</code> - Array of RunStep objects - <code>500 Internal Server Error</code> - Processing error</p> <p>Example: <pre><code>curl \"http://localhost:8000/api/v1/batch/1/steps\"\n</code></pre></p>"},{"location":"ingester/API/#workflow-endpoints","title":"Workflow Endpoints","text":""},{"location":"ingester/API/#get-apiv1workflow","title":"GET /api/v1/workflow/","text":"<p>Get workflow runs with optional pagination.</p> <p>Query Parameters: - <code>batch_id</code> (integer, optional) - Filter by batch ID - <code>include_steps</code> (boolean, optional) - Include step details (default: false) - <code>include_doc_info</code> (boolean, optional) - Include document info (default: false) - <code>page</code> (integer, optional) - Page number (1-indexed) - <code>rows_per_page</code> (integer, optional) - Results per page (default: 10 when paginated)</p> <p>Response: - <code>200 OK</code> - Array of WorkflowRun objects (unpaginated) or PaginatedResponse (paginated)</p> <p>Paginated Response Body: <pre><code>{\n  \"items\": [...],\n  \"total\": 100,\n  \"page\": 1,\n  \"rows_per_page\": 10,\n  \"total_pages\": 10\n}\n</code></pre></p> <p>Example: <pre><code>curl \"http://localhost:8000/api/v1/workflow/?batch_id=1&amp;page=1&amp;rows_per_page=20\"\n</code></pre></p>"},{"location":"ingester/API/#get-apiv1workflowby-status","title":"GET /api/v1/workflow/by-status","text":"<p>Get workflow runs filtered by status with optional pagination.</p> <p>Query Parameters: - <code>status</code> (enum, required) - One of: PENDING, RUNNING, COMPLETED, ERROR, FAILED - <code>batch_id</code> (integer, optional) - Filter by batch ID - <code>include_doc_info</code> (boolean, optional) - Include document info (default: false) - <code>page</code> (integer, optional) - Page number (1-indexed) - <code>rows_per_page</code> (integer, optional) - Results per page</p> <p>Response: - <code>200 OK</code> - Array of WorkflowRun objects or PaginatedResponse</p> <p>Example: <pre><code>curl \"http://localhost:8000/api/v1/workflow/by-status?status=FAILED\"\n</code></pre></p>"},{"location":"ingester/API/#get-apiv1workflowdefinitions","title":"GET /api/v1/workflow/definitions","text":"<p>List all available workflow definitions.</p> <p>Response: - <code>200 OK</code> - Array of workflow definition summaries</p> <p>Response Body: <pre><code>[\n  {\n    \"id\": \"batch\",\n    \"name\": \"Batch Workflow\"\n  },\n  {\n    \"id\": \"interactive\",\n    \"name\": \"Interactive Workflow\"\n  }\n]\n</code></pre></p> <p>Example: <pre><code>curl \"http://localhost:8000/api/v1/workflow/definitions\"\n</code></pre></p>"},{"location":"ingester/API/#get-apiv1workflowdefinitionsworkflow_id","title":"GET /api/v1/workflow/definitions/{workflow_id}","text":"<p>Get workflow definition YAML content by ID.</p> <p>Path Parameters: - <code>workflow_id</code> (string, required) - Workflow definition ID</p> <p>Response: - <code>200 OK</code> - YAML content (Content-Type: text/yaml) - <code>404 Not Found</code> - Workflow definition not found</p> <p>Example: <pre><code>curl \"http://localhost:8000/api/v1/workflow/definitions/batch\"\n</code></pre></p>"},{"location":"ingester/API/#get-apiv1workflowparam-sets","title":"GET /api/v1/workflow/param-sets","text":"<p>List all available parameter sets.</p> <p>Response: - <code>200 OK</code> - Array of parameter set summaries</p> <p>Response Body: <pre><code>[\n  {\n    \"id\": \"default\",\n    \"name\": \"Default Parameters\",\n    \"source\": \"app\"\n  },\n  {\n    \"id\": \"high_quality\",\n    \"name\": \"High Quality Processing\",\n    \"source\": \"user\"\n  }\n]\n</code></pre></p> <p>Example: <pre><code>curl \"http://localhost:8000/api/v1/workflow/param-sets\"\n</code></pre></p>"},{"location":"ingester/API/#get-apiv1workflowparam-setsset_id","title":"GET /api/v1/workflow/param-sets/{set_id}","text":"<p>Get parameter set YAML content by ID.</p> <p>Path Parameters: - <code>set_id</code> (string, required) - Parameter set ID</p> <p>Response: - <code>200 OK</code> - YAML content (Content-Type: text/yaml) - <code>404 Not Found</code> - Parameter set not found</p> <p>Example: <pre><code>curl \"http://localhost:8000/api/v1/workflow/param-sets/default\"\n</code></pre></p>"},{"location":"ingester/API/#get-apiv1workflowparam_setstargettarget","title":"GET /api/v1/workflow/param_sets/target/{target}","text":"<p>Get parameter sets that target a specific LanceDB directory.</p> <p>Path Parameters: - <code>target</code> (string, required) - LanceDB data directory path</p> <p>Response: - <code>200 OK</code> - Array of matching WorkflowParams objects</p> <p>Example: <pre><code>curl \"http://localhost:8000/api/v1/workflow/param_sets/target/lancedb\"\n</code></pre></p>"},{"location":"ingester/API/#post-apiv1workflowparam-sets","title":"POST /api/v1/workflow/param-sets","text":"<p>Upload a new parameter set from YAML content.</p> <p>Content-Type: <code>application/x-www-form-urlencoded</code></p> <p>Form Parameters: - <code>yaml_content</code> (string, required) - Raw YAML content</p> <p>Response: - <code>201 Created</code> - Parameter set created successfully - <code>400 Bad Request</code> - Invalid YAML syntax or format - <code>409 Conflict</code> - Parameter set with same ID already exists - <code>500 Internal Server Error</code> - Processing error</p> <p>Success Response Body: <pre><code>{\n  \"message\": \"Parameter set created successfully\",\n  \"id\": \"my_params\",\n  \"file_path\": \"/path/to/params/my_params.yaml\"\n}\n</code></pre></p> <p>Notes: - Uploaded parameter sets have <code>source</code> set to \"user\" - The parameter set ID is taken from the YAML content</p> <p>Example: <pre><code>curl -X POST \"http://localhost:8000/api/v1/workflow/param-sets\" \\\n  -d \"yaml_content=id: my_params\\nname: My Parameters\\nconfig:\\n  parse:\\n    format: markdown\"\n</code></pre></p>"},{"location":"ingester/API/#delete-apiv1workflowparam-setsset_id","title":"DELETE /api/v1/workflow/param-sets/{set_id}","text":"<p>Delete a user-uploaded parameter set.</p> <p>Path Parameters: - <code>set_id</code> (string, required) - Parameter set ID to delete</p> <p>Response: - <code>200 OK</code> - Parameter set deleted successfully - <code>403 Forbidden</code> - Cannot delete built-in parameter sets - <code>404 Not Found</code> - Parameter set not found - <code>500 Internal Server Error</code> - Processing error</p> <p>Notes: - Only parameter sets with <code>source=\"user\"</code> can be deleted - Built-in parameter sets cannot be deleted via API</p> <p>Example: <pre><code>curl -X DELETE \"http://localhost:8000/api/v1/workflow/param-sets/my_params\"\n</code></pre></p>"},{"location":"ingester/API/#get-apiv1workflowsteps","title":"GET /api/v1/workflow/steps","text":"<p>Get workflow steps filtered by status.</p> <p>Query Parameters: - <code>status</code> (enum, required) - One of: PENDING, RUNNING, COMPLETED, ERROR, FAILED</p> <p>Response: - <code>200 OK</code> - Array of RunStep objects</p> <p>Example: <pre><code>curl \"http://localhost:8000/api/v1/workflow/steps?status=RUNNING\"\n</code></pre></p>"},{"location":"ingester/API/#get-apiv1workflowrun-groups","title":"GET /api/v1/workflow/run-groups","text":"<p>Get workflow run groups, optionally filtered by batch ID.</p> <p>Query Parameters: - <code>batch_id</code> (integer, optional) - Filter by batch ID</p> <p>Response: - <code>200 OK</code> - Array of RunGroup objects - <code>500 Internal Server Error</code> - Processing error</p> <p>Example: <pre><code>curl \"http://localhost:8000/api/v1/workflow/run-groups?batch_id=1\"\n</code></pre></p>"},{"location":"ingester/API/#get-apiv1workflowrun_groupsrun_group_id","title":"GET /api/v1/workflow/run_groups/{run_group_id}","text":"<p>Get specific run group by ID.</p> <p>Path Parameters: - <code>run_group_id</code> (integer, required) - Run group ID</p> <p>Response: - <code>200 OK</code> - RunGroup object - <code>500 Internal Server Error</code> - Processing error</p> <p>Example: <pre><code>curl \"http://localhost:8000/api/v1/workflow/run_groups/5\"\n</code></pre></p>"},{"location":"ingester/API/#delete-apiv1workflowrun_groupsrun_group_id","title":"DELETE /api/v1/workflow/run_groups/{run_group_id}","text":"<p>Delete a run group and all dependent records.</p> <p>Path Parameters: - <code>run_group_id</code> (integer, required) - Run group ID to delete</p> <p>Response: - <code>200 OK</code> - Run group deleted successfully - <code>404 Not Found</code> - Run group does not exist - <code>500 Internal Server Error</code> - Processing error</p> <p>Response Body: <pre><code>{\n  \"message\": \"RunGroup 5 deleted successfully\",\n  \"statistics\": {\n    \"deleted_runsteps\": 150,\n    \"deleted_lifecyclehistory\": 45,\n    \"deleted_workflowruns\": 10,\n    \"deleted_rungroups\": 1,\n    \"total_deleted\": 206\n  }\n}\n</code></pre></p> <p>Notes: - Works with both SQLite and PostgreSQL databases - Deletes all dependent records: RunSteps, LifecycleHistory, WorkflowRuns, and the RunGroup - The deletion is performed within a transaction and rolled back if any error occurs</p> <p>Example: <pre><code>curl -X DELETE \"http://localhost:8000/api/v1/workflow/run_groups/5\"\n</code></pre></p>"},{"location":"ingester/API/#get-apiv1workflowrun_groupsrun_group_idstats","title":"GET /api/v1/workflow/run_groups/{run_group_id}/stats","text":"<p>Get statistics for a run group.</p> <p>Path Parameters: - <code>run_group_id</code> (integer, required) - Run group ID</p> <p>Response: - <code>200 OK</code> - Statistics object with status counts - <code>500 Internal Server Error</code> - Processing error</p> <p>Example: <pre><code>curl \"http://localhost:8000/api/v1/workflow/run_groups/5/stats\"\n</code></pre></p>"},{"location":"ingester/API/#get-apiv1workflowruns","title":"GET /api/v1/workflow/runs","text":"<p>Get workflow runs for a batch.</p> <p>Query Parameters: - <code>batch_id</code> (integer, required) - Batch ID</p> <p>Response: - <code>200 OK</code> - Array of WorkflowRun objects</p> <p>Example: <pre><code>curl \"http://localhost:8000/api/v1/workflow/runs?batch_id=1\"\n</code></pre></p>"},{"location":"ingester/API/#get-apiv1workflowrunsworkflow_id","title":"GET /api/v1/workflow/runs/{workflow_id}","text":"<p>Get specific workflow run by ID, including steps.</p> <p>Path Parameters: - <code>workflow_id</code> (integer, required) - Workflow run ID</p> <p>Response: - <code>200 OK</code> - WorkflowRun object with steps array</p> <p>Example: <pre><code>curl \"http://localhost:8000/api/v1/workflow/runs/42\"\n</code></pre></p>"},{"location":"ingester/API/#get-apiv1workflowrunsworkflow_idlifecycle","title":"GET /api/v1/workflow/runs/{workflow_id}/lifecycle","text":"<p>Get lifecycle history events for a specific workflow run.</p> <p>Path Parameters: - <code>workflow_id</code> (integer, required) - Workflow run ID</p> <p>Response: - <code>200 OK</code> - Array of LifecycleHistory objects ordered by start_date - <code>400 Bad Request</code> - Invalid workflow ID - <code>500 Internal Server Error</code> - Processing error</p> <p>Response Body: <pre><code>[\n  {\n    \"id\": 1,\n    \"event\": \"item_start\",\n    \"handler_name\": null,\n    \"run_group_id\": 5,\n    \"workflow_run_id\": 42,\n    \"step_id\": null,\n    \"start_date\": \"2025-01-15T10:00:00\",\n    \"completed_date\": \"2025-01-15T10:01:30\",\n    \"status\": \"COMPLETED\",\n    \"status_date\": \"2025-01-15T10:01:30\",\n    \"status_message\": \"Item processing completed successfully\",\n    \"status_meta\": {}\n  }\n]\n</code></pre></p> <p>Event Types: - <code>group_start</code> / <code>group_end</code> - Run group lifecycle - <code>item_start</code> / <code>item_end</code> / <code>item_failed</code> - Item processing lifecycle - <code>step_start</code> / <code>step_end</code> / <code>step_failed</code> - Individual step lifecycle</p> <p>Example: <pre><code>curl \"http://localhost:8000/api/v1/workflow/runs/42/lifecycle\"\n</code></pre></p>"},{"location":"ingester/API/#post-apiv1workflow","title":"POST /api/v1/workflow/","text":"<p>Start a new workflow run for a single document.</p> <p>Content-Type: <code>application/x-www-form-urlencoded</code></p> <p>Form Parameters: - <code>doc_id</code> (string, required) - Document hash to process - <code>workflow_definiton_id</code> (string, optional) - Workflow to use - <code>param_id</code> (string, optional) - Parameter set ID - <code>priority</code> (integer, optional) - Processing priority (default: 0)</p> <p>Response: - <code>201 Created</code> - Workflow run created - <code>500 Internal Server Error</code> - Processing error</p> <p>Example: <pre><code>curl -X POST \"http://localhost:8000/api/v1/workflow/\" \\\n  -d \"doc_id=sha256-abc123...\" \\\n  -d \"workflow_definiton_id=batch\" \\\n  -d \"priority=10\"\n</code></pre></p>"},{"location":"ingester/API/#post-apiv1workflowretry","title":"POST /api/v1/workflow/retry","text":"<p>Retry failed workflow steps for a run group.</p> <p>Content-Type: <code>application/x-www-form-urlencoded</code></p> <p>Form Parameters: - <code>run_group_id</code> (integer, required) - Run group ID to retry</p> <p>Response: - <code>201 Created</code> - Failed steps reset successfully - <code>500 Internal Server Error</code> - Processing error</p> <p>Example: <pre><code>curl -X POST \"http://localhost:8000/api/v1/workflow/retry\" \\\n  -d \"run_group_id=5\"\n</code></pre></p>"},{"location":"ingester/API/#source-status-endpoint","title":"Source Status Endpoint","text":""},{"location":"ingester/API/#post-apiv1source-status","title":"POST /api/v1/source-status","text":"<p>Check document status for a source system.</p> <p>Content-Type: <code>application/x-www-form-urlencoded</code></p> <p>Form Parameters: - <code>source</code> (string, required) - Source system identifier - <code>hashes</code> (string, required) - JSON object mapping URIs to hashes</p> <p>Response: - <code>200 OK</code> - Status object indicating new/changed/deleted documents</p> <p>Example: <pre><code>curl -X POST \"http://localhost:8000/api/v1/source-status\" \\\n  -d \"source=filesystem\" \\\n  -d 'hashes={\"file1.pdf\":\"sha256-abc\",\"file2.pdf\":\"sha256-def\"}'\n</code></pre></p>"},{"location":"ingester/API/#stats-endpoints","title":"Stats Endpoints","text":""},{"location":"ingester/API/#get-apiv1statsdurations","title":"GET /api/v1/stats/durations","text":"<p>Get workflow durations by run group.</p> <p>Query Parameters: - <code>run_group_id</code> (integer, required) - Run group ID</p> <p>Response: - <code>200 OK</code> - Duration statistics - <code>500 Internal Server Error</code> - Processing error</p> <p>Example: <pre><code>curl \"http://localhost:8000/api/v1/stats/durations?run_group_id=5\"\n</code></pre></p>"},{"location":"ingester/API/#get-apiv1statsstep-stats","title":"GET /api/v1/stats/step-stats","text":"<p>Get workflow step statistics by run group.</p> <p>Query Parameters: - <code>run_group_id</code> (integer, required) - Run group ID</p> <p>Response: - <code>200 OK</code> - Step statistics - <code>500 Internal Server Error</code> - Processing error</p> <p>Example: <pre><code>curl \"http://localhost:8000/api/v1/stats/step-stats?run_group_id=5\"\n</code></pre></p>"},{"location":"ingester/API/#lancedb-endpoints","title":"LanceDB Endpoints","text":""},{"location":"ingester/API/#get-apiv1lancedblist","title":"GET /api/v1/lancedb/list","text":"<p>List all LanceDB vector databases in the configured directory.</p> <p>Response: - <code>200 OK</code> - List of databases with metadata</p> <p>Response Body: <pre><code>{\n  \"status\": \"ok\",\n  \"lancedb_dir\": \"/data/lancedb\",\n  \"database_count\": 2,\n  \"databases\": [\n    {\n      \"name\": \"default\",\n      \"path\": \"default\",\n      \"size_bytes\": 1048576,\n      \"size_human\": \"1.00 MB\"\n    }\n  ]\n}\n</code></pre></p> <p>Example: <pre><code>curl \"http://localhost:8000/api/v1/lancedb/list\"\n</code></pre></p>"},{"location":"ingester/API/#get-apiv1lancedbinfo","title":"GET /api/v1/lancedb/info","text":"<p>Get detailed information about a specific LanceDB database.</p> <p>Query Parameters: - <code>db</code> (string, required) - Database name relative to lancedb_dir</p> <p>Response: - <code>200 OK</code> - Database information - <code>404 Not Found</code> - Database does not exist - <code>500 Internal Server Error</code> - Failed to open database</p> <p>Response Body: <pre><code>{\n  \"status\": \"ok\",\n  \"path\": \"/data/lancedb/default\",\n  \"versions\": {\n    \"lancedb\": \"0.25.3\",\n    \"haiku_rag\": \"0.25.0\",\n    \"stored_version\": \"0.25.0\"\n  },\n  \"embeddings\": {\n    \"provider\": \"openai\",\n    \"model\": \"text-embedding-3-small\",\n    \"vector_dim\": 1536\n  },\n  \"documents\": {\n    \"count\": 100,\n    \"size_bytes\": 512000,\n    \"size_human\": \"500.00 KB\",\n    \"versions\": 5\n  },\n  \"chunks\": {\n    \"count\": 1500,\n    \"size_bytes\": 2048000,\n    \"size_human\": \"2.00 MB\",\n    \"versions\": 5\n  },\n  \"vector_index\": {\n    \"exists\": true,\n    \"indexed_rows\": 1450,\n    \"unindexed_rows\": 50\n  },\n  \"tables\": [\"documents\", \"chunks\", \"settings\"]\n}\n</code></pre></p> <p>Example: <pre><code>curl \"http://localhost:8000/api/v1/lancedb/info?db=default\"\n</code></pre></p> <p>Note: The <code>db</code> parameter supports nested paths (e.g., <code>project/data</code>).</p>"},{"location":"ingester/API/#get-apiv1lancedbvacuum","title":"GET /api/v1/lancedb/vacuum","text":"<p>Optimize and clean up database tables to reduce disk usage.</p> <p>Query Parameters: - <code>db</code> (string, required) - Database name relative to lancedb_dir</p> <p>Response: - <code>200 OK</code> - Vacuum completed successfully - <code>500 Internal Server Error</code> - Vacuum failed</p> <p>Response Body: <pre><code>{\n  \"status\": \"ok\"\n}\n</code></pre></p> <p>Example: <pre><code>curl \"http://localhost:8000/api/v1/lancedb/vacuum?db=default\"\n</code></pre></p> <p>Note: Vacuum removes deleted rows and compacts table files. Run periodically after bulk deletions.</p>"},{"location":"ingester/API/#get-apiv1lancedbdocuments","title":"GET /api/v1/lancedb/documents","text":"<p>List documents stored in a LanceDB database.</p> <p>Query Parameters: - <code>db</code> (string, required) - Database name relative to lancedb_dir - <code>limit</code> (integer, optional) - Maximum number of documents to return - <code>offset</code> (integer, optional) - Number of documents to skip - <code>filter</code> (string, optional) - SQL WHERE clause to filter documents</p> <p>Response: - <code>200 OK</code> - List of documents - <code>404 Not Found</code> - Database does not exist - <code>500 Internal Server Error</code> - Query error</p> <p>Response Body: <pre><code>{\n  \"status\": \"ok\",\n  \"path\": \"/data/lancedb/default\",\n  \"document_count\": 10,\n  \"documents\": [\n    {\n      \"id\": \"doc-abc123\",\n      \"uri\": \"/documents/report.pdf\",\n      \"title\": \"Q4 Financial Report\",\n      \"created_at\": \"2025-01-15T10:00:00\",\n      \"updated_at\": \"2025-01-15T12:00:00\",\n      \"chunk_count\": 25,\n      \"metadata\": {\"author\": \"John Doe\"}\n    }\n  ]\n}\n</code></pre></p> <p>Example: <pre><code>curl \"http://localhost:8000/api/v1/lancedb/documents?db=default&amp;limit=10\"\n</code></pre></p> <p>Example with filter: <pre><code>curl \"http://localhost:8000/api/v1/lancedb/documents?db=default&amp;filter=uri%20LIKE%20'%25report%25'\"\n</code></pre></p>"},{"location":"ingester/API/#data-models","title":"Data Models","text":""},{"location":"ingester/API/#documentbatch","title":"DocumentBatch","text":"<pre><code>{\n  \"id\": 1,\n  \"name\": \"Q4 Reports\",\n  \"source\": \"filesystem\",\n  \"start_date\": \"2025-01-15T10:00:00\",\n  \"completed_date\": null,\n  \"batch_params\": {},\n  \"duration\": null\n}\n</code></pre>"},{"location":"ingester/API/#document","title":"Document","text":"<pre><code>{\n  \"hash\": \"sha256-abc123...\",\n  \"mime_type\": \"application/pdf\",\n  \"file_size\": 1024000,\n  \"doc_meta\": {\"author\": \"John Doe\"}\n}\n</code></pre>"},{"location":"ingester/API/#documenturi","title":"DocumentURI","text":"<pre><code>{\n  \"id\": 42,\n  \"doc_hash\": \"sha256-abc123...\",\n  \"uri\": \"/documents/report.pdf\",\n  \"source\": \"filesystem\",\n  \"version\": 1,\n  \"batch_id\": 1\n}\n</code></pre>"},{"location":"ingester/API/#workflowrun","title":"WorkflowRun","text":"<pre><code>{\n  \"id\": 100,\n  \"workflow_definition_id\": \"batch\",\n  \"run_group_id\": 5,\n  \"batch_id\": 1,\n  \"doc_id\": \"sha256-abc123...\",\n  \"priority\": 0,\n  \"created_date\": \"2025-01-15T10:00:00\",\n  \"start_date\": \"2025-01-15T10:01:00\",\n  \"completed_date\": null,\n  \"status\": \"RUNNING\",\n  \"status_date\": \"2025-01-15T10:05:00\",\n  \"status_message\": null,\n  \"status_meta\": {},\n  \"run_params\": {},\n  \"duration\": null\n}\n</code></pre>"},{"location":"ingester/API/#runstep","title":"RunStep","text":"<pre><code>{\n  \"id\": 500,\n  \"workflow_run_id\": 100,\n  \"workflow_step_number\": 2,\n  \"workflow_step_name\": \"parse\",\n  \"step_config_id\": 10,\n  \"step_type\": \"parse\",\n  \"is_last_step\": false,\n  \"created_date\": \"2025-01-15T10:01:00\",\n  \"priority\": 0,\n  \"start_date\": \"2025-01-15T10:02:00\",\n  \"status_date\": \"2025-01-15T10:05:00\",\n  \"completed_date\": null,\n  \"retry\": 0,\n  \"retries\": 1,\n  \"status\": \"RUNNING\",\n  \"status_message\": null,\n  \"status_meta\": {},\n  \"worker_id\": \"worker-abc-123\",\n  \"duration\": null\n}\n</code></pre>"},{"location":"ingester/API/#rungroup","title":"RunGroup","text":"<pre><code>{\n  \"id\": 5,\n  \"name\": \"Batch 1 Processing\",\n  \"workflow_definition_id\": \"batch\",\n  \"param_definition_id\": \"default\",\n  \"batch_id\": 1,\n  \"created_date\": \"2025-01-15T10:00:00\",\n  \"start_date\": \"2025-01-15T10:01:00\",\n  \"completed_date\": null,\n  \"status\": \"RUNNING\",\n  \"status_date\": \"2025-01-15T10:30:00\",\n  \"status_message\": \"Processing documents\",\n  \"status_meta\": {}\n}\n</code></pre>"},{"location":"ingester/API/#lifecyclehistory","title":"LifecycleHistory","text":"<pre><code>{\n  \"id\": 1,\n  \"event\": \"item_start\",\n  \"handler_name\": null,\n  \"run_group_id\": 5,\n  \"workflow_run_id\": 42,\n  \"step_id\": null,\n  \"start_date\": \"2025-01-15T10:00:00\",\n  \"completed_date\": \"2025-01-15T10:01:30\",\n  \"status\": \"COMPLETED\",\n  \"status_date\": \"2025-01-15T10:01:30\",\n  \"status_message\": null,\n  \"status_meta\": {}\n}\n</code></pre>"},{"location":"ingester/API/#runstatus-enum","title":"RunStatus Enum","text":"<ul> <li><code>PENDING</code> - Not yet started</li> <li><code>RUNNING</code> - Currently executing</li> <li><code>COMPLETED</code> - Finished successfully</li> <li><code>ERROR</code> - Failed but will retry</li> <li><code>FAILED</code> - Permanently failed after all retries</li> </ul>"},{"location":"ingester/API/#workflowsteptype-enum","title":"WorkflowStepType Enum","text":"<ul> <li><code>ingest</code> - Load document</li> <li><code>validate</code> - Validate document</li> <li><code>parse</code> - Extract text/structure</li> <li><code>chunk</code> - Split into chunks</li> <li><code>embed</code> - Generate embeddings</li> <li><code>store</code> - Save to RAG system</li> <li><code>enrich</code> - Add metadata</li> <li><code>route</code> - Conditional routing</li> </ul>"},{"location":"ingester/API/#error-responses","title":"Error Responses","text":"<p>All error responses follow this format:</p> <pre><code>{\n  \"error\": \"Error message describing what went wrong\",\n  \"status_code\": 400\n}\n</code></pre> <p>Common HTTP status codes: - <code>400 Bad Request</code> - Invalid parameters - <code>403 Forbidden</code> - Permission denied - <code>404 Not Found</code> - Resource not found - <code>409 Conflict</code> - Duplicate resource - <code>500 Internal Server Error</code> - Server-side error</p>"},{"location":"ingester/API/#openapiswagger-documentation","title":"OpenAPI/Swagger Documentation","text":"<p>Interactive API documentation is available at: - Swagger UI: <code>http://localhost:8000/docs</code> - ReDoc: <code>http://localhost:8000/redoc</code></p>"},{"location":"ingester/ARCHITECTURE/","title":"Soliplex Ingester Architecture","text":""},{"location":"ingester/ARCHITECTURE/#overview","title":"Overview","text":"<p>Soliplex Ingester is a document processing and RAG (Retrieval-Augmented Generation) ingestion system designed to handle large-scale document workflows. It provides a FastAPI-based REST API, workflow orchestration, and integration with document parsing and embedding services.</p>"},{"location":"ingester/ARCHITECTURE/#system-components","title":"System Components","text":""},{"location":"ingester/ARCHITECTURE/#1-fastapi-server","title":"1. FastAPI Server","text":"<p>The server provides REST API endpoints for document and workflow management:</p> <ul> <li>Document Routes (<code>/api/v1/document/*</code>) - Document upload, retrieval, and management</li> <li>Batch Routes (<code>/api/v1/batch/*</code>) - Batch processing operations</li> <li>Workflow Routes (<code>/api/v1/workflow/*</code>) - Workflow execution and monitoring</li> <li>Stats Routes (<code>/api/v1/stats/*</code>) - System statistics and metrics</li> </ul> <p>Server entry point: <code>src/soliplex_ingester/server/__init__.py:30</code></p>"},{"location":"ingester/ARCHITECTURE/#2-workflow-system","title":"2. Workflow System","text":"<p>The workflow system orchestrates multi-step document processing pipelines:</p> <pre><code>Document \u2192 Validate \u2192 Parse \u2192 Chunk \u2192 Embed \u2192 Store\n</code></pre> <p>Workflow Components:</p> <ul> <li>WorkflowDefinition - Defines the steps and lifecycle events for a workflow</li> <li>WorkflowRun - Represents a single execution instance for one document</li> <li>RunGroup - Groups multiple workflow runs together</li> <li>RunStep - Individual step execution within a workflow run</li> </ul> <p>Step Types: - <code>INGEST</code> - Load document into system - <code>VALIDATE</code> - Validate document format and content - <code>PARSE</code> - Extract text and structure from document - <code>CHUNK</code> - Split document into semantic chunks - <code>EMBED</code> - Generate vector embeddings - <code>STORE</code> - Save to RAG system (LanceDB + HaikuRAG) - <code>ENRICH</code> - Add metadata or additional processing - <code>ROUTE</code> - Conditional routing logic</p> <p>Implementation: <code>src/soliplex_ingester/lib/wf/</code></p>"},{"location":"ingester/ARCHITECTURE/#3-worker-system","title":"3. Worker System","text":"<p>Async workers process workflow steps concurrently:</p> <ul> <li>Workers poll for pending workflow steps</li> <li>Configurable concurrency levels for different operations</li> <li>Automatic retry logic with configurable retry counts</li> <li>Health check/heartbeat system via <code>WorkerCheckin</code></li> </ul> <p>Worker implementation: <code>src/soliplex_ingester/lib/wf/runner.py</code></p>"},{"location":"ingester/ARCHITECTURE/#4-storage-layer","title":"4. Storage Layer","text":"<p>Database: - SQLModel + SQLAlchemy with async support - Supports SQLite (dev) and PostgreSQL (production) - Alembic for migrations</p> <p>File Storage: - Configurable backends (filesystem, S3-compatible via OpenDAL) - Separate storage locations for different artifact types:   - Raw documents   - Parsed markdown   - Parsed JSON   - Chunks   - Embeddings</p> <p>Vector Storage: - LanceDB for vector embeddings - HaikuRAG client for retrieval operations</p>"},{"location":"ingester/ARCHITECTURE/#5-document-processing-pipeline","title":"5. Document Processing Pipeline","text":"<pre><code>graph LR\n    A[Upload Document] --&gt; B[Create DocumentURI]\n    B --&gt; C[Hash &amp; Store as Document]\n    C --&gt; D[Queue Workflow Run]\n    D --&gt; E[Validate Step]\n    E --&gt; F[Parse with Docling]\n    F --&gt; G[Chunk Text]\n    G --&gt; H[Generate Embeddings]\n    H --&gt; I[Store in LanceDB]\n    I --&gt; J[Update RAG Index]</code></pre>"},{"location":"ingester/ARCHITECTURE/#6-external-services","title":"6. External Services","text":"<p>Docling Server: - Document parsing service - Extracts text, structure, and metadata - Configurable via <code>DOCLING_SERVER_URL</code></p> <p>HaikuRAG: - RAG backend for document retrieval - Vector search and document management - Optional (controlled by <code>DO_RAG</code> setting)</p>"},{"location":"ingester/ARCHITECTURE/#data-flow","title":"Data Flow","text":""},{"location":"ingester/ARCHITECTURE/#document-ingestion-flow","title":"Document Ingestion Flow","text":"<ol> <li>Upload - Client uploads document via <code>/api/v1/document/upload</code></li> <li>Hash &amp; Dedupe - System computes SHA256 hash, checks for duplicates</li> <li>Create URI - Maps source URI to document hash</li> <li>Batch Assignment - Associates document with processing batch</li> <li>Workflow Creation - Creates WorkflowRun and RunSteps</li> <li>Worker Processing - Workers pick up and execute steps</li> <li>Status Updates - Database tracks step and run status</li> <li>Completion - Document marked complete when all steps succeed</li> </ol>"},{"location":"ingester/ARCHITECTURE/#workflow-execution-flow","title":"Workflow Execution Flow","text":"<ol> <li>Worker Startup - Worker registers and starts polling</li> <li>Step Selection - Worker queries for PENDING steps with <code>FOR UPDATE</code> lock</li> <li>Status Transition - PENDING \u2192 RUNNING \u2192 COMPLETED/ERROR/FAILED</li> <li>Step Execution - Calls registered handler method</li> <li>Artifact Storage - Saves intermediate results</li> <li>Retry Logic - Automatic retry on ERROR status</li> <li>Run Completion - Aggregates step status to run status</li> <li>Group Completion - Aggregates run status to group status</li> </ol>"},{"location":"ingester/ARCHITECTURE/#configuration","title":"Configuration","text":"<p>Configuration via environment variables with <code>pydantic-settings</code>:</p> <ul> <li>Database connection</li> <li>File storage paths</li> <li>Worker concurrency settings</li> <li>External service URLs</li> <li>Workflow and parameter directories</li> </ul> <p>See <code>src/soliplex_ingester/lib/config.py:15</code> for full configuration schema.</p>"},{"location":"ingester/ARCHITECTURE/#scalability","title":"Scalability","text":"<p>Horizontal Scaling: - Multiple workers can run concurrently - Database row-level locking prevents duplicate processing - Stateless API servers can be load balanced</p> <p>Vertical Scaling: - Configurable concurrency per worker - Batch size controls for embedding operations - Connection pooling for database access</p> <p>Workflow Parallelism: - Multiple workflows can process simultaneously - Steps within a workflow run sequentially - Different documents process independently</p>"},{"location":"ingester/ARCHITECTURE/#technology-stack","title":"Technology Stack","text":"<ul> <li>Web Framework: FastAPI 0.120+</li> <li>Database ORM: SQLModel 0.0.27+</li> <li>Async Runtime: asyncio</li> <li>CLI: Typer</li> <li>Document Parsing: Docling</li> <li>Vector DB: LanceDB 0.25+</li> <li>RAG: HaikuRAG</li> <li>Storage: OpenDAL (multi-backend support)</li> </ul>"},{"location":"ingester/ARCHITECTURE/#extension-points","title":"Extension Points","text":"<p>Custom Workflow Steps: Define custom step handlers by: 1. Creating a new async function matching the EventHandler signature 2. Registering in workflow YAML configuration 3. Implementing retry logic and error handling</p> <p>Custom Storage Backends: Configure via <code>FILE_STORE_TARGET</code> environment variable and OpenDAL configuration.</p> <p>Custom Lifecycle Events: Add event handlers in workflow configuration to respond to: - <code>GROUP_START</code> / <code>GROUP_END</code> - <code>ITEM_START</code> / <code>ITEM_END</code> - <code>STEP_START</code> / <code>STEP_END</code> - <code>ITEM_FAILED</code> / <code>STEP_FAILED</code></p>"},{"location":"ingester/ARCHITECTURE/#monitoring","title":"Monitoring","text":"<p>Database Tables: - <code>workflowrun</code> - Track run status and duration - <code>runstep</code> - Monitor individual step execution - <code>workcheckin</code> - Worker health and activity - <code>lifecyclehistory</code> - Audit trail of events</p> <p>Metrics Available: - Document processing throughput - Step success/failure rates - Worker utilization - Processing durations - Batch completion times</p> <p>Access via <code>/api/v1/stats/*</code> endpoints.</p>"},{"location":"ingester/AUTHENTICATION/","title":"Authentication Guide","text":"<p>This guide covers setting up authentication for Soliplex Ingester using OAuth2 Proxy.</p>"},{"location":"ingester/AUTHENTICATION/#overview","title":"Overview","text":"<p>Soliplex Ingester uses OAuth2 Proxy as a reverse proxy to handle OIDC authentication. This approach:</p> <ul> <li>Requires zero code changes to the application</li> <li>Supports any OIDC-compliant identity provider</li> <li>Handles session management, token refresh, and logout automatically</li> <li>Forwards user identity to the backend via HTTP headers</li> </ul>"},{"location":"ingester/AUTHENTICATION/#architecture","title":"Architecture","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510     \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510     \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  User    \u2502\u2500\u2500\u2500\u2500\u25b6\u2502 OAuth2 Proxy  \u2502\u2500\u2500\u2500\u2500\u25b6\u2502 Soliplex Ingester   \u2502\n\u2502 Browser  \u2502     \u2502   (OIDC)      \u2502     \u2502   (API + UI)        \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518     \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518     \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                        \u2502\n                        \u25bc\n                 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n                 \u2502 OIDC Provider \u2502\n                 \u2502 (Keycloak,   \u2502\n                 \u2502  Auth0, etc) \u2502\n                 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"ingester/AUTHENTICATION/#quick-start","title":"Quick Start","text":""},{"location":"ingester/AUTHENTICATION/#1-configure-your-oidc-provider","title":"1. Configure Your OIDC Provider","text":"<p>Create a new client/application in your OIDC provider with these settings:</p> Setting Value Client Type Confidential Protocol OpenID Connect Redirect URI <code>http://localhost:4180/oauth2/callback</code> Scopes <code>openid</code>, <code>email</code>, <code>profile</code> <p>Note the Client ID and Client Secret.</p>"},{"location":"ingester/AUTHENTICATION/#2-create-environment-file","title":"2. Create Environment File","text":"<pre><code>cd docker\ncp .env.auth.example .env.auth\n</code></pre> <p>Edit <code>.env.auth</code> with your OIDC settings:</p> <pre><code>OAUTH2_PROXY_OIDC_ISSUER_URL=https://your-idp.example.com/realms/your-realm\nOAUTH2_PROXY_CLIENT_ID=soliplex-ingester\nOAUTH2_PROXY_CLIENT_SECRET=your-secret\nOAUTH2_PROXY_COOKIE_SECRET=$(openssl rand -base64 32 | tr -- '+/' '-_')\nOAUTH2_PROXY_REDIRECT_URL=http://localhost:4180/oauth2/callback\n</code></pre>"},{"location":"ingester/AUTHENTICATION/#3-start-with-authentication","title":"3. Start with Authentication","text":"<pre><code>docker compose -f docker-compose.yml -f docker-compose.auth.yml --env-file .env.auth up\n</code></pre>"},{"location":"ingester/AUTHENTICATION/#4-access-the-application","title":"4. Access the Application","text":"<ul> <li>With auth: http://localhost:4180 (redirects to OIDC login)</li> <li>Direct API (no auth): http://localhost:8002 (if port still exposed)</li> </ul>"},{"location":"ingester/AUTHENTICATION/#provider-specific-configuration","title":"Provider-Specific Configuration","text":""},{"location":"ingester/AUTHENTICATION/#keycloak","title":"Keycloak","text":"<ol> <li>Create a new client in your realm:</li> <li>Client ID: <code>soliplex-ingester</code></li> <li>Client Protocol: <code>openid-connect</code></li> <li>Access Type: <code>confidential</code></li> <li> <p>Valid Redirect URIs: <code>http://localhost:4180/oauth2/callback</code></p> </li> <li> <p>Create an Audience mapper (required):</p> </li> <li>Go to Client \u2192 Mappers \u2192 Add Mapper</li> <li>Mapper Type: <code>Audience</code></li> <li> <p>Included Client Audience: <code>soliplex-ingester</code></p> </li> <li> <p>(Optional) Add Groups mapper for group-based access:</p> </li> <li>Go to Client Scopes \u2192 groups \u2192 Mappers</li> <li>Mapper Type: <code>Group Membership</code></li> <li> <p>Token Claim Name: <code>groups</code></p> </li> <li> <p>Environment settings:    <pre><code>OAUTH2_PROXY_OIDC_ISSUER_URL=https://keycloak.example.com/realms/your-realm\n# Or use keycloak-oidc provider for role support:\n# Add to oauth2-proxy.cfg: provider = \"keycloak-oidc\"\n</code></pre></p> </li> </ol>"},{"location":"ingester/AUTHENTICATION/#auth0","title":"Auth0","text":"<ol> <li>Create a new Regular Web Application</li> <li>Configure Allowed Callback URLs: <code>http://localhost:4180/oauth2/callback</code></li> <li> <p>Enable the following connections as needed</p> </li> <li> <p>Environment settings:    <pre><code>OAUTH2_PROXY_OIDC_ISSUER_URL=https://your-tenant.auth0.com/\n</code></pre></p> </li> </ol>"},{"location":"ingester/AUTHENTICATION/#azure-ad","title":"Azure AD","text":"<ol> <li>Register a new application in Azure Portal</li> <li>Add redirect URI: <code>http://localhost:4180/oauth2/callback</code></li> <li> <p>Create a client secret</p> </li> <li> <p>Environment settings:    <pre><code>OAUTH2_PROXY_OIDC_ISSUER_URL=https://login.microsoftonline.com/{tenant-id}/v2.0\n# Or use azure provider:\n# Add to oauth2-proxy.cfg: provider = \"azure\"\n</code></pre></p> </li> </ol>"},{"location":"ingester/AUTHENTICATION/#okta","title":"Okta","text":"<ol> <li>Create a new Web Application</li> <li> <p>Set Sign-in redirect URI: <code>http://localhost:4180/oauth2/callback</code></p> </li> <li> <p>Environment settings:    <pre><code>OAUTH2_PROXY_OIDC_ISSUER_URL=https://your-org.okta.com\n</code></pre></p> </li> </ol>"},{"location":"ingester/AUTHENTICATION/#access-control","title":"Access Control","text":""},{"location":"ingester/AUTHENTICATION/#email-domain-restriction","title":"Email Domain Restriction","text":"<p>Restrict access to specific email domains:</p> <pre><code># .env.auth\nOAUTH2_PROXY_EMAIL_DOMAINS=yourcompany.com,partner.com\n</code></pre>"},{"location":"ingester/AUTHENTICATION/#group-based-access","title":"Group-Based Access","text":"<p>Restrict access to users in specific groups:</p> <pre><code># oauth2-proxy.cfg\nallowed_groups = [\"soliplex-users\", \"soliplex-admins\"]\n</code></pre> <p>Requires your OIDC provider to include a <code>groups</code> claim in the token.</p>"},{"location":"ingester/AUTHENTICATION/#role-based-access-keycloak","title":"Role-Based Access (Keycloak)","text":"<pre><code># oauth2-proxy.cfg (with provider = \"keycloak-oidc\")\nallowed_roles = [\"soliplex-user\"]\n# Or client roles:\nallowed_roles = [\"soliplex-ingester:admin\"]\n</code></pre>"},{"location":"ingester/AUTHENTICATION/#backend-integration","title":"Backend Integration","text":"<p>OAuth2 Proxy forwards user identity via HTTP headers. The backend receives:</p> Header Description <code>X-Auth-Request-User</code> Username/subject <code>X-Auth-Request-Email</code> User's email <code>X-Auth-Request-Groups</code> User's groups (if available) <code>X-Auth-Request-Access-Token</code> OAuth access token <code>X-Forwarded-User</code> Alias for user <code>X-Forwarded-Email</code> Alias for email"},{"location":"ingester/AUTHENTICATION/#reading-headers-in-fastapi","title":"Reading Headers in FastAPI","text":"<pre><code>from fastapi import Request, HTTPException, Depends\n\ndef get_current_user(request: Request) -&gt; dict:\n    \"\"\"Extract user from OAuth2 Proxy headers.\"\"\"\n    user = request.headers.get(\"X-Auth-Request-User\")\n    email = request.headers.get(\"X-Auth-Request-Email\")\n\n    if not user:\n        raise HTTPException(status_code=401, detail=\"Not authenticated\")\n\n    return {\"user\": user, \"email\": email}\n\n@router.get(\"/protected\")\nasync def protected_endpoint(user: dict = Depends(get_current_user)):\n    return {\"message\": f\"Hello {user['email']}\"}\n</code></pre>"},{"location":"ingester/AUTHENTICATION/#api-key-fallback","title":"API Key Fallback","text":"<p>For programmatic access (scripts, CI/CD), you can enable API key authentication alongside OIDC:</p>"},{"location":"ingester/AUTHENTICATION/#enable-api-key-support","title":"Enable API Key Support","text":"<pre><code># .env.auth\nAPI_KEY_ENABLED=true\nAPI_KEY=$(openssl rand -hex 32)\n</code></pre>"},{"location":"ingester/AUTHENTICATION/#using-api-keys","title":"Using API Keys","text":"<p>Both methods work through the OAuth2 Proxy port (4180):</p> <pre><code># Through OAuth2 Proxy (recommended - single port for all clients)\ncurl -H \"Authorization: Bearer your-api-key\" http://localhost:4180/api/v1/batch/\n\n# Direct to API (if port 8002 is exposed)\ncurl -H \"Authorization: Bearer your-api-key\" http://localhost:8002/api/v1/batch/\n</code></pre> <p>How it works: OAuth2 Proxy is configured with <code>skip_jwt_bearer_tokens = true</code>, which allows requests with an <code>Authorization: Bearer</code> header to pass through without OIDC authentication. The backend then validates the token.</p>"},{"location":"ingester/AUTHENTICATION/#production-deployment","title":"Production Deployment","text":""},{"location":"ingester/AUTHENTICATION/#enable-https","title":"Enable HTTPS","text":"<ol> <li>Update redirect URL in OIDC provider</li> <li>Configure SSL certificates</li> <li>Update environment:    <pre><code>OAUTH2_PROXY_COOKIE_SECURE=true\nOAUTH2_PROXY_REDIRECT_URL=https://your-domain.com/oauth2/callback\n</code></pre></li> </ol>"},{"location":"ingester/AUTHENTICATION/#enable-redis-session-storage","title":"Enable Redis Session Storage","text":"<p>For high availability and session sharing:</p> <pre><code># .env.auth\nOAUTH2_PROXY_SESSION_STORE_TYPE=redis\nOAUTH2_PROXY_REDIS_CONNECTION_URL=redis://redis:6379\n</code></pre>"},{"location":"ingester/AUTHENTICATION/#restrict-cors-origins","title":"Restrict CORS Origins","text":"<p>Update the application's CORS settings to only allow your domain.</p>"},{"location":"ingester/AUTHENTICATION/#troubleshooting","title":"Troubleshooting","text":""},{"location":"ingester/AUTHENTICATION/#invalid-redirect-error","title":"\"Invalid redirect\" Error","text":"<p>Ensure the redirect URL in <code>.env.auth</code> exactly matches what's configured in your OIDC provider.</p>"},{"location":"ingester/AUTHENTICATION/#token-audience-doesnt-match","title":"\"Token audience doesn't match\"","text":"<p>For Keycloak, add an Audience mapper to your client (see Keycloak section above).</p>"},{"location":"ingester/AUTHENTICATION/#headers-not-reaching-backend","title":"Headers Not Reaching Backend","text":"<p>Ensure <code>set_xauthrequest = true</code> is in <code>oauth2-proxy.cfg</code> and the backend trusts proxy headers.</p>"},{"location":"ingester/AUTHENTICATION/#session-expires-frequently","title":"Session Expires Frequently","text":"<p>Increase cookie lifetime: <pre><code># oauth2-proxy.cfg\ncookie_expire = \"168h\"\ncookie_refresh = \"1h\"\n</code></pre></p>"},{"location":"ingester/AUTHENTICATION/#debug-logging","title":"Debug Logging","text":"<p>Enable verbose logging: <pre><code># oauth2-proxy.cfg\nstandard_logging = true\nauth_logging = true\nrequest_logging = true\n</code></pre></p>"},{"location":"ingester/AUTHENTICATION/#files-reference","title":"Files Reference","text":"File Purpose <code>docker/docker-compose.auth.yml</code> Docker Compose overlay for auth <code>docker/oauth2-proxy/oauth2-proxy.cfg</code> OAuth2 Proxy configuration <code>docker/.env.auth.example</code> Environment variable template <code>docker/nginx/nginx-auth.conf</code> Nginx config (optional) <code>docker/nginx/locations.conf</code> Nginx location blocks"},{"location":"ingester/AUTHENTICATION/#see-also","title":"See Also","text":"<ul> <li>OAuth2 Proxy Documentation</li> <li>CONFIGURATION.md - Environment variables</li> <li>API.md - API reference</li> </ul>"},{"location":"ingester/CLI/","title":"CLI Reference","text":""},{"location":"ingester/CLI/#overview","title":"Overview","text":"<p>Soliplex Ingester provides a command-line interface (CLI) built with Typer. The CLI binary is named <code>si-cli</code>.</p> <p>Installation: After installing the package, the <code>si-cli</code> command is available: <pre><code>pip install -e .\nsi-cli --help\n</code></pre></p> <p>Entry Point: <code>src/soliplex_ingester/cli.py:35</code></p>"},{"location":"ingester/CLI/#global-options","title":"Global Options","text":"<p>All commands support these options:</p> <pre><code>si-cli --help           # Show help for all commands\nsi-cli COMMAND --help   # Show help for specific command\n</code></pre> <p>Initialization: Before running any command, the CLI automatically: 1. Validates settings 2. Sets up logging based on <code>LOG_LEVEL</code></p>"},{"location":"ingester/CLI/#commands","title":"Commands","text":""},{"location":"ingester/CLI/#validate-settings","title":"validate-settings","text":"<p>Validate and display application settings.</p> <p>Usage: <pre><code>si-cli validate-settings\n</code></pre></p> <p>Description: - Validates all environment variables - Displays current configuration - Exits with error code if validation fails</p> <p>Example Output: <pre><code>doc_db_url='sqlite+aiosqlite:///./db/documents.db'\ndocling_server_url='http://localhost:5001/v1'\ndocling_http_timeout=600\nlog_level='INFO'\nfile_store_target='fs'\nfile_store_dir='file_store'\n...\n</code></pre></p> <p>Error Output: <pre><code>invalid settings\n{'type': 'missing', 'loc': ('doc_db_url',), 'msg': 'Field required'}\n</code></pre></p> <p>Exit Codes: - <code>0</code> - Settings valid - <code>1</code> - Validation failed</p> <p>Implementation: <code>src/soliplex_ingester/cli.py:38</code></p>"},{"location":"ingester/CLI/#db-init","title":"db-init","text":"<p>Initialize database tables and run migrations.</p> <p>Usage: <pre><code>si-cli db-init\n</code></pre></p> <p>Description: - Creates all database tables using SQLModel metadata - Runs Alembic migrations to latest version - Idempotent (safe to run multiple times)</p> <p>Prerequisites: - <code>DOC_DB_URL</code> environment variable must be set - Database server must be accessible - User must have CREATE TABLE permissions</p> <p>Example: <pre><code>export DOC_DB_URL=\"sqlite+aiosqlite:///./db/documents.db\"\nsi-cli db-init\n</code></pre></p> <p>Notes: - For SQLite, creates database file if it doesn't exist - For PostgreSQL, database must already exist - Uses synchronous SQLAlchemy engine (not async)</p> <p>Implementation: <code>src/soliplex_ingester/cli.py:68</code></p>"},{"location":"ingester/CLI/#serve","title":"serve","text":"<p>Start the FastAPI web server.</p> <p>Usage: <pre><code>si-cli serve [OPTIONS]\n</code></pre></p> <p>Options:</p> Option Short Type Default Description <code>--host</code> <code>-h</code> str <code>127.0.0.1</code> Bind address <code>--port</code> <code>-p</code> int <code>8000</code> Port number <code>--uds</code> - str None Unix domain socket path <code>--fd</code> - int None File descriptor to bind <code>--reload</code> <code>-r</code> bool False Auto-reload on file changes <code>--workers</code> - int None Number of worker processes <code>--access-log</code> - bool None Enable/disable access log <code>--proxy-headers</code> - bool None Trust proxy headers <code>--forwarded-allow-ips</code> - str None IPs to trust for proxy headers <p>Examples:</p> <p>Basic server: <pre><code>si-cli serve\n</code></pre></p> <p>Custom host and port: <pre><code>si-cli serve --host 0.0.0.0 --port 9000\n</code></pre></p> <p>Development mode with auto-reload: <pre><code>si-cli serve --reload\n</code></pre></p> <p>Production with multiple workers: <pre><code>si-cli serve --workers 4 --host 0.0.0.0\n</code></pre></p> <p>Unix socket: <pre><code>si-cli serve --uds /tmp/soliplex.sock\n</code></pre></p> <p>Behind proxy: <pre><code>si-cli serve --proxy-headers --forwarded-allow-ips \"10.0.0.0/8\"\n</code></pre></p> <p>Reload Configuration: When <code>--reload</code> is enabled: - Watches Python files in <code>soliplex_ingester</code> package - Watches <code>*.yaml</code>, <code>*.yml</code>, <code>*.txt</code> files - Automatically restarts on changes</p> <p>Worker Note: The server automatically starts a background worker on startup. The worker processes workflow steps concurrently with serving API requests.</p> <p>Environment Variables: - <code>WEB_CONCURRENCY</code> - Default number of workers if not specified</p> <p>Implementation: <code>src/soliplex_ingester/cli.py:207</code></p>"},{"location":"ingester/CLI/#worker","title":"worker","text":"<p>Run a standalone workflow processing worker.</p> <p>Usage: <pre><code>si-cli worker\n</code></pre></p> <p>Description: - Starts a worker that polls for pending workflow steps - Executes steps according to workflow definitions - Runs indefinitely until interrupted (Ctrl+C)</p> <p>Behavior: - Registers worker with unique ID in database - Sends heartbeat every <code>WORKER_CHECKIN_INTERVAL</code> seconds - Processes steps based on priority and availability - Handles retries according to step configuration</p> <p>Example: <pre><code>si-cli worker\n</code></pre></p> <p>Multiple Workers: Run multiple instances for increased throughput: <pre><code># Terminal 1\nsi-cli worker\n\n# Terminal 2\nsi-cli worker\n\n# Terminal 3\nsi-cli worker\n</code></pre></p> <p>Graceful Shutdown: - Press <code>Ctrl+C</code> to stop worker - Worker will finish current step before exiting - Pending steps remain in database for other workers</p> <p>Monitoring: Check worker status via API: <pre><code>curl http://localhost:8000/api/v1/workflow/steps?status=RUNNING\n</code></pre></p> <p>Implementation: <code>src/soliplex_ingester/cli.py:148</code></p>"},{"location":"ingester/CLI/#validate-haiku","title":"validate-haiku","text":"<p>Validate HaikuRAG integration for a batch.</p> <p>Usage: <pre><code>si-cli validate-haiku BATCH_ID [OPTIONS]\n</code></pre></p> <p>Arguments: - <code>BATCH_ID</code> (int, required) - Batch ID to validate</p> <p>Options: - <code>--detail</code> (bool) - Show detailed output (not yet implemented)</p> <p>Description: - Checks all documents in batch - Verifies parsed markdown exists - Confirms documents are indexed in HaikuRAG - Reports any errors or missing documents</p> <p>Example: <pre><code>si-cli validate-haiku 1\n</code></pre></p> <p>Output: <pre><code>-----------results--------------\n found 10 results\n-----------fails--------------\n[\n  {\n    \"doc\": \"sha256-abc123...\",\n    \"haiku\": null,\n    \"message\": \"Document not found in HaikuRAG\",\n    \"status\": \"haiku error\"\n  }\n]\n</code></pre></p> <p>Status Values: - <code>success</code> - Document indexed correctly - <code>no_id</code> - Document has no <code>rag_id</code> (not yet stored) - <code>md error</code> - Parsed markdown not found - <code>haiku error</code> - Error fetching from HaikuRAG</p> <p>Implementation: <code>src/soliplex_ingester/cli.py:133</code></p>"},{"location":"ingester/CLI/#list-workflows","title":"list-workflows","text":"<p>List all available workflow definitions.</p> <p>Usage: <pre><code>si-cli list-workflows\n</code></pre></p> <p>Description: - Scans <code>WORKFLOW_DIR</code> for YAML files - Displays workflow IDs</p> <p>Example: <pre><code>si-cli list-workflows\n</code></pre></p> <p>Output: <pre><code>batch\nbatch_split\ninteractive\n</code></pre></p> <p>Implementation: <code>src/soliplex_ingester/cli.py:189</code></p>"},{"location":"ingester/CLI/#dump-workflow","title":"dump-workflow","text":"<p>Display complete workflow definition.</p> <p>Usage: <pre><code>si-cli dump-workflow WORKFLOW_ID\n</code></pre></p> <p>Arguments: - <code>WORKFLOW_ID</code> (str, required) - Workflow definition ID</p> <p>Description: - Loads workflow from YAML - Displays as formatted JSON</p> <p>Example: <pre><code>si-cli dump-workflow batch\n</code></pre></p> <p>Output: <pre><code>{\n  \"id\": \"batch\",\n  \"name\": \"Batch Workflow\",\n  \"meta\": {},\n  \"item_steps\": {\n    \"validate\": {\n      \"name\": \"docling validate\",\n      \"retries\": 3,\n      \"method\": \"soliplex_ingester.lib.workflow.validate_document\",\n      \"parameters\": {}\n    },\n    ...\n  },\n  \"lifecycle_events\": null\n}\n</code></pre></p> <p>Implementation: <code>src/soliplex_ingester/cli.py:162</code></p>"},{"location":"ingester/CLI/#list-param-sets","title":"list-param-sets","text":"<p>List all available parameter sets.</p> <p>Usage: <pre><code>si-cli list-param-sets\n</code></pre></p> <p>Description: - Scans <code>PARAM_DIR</code> for YAML files - Displays parameter set IDs</p> <p>Example: <pre><code>si-cli list-param-sets\n</code></pre></p> <p>Output: <pre><code>default\nhigh_quality\nfast_processing\n</code></pre></p> <p>Implementation: <code>src/soliplex_ingester/cli.py:201</code></p>"},{"location":"ingester/CLI/#dump-param-set","title":"dump-param-set","text":"<p>Display complete parameter set configuration.</p> <p>Usage: <pre><code>si-cli dump-param-set [PARAM_ID]\n</code></pre></p> <p>Arguments: - <code>PARAM_ID</code> (str, optional) - Parameter set ID (default: \"default\")</p> <p>Description: - Loads parameter set from YAML - Displays as formatted JSON</p> <p>Example: <pre><code>si-cli dump-param-set default\n</code></pre></p> <p>Output: <pre><code>{\n  \"id\": \"default\",\n  \"name\": \"Default Parameters\",\n  \"meta\": {},\n  \"config\": {\n    \"parse\": {\n      \"format\": \"markdown\",\n      \"ocr_enabled\": true\n    },\n    \"chunk\": {\n      \"chunk_size\": 512,\n      \"chunk_overlap\": 50\n    },\n    ...\n  }\n}\n</code></pre></p> <p>Implementation: <code>src/soliplex_ingester/cli.py:175</code></p>"},{"location":"ingester/CLI/#usage-patterns","title":"Usage Patterns","text":""},{"location":"ingester/CLI/#development-workflow","title":"Development Workflow","text":"<p>1. Validate configuration: <pre><code>si-cli validate-settings\n</code></pre></p> <p>2. Initialize database: <pre><code>si-cli db-init\n</code></pre></p> <p>3. Start server with reload: <pre><code>si-cli serve --reload\n</code></pre></p> <p>4. (Optional) Start additional workers: <pre><code>si-cli worker\n</code></pre></p>"},{"location":"ingester/CLI/#production-deployment","title":"Production Deployment","text":"<p>1. Validate configuration: <pre><code>si-cli validate-settings\n</code></pre></p> <p>2. Run migrations: <pre><code>si-cli db-init\n</code></pre></p> <p>3. Start server with multiple workers: <pre><code>si-cli serve --host 0.0.0.0 --port 8000 --workers 4\n</code></pre></p> <p>4. Start dedicated worker processes: <pre><code># In separate terminals/services\nsi-cli worker  # Process 1\nsi-cli worker  # Process 2\nsi-cli worker  # Process 3\n</code></pre></p>"},{"location":"ingester/CLI/#batch-processing","title":"Batch Processing","text":"<p>1. Create batch and ingest documents: <pre><code># Use API or client library\ncurl -X POST http://localhost:8000/api/v1/batch/ \\\n  -d \"source=filesystem\" \\\n  -d \"name=Test Batch\"\n</code></pre></p> <p>2. Start workflows: <pre><code>curl -X POST http://localhost:8000/api/v1/batch/start-workflows \\\n  -d \"batch_id=1\" \\\n  -d \"workflow_definition_id=batch\"\n</code></pre></p> <p>3. Start workers to process: <pre><code>si-cli worker\n</code></pre></p> <p>4. Monitor progress: <pre><code>curl http://localhost:8000/api/v1/batch/status?batch_id=1\n</code></pre></p> <p>5. Validate results: <pre><code>si-cli validate-haiku 1\n</code></pre></p>"},{"location":"ingester/CLI/#configuration-management","title":"Configuration Management","text":"<p>List available workflows: <pre><code>si-cli list-workflows\n</code></pre></p> <p>Inspect workflow: <pre><code>si-cli dump-workflow batch\n</code></pre></p> <p>List parameter sets: <pre><code>si-cli list-param-sets\n</code></pre></p> <p>Inspect parameters: <pre><code>si-cli dump-param-set default\n</code></pre></p>"},{"location":"ingester/CLI/#troubleshooting","title":"Troubleshooting","text":"<p>Check configuration: <pre><code>si-cli validate-settings\n</code></pre></p> <p>Verify database connection: <pre><code>si-cli db-init\n</code></pre></p> <p>Test server startup: <pre><code>si-cli serve --host localhost --port 8000\n# Press Ctrl+C to stop\n</code></pre></p> <p>Check worker connectivity: <pre><code>si-cli worker\n# Should start without errors\n# Press Ctrl+C to stop\n</code></pre></p> <p>Validate batch processing: <pre><code>si-cli validate-haiku BATCH_ID\n</code></pre></p>"},{"location":"ingester/CLI/#exit-codes","title":"Exit Codes","text":"Code Meaning <code>0</code> Success <code>1</code> Configuration error / validation failed <code>130</code> Interrupted by user (Ctrl+C)"},{"location":"ingester/CLI/#environment-variables","title":"Environment Variables","text":"<p>The CLI respects all configuration environment variables. Key ones for CLI usage:</p> <ul> <li><code>DOC_DB_URL</code> - Database connection (required)</li> <li><code>LOG_LEVEL</code> - Logging verbosity (DEBUG, INFO, WARNING, ERROR)</li> <li><code>WORKFLOW_DIR</code> - Workflow definitions directory</li> <li><code>PARAM_DIR</code> - Parameter sets directory</li> <li><code>DOCLING_SERVER_URL</code> - Docling service endpoint</li> </ul> <p>See CONFIGURATION.md for complete list.</p>"},{"location":"ingester/CLI/#logging","title":"Logging","text":""},{"location":"ingester/CLI/#log-levels","title":"Log Levels","text":"<p>Set via <code>LOG_LEVEL</code> environment variable:</p> <pre><code>LOG_LEVEL=DEBUG si-cli serve\n</code></pre> <p>Levels: - <code>DEBUG</code> - Detailed diagnostic information - <code>INFO</code> - General informational messages (default) - <code>WARNING</code> - Warning messages - <code>ERROR</code> - Error messages - <code>CRITICAL</code> - Critical error messages</p>"},{"location":"ingester/CLI/#log-output","title":"Log Output","text":"<p>Logs are written to stderr. Redirect as needed:</p> <pre><code>si-cli worker 2&gt;&amp;1 | tee worker.log\n</code></pre>"},{"location":"ingester/CLI/#log-format","title":"Log Format","text":"<p>Default format includes: - Timestamp - Log level - Logger name - Message</p> <p>Example: <pre><code>2025-01-15 10:00:00,123 INFO soliplex_ingester.cli Starting server\n2025-01-15 10:00:01,456 INFO soliplex_ingester.server Starting worker\n</code></pre></p>"},{"location":"ingester/CLI/#signal-handling","title":"Signal Handling","text":""},{"location":"ingester/CLI/#graceful-shutdown","title":"Graceful Shutdown","text":"<p>The CLI handles signals for graceful shutdown:</p> <p>Signals: - <code>SIGINT</code> (Ctrl+C) - Graceful shutdown - <code>SIGTERM</code> - Graceful shutdown</p> <p>Behavior: 1. Stop accepting new work 2. Complete current operations 3. Clean up resources 4. Exit with code 0</p> <p>Example: <pre><code>si-cli worker\n# Press Ctrl+C\n# Worker completes current step and exits\n</code></pre></p>"},{"location":"ingester/CLI/#platform-notes","title":"Platform Notes","text":""},{"location":"ingester/CLI/#windows","title":"Windows","text":"<p>On Windows, the CLI automatically sets the event loop policy for compatibility:</p> <pre><code>if platform.system() == \"Windows\":\n    asyncio.set_event_loop_policy(asyncio.WindowsSelectorEventLoopPolicy())\n</code></pre> <p>This is handled automatically; no user action required.</p>"},{"location":"ingester/CLI/#unixlinux","title":"Unix/Linux","text":"<p>No special configuration needed.</p>"},{"location":"ingester/CLI/#running-with-python","title":"Running with Python","text":"<p>If <code>si-cli</code> is not in PATH, run directly:</p> <pre><code>python -m soliplex_ingester.cli --help\n</code></pre>"},{"location":"ingester/CLI/#docker-usage","title":"Docker Usage","text":"<p>Dockerfile CMD examples:</p> <p>Server: <pre><code>CMD [\"si-cli\", \"serve\", \"--host\", \"0.0.0.0\", \"--port\", \"8000\"]\n</code></pre></p> <p>Worker: <pre><code>CMD [\"si-cli\", \"worker\"]\n</code></pre></p> <p>Init container: <pre><code>CMD [\"si-cli\", \"db-init\"]\n</code></pre></p>"},{"location":"ingester/CLI/#systemd-service","title":"Systemd Service","text":"<p>Example service file:</p> <p>/etc/systemd/system/soliplex-ingester.service: <pre><code>[Unit]\nDescription=Soliplex Ingester API Server\nAfter=network.target postgresql.service\n\n[Service]\nType=simple\nUser=soliplex\nGroup=soliplex\nWorkingDirectory=/opt/soliplex-ingester\nEnvironmentFile=/etc/soliplex/config.env\nExecStart=/opt/soliplex-ingester/.venv/bin/si-cli serve --host 0.0.0.0 --port 8000\nRestart=on-failure\nRestartSec=5s\n\n[Install]\nWantedBy=multi-user.target\n</code></pre></p> <p>/etc/systemd/system/soliplex-worker@.service: <pre><code>[Unit]\nDescription=Soliplex Ingester Worker %i\nAfter=network.target postgresql.service\n\n[Service]\nType=simple\nUser=soliplex\nGroup=soliplex\nWorkingDirectory=/opt/soliplex-ingester\nEnvironmentFile=/etc/soliplex/config.env\nEnvironment=\"WORKER_ID=worker-%i\"\nExecStart=/opt/soliplex-ingester/.venv/bin/si-cli worker\nRestart=on-failure\nRestartSec=10s\n\n[Install]\nWantedBy=multi-user.target\n</code></pre></p> <p>Start services: <pre><code>sudo systemctl daemon-reload\nsudo systemctl enable soliplex-ingester\nsudo systemctl start soliplex-ingester\nsudo systemctl enable soliplex-worker@{1..3}\nsudo systemctl start soliplex-worker@{1..3}\n</code></pre></p>"},{"location":"ingester/CLI/#future-commands","title":"Future Commands","text":"<p>Commands planned for future releases:</p> <ul> <li><code>si-cli batch create</code> - Create batch via CLI</li> <li><code>si-cli batch ingest</code> - Ingest documents from directory</li> <li><code>si-cli batch status</code> - Check batch status</li> <li><code>si-cli workflow retry</code> - Retry failed workflows</li> <li><code>si-cli stats</code> - Display system statistics</li> <li><code>si-cli clean</code> - Clean up old data</li> </ul>"},{"location":"ingester/CLI/#getting-help","title":"Getting Help","text":"<p>Command help: <pre><code>si-cli --help\nsi-cli serve --help\nsi-cli worker --help\n</code></pre></p> <p>Report issues: - GitHub: https://github.com/your-repo/soliplex-ingester/issues - Include <code>si-cli validate-settings</code> output - Include relevant logs with <code>LOG_LEVEL=DEBUG</code></p>"},{"location":"ingester/CONFIGURATION/","title":"Configuration Guide","text":""},{"location":"ingester/CONFIGURATION/#overview","title":"Overview","text":"<p>Soliplex Ingester is configured via environment variables using Pydantic Settings. All configuration is defined in <code>src/soliplex/ingester/lib/config.py:15</code>.</p>"},{"location":"ingester/CONFIGURATION/#environment-variables","title":"Environment Variables","text":""},{"location":"ingester/CONFIGURATION/#database-configuration","title":"Database Configuration","text":""},{"location":"ingester/CONFIGURATION/#doc_db_url-required","title":"DOC_DB_URL (required)","text":"<p>Database connection URL.</p> <p>SQLite Example: <pre><code>DOC_DB_URL=\"sqlite+aiosqlite:///./db/documents.db\"\n</code></pre></p> <p>PostgreSQL Example: <pre><code>DOC_DB_URL=\"postgresql+psycopg://username:password@localhost:5432/soliplex\"\n</code></pre></p> <p>Notes: - Must use async drivers (<code>aiosqlite</code> for SQLite or <code>psycopg</code> for PostgreSQL) - SQLite uses relative or absolute file paths - PostgreSQL requires credentials and network access</p>"},{"location":"ingester/CONFIGURATION/#external-services","title":"External Services","text":""},{"location":"ingester/CONFIGURATION/#docling_server_url","title":"DOCLING_SERVER_URL","text":"<p>Docling document parsing service endpoint.</p> <p>Default: <code>http://localhost:5001/v1</code></p> <p>Example: <pre><code>DOCLING_SERVER_URL=\"http://docling.internal.company.com/v1\"\n</code></pre></p> <p>Notes: - Used for document parsing (PDF, DOCX, etc.) - Must be accessible from worker nodes - Health check: <code>GET {url}/health</code></p>"},{"location":"ingester/CONFIGURATION/#docling_chunk_server_url","title":"DOCLING_CHUNK_SERVER_URL","text":"<p>Docling service endpoint for chunking operations.</p> <p>Default: <code>http://localhost:5001/v1</code></p> <p>Example: <pre><code>DOCLING_CHUNK_SERVER_URL=\"http://docling-chunker.internal.company.com/v1\"\n</code></pre></p> <p>Notes: - Used by haiku.rag for document chunking via docling-serve - Can point to a different Docling instance than <code>DOCLING_SERVER_URL</code> for load distribution - If not set, defaults to the same endpoint as parsing - Useful when running separate Docling instances for parsing vs chunking</p>"},{"location":"ingester/CONFIGURATION/#docling_http_timeout","title":"DOCLING_HTTP_TIMEOUT","text":"<p>HTTP timeout for Docling requests in seconds.</p> <p>Default: <code>600</code> (10 minutes)</p> <p>Example: <pre><code>DOCLING_HTTP_TIMEOUT=300\n</code></pre></p> <p>Notes: - Large documents may require longer timeouts - Adjust based on document size and complexity</p>"},{"location":"ingester/CONFIGURATION/#ollama_base_url","title":"OLLAMA_BASE_URL","text":"<p>Ollama server endpoint for embedding generation.</p> <p>Default: <code>http://ollama:11434</code></p> <p>Example: <pre><code>OLLAMA_BASE_URL=\"http://ollama.internal.company.com:11434\"\n</code></pre></p> <p>Notes: - Used for generating document embeddings during the embed step - Must be accessible from worker nodes - The Ollama server should have the required embedding models loaded</p>"},{"location":"ingester/CONFIGURATION/#ollama_base_url_docling","title":"OLLAMA_BASE_URL_DOCLING","text":"<p>Ollama server endpoint for Docling chunking operations.</p> <p>Default: <code>http://ollama:11434</code></p> <p>Example: <pre><code>OLLAMA_BASE_URL_DOCLING=\"http://ollama-chunker.internal.company.com:11434\"\n</code></pre></p> <p>Notes: - Used by docling-serve for document chunking operations - Can point to a different Ollama instance than <code>OLLAMA_BASE_URL</code> for load distribution - If not set, defaults to the same URL as <code>OLLAMA_BASE_URL</code> - Useful when running separate Ollama instances to distribute model loading across servers</p>"},{"location":"ingester/CONFIGURATION/#logging","title":"Logging","text":""},{"location":"ingester/CONFIGURATION/#log_level","title":"LOG_LEVEL","text":"<p>Python logging level.</p> <p>Default: <code>INFO</code></p> <p>Options: <code>DEBUG</code>, <code>INFO</code>, <code>WARNING</code>, <code>ERROR</code>, <code>CRITICAL</code></p> <p>Example: <pre><code>LOG_LEVEL=DEBUG\n</code></pre></p>"},{"location":"ingester/CONFIGURATION/#file-storage","title":"File Storage","text":""},{"location":"ingester/CONFIGURATION/#file_store_target","title":"FILE_STORE_TARGET","text":"<p>Storage backend type.</p> <p>Default: <code>fs</code> (filesystem)</p> <p>Options: - <code>fs</code> - Local filesystem - <code>s3</code> - S3-compatible storage (requires OpenDAL config)</p> <p>Example: <pre><code>FILE_STORE_TARGET=s3\n</code></pre></p>"},{"location":"ingester/CONFIGURATION/#file_store_dir","title":"FILE_STORE_DIR","text":"<p>Base directory for file storage.</p> <p>Default: <code>file_store</code></p> <p>Example: <pre><code>FILE_STORE_DIR=/var/lib/soliplex/files\n</code></pre></p> <p>Notes: - Used when <code>FILE_STORE_TARGET=fs</code> - Must be writable by the application user - Consider disk space requirements</p>"},{"location":"ingester/CONFIGURATION/#document_store_dir","title":"DOCUMENT_STORE_DIR","text":"<p>Subdirectory for raw documents.</p> <p>Default: <code>raw</code></p> <p>Full Path: <code>{FILE_STORE_DIR}/{DOCUMENT_STORE_DIR}</code></p>"},{"location":"ingester/CONFIGURATION/#parsed_markdown_store_dir","title":"PARSED_MARKDOWN_STORE_DIR","text":"<p>Subdirectory for parsed markdown.</p> <p>Default: <code>markdown</code></p>"},{"location":"ingester/CONFIGURATION/#parsed_json_store_dir","title":"PARSED_JSON_STORE_DIR","text":"<p>Subdirectory for parsed JSON.</p> <p>Default: <code>json</code></p>"},{"location":"ingester/CONFIGURATION/#chunks_store_dir","title":"CHUNKS_STORE_DIR","text":"<p>Subdirectory for text chunks.</p> <p>Default: <code>chunks</code></p>"},{"location":"ingester/CONFIGURATION/#embeddings_store_dir","title":"EMBEDDINGS_STORE_DIR","text":"<p>Subdirectory for embedding vectors.</p> <p>Default: <code>embeddings</code></p>"},{"location":"ingester/CONFIGURATION/#vector-database","title":"Vector Database","text":""},{"location":"ingester/CONFIGURATION/#lancedb_dir","title":"LANCEDB_DIR","text":"<p>Directory for LanceDB vector storage.</p> <p>Default: <code>lancedb</code></p> <p>Filesystem Example: <pre><code>LANCEDB_DIR=/var/lib/soliplex/lancedb\n</code></pre></p> <p>S3 Example: <pre><code>LANCEDB_DIR=s3://my-bucket/lancedb\n</code></pre></p> <p>Notes: - Local filesystem paths or S3 URIs are supported - When using S3, LanceDB requires standard AWS environment variables (see below) - Stores vector embeddings for RAG retrieval - Requires sufficient disk space (filesystem) or S3 bucket access - Periodically compact for performance</p> <p>Required AWS Environment Variables for S3: <pre><code>AWS_ACCESS_KEY_ID=your_access_key_id\nAWS_SECRET_ACCESS_KEY=your_secret_key\nAWS_REGION=us-east-1\n</code></pre></p> <p>Optional AWS Environment Variables: <pre><code># For S3-compatible providers (MinIO, SeaweedFS, etc.)\nAWS_ENDPOINT=http://127.0.0.1:8333\n\n# Required when using HTTP to connect to endpoint\nAWS_ALLOW_HTTP=1\n</code></pre></p>"},{"location":"ingester/CONFIGURATION/#worker-configuration","title":"Worker Configuration","text":""},{"location":"ingester/CONFIGURATION/#ingest_queue_concurrency","title":"INGEST_QUEUE_CONCURRENCY","text":"<p>Maximum concurrent queue operations.</p> <p>Default: <code>20</code></p> <p>Example: <pre><code>INGEST_QUEUE_CONCURRENCY=50\n</code></pre></p> <p>Notes: - Controls internal queue processing - Higher values increase throughput but use more memory</p>"},{"location":"ingester/CONFIGURATION/#ingest_worker_concurrency","title":"INGEST_WORKER_CONCURRENCY","text":"<p>Maximum concurrent workflow steps per worker.</p> <p>Default: <code>10</code></p> <p>Example: <pre><code>INGEST_WORKER_CONCURRENCY=20\n</code></pre></p> <p>Notes: - Primary throughput control - Balance against CPU and external service limits - Monitor resource usage when tuning</p>"},{"location":"ingester/CONFIGURATION/#docling_concurrency","title":"DOCLING_CONCURRENCY","text":"<p>Maximum concurrent Docling requests.</p> <p>Default: <code>3</code></p> <p>Example: <pre><code>DOCLING_CONCURRENCY=5\n</code></pre></p> <p>Notes: - Prevents overwhelming Docling service - Coordinate with Docling server capacity - Increase if Docling can handle load</p>"},{"location":"ingester/CONFIGURATION/#worker_task_count","title":"WORKER_TASK_COUNT","text":"<p>Number of workflow steps to fetch per query.</p> <p>Default: <code>5</code></p> <p>Example: <pre><code>WORKER_TASK_COUNT=10\n</code></pre></p> <p>Notes: - Batch size for step queries - Higher values reduce database round-trips - Lower values improve fairness across workers</p>"},{"location":"ingester/CONFIGURATION/#worker_checkin_interval","title":"WORKER_CHECKIN_INTERVAL","text":"<p>Worker heartbeat interval in seconds.</p> <p>Default: <code>120</code> (2 minutes)</p> <p>Example: <pre><code>WORKER_CHECKIN_INTERVAL=60\n</code></pre></p> <p>Notes: - How often workers update health status - Lower values increase database load slightly - Used for monitoring worker liveness</p>"},{"location":"ingester/CONFIGURATION/#worker_checkin_timeout","title":"WORKER_CHECKIN_TIMEOUT","text":"<p>Worker timeout threshold in seconds.</p> <p>Default: <code>600</code> (10 minutes)</p> <p>Example: <pre><code>WORKER_CHECKIN_TIMEOUT=300\n</code></pre></p> <p>Notes: - When to consider a worker stale - Should be significantly larger than <code>WORKER_CHECKIN_INTERVAL</code> - Used for detecting crashed workers</p>"},{"location":"ingester/CONFIGURATION/#embed_batch_size","title":"EMBED_BATCH_SIZE","text":"<p>Batch size for embedding operations.</p> <p>Default: <code>1000</code></p> <p>Example: <pre><code>EMBED_BATCH_SIZE=500\n</code></pre></p> <p>Notes: - Number of chunks to embed at once - Higher values improve throughput - Limited by embedding service capacity and memory</p>"},{"location":"ingester/CONFIGURATION/#workflow-configuration","title":"Workflow Configuration","text":""},{"location":"ingester/CONFIGURATION/#workflow_dir","title":"WORKFLOW_DIR","text":"<p>Directory containing workflow YAML definitions.</p> <p>Default: <code>config/workflows</code></p> <p>Example: <pre><code>WORKFLOW_DIR=/etc/soliplex/workflows\n</code></pre></p> <p>Notes: - Scanned for <code>*.yaml</code> files at startup - Hot-reload if <code>--reload</code> flag is used</p>"},{"location":"ingester/CONFIGURATION/#default_workflow_id","title":"DEFAULT_WORKFLOW_ID","text":"<p>Default workflow to use when not specified.</p> <p>Default: <code>batch_split</code></p> <p>Example: <pre><code>DEFAULT_WORKFLOW_ID=batch\n</code></pre></p> <p>Notes: - Must match an <code>id</code> in workflow YAML files - Used when API requests omit <code>workflow_definition_id</code></p>"},{"location":"ingester/CONFIGURATION/#param_dir","title":"PARAM_DIR","text":"<p>Directory containing parameter set YAML files.</p> <p>Default: <code>config/params</code></p> <p>Example: <pre><code>PARAM_DIR=/etc/soliplex/params\n</code></pre></p>"},{"location":"ingester/CONFIGURATION/#default_param_id","title":"DEFAULT_PARAM_ID","text":"<p>Default parameter set to use when not specified.</p> <p>Default: <code>default</code></p> <p>Example: <pre><code>DEFAULT_PARAM_ID=high_quality\n</code></pre></p> <p>Notes: - Must match an <code>id</code> in parameter YAML files</p>"},{"location":"ingester/CONFIGURATION/#feature-flags","title":"Feature Flags","text":""},{"location":"ingester/CONFIGURATION/#do_rag","title":"DO_RAG","text":"<p>Enable/disable HaikuRAG integration.</p> <p>Default: <code>True</code></p> <p>Example: <pre><code>DO_RAG=false\n</code></pre></p> <p>Notes: - Set to <code>false</code> for testing without RAG backend - When disabled, <code>store</code> step becomes a no-op - Useful for CI/CD testing</p>"},{"location":"ingester/CONFIGURATION/#authentication","title":"Authentication","text":""},{"location":"ingester/CONFIGURATION/#api_key","title":"API_KEY","text":"<p>Static API key for programmatic access.</p> <p>Default: None (disabled)</p> <p>Example: <pre><code>API_KEY=your-secret-api-key-here\n</code></pre></p> <p>Notes: - Generate with: <code>openssl rand -hex 32</code> - Must also set <code>API_KEY_ENABLED=true</code> to enforce - Clients pass via <code>Authorization: Bearer &lt;token&gt;</code> header - Keep this value secure - do not commit to version control</p>"},{"location":"ingester/CONFIGURATION/#api_key_enabled","title":"API_KEY_ENABLED","text":"<p>Enable API key authentication.</p> <p>Default: <code>False</code></p> <p>Example: <pre><code>API_KEY_ENABLED=true\n</code></pre></p> <p>Notes: - When <code>true</code>, all API requests require valid <code>Authorization: Bearer</code> header - When <code>false</code>, API is open (or protected by OAuth2 Proxy) - Can be combined with <code>AUTH_TRUST_PROXY_HEADERS</code> for hybrid auth</p>"},{"location":"ingester/CONFIGURATION/#auth_trust_proxy_headers","title":"AUTH_TRUST_PROXY_HEADERS","text":"<p>Trust user identity headers from OAuth2 Proxy.</p> <p>Default: <code>False</code></p> <p>Example: <pre><code>AUTH_TRUST_PROXY_HEADERS=true\n</code></pre></p> <p>Notes: - Enable when running behind OAuth2 Proxy - Reads user identity from <code>X-Auth-Request-User</code>, <code>X-Auth-Request-Email</code> headers - Security: Only enable when behind a trusted reverse proxy - See AUTHENTICATION.md for OAuth2 Proxy setup</p>"},{"location":"ingester/CONFIGURATION/#configuration-file","title":"Configuration File","text":"<p>While the system uses environment variables, you can organize them in a <code>.env</code> file:</p> <p>.env Example: <pre><code># Database\nDOC_DB_URL=sqlite+aiosqlite:///./db/documents.db\n\n# External Services\nDOCLING_SERVER_URL=http://localhost:5001/v1\nDOCLING_HTTP_TIMEOUT=600\n\n# Logging\nLOG_LEVEL=INFO\n\n# Storage\nFILE_STORE_TARGET=fs\nFILE_STORE_DIR=file_store\nLANCEDB_DIR=lancedb\n\n# Worker Settings\nINGEST_WORKER_CONCURRENCY=10\nDOCLING_CONCURRENCY=3\nWORKER_TASK_COUNT=5\nWORKER_CHECKIN_INTERVAL=120\nWORKER_CHECKIN_TIMEOUT=600\nEMBED_BATCH_SIZE=1000\n\n# Workflow Configuration\nWORKFLOW_DIR=config/workflows\nDEFAULT_WORKFLOW_ID=batch\nPARAM_DIR=config/params\nDEFAULT_PARAM_ID=default\n\n# Features\nDO_RAG=true\n</code></pre></p> <p>Load with: <pre><code>export $(cat .env | xargs)\nsi-cli serve\n</code></pre></p>"},{"location":"ingester/CONFIGURATION/#s3-configuration-overview","title":"S3 Configuration Overview","text":"<p>This project supports S3 storage in two different contexts with different configuration methods:</p>"},{"location":"ingester/CONFIGURATION/#1-lancedb-vector-storage-lancedb_dir","title":"1. LanceDB Vector Storage (<code>LANCEDB_DIR</code>)","text":"<p>Purpose: Stores vector embeddings for RAG retrieval Configuration Method: Standard AWS environment variables Example: <pre><code>LANCEDB_DIR=s3://my-vector-bucket/lancedb\nAWS_ACCESS_KEY_ID=your_key_id\nAWS_SECRET_ACCESS_KEY=your_secret_key\nAWS_REGION=us-east-1\n</code></pre></p>"},{"location":"ingester/CONFIGURATION/#2-artifact-storage-file_store_targets3","title":"2. Artifact Storage (<code>FILE_STORE_TARGET=s3</code>)","text":"<p>Purpose: Stores intermediate processing artifacts (documents, markdown, chunks, embeddings) Configuration Method: Nested Pydantic settings with <code>__</code> delimiter Example: <pre><code>FILE_STORE_TARGET=s3\nARTIFACT_S3__BUCKET=my-artifact-bucket\nARTIFACT_S3__ACCESS_KEY_ID=your_key_id\nARTIFACT_S3__ACCESS_SECRET=your_secret_key\nARTIFACT_S3__REGION=us-east-1\nARTIFACT_S3__ENDPOINT_URL=http://127.0.0.1:8333\n</code></pre></p> <p>Important Notes: - These are independent systems and can use different S3 buckets or providers - LanceDB uses standard AWS SDK naming (<code>AWS_SECRET_ACCESS_KEY</code>) - Artifact/Input S3 uses Pydantic nested naming (<code>ARTIFACT_S3__ACCESS_SECRET</code>) - The field name difference is intentional to support Pydantic's nested configuration</p>"},{"location":"ingester/CONFIGURATION/#nested-configuration-advanced","title":"Nested Configuration (Advanced)","text":"<p>Pydantic Settings supports nested configuration using <code>__</code> delimiter for structured settings.</p> <p>Artifact S3 Configuration: <pre><code>ARTIFACT_S3__BUCKET=soliplex-artifacts\nARTIFACT_S3__ACCESS_KEY_ID=soliplex\nARTIFACT_S3__ACCESS_SECRET=soliplex\nARTIFACT_S3__REGION=xx\nARTIFACT_S3__ENDPOINT_URL=http://127.0.0.1:8333\n</code></pre></p> <p>Input S3 Configuration: <pre><code>INPUT_S3__BUCKET=soliplex-inputs\nINPUT_S3__ACCESS_KEY_ID=soliplex\nINPUT_S3__ACCESS_SECRET=soliplex\nINPUT_S3__REGION=xx\nINPUT_S3__ENDPOINT_URL=http://127.0.0.1:8333\n</code></pre></p> <p>Notes: - <code>ACCESS_SECRET</code> (not <code>SECRET_ACCESS_KEY</code>) is used for nested config fields - Nested delimiter is <code>__</code> (double underscore) - Both <code>INPUT_S3</code> and <code>ARTIFACT_S3</code> can point to different buckets/providers</p> <p>See <code>src/soliplex/ingester/lib/config.py:7-16</code> for nested model definitions.</p>"},{"location":"ingester/CONFIGURATION/#configuration-validation","title":"Configuration Validation","text":""},{"location":"ingester/CONFIGURATION/#validate-settings","title":"Validate Settings","text":"<p>Check configuration without starting services:</p> <pre><code>si-cli validate-settings\n</code></pre> <p>Output: <pre><code>doc_db_url='sqlite+aiosqlite:///./db/documents.db'\ndocling_server_url='http://localhost:5001/v1'\nlog_level='INFO'\n...\n</code></pre></p> <p>Validation Errors: <pre><code>invalid settings\n{'type': 'missing', 'loc': ('doc_db_url',), 'msg': 'Field required'}\n</code></pre></p>"},{"location":"ingester/CONFIGURATION/#environment-specific-configuration","title":"Environment-Specific Configuration","text":""},{"location":"ingester/CONFIGURATION/#development","title":"Development","text":"<p>dev.env: <pre><code>DOC_DB_URL=sqlite+aiosqlite:///./db/dev.db\nLOG_LEVEL=DEBUG\nINGEST_WORKER_CONCURRENCY=5\nDO_RAG=false\n</code></pre></p>"},{"location":"ingester/CONFIGURATION/#staging","title":"Staging","text":"<p>staging.env: <pre><code>DOC_DB_URL=postgresql+psycopg://user:pass@staging-db:5432/soliplex\nLOG_LEVEL=INFO\nINGEST_WORKER_CONCURRENCY=10\nDOCLING_SERVER_URL=http://docling-staging:5001/v1\nDO_RAG=true\n</code></pre></p>"},{"location":"ingester/CONFIGURATION/#production","title":"Production","text":"<p>production.env: <pre><code>DOC_DB_URL=postgresql+psycopg://user:pass@prod-db:5432/soliplex\nLOG_LEVEL=WARNING\nINGEST_WORKER_CONCURRENCY=20\nDOCLING_CONCURRENCY=5\nDOCLING_SERVER_URL=http://docling-prod:5001/v1\nFILE_STORE_TARGET=s3\nDO_RAG=true\nWORKER_CHECKIN_INTERVAL=60\n</code></pre></p>"},{"location":"ingester/CONFIGURATION/#docker-configuration","title":"Docker Configuration","text":""},{"location":"ingester/CONFIGURATION/#docker-compose-example","title":"Docker Compose Example","text":"<p>docker-compose.yml: <pre><code>version: '3.8'\n\nservices:\n  ingester:\n    image: soliplex-ingester:latest\n    environment:\n      DOC_DB_URL: postgresql+psycopg://postgres:password@db:5432/soliplex\n      DOCLING_SERVER_URL: http://docling:5001/v1\n      LOG_LEVEL: INFO\n      FILE_STORE_DIR: /data/files\n      LANCEDB_DIR: /data/lancedb\n      INGEST_WORKER_CONCURRENCY: 15\n    volumes:\n      - ./config/workflows:/app/config/workflows\n      - ./config/params:/app/config/params\n      - data-volume:/data\n    depends_on:\n      - db\n      - docling\n\n  db:\n    image: postgres:16\n    environment:\n      POSTGRES_DB: soliplex\n      POSTGRES_USER: postgres\n      POSTGRES_PASSWORD: password\n    volumes:\n      - db-volume:/var/lib/postgresql/data\n\n  docling:\n    image: docling-server:latest\n    ports:\n      - \"5001:5001\"\n\nvolumes:\n  db-volume:\n  data-volume:\n</code></pre></p>"},{"location":"ingester/CONFIGURATION/#kubernetes-configmap","title":"Kubernetes ConfigMap","text":"<p>configmap.yaml: <pre><code>apiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: soliplex-config\ndata:\n  DOC_DB_URL: \"postgresql+psycopg://user:pass@postgres-service:5432/soliplex\"\n  DOCLING_SERVER_URL: \"http://docling-service:5001/v1\"\n  LOG_LEVEL: \"INFO\"\n  INGEST_WORKER_CONCURRENCY: \"20\"\n  WORKFLOW_DIR: \"/config/workflows\"\n  PARAM_DIR: \"/config/params\"\n</code></pre></p>"},{"location":"ingester/CONFIGURATION/#performance-tuning","title":"Performance Tuning","text":""},{"location":"ingester/CONFIGURATION/#high-throughput","title":"High Throughput","text":"<pre><code>INGEST_WORKER_CONCURRENCY=50\nDOCLING_CONCURRENCY=10\nWORKER_TASK_COUNT=20\nEMBED_BATCH_SIZE=2000\n</code></pre> <p>Notes: - Requires powerful hardware - Monitor CPU, memory, and I/O - Coordinate with external service capacity</p>"},{"location":"ingester/CONFIGURATION/#resource-constrained","title":"Resource Constrained","text":"<pre><code>INGEST_WORKER_CONCURRENCY=5\nDOCLING_CONCURRENCY=2\nWORKER_TASK_COUNT=3\nEMBED_BATCH_SIZE=500\n</code></pre> <p>Notes: - Reduces memory and CPU usage - Lower throughput but more stable - Good for shared environments</p>"},{"location":"ingester/CONFIGURATION/#batch-processing","title":"Batch Processing","text":"<pre><code>INGEST_WORKER_CONCURRENCY=30\nDOCLING_CONCURRENCY=8\nWORKER_TASK_COUNT=10\nWORKER_CHECKIN_INTERVAL=300\n</code></pre> <p>Notes: - Optimized for processing large batches - Reduces monitoring overhead - Assumes long-running workers</p>"},{"location":"ingester/CONFIGURATION/#secrets-management","title":"Secrets Management","text":""},{"location":"ingester/CONFIGURATION/#using-environment-files","title":"Using Environment Files","text":"<p>Keep secrets out of version control:</p> <pre><code># .env.secrets (add to .gitignore)\nDOC_DB_URL=postgresql+psycopg://user:$(cat /run/secrets/db_password)@db/soliplex\n</code></pre>"},{"location":"ingester/CONFIGURATION/#using-secret-management-tools","title":"Using Secret Management Tools","text":"<p>AWS Secrets Manager: <pre><code>export DOC_DB_URL=$(aws secretsmanager get-secret-value --secret-id db-url --query SecretString --output text)\n</code></pre></p> <p>HashiCorp Vault: <pre><code>export DOC_DB_URL=$(vault kv get -field=url secret/soliplex/db)\n</code></pre></p> <p>Kubernetes Secrets: <pre><code>env:\n  - name: DOC_DB_URL\n    valueFrom:\n      secretKeyRef:\n        name: db-credentials\n        key: url\n</code></pre></p>"},{"location":"ingester/CONFIGURATION/#troubleshooting","title":"Troubleshooting","text":""},{"location":"ingester/CONFIGURATION/#configuration-not-loading","title":"Configuration Not Loading","text":"<p>Symptom: Application uses default values</p> <p>Solutions: 1. Verify environment variables are set: <code>env | grep DOC_</code> 2. Check for typos in variable names 3. Ensure <code>.env</code> file is in correct directory 4. Verify <code>.env</code> file is being loaded</p>"},{"location":"ingester/CONFIGURATION/#validation-errors","title":"Validation Errors","text":"<p>Symptom: Application fails to start with validation error</p> <p>Solutions: 1. Run <code>si-cli validate-settings</code> to see errors 2. Check required fields are set 3. Verify value types (e.g., integers for ports) 4. Check URL formats</p>"},{"location":"ingester/CONFIGURATION/#connection-errors","title":"Connection Errors","text":"<p>Symptom: Cannot connect to database or Docling</p> <p>Solutions: 1. Verify URLs are correct 2. Test connectivity: <code>curl http://docling-url/health</code> 3. Check network policies/firewall 4. Verify credentials</p>"},{"location":"ingester/CONFIGURATION/#file-permissions","title":"File Permissions","text":"<p>Symptom: Cannot write to storage directories</p> <p>Solutions: 1. Check directory exists and is writable 2. Verify application user permissions 3. Create directories if needed: <code>mkdir -p file_store lancedb</code> 4. Set ownership: <code>chown -R app-user file_store lancedb</code></p>"},{"location":"ingester/CONFIGURATION/#configuration-reference","title":"Configuration Reference","text":"Variable Type Required Default Description <code>DOC_DB_URL</code> str Yes - Database connection URL <code>DOCLING_SERVER_URL</code> str No <code>http://localhost:5001/v1</code> Docling parsing service URL <code>DOCLING_CHUNK_SERVER_URL</code> str No <code>http://localhost:5001/v1</code> Docling chunking service URL <code>DOCLING_HTTP_TIMEOUT</code> int No <code>600</code> Docling timeout (seconds) <code>LOG_LEVEL</code> str No <code>INFO</code> Logging level <code>FILE_STORE_TARGET</code> str No <code>fs</code> Storage backend type <code>FILE_STORE_DIR</code> str No <code>file_store</code> Base storage directory <code>LANCEDB_DIR</code> str No <code>lancedb</code> LanceDB directory (supports S3 URIs) <code>DOCUMENT_STORE_DIR</code> str No <code>raw</code> Raw documents subdir <code>PARSED_MARKDOWN_STORE_DIR</code> str No <code>markdown</code> Markdown subdir <code>PARSED_JSON_STORE_DIR</code> str No <code>json</code> JSON subdir <code>CHUNKS_STORE_DIR</code> str No <code>chunks</code> Chunks subdir <code>EMBEDDINGS_STORE_DIR</code> str No <code>embeddings</code> Embeddings subdir <code>INGEST_QUEUE_CONCURRENCY</code> int No <code>20</code> Queue concurrency <code>INGEST_WORKER_CONCURRENCY</code> int No <code>10</code> Worker concurrency <code>DOCLING_CONCURRENCY</code> int No <code>3</code> Docling concurrency <code>WORKER_TASK_COUNT</code> int No <code>5</code> Steps per query <code>WORKER_CHECKIN_INTERVAL</code> int No <code>120</code> Heartbeat interval (sec) <code>WORKER_CHECKIN_TIMEOUT</code> int No <code>600</code> Worker timeout (sec) <code>EMBED_BATCH_SIZE</code> int No <code>1000</code> Embedding batch size <code>OLLAMA_BASE_URL</code> str No <code>http://ollama:11434</code> Ollama server URL for embeddings <code>OLLAMA_BASE_URL_DOCLING</code> str No <code>http://ollama:11434</code> Ollama server URL for Docling chunking (can differ for load distribution) <code>WORKFLOW_DIR</code> str No <code>config/workflows</code> Workflow definitions dir <code>DEFAULT_WORKFLOW_ID</code> str No <code>batch_split</code> Default workflow <code>PARAM_DIR</code> str No <code>config/params</code> Parameter sets dir <code>DEFAULT_PARAM_ID</code> str No <code>default</code> Default parameter set <code>AWS_ACCESS_KEY_ID</code> str Conditional - AWS access key (required for S3 LanceDB) <code>AWS_SECRET_ACCESS_KEY</code> str Conditional - AWS secret key (required for S3 LanceDB) <code>AWS_REGION</code> str Conditional - AWS region (required for S3 LanceDB) <code>AWS_ENDPOINT</code> str No - S3 endpoint (for non-AWS providers) <code>AWS_ALLOW_HTTP</code> int No - Allow HTTP for S3 (set to 1 for HTTP) <code>ARTIFACT_S3__*</code> nested Conditional - Artifact S3 config (BUCKET, ACCESS_SECRET, etc.) <code>INPUT_S3__*</code> nested Conditional - Input S3 config (BUCKET, ACCESS_SECRET, etc.) <code>DO_RAG</code> bool No <code>True</code> Enable RAG integration <code>API_KEY</code> str Conditional - Static API key (required if API_KEY_ENABLED) <code>API_KEY_ENABLED</code> bool No <code>False</code> Enable API key authentication <code>AUTH_TRUST_PROXY_HEADERS</code> bool No <code>False</code> Trust OAuth2 Proxy headers"},{"location":"ingester/DATABASE/","title":"Database Models and Schema","text":""},{"location":"ingester/DATABASE/#overview","title":"Overview","text":"<p>Soliplex Ingester uses SQLModel (built on SQLAlchemy) for database modeling with async support. The system supports both SQLite (development) and PostgreSQL (production).</p> <p>Database models defined in: <code>src/soliplex/ingester/lib/models.py</code></p>"},{"location":"ingester/DATABASE/#database-connection","title":"Database Connection","text":""},{"location":"ingester/DATABASE/#configuration","title":"Configuration","text":"<p>Set via environment variable: <pre><code>DOC_DB_URL=\"sqlite+aiosqlite:///./db/documents.db\"\n# or\nDOC_DB_URL=\"postgresql+asyncpg://user:pass@localhost/soliplex\"\n</code></pre></p>"},{"location":"ingester/DATABASE/#database-manager","title":"Database Manager","text":"<p>The <code>Database</code> class manages engine lifecycle and session creation with automatic connection pooling.</p> <pre><code>from soliplex.ingester.lib.models import Database\n\n# Initialize once at application startup\nawait Database.initialize()\n\n# Or with custom URL (for testing)\nawait Database.initialize(\"sqlite+aiosqlite:///:memory:\")\n\n# Get sessions anywhere in the app\nasync with Database.session() as session:\n    result = await session.exec(select(Document))\n    # Transaction auto-commits on success, rollback on exception\n\n# Cleanup at shutdown\nawait Database.close()\n\n# Reset and reinitialize (primarily for testing)\nawait Database.reset(url)\n</code></pre>"},{"location":"ingester/DATABASE/#backwards-compatible-functions","title":"Backwards-Compatible Functions","text":"<pre><code>from soliplex.ingester.lib.models import get_session, get_engine\n\nasync with get_session() as session:\n    result = await session.exec(select(Document))\n\nengine = await get_engine()\n</code></pre>"},{"location":"ingester/DATABASE/#core-models","title":"Core Models","text":""},{"location":"ingester/DATABASE/#documentbatch","title":"DocumentBatch","text":"<p>Represents a batch of documents ingested together.</p> <p>Table: <code>documentbatch</code></p> <p>Fields: - <code>id</code> (int, primary key) - Auto-increment batch ID - <code>name</code> (str) - Human-readable batch name - <code>source</code> (str) - Source system identifier - <code>start_date</code> (datetime) - When batch processing started - <code>completed_date</code> (datetime, nullable) - When batch completed - <code>batch_params</code> (dict[str, str]) - JSON metadata</p> <p>Computed Fields: - <code>duration</code> (float) - Processing time in seconds (None if not completed)</p> <p>Example: <pre><code>{\n  \"id\": 1,\n  \"name\": \"Q4 Financial Reports\",\n  \"source\": \"sharepoint\",\n  \"start_date\": \"2025-01-15T10:00:00\",\n  \"completed_date\": \"2025-01-15T12:30:00\",\n  \"batch_params\": {\"department\": \"finance\"},\n  \"duration\": 9000.0\n}\n</code></pre></p>"},{"location":"ingester/DATABASE/#document","title":"Document","text":"<p>Represents a unique document identified by content hash.</p> <p>Table: <code>document</code></p> <p>Fields: - <code>hash</code> (str, primary key) - SHA256 content hash (format: \"sha256-...\") - <code>mime_type</code> (str) - Document MIME type - <code>file_size</code> (int, nullable) - Size in bytes - <code>doc_meta</code> (dict[str, str]) - JSON metadata</p> <p>Relationships: - Multiple <code>DocumentURI</code> records can reference the same document</p> <p>Deduplication: Documents are deduplicated by hash. If the same file is ingested multiple times, only one Document record exists.</p> <p>Example: <pre><code>{\n  \"hash\": \"sha256-a1b2c3d4e5f6...\",\n  \"mime_type\": \"application/pdf\",\n  \"file_size\": 1024000,\n  \"doc_meta\": {\n    \"author\": \"John Doe\",\n    \"title\": \"Q4 Report\"\n  }\n}\n</code></pre></p>"},{"location":"ingester/DATABASE/#documenturi","title":"DocumentURI","text":"<p>Maps source URIs to document hashes, allowing multiple URIs to reference the same document.</p> <p>Table: <code>documenturi</code></p> <p>Fields: - <code>id</code> (int, primary key) - Auto-increment ID - <code>doc_hash</code> (str, foreign key) - References <code>document.hash</code> - <code>uri</code> (str) - Source system path/identifier - <code>source</code> (str) - Source system name - <code>version</code> (int) - Version number (increments on changes) - <code>batch_id</code> (int, foreign key, nullable) - Associated batch</p> <p>Constraints: - Unique constraint on <code>(uri, source)</code> - One active URI per source</p> <p>Use Cases: - Track document locations across source systems - Detect when a document at a URI has changed (hash mismatch) - Support document versioning</p> <p>Example: <pre><code>{\n  \"id\": 42,\n  \"doc_hash\": \"sha256-a1b2c3d4e5f6...\",\n  \"uri\": \"/sharepoint/finance/q4-report.pdf\",\n  \"source\": \"sharepoint\",\n  \"version\": 2,\n  \"batch_id\": 1\n}\n</code></pre></p>"},{"location":"ingester/DATABASE/#documenturihistory","title":"DocumentURIHistory","text":"<p>Tracks historical versions of documents at specific URIs.</p> <p>Table: <code>documenturihistory</code></p> <p>Fields: - <code>id</code> (int, primary key) - Auto-increment ID - <code>doc_uri_id</code> (int, foreign key) - References <code>documenturi.id</code> - <code>version</code> (int) - Version number - <code>hash</code> (str) - Document hash at this version - <code>process_date</code> (datetime) - When this version was processed - <code>action</code> (str) - Action taken (\"created\", \"updated\", \"deleted\") - <code>batch_id</code> (int, foreign key, nullable) - Associated batch - <code>histmeta</code> (dict[str, str]) - JSON metadata</p> <p>Use Cases: - Audit trail of document changes - Rollback to previous versions - Compliance and record-keeping</p> <p>Example: <pre><code>{\n  \"id\": 100,\n  \"doc_uri_id\": 42,\n  \"version\": 1,\n  \"hash\": \"sha256-old-hash...\",\n  \"process_date\": \"2025-01-10T10:00:00\",\n  \"action\": \"created\",\n  \"batch_id\": 1,\n  \"histmeta\": {\"user\": \"importer\"}\n}\n</code></pre></p>"},{"location":"ingester/DATABASE/#documentbytes","title":"DocumentBytes","text":"<p>Stores raw file bytes and artifacts in the database.</p> <p>Table: <code>documentbytes</code></p> <p>Fields: - <code>hash</code> (str, primary key) - Document hash - <code>artifact_type</code> (str, primary key) - Type of artifact - <code>storage_root</code> (str, primary key) - Storage location identifier - <code>file_size</code> (int, nullable) - Size in bytes (auto-computed from file_bytes) - <code>file_bytes</code> (bytes) - Raw binary data</p> <p>Artifact Types: - <code>document</code> - Raw document - <code>parsed_markdown</code> - Extracted markdown - <code>parsed_json</code> - Structured JSON - <code>chunks</code> - Text chunks - <code>embeddings</code> - Vector embeddings - <code>rag</code> - RAG metadata</p> <p>Note: For production, consider using file storage instead of database storage for large binaries.</p> <p>Example: <pre><code>{\n  \"hash\": \"sha256-a1b2c3d4e5f6...\",\n  \"artifact_type\": \"parsed_markdown\",\n  \"storage_root\": \"db\",\n  \"file_size\": 50000,\n  \"file_bytes\": \"...\"\n}\n</code></pre></p>"},{"location":"ingester/DATABASE/#workflow-models","title":"Workflow Models","text":""},{"location":"ingester/DATABASE/#rungroup","title":"RunGroup","text":"<p>Groups related workflow runs together.</p> <p>Table: <code>rungroup</code></p> <p>Fields: - <code>id</code> (int, primary key) - Auto-increment ID - <code>name</code> (str, nullable) - Optional group name - <code>workflow_definition_id</code> (str) - Workflow used - <code>param_definition_id</code> (str) - Parameter set used - <code>batch_id</code> (int, foreign key, nullable) - Associated batch - <code>created_date</code> (datetime) - When group was created - <code>start_date</code> (datetime) - When first run started - <code>completed_date</code> (datetime, nullable) - When all runs completed - <code>status</code> (RunStatus) - Overall group status - <code>status_date</code> (datetime, nullable) - When status last changed - <code>status_message</code> (str, nullable) - Status description - <code>status_meta</code> (dict[str, str]) - JSON metadata</p> <p>Relationships: - Has many <code>WorkflowRun</code> records - Has many <code>LifecycleHistory</code> records</p> <p>Example: <pre><code>{\n  \"id\": 5,\n  \"name\": \"Batch 1 Processing\",\n  \"workflow_definition_id\": \"batch\",\n  \"param_definition_id\": \"default\",\n  \"batch_id\": 1,\n  \"created_date\": \"2025-01-15T10:00:00\",\n  \"start_date\": \"2025-01-15T10:01:00\",\n  \"completed_date\": null,\n  \"status\": \"RUNNING\",\n  \"status_date\": \"2025-01-15T10:30:00\",\n  \"status_message\": \"Processing documents\",\n  \"status_meta\": {}\n}\n</code></pre></p>"},{"location":"ingester/DATABASE/#workflowrun","title":"WorkflowRun","text":"<p>Represents a single workflow execution for one document.</p> <p>Table: <code>workflowrun</code></p> <p>Fields: - <code>id</code> (int, primary key) - Auto-increment ID - <code>workflow_definition_id</code> (str) - Workflow definition ID - <code>run_group_id</code> (int, foreign key) - Parent group - <code>batch_id</code> (int, foreign key) - Associated batch - <code>doc_id</code> (str) - Document hash being processed - <code>priority</code> (int) - Processing priority (higher = more urgent) - <code>created_date</code> (datetime) - When run was created - <code>start_date</code> (datetime) - When first step started - <code>completed_date</code> (datetime, nullable) - When all steps completed - <code>status</code> (RunStatus) - Current status - <code>status_date</code> (datetime, nullable) - When status last changed - <code>status_message</code> (str, nullable) - Status description - <code>status_meta</code> (dict[str, str]) - JSON metadata - <code>run_params</code> (dict[str, str|int|bool]) - Runtime parameters</p> <p>Computed Fields: - <code>duration</code> (float) - Processing time in seconds (None if not completed)</p> <p>Relationships: - Has many <code>RunStep</code> records - Belongs to <code>RunGroup</code> - References <code>Document</code> via <code>doc_id</code></p> <p>Example: <pre><code>{\n  \"id\": 100,\n  \"workflow_definition_id\": \"batch\",\n  \"run_group_id\": 5,\n  \"batch_id\": 1,\n  \"doc_id\": \"sha256-a1b2c3d4e5f6...\",\n  \"priority\": 0,\n  \"created_date\": \"2025-01-15T10:00:00\",\n  \"start_date\": \"2025-01-15T10:01:00\",\n  \"completed_date\": null,\n  \"status\": \"RUNNING\",\n  \"status_date\": \"2025-01-15T10:05:00\",\n  \"status_message\": \"Processing step 3 of 5\",\n  \"status_meta\": {},\n  \"run_params\": {},\n  \"duration\": null\n}\n</code></pre></p>"},{"location":"ingester/DATABASE/#runstep","title":"RunStep","text":"<p>Represents one step within a workflow run.</p> <p>Table: <code>runstep</code></p> <p>Fields: - <code>id</code> (int, primary key) - Auto-increment ID - <code>workflow_run_id</code> (int, foreign key) - Parent workflow run - <code>workflow_step_number</code> (int) - Step sequence number - <code>workflow_step_name</code> (str) - Step name/identifier - <code>step_config_id</code> (int, foreign key) - Configuration used - <code>step_type</code> (WorkflowStepType) - Type of step - <code>is_last_step</code> (bool) - Whether this is the final step - <code>created_date</code> (datetime) - When step was created - <code>priority</code> (int) - Processing priority - <code>start_date</code> (datetime, nullable) - When step started executing - <code>status_date</code> (datetime, nullable) - When status last changed - <code>completed_date</code> (datetime, nullable) - When step completed - <code>retry</code> (int) - Current retry attempt (0-indexed) - <code>retries</code> (int) - Maximum retry attempts - <code>status</code> (RunStatus) - Current status - <code>status_message</code> (str, nullable) - Status description - <code>status_meta</code> (dict[str, str]) - JSON metadata - <code>worker_id</code> (str, nullable) - Worker processing this step</p> <p>Computed Fields: - <code>duration</code> (float) - Execution time in seconds (None if not completed)</p> <p>Relationships: - Belongs to <code>WorkflowRun</code> - References <code>StepConfig</code></p> <p>Example: <pre><code>{\n  \"id\": 500,\n  \"workflow_run_id\": 100,\n  \"workflow_step_number\": 2,\n  \"workflow_step_name\": \"parse\",\n  \"step_config_id\": 10,\n  \"step_type\": \"parse\",\n  \"is_last_step\": false,\n  \"created_date\": \"2025-01-15T10:01:00\",\n  \"priority\": 0,\n  \"start_date\": \"2025-01-15T10:02:00\",\n  \"status_date\": \"2025-01-15T10:05:00\",\n  \"completed_date\": null,\n  \"retry\": 0,\n  \"retries\": 1,\n  \"status\": \"RUNNING\",\n  \"status_message\": \"Parsing with Docling\",\n  \"status_meta\": {},\n  \"worker_id\": \"worker-abc-123\",\n  \"duration\": null\n}\n</code></pre></p>"},{"location":"ingester/DATABASE/#stepconfig","title":"StepConfig","text":"<p>Stores step configuration for reuse and tracking.</p> <p>Table: <code>stepconfig</code></p> <p>Fields: - <code>id</code> (int, primary key) - Auto-increment ID - <code>created_date</code> (datetime, nullable) - When config was created - <code>step_type</code> (WorkflowStepType) - Type of step - <code>config_json</code> (dict[str, str|int|bool], nullable) - Step parameters - <code>cuml_config_json</code> (str, nullable) - Cumulative config from previous steps</p> <p>Use Cases: - Deduplicate identical configurations - Track which configuration was used for each run - Audit changes to processing parameters</p> <p>Example: <pre><code>{\n  \"id\": 10,\n  \"created_date\": \"2025-01-15T09:00:00\",\n  \"step_type\": \"parse\",\n  \"config_json\": {\n    \"format\": \"markdown\",\n    \"ocr_enabled\": true\n  },\n  \"cuml_config_json\": \"{\\\"validate\\\":{...},\\\"parse\\\":{...}}\"\n}\n</code></pre></p>"},{"location":"ingester/DATABASE/#configset","title":"ConfigSet","text":"<p>Represents a complete parameter set configuration.</p> <p>Table: <code>configset</code></p> <p>Fields: - <code>id</code> (int, primary key) - Auto-increment ID - <code>yaml_id</code> (str) - Parameter set ID from YAML - <code>yaml_contents</code> (str) - Full YAML contents - <code>created_date</code> (datetime, nullable) - When loaded</p> <p>Relationships: - Has many <code>ConfigSetItem</code> records (junction table) - Links to multiple <code>StepConfig</code> records</p> <p>Use Cases: - Track which parameter sets were used - Reproduce exact configurations - Version control for processing parameters</p>"},{"location":"ingester/DATABASE/#configsetitem","title":"ConfigSetItem","text":"<p>Junction table linking config sets to step configs.</p> <p>Table: <code>configsetitem</code></p> <p>Fields: - <code>config_set_id</code> (int, primary key, foreign key) - References <code>configset.id</code> - <code>config_id</code> (int, primary key, foreign key) - References <code>stepconfig.id</code></p>"},{"location":"ingester/DATABASE/#lifecyclehistory","title":"LifecycleHistory","text":"<p>Tracks lifecycle events during workflow execution.</p> <p>Table: <code>lifecyclehistory</code></p> <p>Fields: - <code>id</code> (int, primary key) - Auto-increment ID - <code>event</code> (LifeCycleEvent) - Type of event - <code>handler_name</code> (str, nullable) - Name of the handler processing the event - <code>run_group_id</code> (int, foreign key) - Associated run group - <code>workflow_run_id</code> (int, foreign key) - Associated workflow run - <code>step_id</code> (int, nullable) - Associated step (if applicable) - <code>start_date</code> (datetime) - When event started - <code>completed_date</code> (datetime, nullable) - When event completed - <code>status</code> (RunStatus) - Event status - <code>status_date</code> (datetime, nullable) - When status changed - <code>status_message</code> (str, nullable) - Status description - <code>status_meta</code> (dict[str, str]) - JSON metadata</p> <p>Event Types: - <code>group_start</code> / <code>group_end</code> - <code>item_start</code> / <code>item_end</code> / <code>item_failed</code> - <code>step_start</code> / <code>step_end</code> / <code>step_failed</code></p> <p>Use Cases: - Audit trail of workflow execution - Performance monitoring - Debugging workflow issues</p>"},{"location":"ingester/DATABASE/#workercheckin","title":"WorkerCheckin","text":"<p>Tracks worker health and activity.</p> <p>Table: <code>workercheckin</code></p> <p>Fields: - <code>id</code> (str, primary key) - Worker identifier - <code>first_checkin</code> (datetime) - When worker first registered - <code>last_checkin</code> (datetime) - Most recent heartbeat</p> <p>Constraints: - Unique constraint on <code>id</code></p> <p>Use Cases: - Monitor active workers - Detect stale/crashed workers - Worker load balancing</p> <p>Example: <pre><code>{\n  \"id\": \"worker-abc-123\",\n  \"first_checkin\": \"2025-01-15T10:00:00\",\n  \"last_checkin\": \"2025-01-15T10:30:00\"\n}\n</code></pre></p>"},{"location":"ingester/DATABASE/#enums","title":"Enums","text":""},{"location":"ingester/DATABASE/#runstatus","title":"RunStatus","text":"<p>Workflow and step status values.</p> <pre><code>class RunStatus(str, Enum):\n    PENDING = \"PENDING\"      # Not yet started\n    RUNNING = \"RUNNING\"      # Currently executing\n    COMPLETED = \"COMPLETED\"  # Finished successfully\n    ERROR = \"ERROR\"          # Failed but still retrying\n    FAILED = \"FAILED\"        # Permanently failed\n</code></pre>"},{"location":"ingester/DATABASE/#workflowsteptype","title":"WorkflowStepType","text":"<p>Types of workflow steps.</p> <pre><code>class WorkflowStepType(str, Enum):\n    INGEST = \"ingest\"\n    VALIDATE = \"validate\"\n    PARSE = \"parse\"\n    CHUNK = \"chunk\"\n    EMBED = \"embed\"\n    STORE = \"store\"\n    ENRICH = \"enrich\"\n    ROUTE = \"route\"\n</code></pre>"},{"location":"ingester/DATABASE/#artifacttype","title":"ArtifactType","text":"<p>Types of stored artifacts.</p> <pre><code>class ArtifactType(Enum):\n    DOC = \"document\"\n    PARSED_MD = \"parsed_markdown\"\n    PARSED_JSON = \"parsed_json\"\n    CHUNKS = \"chunks\"\n    EMBEDDINGS = \"embeddings\"\n    RAG = \"rag\"\n</code></pre>"},{"location":"ingester/DATABASE/#lifecycleevent","title":"LifeCycleEvent","text":"<p>Workflow lifecycle events.</p> <pre><code>class LifeCycleEvent(str, Enum):\n    GROUP_START = \"group_start\"\n    GROUP_END = \"group_end\"\n    ITEM_START = \"item_start\"\n    ITEM_END = \"item_end\"\n    ITEM_FAILED = \"item_failed\"\n    STEP_START = \"step_start\"\n    STEP_END = \"step_end\"\n    STEP_FAILED = \"step_failed\"\n</code></pre>"},{"location":"ingester/DATABASE/#artifact-mapping","title":"Artifact Mapping","text":"<p>Workflow Steps to Artifacts: - INGEST - DOC - PARSE - PARSED_MD, PARSED_JSON - CHUNK - CHUNKS - EMBED - EMBEDDINGS - STORE - RAG</p>"},{"location":"ingester/DATABASE/#relationships-diagram","title":"Relationships Diagram","text":"<pre><code>DocumentBatch\n    | (1:N)\nDocumentURI --&gt; Document (N:1)\n    |\nDocumentURIHistory\n\nDocumentBatch\n    | (1:N)\nRunGroup\n    | (1:N)\nWorkflowRun --&gt; Document (N:1)\n    | (1:N)\nRunStep --&gt; StepConfig (N:1)\n\nConfigSet\n    | (N:M via ConfigSetItem)\nStepConfig\n\nRunGroup --&gt; LifecycleHistory (1:N)\nWorkflowRun --&gt; LifecycleHistory (1:N)\n</code></pre>"},{"location":"ingester/DATABASE/#response-models","title":"Response Models","text":""},{"location":"ingester/DATABASE/#documentinfo","title":"DocumentInfo","text":"<p>API response model for document information.</p> <pre><code>class DocumentInfo(BaseModel):\n    uri: str | None = None\n    source: str | None = None\n    file_size: int | None = None\n    mime_type: str | None = None\n</code></pre>"},{"location":"ingester/DATABASE/#workflowrunwithdetails","title":"WorkflowRunWithDetails","text":"<p>Response model for workflow run with optional steps and document info.</p> <pre><code>class WorkflowRunWithDetails(BaseModel):\n    workflow_run: WorkflowRun\n    steps: list[RunStep] | None = None\n    document_info: DocumentInfo | None = None\n</code></pre>"},{"location":"ingester/DATABASE/#paginatedresponse","title":"PaginatedResponse","text":"<p>Generic paginated response model.</p> <pre><code>class PaginatedResponse[T](BaseModel):\n    items: list[T]\n    total: int\n    page: int\n    rows_per_page: int\n    total_pages: int\n</code></pre>"},{"location":"ingester/DATABASE/#database-initialization","title":"Database Initialization","text":""},{"location":"ingester/DATABASE/#using-cli","title":"Using CLI","text":"<pre><code>si-cli db-init\n</code></pre> <p>This creates tables and runs migrations.</p>"},{"location":"ingester/DATABASE/#using-alembic-directly","title":"Using Alembic Directly","text":"<pre><code>alembic upgrade head\n</code></pre>"},{"location":"ingester/DATABASE/#programmatic","title":"Programmatic","text":"<pre><code>from soliplex.ingester.lib.models import Database\n\n# Initialize with default URL from settings\nawait Database.initialize()\n\n# Or with custom URL\nawait Database.initialize(\"sqlite+aiosqlite:///:memory:\")\n</code></pre>"},{"location":"ingester/DATABASE/#python-cascading-delete-functions","title":"Python Cascading Delete Functions","text":""},{"location":"ingester/DATABASE/#delete_run_group","title":"delete_run_group","text":"<p>Cascading deletion function for run groups and all dependent records.</p> <p>Location: <code>src/soliplex/ingester/lib/wf/operations.py</code></p> <p>Signature: <pre><code>async def delete_run_group(run_group_id: int) -&gt; dict[str, int]\n</code></pre></p> <p>Database Compatibility: - SQLite (via aiosqlite) - PostgreSQL (via asyncpg)</p> <p>Behavior: 1. Verifies the RunGroup exists (raises <code>NotFoundError</code> if not found) 2. Retrieves all WorkflowRun IDs for the RunGroup 3. Deletes all RunStep records for those WorkflowRuns 4. Deletes all LifecycleHistory records (for both RunGroup and WorkflowRuns) 5. Deletes all WorkflowRun records in the group 6. Deletes the RunGroup itself 7. Returns deletion statistics</p> <p>All operations occur within a single database transaction to ensure atomicity.</p> <p>Usage: <pre><code>from soliplex.ingester.lib.wf.operations import delete_run_group, NotFoundError\n\n# Delete a run group and all dependent records\nresult = await delete_run_group(run_group_id=5)\n\nprint(f\"Deleted {result['deleted_rungroups']} run group(s)\")\nprint(f\"Deleted {result['deleted_workflowruns']} workflow run(s)\")\nprint(f\"Deleted {result['deleted_runsteps']} run step(s)\")\nprint(f\"Deleted {result['deleted_lifecyclehistory']} lifecycle history record(s)\")\nprint(f\"Total records deleted: {result['total_deleted']}\")\n</code></pre></p> <p>Returns: <pre><code>{\n    \"deleted_runsteps\": 150,\n    \"deleted_lifecyclehistory\": 45,\n    \"deleted_workflowruns\": 10,\n    \"deleted_rungroups\": 1,\n    \"total_deleted\": 206\n}\n</code></pre></p> <p>Raises: - <code>NotFoundError</code> - If the RunGroup with the specified ID does not exist</p>"},{"location":"ingester/DATABASE/#delete_document_uri_by_uri","title":"delete_document_uri_by_uri","text":"<p>Cascading deletion function for DocumentURI and all dependent records.</p> <p>Location: <code>src/soliplex/ingester/lib/operations.py</code></p> <p>Signature: <pre><code>async def delete_document_uri_by_uri(uri: str, source: str) -&gt; dict[str, int]\n</code></pre></p> <p>Behavior: 1. Finds the DocumentURI by <code>uri</code> and <code>source</code> 2. Counts how many DocumentURIs reference the same document hash 3. If only one URI references the document (cascade delete):    - Deletes all RunStep records for WorkflowRuns with this doc_id    - Deletes all LifecycleHistory records for those WorkflowRuns    - Deletes all WorkflowRun records with this doc_id    - Deletes all DocumentBytes artifacts for this hash    - Deletes file artifacts from storage    - Deletes the DocumentURIHistory records    - Deletes the DocumentURI record    - Deletes the Document record 4. If multiple URIs reference the document (preserve document):    - Deletes only the DocumentURIHistory records for this URI    - Deletes only the DocumentURI record    - Preserves the Document and all workflow-related records</p> <p>Returns: <pre><code>{\n    \"deleted_document_uris\": 1,\n    \"deleted_uri_history\": 3,\n    \"deleted_documents\": 1,\n    \"deleted_workflow_runs\": 2,\n    \"deleted_run_steps\": 10,\n    \"deleted_lifecycle_history\": 6,\n    \"total_deleted\": 23\n}\n</code></pre></p> <p>Usage: <pre><code>from soliplex.ingester.lib.operations import delete_document_uri_by_uri\nfrom soliplex.ingester.lib.operations import DocumentURINotFoundError\n\ntry:\n    stats = await delete_document_uri_by_uri(\n        uri=\"/documents/report.pdf\",\n        source=\"filesystem\"\n    )\n    print(f\"Total deleted: {stats['total_deleted']}\")\nexcept DocumentURINotFoundError as e:\n    print(f\"Error: {e}\")\n</code></pre></p> <p>Notes: - All deletions occur within a single transaction - Works with both SQLite and PostgreSQL - Raises <code>DocumentURINotFoundError</code> if the URI/source combination does not exist - Used by the <code>DELETE /api/v1/document/by-uri</code> endpoint</p>"},{"location":"ingester/DATABASE/#migrations","title":"Migrations","text":""},{"location":"ingester/DATABASE/#location","title":"Location","text":"<p><code>src/soliplex/ingester/migrations/</code></p>"},{"location":"ingester/DATABASE/#configuration_1","title":"Configuration","text":"<p><code>alembic.ini</code> (project root)</p>"},{"location":"ingester/DATABASE/#create-migration","title":"Create Migration","text":"<pre><code>alembic revision --autogenerate -m \"description\"\n</code></pre>"},{"location":"ingester/DATABASE/#apply-migration","title":"Apply Migration","text":"<pre><code>alembic upgrade head\n</code></pre>"},{"location":"ingester/DATABASE/#rollback","title":"Rollback","text":"<pre><code>alembic downgrade -1\n</code></pre>"},{"location":"ingester/DATABASE/#indexes","title":"Indexes","text":"<p>Consider adding these indexes for production:</p> <pre><code>-- Workflow processing queries\nCREATE INDEX idx_runstep_status ON runstep(status, priority DESC);\nCREATE INDEX idx_workflowrun_status ON workflowrun(status, batch_id);\nCREATE INDEX idx_rungroup_batch ON rungroup(batch_id);\n\n-- Document lookups\nCREATE INDEX idx_documenturi_source ON documenturi(source);\n\n-- Worker monitoring\nCREATE INDEX idx_runstep_worker ON runstep(worker_id);\nCREATE INDEX idx_workercheckin_last ON workercheckin(last_checkin);\n</code></pre>"},{"location":"ingester/DATABASE/#backup-and-maintenance","title":"Backup and Maintenance","text":""},{"location":"ingester/DATABASE/#sqlite-backup","title":"SQLite Backup","text":"<pre><code>sqlite3 db/documents.db \".backup backup.db\"\n</code></pre>"},{"location":"ingester/DATABASE/#postgresql-backup","title":"PostgreSQL Backup","text":"<pre><code>pg_dump -h localhost -U user soliplex &gt; backup.sql\n</code></pre>"},{"location":"ingester/DATABASE/#vacuum-sqlite","title":"Vacuum (SQLite)","text":"<pre><code>sqlite3 db/documents.db \"VACUUM;\"\n</code></pre>"},{"location":"ingester/DATABASE/#analyze-postgresql","title":"Analyze (PostgreSQL)","text":"<pre><code>psql -h localhost -U user -d soliplex -c \"ANALYZE;\"\n</code></pre>"},{"location":"ingester/DATABASE/#query-examples","title":"Query Examples","text":""},{"location":"ingester/DATABASE/#find-failed-workflows","title":"Find Failed Workflows","text":"<pre><code>from soliplex.ingester.lib.models import WorkflowRun, RunStatus, get_session\nfrom sqlmodel import select\n\nasync with get_session() as session:\n    query = select(WorkflowRun).where(WorkflowRun.status == RunStatus.FAILED)\n    results = await session.exec(query)\n    failed_runs = results.all()\n</code></pre>"},{"location":"ingester/DATABASE/#get-batch-statistics","title":"Get Batch Statistics","text":"<pre><code>from sqlmodel import func, select\n\nasync with get_session() as session:\n    query = select(\n        func.count(WorkflowRun.id).label(\"total\"),\n        WorkflowRun.status\n    ).where(\n        WorkflowRun.batch_id == batch_id\n    ).group_by(WorkflowRun.status)\n\n    results = await session.exec(query)\n    stats = {row.status: row.total for row in results}\n</code></pre>"},{"location":"ingester/DATABASE/#find-stale-workers","title":"Find Stale Workers","text":"<pre><code>from datetime import datetime, timedelta\n\ncutoff = datetime.now() - timedelta(seconds=600)\nquery = select(WorkerCheckin).where(WorkerCheckin.last_checkin &lt; cutoff)\nstale_workers = await session.exec(query)\n</code></pre>"},{"location":"ingester/DOCKER/","title":"Docker Deployment Guide","text":"<p>This guide covers deploying Soliplex Ingester using Docker Compose for production and development environments. While it can function on its own, it is mostly intended as a guide for creating customized deplolyments to match expected configurations.</p>"},{"location":"ingester/DOCKER/#table-of-contents","title":"Table of Contents","text":"<ul> <li>Quick Start</li> <li>Service Overview</li> <li>Prerequisites</li> <li>Configuration</li> <li>Service Details</li> <li>Authentication Setup</li> <li>Production Deployment</li> <li>Monitoring and Maintenance</li> <li>Troubleshooting</li> </ul>"},{"location":"ingester/DOCKER/#quick-start","title":"Quick Start","text":""},{"location":"ingester/DOCKER/#starting-services","title":"Starting Services","text":"<ol> <li> <p>Navigate to docker directory: <pre><code>cd docker\n</code></pre></p> </li> <li> <p>Start all services: <pre><code>docker-compose up -d\n</code></pre></p> </li> <li> <p>Verify services are running: <pre><code>docker-compose ps\n</code></pre></p> </li> <li> <p>Access the application:</p> </li> <li>Web UI: http://localhost:8002</li> <li>API Documentation: http://localhost:8002/docs</li> <li>PostgreSQL: localhost:5432</li> <li> <p>SeaweedFS: http://localhost:8333 (S3) / http://localhost:9333 (Admin)</p> </li> <li> <p>View logs: <pre><code># All services\ndocker-compose logs -f\n\n# Specific service\ndocker-compose logs -f soliplex_ingester\n</code></pre></p> </li> <li> <p>Stop services: <pre><code>docker-compose down\n</code></pre></p> </li> </ol>"},{"location":"ingester/DOCKER/#service-overview","title":"Service Overview","text":""},{"location":"ingester/DOCKER/#architecture-diagram","title":"Architecture Diagram","text":"<pre><code>graph TB\n    subgraph \"Docker Network (soliplex_net)\"\n        Ingester[\"Soliplex Ingester&lt;br/&gt;:8000\u21928002&lt;br/&gt;(API + Worker)\"]\n\n        Postgres[(\"PostgreSQL&lt;br/&gt;:5432&lt;br/&gt;(Database)\")]\n\n        HAProxy[\"HAProxy&lt;br/&gt;:5004&lt;br/&gt;(Load Balancer)\"]\n\n        Ollama[\"Ollama&lt;br/&gt;(GPU)&lt;br/&gt;(Embeddings)\"]\n\n        Docling1[\"Docling 1&lt;br/&gt;(GPU)\"]\n        Docling2[\"Docling 2&lt;br/&gt;(GPU)\"]\n        Docling3[\"Docling 3&lt;br/&gt;(GPU)\"]\n\n        SeaweedFS[(\"SeaweedFS&lt;br/&gt;:8333 (S3)&lt;br/&gt;:9333 (Admin)\")]\n\n        Ingester --&gt;|Stores metadata| Postgres\n        Ingester --&gt;|Parse requests| HAProxy\n        Ingester --&gt;|Embeddings| Ollama\n        Ingester -.-&gt;|Optional S3| SeaweedFS\n\n        HAProxy --&gt;|Round-robin&lt;br/&gt;Cookie-based| Docling1\n        HAProxy --&gt;|Load balanced| Docling2\n        HAProxy --&gt;|Load balanced| Docling3\n    end\n\n    User([User]) --&gt;|http://localhost:8002| Ingester\n\n    style Ingester fill:#4a90e2,stroke:#2e5c8a,color:#fff\n    style Postgres fill:#336791,stroke:#224466,color:#fff\n    style HAProxy fill:#3ba13b,stroke:#2d7a2d,color:#fff\n    style Ollama fill:#ff6b6b,stroke:#cc5555,color:#fff\n    style Docling1 fill:#f39c12,stroke:#c27d0e,color:#fff\n    style Docling2 fill:#f39c12,stroke:#c27d0e,color:#fff\n    style Docling3 fill:#f39c12,stroke:#c27d0e,color:#fff\n    style SeaweedFS fill:#9b59b6,stroke:#7a4691,color:#fff</code></pre>"},{"location":"ingester/DOCKER/#required-services","title":"Required Services","text":"Service Purpose Required soliplex_ingester Main application (API + Worker) Yes postgres Document and workflow database Yes"},{"location":"ingester/DOCKER/#optional-services","title":"Optional Services","text":"Service Purpose Required haproxy Load balancer for Docling instances No (but recommended for production) docling (1-3) PDF parsing with GPU acceleration No (can parse without GPU or use external service) ollama_img Embedding generation with GPU No (can use external embedding service) seaweedfs S3-compatible object storage No (can use filesystem or cloud S3)"},{"location":"ingester/DOCKER/#resource-requirements","title":"Resource Requirements","text":"<p>Minimum (Development - No GPU): - CPU: 4 cores - RAM: 8 GB - Disk: 20 GB</p> <p>Recommended (Production with GPU): - CPU: 16+ cores - RAM: 64+ GB - GPU: NVIDIA GPU with 24+ GB VRAM (for Docling + Ollama) - Disk: 100+ GB</p>"},{"location":"ingester/DOCKER/#prerequisites","title":"Prerequisites","text":""},{"location":"ingester/DOCKER/#required-software","title":"Required Software","text":"<ol> <li> <p>Docker Engine 20.10+ <pre><code>docker --version\n</code></pre></p> </li> <li> <p>Docker Compose 2.0+ <pre><code>docker-compose --version\n</code></pre></p> </li> </ol>"},{"location":"ingester/DOCKER/#for-gpu-support","title":"For GPU Support","text":"<ol> <li>NVIDIA Container Toolkit</li> </ol> <p>Install NVIDIA Container Toolkit for GPU support:</p> <p>Ubuntu/Debian: <pre><code>distribution=$(. /etc/os-release;echo $ID$VERSION_ID)\ncurl -fsSL https://nvidia.github.io/libnvidia-container/gpgkey | sudo gpg --dearmor -o /usr/share/keyrings/nvidia-container-toolkit-keyring.gpg\ncurl -s -L https://nvidia.github.io/libnvidia-container/$distribution/libnvidia-container.list | \\\n  sed 's#deb https://#deb [signed-by=/usr/share/keyrings/nvidia-container-toolkit-keyring.gpg] https://#g' | \\\n  sudo tee /etc/apt/sources.list.d/nvidia-container-toolkit.list\n\nsudo apt-get update\nsudo apt-get install -y nvidia-container-toolkit\nsudo systemctl restart docker\n</code></pre></p> <p>Verify GPU access: <pre><code>docker run --rm --gpus all nvidia/cuda:12.8.0-base-ubuntu22.04 nvidia-smi\n</code></pre></p>"},{"location":"ingester/DOCKER/#configuration","title":"Configuration","text":""},{"location":"ingester/DOCKER/#environment-variables","title":"Environment Variables","text":"<p>Create a <code>.env</code> file in the <code>docker/</code> directory:</p> <pre><code># Database Configuration\nPOSTGRES_USER=postgres\nPOSTGRES_PASSWORD=your_secure_password_here\nPOSTGRES_DB=soliplex_attrib\nDOC_DB_URL=postgresql+psycopg://soliplex_attrib:soliplex_attrib@postgres:5432/soliplex_attrib\n\n# Storage Configuration\nFILE_STORE_TARGET=fs                    # Options: fs, db, s3\nFILE_STORE_DIR=/var/soliplex/file_store\nLANCEDB_DIR=/var/soliplex/lancedb\n\n# Worker Configuration\nWORKER_TASK_COUNT=10                    # Number of concurrent workflow steps\nINGEST_WORKER_CONCURRENCY=20            # Document ingestion concurrency\n\n# Docling Configuration\nDOCLING_SERVER_URL=http://haproxy:5004/v1\nDOCLING_HTTP_TIMEOUT=1200               # Timeout in seconds\nDOCLING_CONCURRENCY=4                   # Concurrent Docling requests\n\n# Ollama Configuration (if using Ollama for embeddings)\nOLLAMA_BASE_URL=http://ollama_img:11434\n\n# SeaweedFS Configuration (if using S3 storage)\nS3_ENDPOINT_URL=http://seaweedfs:8333\nS3_ACCESS_KEY_ID=your_access_key\nS3_SECRET_ACCESS_KEY=your_secret_key\nS3_BUCKET_NAME=soliplex-artifacts\n\n# Logging\nLOG_LEVEL=INFO                          # Options: DEBUG, INFO, WARNING, ERROR\n\n# API Configuration\nAPI_KEY_ENABLED=false                   # Enable API key authentication\n</code></pre> <p>See .env.docker.example for a complete template.</p>"},{"location":"ingester/DOCKER/#volume-management","title":"Volume Management","text":"<p>The docker-compose configuration creates persistent volumes:</p> <pre><code>volumes:\n  postgres_data:        # PostgreSQL database files\n  seaweedfs_data:       # SeaweedFS object storage\n  docling_artifacts:    # Docling temporary artifacts\n  ollama_img_data:      # Ollama model files\n</code></pre> <p>Local bind mounts: <pre><code>./file_store:/var/soliplex/file_store   # Document artifacts\n./lancedb:/var/soliplex/lancedb         # Vector database\n</code></pre></p> <p>Backup volumes: <pre><code># Backup PostgreSQL\ndocker-compose exec postgres pg_dump -U postgres soliplex_attrib &gt; backup.sql\n\n# Backup volumes\ndocker run --rm -v postgres_data:/data -v $(pwd):/backup alpine tar czf /backup/postgres_data.tar.gz -C /data .\n</code></pre></p> <p>Restore volumes: <pre><code>docker run --rm -v postgres_data:/data -v $(pwd):/backup alpine sh -c \"cd /data &amp;&amp; tar xzf /backup/postgres_data.tar.gz\"\n</code></pre></p>"},{"location":"ingester/DOCKER/#gpu-configuration","title":"GPU Configuration","text":"<p>The docker-compose.yml configures GPU access for Docling and Ollama services.</p> <p>Important: Adjust <code>device_ids</code> based on your hardware:</p> <pre><code>deploy:\n  resources:\n    reservations:\n      devices:\n        - driver: nvidia\n          device_ids: ['3']  # \u2190 Change this to match your GPU ID\n          capabilities: [gpu]\n</code></pre> <p>Check available GPUs: <pre><code>nvidia-smi -L\n</code></pre></p> <p>Example output: <pre><code>GPU 0: NVIDIA A100-SXM4-80GB\nGPU 1: NVIDIA A100-SXM4-80GB\nGPU 2: NVIDIA A100-SXM4-80GB\nGPU 3: NVIDIA A100-SXM4-80GB\n</code></pre></p> <p>Multiple services sharing one GPU:</p> <p>The default configuration runs 3 Docling instances + Ollama all on GPU 3. This works if: - GPU has sufficient VRAM (24+ GB recommended) - Memory limits are properly configured - Workload is I/O bound (services wait on data)</p> <p>Distribute across GPUs: <pre><code># Docling on GPU 0\ndevice_ids: ['0']\n\n# Docling_2 on GPU 1\ndevice_ids: ['1']\n\n# Docling_3 on GPU 2\ndevice_ids: ['2']\n\n# Ollama on GPU 3\ndevice_ids: ['3']\n</code></pre></p>"},{"location":"ingester/DOCKER/#network-configuration","title":"Network Configuration","text":"<p>All services run on the <code>soliplex_net</code> bridge network for internal communication.</p> <p>Port Mappings:</p> Host Port Container Port Service Purpose 8002 8000 soliplex_ingester Web UI &amp; API 5432 5432 postgres Database 5004 5004 haproxy Docling load balancer 5000 5001 docling Direct Docling access 5001 5001 docling_2 Direct Docling access 8333 8333 seaweedfs S3 API 9333 9333 seaweedfs Admin UI <p>Change ports if conflicts exist: <pre><code>ports:\n  - \"8080:8000\"  # Map to different host port\n</code></pre></p>"},{"location":"ingester/DOCKER/#service-details","title":"Service Details","text":""},{"location":"ingester/DOCKER/#soliplex-ingester","title":"Soliplex Ingester","text":"<p>Configuration: <pre><code>soliplex_ingester:\n  image: soliplex_ingester:latest\n  environment:\n    DOC_DB_URL: postgresql+psycopg://soliplex_attrib:soliplex_attrib@postgres:5432/soliplex_attrib\n    FILE_STORE_TARGET: fs\n    FILE_STORE_DIR: /var/soliplex/file_store\n    LANCEDB_DIR: /var/soliplex/lancedb\n    WORKER_TASK_COUNT: 10\n    DOCLING_SERVER_URL: http://haproxy:5004/v1\n    DOCLING_HTTP_TIMEOUT: 1200\n    DOCLING_CONCURRENCY: 4\n  ports:\n    - \"8002:8000\"\n  volumes:\n    - ./file_store:/var/soliplex/file_store\n    - ./lancedb:/var/soliplex/lancedb\n</code></pre></p> <p>Building the image: <pre><code># From project root\ndocker build -t soliplex_ingester:latest .\n</code></pre></p> <p>Scaling workers:</p> <p>The default configuration runs the API server with an integrated worker. For production, separate them:</p> <pre><code># API Server\nsoliplex_api:\n  image: soliplex_ingester:latest\n  command: si-cli serve --host 0.0.0.0 --workers 4\n  # ... rest of config\n\n# Workers (scale as needed)\nsoliplex_worker:\n  image: soliplex_ingester:latest\n  command: si-cli worker\n  deploy:\n    replicas: 3\n  # ... rest of config\n</code></pre>"},{"location":"ingester/DOCKER/#postgresql","title":"PostgreSQL","text":"<p>Configuration: <pre><code>postgres:\n  image: postgres:18-trixie\n  environment:\n    POSTGRES_USER: postgres\n    POSTGRES_PASSWORD: postgres\n    POSTGRES_INITDB_ARGS: \"-A scram-sha-256\"\n  ports:\n    - \"5432:5432\"\n  volumes:\n    - postgres_data:/var/lib/postgresql\n    - ./pgsql/config/init.sql:/docker-entrypoint-initdb.d/init.sql\n</code></pre></p> <p>Initialization Script:</p> <p>The <code>init.sql</code> script creates users and databases:</p> <pre><code>-- Create application user\nCREATE USER soliplex_attrib WITH PASSWORD 'soliplex_attrib';\n\n-- Create database\nCREATE DATABASE soliplex_attrib OWNER soliplex_attrib;\n\n-- Grant permissions\nGRANT ALL PRIVILEGES ON DATABASE soliplex_attrib TO soliplex_attrib;\n</code></pre> <p>Production Security:</p> <p>\u26a0\ufe0f The example uses weak passwords for development. For production:</p> <ol> <li>Use strong, randomly generated passwords</li> <li>Store credentials in Docker secrets or environment files</li> <li>Restrict network access</li> <li>Enable SSL/TLS connections</li> </ol> <p>Connection string format: <pre><code>postgresql+psycopg://user:password@host:port/database\n</code></pre></p>"},{"location":"ingester/DOCKER/#docling-services","title":"Docling Services","text":"<p>Docling converts PDF documents to markdown and structured JSON.</p> <p>Configuration (per instance): <pre><code>docling:\n  image: ghcr.io/docling-project/docling-serve-cu128\n  environment:\n    DOCLING_SERVE_ENG_LOC_NUM_WORKERS: 4\n    DOCLING_SERVE_ARTIFACTS_PATH: \"/artifacts\"\n    DOCLING_NUM_THREADS: 16\n    UVICORN_WORKERS: 1\n    PYTORCH_CUDA_ALLOC_CONF: \"expandable_segments:True\"\n    DOCLING_SERVE_ENABLE_UI: 1\n    DOCLING_SERVE_MAX_SYNC_WAIT: 9999\n    NVIDIA_VISIBLE_DEVICES: \"all\"\n    DOCLING_SERVE_ENABLE_REMOTE_SERVICES: True\n  restart: \"unless-stopped\"\n  runtime: \"nvidia\"\n  volumes:\n    - docling_artifacts:/artifacts\n  deploy:\n    resources:\n      limits:\n        memory: 32000M\n      reservations:\n        devices:\n          - driver: nvidia\n            device_ids: ['3']\n            capabilities: [gpu]\n</code></pre></p> <p>Key Environment Variables:</p> <ul> <li><code>DOCLING_SERVE_ENG_LOC_NUM_WORKERS: 4</code> - Layout analysis workers</li> <li><code>DOCLING_NUM_THREADS: 16</code> - Processing threads</li> <li><code>PYTORCH_CUDA_ALLOC_CONF: \"expandable_segments:True\"</code> - GPU memory optimization</li> <li><code>DOCLING_SERVE_MAX_SYNC_WAIT: 9999</code> - Long timeout for large documents</li> </ul> <p>Memory Management:</p> <p>\u26a0\ufe0f Docling is prone to memory leaks with long-running processes.</p> <p>Mitigation strategies:</p> <ol> <li>Memory limits: <code>memory: 32000M</code> prevents OOM killing other services</li> <li>Restart policy: <code>restart: unless-stopped</code> recovers from crashes</li> <li>Load balancing: Multiple instances with HAProxy provide redundancy</li> <li>Health checks: HAProxy routes around unhealthy instances</li> </ol> <p>Without GPU:</p> <p>Remove GPU configuration and use CPU-only image: <pre><code>docling:\n  image: ghcr.io/docling-project/docling-serve  # CPU-only\n  runtime: null  # Remove nvidia runtime\n  deploy:\n    resources:\n      limits:\n        memory: 16000M\n      # Remove GPU reservation\n</code></pre></p>"},{"location":"ingester/DOCKER/#haproxy-load-balancer","title":"HAProxy Load Balancer","text":"<p>HAProxy distributes requests across multiple Docling instances.</p> <p>Configuration: <pre><code>haproxy:\n  image: docker.io/library/haproxy:3.3-alpine\n  ports:\n    - 5004:5004\n  volumes:\n    - ./haproxy/haproxy.cfg:/usr/local/etc/haproxy/haproxy.cfg\n</code></pre></p> <p>HAProxy Configuration (haproxy/haproxy.cfg):</p> <pre><code>global\n    maxconn 256\n\ndefaults\n    mode http\n    timeout connect 5000ms\n    timeout client 1200000ms\n    timeout server 1200000ms\n\nfrontend docling_frontend\n    bind *:5004\n    default_backend docling_backend\n\nbackend docling_backend\n    balance roundrobin\n    cookie SERVERID insert indirect nocache\n    server docling1 docling:5001 check cookie docling1\n    server docling2 docling_2:5001 check cookie docling2\n    server docling3 docling_3:5001 check cookie docling3\n</code></pre> <p>Load Balancing Strategy:</p> <ul> <li>Round-robin: Distributes requests evenly</li> <li>Cookie-based persistence: Same client goes to same server</li> <li>Health checks: Removes failed servers from rotation</li> </ul> <p>Why cookie-based persistence?</p> <p>Docling parsing is stateful for multi-step conversions. The ingester client uses cookies to ensure all requests for a document go to the same Docling instance.</p>"},{"location":"ingester/DOCKER/#ollama","title":"Ollama","text":"<p>Ollama provides embedding generation for vector search.</p> <p>Configuration: <pre><code>ollama_img:\n  image: ollama/ollama:latest\n  container_name: ollama_img\n  volumes:\n    - ollama_img_data:/root/.ollama\n  restart: always\n  deploy:\n    resources:\n      limits:\n        memory: 32000M\n      reservations:\n        devices:\n          - driver: nvidia\n            device_ids: ['3']\n            capabilities: [gpu]\n</code></pre></p> <p>Pull models: <pre><code>docker-compose exec ollama_img ollama pull nomic-embed-text\ndocker-compose exec ollama_img ollama pull llama2\n</code></pre></p> <p>List installed models: <pre><code>docker-compose exec ollama_img ollama list\n</code></pre></p> <p>Ingester Configuration:</p> <p>Set in <code>.env</code>: <pre><code>OLLAMA_BASE_URL=http://ollama_img:11434\n</code></pre></p>"},{"location":"ingester/DOCKER/#seaweedfs","title":"SeaweedFS","text":"<p>SeaweedFS provides S3-compatible object storage for artifacts.</p> <p>Configuration: <pre><code>seaweedfs:\n  image: ghcr.io/chrislusf/seaweedfs\n  command: server -s3 -s3.config=/config/config.json\n  ports:\n    - 8333:8333  # S3 API\n    - 9333:9333  # Admin UI\n  volumes:\n    - seaweedfs_data:/data\n    - ./seaweedfs/config:/config\n</code></pre></p> <p>Initialization:</p> <p>The <code>seaweedfs-init</code> container runs setup:</p> <pre><code>seaweedfs-init:\n  image: ghcr.io/chrislusf/seaweedfs\n  entrypoint: [\"/bin/sh\"]\n  volumes:\n    - ./seaweedfs/config/init.sh:/init.sh\n  command: [\"/init.sh\"]\n</code></pre> <p>Example init.sh: <pre><code>#!/bin/sh\n# Wait for SeaweedFS to start\nsleep 5\n\n# Create bucket\ncurl -X PUT http://seaweedfs:8333/soliplex-artifacts\n\n# Configure credentials (in config.json)\n</code></pre></p> <p>Ingester Configuration:</p> <p>Set in <code>.env</code>: <pre><code>FILE_STORE_TARGET=s3\nS3_ENDPOINT_URL=http://seaweedfs:8333\nS3_ACCESS_KEY_ID=your_access_key\nS3_SECRET_ACCESS_KEY=your_secret_key\nS3_BUCKET_NAME=soliplex-artifacts\n</code></pre></p> <p>Alternative: Use Cloud S3</p> <pre><code>FILE_STORE_TARGET=s3\nS3_ENDPOINT_URL=https://s3.amazonaws.com\nS3_ACCESS_KEY_ID=your_aws_key\nS3_SECRET_ACCESS_KEY=your_aws_secret\nS3_BUCKET_NAME=your-bucket-name\nAWS_REGION=us-east-1\n</code></pre>"},{"location":"ingester/DOCKER/#authentication-setup","title":"Authentication Setup","text":"<p>For production deployments with authentication, use <code>docker-compose.auth.yml</code>.</p>"},{"location":"ingester/DOCKER/#oauth2-proxy-stack","title":"OAuth2 Proxy Stack","text":"<p>The auth configuration adds: - NGINX - Reverse proxy with SSL termination - OAuth2 Proxy - OIDC authentication - Soliplex Ingester - Configured to trust proxy headers</p> <p>Start with authentication: <pre><code>docker-compose -f docker-compose.yml -f docker-compose.auth.yml up -d\n</code></pre></p>"},{"location":"ingester/DOCKER/#configuration_1","title":"Configuration","text":"<ol> <li>Create <code>.env.auth</code> file:</li> </ol> <p>See <code>docker/.env.auth.example</code>:</p> <pre><code># OIDC Provider Configuration\nOAUTH2_PROVIDER=oidc\nOAUTH2_OIDC_ISSUER_URL=https://your-oidc-provider.com\nOAUTH2_CLIENT_ID=your_client_id\nOAUTH2_CLIENT_SECRET=your_client_secret\nOAUTH2_REDIRECT_URL=https://your-domain.com/oauth2/callback\n\n# OAuth2 Proxy Configuration\nOAUTH2_COOKIE_SECRET=random_32_char_secret_here\nOAUTH2_COOKIE_DOMAIN=your-domain.com\n\n# Soliplex Ingester Configuration\nAUTH_TRUST_PROXY_HEADERS=true\nAUTH_USER_HEADER=X-Forwarded-User\nAUTH_EMAIL_HEADER=X-Forwarded-Email\n</code></pre> <ol> <li>Configure NGINX:</li> </ol> <p>Edit <code>docker/nginx/nginx.conf</code> for your domain and SSL certificates.</p> <ol> <li>Configure OAuth2 Proxy:</li> </ol> <p>Edit <code>docker/oauth2-proxy/oauth2-proxy.cfg</code> for your OIDC provider.</p> <p>See AUTHENTICATION.md for detailed setup instructions.</p>"},{"location":"ingester/DOCKER/#production-deployment","title":"Production Deployment","text":""},{"location":"ingester/DOCKER/#security-best-practices","title":"Security Best Practices","text":"<ol> <li> <p>Use Strong Passwords: <pre><code># Generate secure password\nopenssl rand -base64 32\n</code></pre></p> </li> <li> <p>Use Docker Secrets: <pre><code>secrets:\n  db_password:\n    file: ./secrets/db_password.txt\n\nservices:\n  postgres:\n    secrets:\n      - db_password\n    environment:\n      POSTGRES_PASSWORD_FILE: /run/secrets/db_password\n</code></pre></p> </li> <li> <p>Restrict Network Access: <pre><code>services:\n  postgres:\n    ports: []  # Don't expose to host\n    networks:\n      - soliplex_net  # Internal only\n</code></pre></p> </li> <li> <p>Enable SSL/TLS:</p> </li> </ol> <p>Use NGINX with Let's Encrypt certificates or cloud load balancer.</p> <ol> <li>Scan Images: <pre><code>docker scan soliplex_ingester:latest\n</code></pre></li> </ol>"},{"location":"ingester/DOCKER/#scaling-configuration","title":"Scaling Configuration","text":"<p>For high throughput:</p> <pre><code>services:\n  soliplex_api:\n    command: si-cli serve --host 0.0.0.0 --workers 8\n    deploy:\n      replicas: 2\n\n  soliplex_worker:\n    command: si-cli worker\n    environment:\n      WORKER_TASK_COUNT: 20\n    deploy:\n      replicas: 5\n\n  docling:\n    deploy:\n      replicas: 5\n      resources:\n        limits:\n          memory: 24000M\n</code></pre>"},{"location":"ingester/DOCKER/#resource-limits","title":"Resource Limits","text":"<p>Set appropriate limits to prevent resource exhaustion:</p> <pre><code>services:\n  soliplex_ingester:\n    deploy:\n      resources:\n        limits:\n          cpus: '4.0'\n          memory: 8G\n        reservations:\n          cpus: '2.0'\n          memory: 4G\n</code></pre>"},{"location":"ingester/DOCKER/#health-checks","title":"Health Checks","text":"<p>Add health checks for automatic recovery:</p> <pre><code>services:\n  soliplex_ingester:\n    healthcheck:\n      test: [\"CMD\", \"curl\", \"-f\", \"http://localhost:8000/api/v1/batch/\"]\n      interval: 30s\n      timeout: 10s\n      retries: 3\n      start_period: 40s\n</code></pre>"},{"location":"ingester/DOCKER/#logging","title":"Logging","text":"<p>Configure logging drivers:</p> <pre><code>services:\n  soliplex_ingester:\n    logging:\n      driver: \"json-file\"\n      options:\n        max-size: \"100m\"\n        max-file: \"5\"\n</code></pre> <p>Or use external logging:</p> <pre><code>logging:\n  driver: \"syslog\"\n  options:\n    syslog-address: \"tcp://192.168.0.1:514\"\n</code></pre>"},{"location":"ingester/DOCKER/#monitoring-and-maintenance","title":"Monitoring and Maintenance","text":""},{"location":"ingester/DOCKER/#health-checks_1","title":"Health Checks","text":"<p>Check service status: <pre><code>docker-compose ps\n</code></pre></p> <p>View resource usage: <pre><code>docker stats\n</code></pre></p> <p>Check specific service: <pre><code>docker-compose exec soliplex_ingester curl http://localhost:8000/api/v1/stats/durations\n</code></pre></p>"},{"location":"ingester/DOCKER/#log-management","title":"Log Management","text":"<p>View logs: <pre><code># All services\ndocker-compose logs -f\n\n# Specific service\ndocker-compose logs -f soliplex_ingester\n\n# Last 100 lines\ndocker-compose logs --tail=100 docling\n\n# Since timestamp\ndocker-compose logs --since 2026-01-22T10:00:00\n</code></pre></p> <p>Export logs: <pre><code>docker-compose logs &gt; logs.txt\n</code></pre></p>"},{"location":"ingester/DOCKER/#database-maintenance","title":"Database Maintenance","text":"<p>Backup: <pre><code>docker-compose exec postgres pg_dump -U postgres soliplex_attrib | gzip &gt; backup_$(date +%Y%m%d).sql.gz\n</code></pre></p> <p>Restore: <pre><code>gunzip &lt; backup_20260122.sql.gz | docker-compose exec -T postgres psql -U postgres soliplex_attrib\n</code></pre></p> <p>Vacuum database: <pre><code>docker-compose exec postgres psql -U postgres -d soliplex_attrib -c \"VACUUM ANALYZE;\"\n</code></pre></p>"},{"location":"ingester/DOCKER/#vector-database-maintenance","title":"Vector Database Maintenance","text":"<p>Vacuum LanceDB: <pre><code>curl \"http://localhost:8002/api/v1/lancedb/vacuum?db=default\"\n</code></pre></p> <p>Check database size: <pre><code>docker-compose exec soliplex_ingester du -sh /var/soliplex/lancedb\n</code></pre></p>"},{"location":"ingester/DOCKER/#updates","title":"Updates","text":"<p>Update images: <pre><code>docker-compose pull\ndocker-compose up -d\n</code></pre></p> <p>Update single service: <pre><code>docker-compose pull soliplex_ingester\ndocker-compose up -d soliplex_ingester\n</code></pre></p> <p>Rebuild custom image: <pre><code>docker build -t soliplex_ingester:latest .\ndocker-compose up -d soliplex_ingester\n</code></pre></p>"},{"location":"ingester/DOCKER/#troubleshooting","title":"Troubleshooting","text":""},{"location":"ingester/DOCKER/#common-issues","title":"Common Issues","text":""},{"location":"ingester/DOCKER/#services-wont-start","title":"Services Won't Start","text":"<p>Check logs: <pre><code>docker-compose logs &lt;service_name&gt;\n</code></pre></p> <p>Check configuration: <pre><code>docker-compose config\n</code></pre></p> <p>Validate environment variables: <pre><code>docker-compose exec soliplex_ingester env | grep DOC_DB_URL\n</code></pre></p>"},{"location":"ingester/DOCKER/#database-connection-errors","title":"Database Connection Errors","text":"<p>Error: <code>connection to server at \"postgres\" (172.18.0.2), port 5432 failed</code></p> <p>Solutions: 1. Verify postgres is running: <code>docker-compose ps postgres</code> 2. Check network: <code>docker-compose exec soliplex_ingester ping postgres</code> 3. Verify credentials in <code>DOC_DB_URL</code> 4. Check postgres logs: <code>docker-compose logs postgres</code></p> <p>Test connection: <pre><code>docker-compose exec soliplex_ingester psql \"postgresql://soliplex_attrib:soliplex_attrib@postgres:5432/soliplex_attrib\"\n</code></pre></p>"},{"location":"ingester/DOCKER/#gpu-not-available","title":"GPU Not Available","text":"<p>Error: <code>could not select device driver \"\" with capabilities: [[gpu]]</code></p> <p>Solutions: 1. Install NVIDIA Container Toolkit (see Prerequisites) 2. Restart Docker daemon: <code>sudo systemctl restart docker</code> 3. Verify GPU access: <code>docker run --rm --gpus all nvidia/cuda:12.8.0-base-ubuntu22.04 nvidia-smi</code></p> <p>Check GPU usage: <pre><code>docker-compose exec docling nvidia-smi\n</code></pre></p>"},{"location":"ingester/DOCKER/#docling-memory-errors","title":"Docling Memory Errors","text":"<p>Error: <code>CUDA out of memory</code> or container crashes</p> <p>Solutions: 1. Reduce <code>DOCLING_NUM_THREADS</code> in docker-compose.yml 2. Reduce <code>DOCLING_SERVE_ENG_LOC_NUM_WORKERS</code> 3. Increase GPU memory by using dedicated GPU per instance 4. Process smaller documents or reduce concurrency</p> <p>Monitor memory: <pre><code>docker stats docling\n</code></pre></p>"},{"location":"ingester/DOCKER/#port-conflicts","title":"Port Conflicts","text":"<p>Error: <code>bind: address already in use</code></p> <p>Solutions: 1. Check what's using the port: <pre><code># Linux/macOS\nlsof -i :8002\n\n# Windows\nnetstat -ano | findstr :8002\n</code></pre></p> <ol> <li>Change port mapping in docker-compose.yml: <pre><code>ports:\n  - \"8080:8000\"  # Use different host port\n</code></pre></li> </ol>"},{"location":"ingester/DOCKER/#volume-permission-errors","title":"Volume Permission Errors","text":"<p>Error: <code>permission denied</code> when accessing volumes</p> <p>Solutions: 1. Check ownership: <pre><code>ls -la ./file_store ./lancedb\n</code></pre></p> <ol> <li> <p>Fix permissions: <pre><code>sudo chown -R $(id -u):$(id -g) ./file_store ./lancedb\n</code></pre></p> </li> <li> <p>Or use Docker's user mapping: <pre><code>user: \"${UID}:${GID}\"\n</code></pre></p> </li> </ol>"},{"location":"ingester/DOCKER/#seaweedfs-connection-errors","title":"SeaweedFS Connection Errors","text":"<p>Error: <code>Unable to connect to S3 endpoint</code></p> <p>Solutions: 1. Verify SeaweedFS is running: <code>docker-compose ps seaweedfs</code> 2. Check initialization completed: <code>docker-compose logs seaweedfs-init</code> 3. Test S3 endpoint: <pre><code>curl http://localhost:8333\n</code></pre></p> <ol> <li>Verify bucket exists: <pre><code>docker-compose exec seaweedfs weed shell\n&gt; s3.bucket.list\n</code></pre></li> </ol>"},{"location":"ingester/DOCKER/#haproxy-routing-issues","title":"HAProxy Routing Issues","text":"<p>Symptom: Requests timing out or routing to unhealthy Docling instances</p> <p>Debug: 1. Check HAProxy stats (if enabled): <pre><code>http://localhost:5004/stats\n</code></pre></p> <ol> <li> <p>View HAProxy logs: <pre><code>docker-compose logs haproxy\n</code></pre></p> </li> <li> <p>Test Docling instances directly: <pre><code>curl http://localhost:5000/v1/health\ncurl http://localhost:5001/v1/health\n</code></pre></p> </li> <li> <p>Restart HAProxy: <pre><code>docker-compose restart haproxy\n</code></pre></p> </li> </ol>"},{"location":"ingester/DOCKER/#performance-issues","title":"Performance Issues","text":""},{"location":"ingester/DOCKER/#slow-document-processing","title":"Slow Document Processing","text":"<p>Diagnose: <pre><code># Check worker activity\ncurl http://localhost:8002/api/v1/workflow/steps?status=RUNNING\n\n# Check CPU/memory\ndocker stats\n\n# Check Docling queue\ndocker-compose logs docling | grep -i queue\n</code></pre></p> <p>Solutions: 1. Increase worker concurrency: <code>WORKER_TASK_COUNT=20</code> 2. Add more Docling instances 3. Increase <code>DOCLING_CONCURRENCY</code> 4. Scale workers: <code>docker-compose up -d --scale soliplex_worker=5</code></p>"},{"location":"ingester/DOCKER/#high-memory-usage","title":"High Memory Usage","text":"<p>Monitor: <pre><code>docker stats --no-stream\n</code></pre></p> <p>Solutions: 1. Reduce concurrency settings 2. Increase memory limits 3. Add swap space (not recommended for production) 4. Use smaller batch sizes</p>"},{"location":"ingester/DOCKER/#disk-space-issues","title":"Disk Space Issues","text":"<p>Check usage: <pre><code>docker system df\n</code></pre></p> <p>Clean up: <pre><code># Remove unused images\ndocker image prune -a\n\n# Remove stopped containers\ndocker container prune\n\n# Remove unused volumes\ndocker volume prune\n\n# Clean everything\ndocker system prune -a --volumes\n</code></pre></p>"},{"location":"ingester/DOCKER/#recovery-procedures","title":"Recovery Procedures","text":""},{"location":"ingester/DOCKER/#reset-everything","title":"Reset Everything","text":"<p>\u26a0\ufe0f This deletes all data!</p> <pre><code>docker-compose down -v\nrm -rf ./file_store/* ./lancedb/*\ndocker-compose up -d\n</code></pre>"},{"location":"ingester/DOCKER/#reset-database-only","title":"Reset Database Only","text":"<pre><code>docker-compose down\ndocker volume rm docker_postgres_data\ndocker-compose up -d postgres\n# Wait for postgres to initialize\ndocker-compose exec postgres psql -U postgres -f /docker-entrypoint-initdb.d/init.sql\ndocker-compose up -d\n</code></pre>"},{"location":"ingester/DOCKER/#restart-single-service","title":"Restart Single Service","text":"<pre><code>docker-compose restart soliplex_ingester\n</code></pre>"},{"location":"ingester/DOCKER/#force-recreate-service","title":"Force Recreate Service","text":"<pre><code>docker-compose up -d --force-recreate soliplex_ingester\n</code></pre>"},{"location":"ingester/DOCKER/#additional-resources","title":"Additional Resources","text":"<ul> <li>Soliplex Ingester Documentation: ../README.md</li> <li>API Reference: API.md</li> <li>Configuration Guide: CONFIGURATION.md</li> <li>Authentication Guide: AUTHENTICATION.md</li> <li>Docling Documentation: https://docling-project.github.io/docling/</li> <li>Docker Compose Documentation: https://docs.docker.com/compose/</li> <li>NVIDIA Container Toolkit: https://docs.nvidia.com/datacenter/cloud-native/container-toolkit/</li> </ul>"},{"location":"ingester/DOCKER/#getting-help","title":"Getting Help","text":"<p>If you encounter issues not covered in this guide:</p> <ol> <li>Check the main troubleshooting guide</li> <li>Review service-specific logs</li> <li>Open an issue on GitHub with:</li> <li>Output of <code>docker-compose ps</code></li> <li>Relevant logs from <code>docker-compose logs</code></li> <li>Your docker-compose.yml modifications</li> <li>Environment details (OS, Docker version, GPU info)</li> </ol>"},{"location":"ingester/GETTING_STARTED/","title":"Getting Started with Soliplex Ingester","text":""},{"location":"ingester/GETTING_STARTED/#quick-start","title":"Quick Start","text":"<p>This guide will help you get Soliplex Ingester up and running in minutes.</p>"},{"location":"ingester/GETTING_STARTED/#prerequisites","title":"Prerequisites","text":"<ul> <li>Python 3.12 or higher</li> <li>pip or uv package manager</li> <li>SQLite (included with Python) or PostgreSQL</li> <li>Docling server for document parsing (optional)</li> <li>S3 backend (optional)</li> </ul>"},{"location":"ingester/GETTING_STARTED/#docker-deployment","title":"Docker Deployment","text":"<p>For production deployment using Docker Compose, see the comprehensive Docker Deployment Guide.</p> <p>The docker-compose configuration provides all necessary services: - PostgreSQL database with initialization scripts - Docling document parsing services with GPU support and load balancing - SeaweedFS for S3-compatible object storage - HAProxy load balancer for high availability</p> <p>Quick Start with Docker: <pre><code>cd docker\ndocker-compose up -d\n</code></pre></p> <p>Access the application at http://localhost:8002</p> <p>For detailed instructions including: - Service configuration and scaling - GPU setup and optimization - Authentication with OAuth2 Proxy - Production deployment best practices - Troubleshooting guide</p> <p>See DOCKER.md</p>"},{"location":"ingester/GETTING_STARTED/#1-install-package","title":"1. Install Package","text":""},{"location":"ingester/GETTING_STARTED/#installation-from-source","title":"Installation from source","text":"<p>Using pip: <pre><code>cd soliplex-ingester\npip install -e .\n</code></pre></p> <p>Using uv: <pre><code>cd soliplex-ingester\nuv pip install -e .\n</code></pre></p>"},{"location":"ingester/GETTING_STARTED/#running-your-own-install","title":"Running your own Install","text":"<p>You can integrate soliplex ingester into another python project by installing it like any other package.  This will allow you to use custom methods for any part of the workflow if desired.</p> <pre><code>uv init --lib &lt;my project name&gt;\nuv add https://github.com/soliplex/ingester.git\nuv run si-cli bootstrap\n</code></pre> <p>This installs the package and makes the <code>si-cli</code> command available.</p>"},{"location":"ingester/GETTING_STARTED/#2-verify-installation","title":"2. Verify Installation","text":"<pre><code>si-cli --help\n</code></pre> <p>You should see the CLI help menu.</p>"},{"location":"ingester/GETTING_STARTED/#configuration","title":"Configuration","text":""},{"location":"ingester/GETTING_STARTED/#3-set-environment-variables","title":"3. Set Environment Variables","text":"<p>Automatically configure: <pre><code>uv run init-env\n</code></pre></p> <p>Manually create a <code>.env</code> file in the project root:</p> <pre><code># Minimum required configuration\nDOC_DB_URL=sqlite+aiosqlite:///./db/documents.db\n\n# Optional: Docling service (for document parsing)\nDOCLING_SERVER_URL=http://localhost:5001/v1\n\n# Optional: Adjust logging\nLOG_LEVEL=INFO\n</code></pre> <p>Load the environment: <pre><code>export $(cat .env | xargs)\n</code></pre></p> <p>Or on Windows: <pre><code>Get-Content .env | ForEach-Object { $var = $_.Split('='); [Environment]::SetEnvironmentVariable($var[0], $var[1]) }\n</code></pre> Alternatively, si-cli can be run via uv to initialize the environment file <pre><code>uv run --env-file=.env si-cli\n</code></pre></p>"},{"location":"ingester/GETTING_STARTED/#4-validate-configuration","title":"4. Validate Configuration","text":"<pre><code>si-cli validate-settings\n</code></pre> <p>This should display your configuration without errors.</p>"},{"location":"ingester/GETTING_STARTED/#database-setup","title":"Database Setup","text":""},{"location":"ingester/GETTING_STARTED/#5-initialize-database","title":"5. Initialize Database","text":"<pre><code>si-cli db-init\n</code></pre> <p>This creates: - SQLite database file at <code>db/documents.db</code> - All necessary tables - Runs migrations</p>"},{"location":"ingester/GETTING_STARTED/#start-the-server","title":"Start the Server","text":""},{"location":"ingester/GETTING_STARTED/#6-run-the-development-server","title":"6. Run the Development Server","text":"<pre><code>si-cli serve --reload\n</code></pre> <p>The server starts on <code>http://127.0.0.1:8000</code> with: - Auto-reload on code changes - Integrated worker for processing - Web UI at <code>/</code> - OpenAPI docs at <code>/docs</code></p>"},{"location":"ingester/GETTING_STARTED/#7-access-the-application","title":"7. Access the Application","text":"<p>Web UI (Main Application):</p> <p>Open your browser and navigate to: <pre><code>http://localhost:8000/\n</code></pre></p> <p>The web UI provides: - Dashboard - Monitor workflow status and batch processing - Batches - View and manage document batches - Workflows - Inspect workflow definitions and runs - Parameters - View and create parameter sets - LanceDB - Manage vector databases - Statistics - View processing metrics and performance data</p> <p>API Documentation (Swagger UI):</p> <p>For API testing and documentation: <pre><code>http://localhost:8000/docs\n</code></pre></p> <p>Alternative API Documentation (ReDoc): <pre><code>http://localhost:8000/redoc\n</code></pre></p> <p>Test the server: <pre><code>curl http://localhost:8000/docs\n</code></pre></p> <p>You should see the Swagger UI.</p>"},{"location":"ingester/GETTING_STARTED/#your-first-batch","title":"Your First Batch","text":""},{"location":"ingester/GETTING_STARTED/#8-create-a-batch","title":"8. Create a Batch","text":"<pre><code>curl -X POST \"http://localhost:8000/api/v1/batch/\" \\\n  -d \"source=test\" \\\n  -d \"name=My First Batch\"\n</code></pre> <p>Response: <pre><code>{\n  \"batch_id\": 1\n}\n</code></pre></p>"},{"location":"ingester/GETTING_STARTED/#9-ingest-a-document","title":"9. Ingest a Document","text":"<p>Option A: Upload a file <pre><code>curl -X POST \"http://localhost:8000/api/v1/document/ingest-document\" \\\n  -F \"file=@sample.pdf\" \\\n  -F \"source_uri=/documents/sample.pdf\" \\\n  -F \"source=test\" \\\n  -F \"batch_id=1\"\n</code></pre></p> <p>Option B: Provide a URI (requires Docling server) <pre><code>curl -X POST \"http://localhost:8000/api/v1/document/ingest-document\" \\\n  -F \"input_uri=https://example.com/document.pdf\" \\\n  -F \"source_uri=/remote/document.pdf\" \\\n  -F \"source=test\" \\\n  -F \"batch_id=1\"\n</code></pre></p> <p>Response: <pre><code>{\n  \"batch_id\": 1,\n  \"document_uri\": \"/documents/sample.pdf\",\n  \"document_hash\": \"sha256-abc123...\",\n  \"source\": \"test\",\n  \"uri_id\": 1\n}\n</code></pre></p>"},{"location":"ingester/GETTING_STARTED/#10-start-workflow-processing","title":"10. Start Workflow Processing","text":"<pre><code>curl -X POST \"http://localhost:8000/api/v1/batch/start-workflows\" \\\n  -d \"batch_id=1\" \\\n  -d \"workflow_definition_id=batch\"\n</code></pre> <p>Response: <pre><code>{\n  \"message\": \"Workflows started\",\n  \"workflows\": 1,\n  \"run_group\": 1\n}\n</code></pre></p>"},{"location":"ingester/GETTING_STARTED/#11-monitor-progress","title":"11. Monitor Progress","text":"<p>Check batch status: <pre><code>curl \"http://localhost:8000/api/v1/batch/status?batch_id=1\"\n</code></pre></p> <p>Response: <pre><code>{\n  \"batch\": { ... },\n  \"document_count\": 1,\n  \"workflow_count\": {\n    \"COMPLETED\": 0,\n    \"RUNNING\": 1,\n    \"PENDING\": 0\n  },\n  \"workflows\": [ ... ],\n  \"parsed\": 0,\n  \"remaining\": 1\n}\n</code></pre></p> <p>Watch workflow runs: <pre><code>watch -n 5 'curl -s \"http://localhost:8000/api/v1/workflow/?batch_id=1\"'\n</code></pre></p>"},{"location":"ingester/GETTING_STARTED/#12-view-results","title":"12. View Results","text":"<p>Once processing completes, check the document:</p> <pre><code>curl \"http://localhost:8000/api/v1/document/?batch_id=1\"\n</code></pre>"},{"location":"ingester/GETTING_STARTED/#next-steps","title":"Next Steps","text":""},{"location":"ingester/GETTING_STARTED/#explore-workflows","title":"Explore Workflows","text":"<p>List available workflows: <pre><code>si-cli list-workflows\n</code></pre></p> <p>Inspect a workflow: <pre><code>si-cli dump-workflow batch\n</code></pre></p> <p>View workflow runs: <pre><code>curl \"http://localhost:8000/api/v1/workflow/?batch_id=1\"\n</code></pre></p>"},{"location":"ingester/GETTING_STARTED/#configure-parameters","title":"Configure Parameters","text":"<p>List parameter sets: <pre><code>si-cli list-param-sets\n</code></pre></p> <p>View parameters: <pre><code>si-cli dump-param-set default\n</code></pre></p> <p>Create custom parameters: 1. Copy <code>config/params/default.yaml</code> to <code>config/params/custom.yaml</code> 2. Modify settings as needed 3. Use in API: <code>-d \"param_id=custom\"</code></p>"},{"location":"ingester/GETTING_STARTED/#scale-workers","title":"Scale Workers","text":"<p>Run additional workers: <pre><code># Terminal 1\nsi-cli worker\n\n# Terminal 2\nsi-cli worker\n\n# Terminal 3\nsi-cli worker\n</code></pre></p> <p>Each worker processes steps independently, increasing throughput.</p>"},{"location":"ingester/GETTING_STARTED/#monitor-system","title":"Monitor System","text":"<p>API Documentation: Browse to <code>http://localhost:8000/docs</code> for interactive API docs.</p> <p>Database Inspection: <pre><code>sqlite3 db/documents.db\nsqlite&gt; .tables\nsqlite&gt; SELECT * FROM documentbatch;\nsqlite&gt; SELECT * FROM workflowrun WHERE batch_id = 1;\n</code></pre></p>"},{"location":"ingester/GETTING_STARTED/#troubleshooting","title":"Troubleshooting","text":""},{"location":"ingester/GETTING_STARTED/#server-wont-start","title":"Server Won't Start","text":"<p>Problem: Configuration validation fails</p> <p>Solution: <pre><code>si-cli validate-settings\n</code></pre></p> <p>Fix any reported errors in your <code>.env</code> file.</p> <p>Problem: Port already in use</p> <p>Solution: <pre><code>si-cli serve --port 8001\n</code></pre></p>"},{"location":"ingester/GETTING_STARTED/#workflows-stuck","title":"Workflows Stuck","text":"<p>Problem: Workflows remain in PENDING status</p> <p>Solution: Ensure a worker is running: <pre><code>si-cli worker\n</code></pre></p> <p>Check worker logs for errors.</p>"},{"location":"ingester/GETTING_STARTED/#document-parsing-fails","title":"Document Parsing Fails","text":"<p>Problem: Parse step fails with connection error</p> <p>Solution: 1. Verify Docling server is running 2. Check <code>DOCLING_SERVER_URL</code> is correct 3. Test connectivity:    <pre><code>curl http://localhost:5001/v1/health\n</code></pre></p>"},{"location":"ingester/GETTING_STARTED/#database-errors","title":"Database Errors","text":"<p>Problem: Database connection fails</p> <p>Solution: 1. Check <code>DOC_DB_URL</code> format 2. Ensure directory exists: <code>mkdir -p db</code> 3. Check permissions: <code>chmod 755 db</code> 4. Reinitialize: <code>si-cli db-init</code></p>"},{"location":"ingester/GETTING_STARTED/#development-mode","title":"Development Mode","text":"<p>For active development:</p> <p>1. Enable auto-reload: <pre><code>si-cli serve --reload\n</code></pre></p> <p>2. Set debug logging: <pre><code>export LOG_LEVEL=DEBUG\nsi-cli serve --reload\n</code></pre></p> <p>3. Watch logs: <pre><code>si-cli serve --reload 2&gt;&amp;1 | tee server.log\n</code></pre></p> <p>4. Monitor database: <pre><code>watch -n 2 'sqlite3 db/documents.db \"SELECT status, COUNT(*) FROM workflowrun GROUP BY status\"'\n</code></pre></p>"},{"location":"ingester/GETTING_STARTED/#production-deployment","title":"Production Deployment","text":""},{"location":"ingester/GETTING_STARTED/#configuration_1","title":"Configuration","text":"<p>Create production <code>.env</code>:</p> <pre><code># Database\nDOC_DB_URL=postgresql+asyncpg://user:password@db-host:5432/soliplex\n\n# Services\nDOCLING_SERVER_URL=http://docling-prod:5001/v1\n\n# Logging\nLOG_LEVEL=WARNING\n\n# Performance\nINGEST_WORKER_CONCURRENCY=20\nDOCLING_CONCURRENCY=5\nWORKER_TASK_COUNT=10\n\n# Storage\nFILE_STORE_DIR=/var/lib/soliplex/files\nLANCEDB_DIR=/var/lib/soliplex/lancedb\n</code></pre>"},{"location":"ingester/GETTING_STARTED/#run-services","title":"Run Services","text":"<p>Server: <pre><code>si-cli serve --host 0.0.0.0 --port 8000 --workers 4\n</code></pre></p> <p>Workers: (in separate processes) <pre><code>si-cli worker  # Worker 1\nsi-cli worker  # Worker 2\nsi-cli worker  # Worker 3\n</code></pre></p> <p>Behind Nginx: <pre><code>upstream soliplex {\n    server 127.0.0.1:8000;\n}\n\nserver {\n    listen 80;\n    server_name soliplex.example.com;\n\n    location / {\n        proxy_pass http://soliplex;\n        proxy_set_header Host $host;\n        proxy_set_header X-Real-IP $remote_addr;\n    }\n}\n</code></pre></p>"},{"location":"ingester/GETTING_STARTED/#docker-deployment_1","title":"Docker Deployment","text":"<p>Dockerfile: <pre><code>FROM python:3.12-slim\n\nWORKDIR /app\nCOPY . .\nRUN pip install -e .\n\nCMD [\"si-cli\", \"serve\", \"--host\", \"0.0.0.0\"]\n</code></pre></p> <p>docker-compose.yml: <pre><code>version: '3.8'\n\nservices:\n  server:\n    build: .\n    ports:\n      - \"8000:8000\"\n    environment:\n      DOC_DB_URL: postgresql+asyncpg://postgres:password@db/soliplex\n      DOCLING_SERVER_URL: http://docling:5001/v1\n    depends_on:\n      - db\n\n  worker:\n    build: .\n    command: si-cli worker\n    environment:\n      DOC_DB_URL: postgresql+asyncpg://postgres:password@db/soliplex\n      DOCLING_SERVER_URL: http://docling:5001/v1\n    depends_on:\n      - db\n    deploy:\n      replicas: 3\n\n  db:\n    image: postgres:16\n    environment:\n      POSTGRES_DB: soliplex\n      POSTGRES_USER: postgres\n      POSTGRES_PASSWORD: password\n    volumes:\n      - db-data:/var/lib/postgresql/data\n\nvolumes:\n  db-data:\n</code></pre></p> <p>Run: <pre><code>docker-compose up -d\n</code></pre></p>"},{"location":"ingester/GETTING_STARTED/#learning-more","title":"Learning More","text":""},{"location":"ingester/GETTING_STARTED/#documentation","title":"Documentation","text":"<ul> <li>Architecture Overview - System design and components</li> <li>API Reference - Complete REST API documentation</li> <li>Workflow System - Workflow concepts and configuration</li> <li>Database Schema - Data models and relationships</li> <li>Configuration - Environment variables and settings</li> <li>CLI Reference - Command-line interface guide</li> </ul>"},{"location":"ingester/GETTING_STARTED/#examples","title":"Examples","text":"<p>Check the <code>examples/</code> directory (if available) for: - Sample workflows - Integration scripts - Custom step handlers - Batch processing examples</p>"},{"location":"ingester/GETTING_STARTED/#community","title":"Community","text":"<ul> <li>Issues: Report bugs and request features</li> <li>Discussions: Ask questions and share ideas</li> <li>Contributing: See CONTRIBUTING.md (if available)</li> </ul>"},{"location":"ingester/GETTING_STARTED/#common-patterns","title":"Common Patterns","text":""},{"location":"ingester/GETTING_STARTED/#batch-document-ingestion","title":"Batch Document Ingestion","text":"<pre><code>import asyncio\nfrom pathlib import Path\nimport httpx\n\nasync def ingest_directory(directory: Path, batch_id: int, source: str):\n    \"\"\"Ingest all documents in a directory.\"\"\"\n    async with httpx.AsyncClient() as client:\n        for file_path in directory.glob(\"**/*.pdf\"):\n            with open(file_path, \"rb\") as f:\n                files = {\"file\": f}\n                data = {\n                    \"source_uri\": str(file_path),\n                    \"source\": source,\n                    \"batch_id\": batch_id,\n                }\n                response = await client.post(\n                    \"http://localhost:8000/api/v1/document/ingest-document\",\n                    files=files,\n                    data=data,\n                )\n                print(f\"Ingested {file_path}: {response.status_code}\")\n\n# Usage\nasyncio.run(ingest_directory(Path(\"/documents\"), batch_id=1, source=\"filesystem\"))\n</code></pre>"},{"location":"ingester/GETTING_STARTED/#monitor-batch-progress","title":"Monitor Batch Progress","text":"<pre><code>import asyncio\nimport httpx\n\nasync def wait_for_batch(batch_id: int, poll_interval: int = 5):\n    \"\"\"Wait for batch processing to complete.\"\"\"\n    async with httpx.AsyncClient() as client:\n        while True:\n            response = await client.get(\n                f\"http://localhost:8000/api/v1/batch/status\",\n                params={\"batch_id\": batch_id}\n            )\n            data = response.json()\n            counts = data[\"workflow_count\"]\n\n            print(f\"Completed: {counts.get('COMPLETED', 0)}, \"\n                  f\"Running: {counts.get('RUNNING', 0)}, \"\n                  f\"Failed: {counts.get('FAILED', 0)}\")\n\n            if counts.get(\"RUNNING\", 0) == 0 and counts.get(\"PENDING\", 0) == 0:\n                print(\"Batch complete!\")\n                break\n\n            await asyncio.sleep(poll_interval)\n\n# Usage\nasyncio.run(wait_for_batch(1))\n</code></pre>"},{"location":"ingester/GETTING_STARTED/#retry-failed-workflows","title":"Retry Failed Workflows","text":"<pre><code>#!/bin/bash\n# retry_failed.sh\n\nBATCH_ID=$1\nRUN_GROUP=$(curl -s \"http://localhost:8000/api/v1/workflow/run-groups?batch_id=${BATCH_ID}\" | jq -r '.[0].id')\n\nif [ -n \"$RUN_GROUP\" ]; then\n    curl -X POST \"http://localhost:8000/api/v1/workflow/retry\" \\\n        -d \"run_group_id=${RUN_GROUP}\"\n    echo \"Retried run group ${RUN_GROUP}\"\nelse\n    echo \"No run group found for batch ${BATCH_ID}\"\nfi\n</code></pre>"},{"location":"ingester/GETTING_STARTED/#whats-next","title":"What's Next?","text":"<p>Now that you have Soliplex Ingester running:</p> <ol> <li>Customize workflows - Create workflows for your specific needs</li> <li>Integrate services - Connect your data sources and RAG backends</li> <li>Scale processing - Add more workers and optimize configuration</li> <li>Monitor production - Set up logging, metrics, and alerting</li> <li>Build applications - Use the API to build document processing apps</li> </ol> <p>Welcome to Soliplex Ingester! \ud83d\ude80</p>"},{"location":"ingester/PARAMETER_SETS/","title":"Parameter Sets","text":"<p>Parameter sets define the configuration for document processing workflows in Soliplex Ingester. Each parameter set specifies how documents should be parsed, chunked, embedded, and stored.</p>"},{"location":"ingester/PARAMETER_SETS/#table-of-contents","title":"Table of Contents","text":"<ul> <li>Overview</li> <li>YAML Schema</li> <li>Configuration Sections</li> <li>Creating Parameter Sets</li> <li>Managing Parameter Sets</li> <li>Examples</li> <li>Best Practices</li> </ul>"},{"location":"ingester/PARAMETER_SETS/#overview","title":"Overview","text":"<p>Parameter sets control every aspect of document processing:</p> <ul> <li>Parsing: How to extract text and structure from documents</li> <li>Chunking: How to split documents into semantic chunks</li> <li>Embedding: Which model to use for vector embeddings</li> <li>Storage: Where to store the resulting vector database</li> </ul> <p>Parameter sets are stored as YAML files and can be created via: - Configuration files in <code>config/params/</code> (built-in) - REST API uploads (user-created) - Web UI (if available)</p>"},{"location":"ingester/PARAMETER_SETS/#yaml-schema","title":"YAML Schema","text":""},{"location":"ingester/PARAMETER_SETS/#complete-structure","title":"Complete Structure","text":"<pre><code>id: &lt;string&gt;              # Required: Unique identifier for this parameter set\nname: &lt;string&gt;            # Optional: Human-readable name\nconfig:                   # Required: Configuration sections\n  parse:                  # Optional: Document parsing configuration\n    do_ocr: &lt;boolean&gt;\n    force_ocr: &lt;boolean&gt;\n    ocr_engine: &lt;string&gt;\n    ocr_lang: &lt;string&gt;\n    pdf_backend: &lt;string&gt;\n    table_mode: &lt;string&gt;\n\n  chunk:                  # Optional: Document chunking configuration\n    chunker: &lt;string&gt;\n    chunk_size: &lt;integer&gt;\n    text_context_radius: &lt;integer&gt;\n    chunker_type: &lt;string&gt;\n\n  embed:                  # Required: Embedding configuration\n    provider: &lt;string&gt;\n    model: &lt;string&gt;\n    vector_dim: &lt;integer&gt;\n\n  store:                  # Required: Storage configuration\n    data_dir: &lt;string&gt;\n</code></pre>"},{"location":"ingester/PARAMETER_SETS/#field-reference","title":"Field Reference","text":"Field Type Required Description <code>id</code> string Yes Unique identifier (alphanumeric, hyphens, underscores) <code>name</code> string No Display name for UI <code>config</code> object Yes Configuration sections"},{"location":"ingester/PARAMETER_SETS/#configuration-sections","title":"Configuration Sections","text":""},{"location":"ingester/PARAMETER_SETS/#parse-configuration","title":"Parse Configuration","text":"<p>Controls how documents are parsed and text is extracted.</p> <pre><code>parse:\n  do_ocr: false              # Enable OCR for images and scanned PDFs\n  force_ocr: false           # Force OCR even if text layer exists\n  ocr_engine: easyocr        # OCR engine: easyocr, tesseract\n  ocr_lang: en               # OCR language code\n  pdf_backend: pypdfium2     # PDF parsing backend: pypdfium2, pdfplumber\n  table_mode: accurate       # Table extraction: accurate, fast\n</code></pre> <p>Field Details:</p> Field Type Default Description <code>do_ocr</code> boolean <code>false</code> Enable OCR for image-based PDFs <code>force_ocr</code> boolean <code>false</code> Force OCR even when text layer exists <code>ocr_engine</code> string <code>easyocr</code> OCR engine to use <code>ocr_lang</code> string <code>en</code> Language code for OCR (ISO 639-1) <code>pdf_backend</code> string <code>pypdfium2</code> PDF parsing library <code>table_mode</code> string <code>accurate</code> Table extraction mode <p>OCR Engines: - <code>easyocr</code> - Neural network-based OCR (recommended) - <code>tesseract</code> - Traditional OCR engine</p> <p>PDF Backends: - <code>pypdfium2</code> - Fast, modern PDF parsing (recommended) - <code>pdfplumber</code> - Feature-rich parsing with table support</p> <p>Table Modes: - <code>accurate</code> - Slower but more precise table extraction - <code>fast</code> - Faster processing with acceptable accuracy</p>"},{"location":"ingester/PARAMETER_SETS/#chunk-configuration","title":"Chunk Configuration","text":"<p>Controls how documents are split into chunks for vector search.</p> <pre><code>chunk:\n  chunker: docling-serve      # Chunking service: docling-serve, local\n  chunk_size: 256             # Target chunk size in tokens\n  text_context_radius: 0      # Context overlap in characters\n  chunker_type: hybrid        # Chunking strategy: hybrid, hierarchical, token\n</code></pre> <p>Field Details:</p> Field Type Default Description <code>chunker</code> string <code>docling-serve</code> Chunking service to use <code>chunk_size</code> integer <code>256</code> Target chunk size in tokens <code>text_context_radius</code> integer <code>0</code> Character overlap between chunks <code>chunker_type</code> string <code>hybrid</code> Chunking strategy <p>Chunker Options: - <code>docling-serve</code> - Uses Docling service for semantic chunking (recommended) - <code>local</code> - Local chunking without external service</p> <p>Chunker Types: - <code>hybrid</code> - Combines semantic and token-based splitting (recommended) - <code>hierarchical</code> - Respects document structure (sections, paragraphs) - <code>token</code> - Simple token-based splitting</p> <p>Chunk Size Guidelines: - 128-256 tokens: Good for precise search, higher storage cost - 256-512 tokens: Balanced performance (recommended) - 512-1024 tokens: Better context, less precise search</p> <p>Text Context Radius: - 0: No overlap (faster indexing, less redundancy) - 50-100 chars: Small overlap for continuity - 100-200 chars: Medium overlap (recommended for narratives)</p>"},{"location":"ingester/PARAMETER_SETS/#embed-configuration","title":"Embed Configuration","text":"<p>Controls vector embedding generation.</p> <pre><code>embed:\n  provider: ollama           # Embedding provider: ollama, openai, azure\n  model: qwen3-embedding:4b  # Model identifier\n  vector_dim: 2560           # Vector dimension\n</code></pre> <p>Field Details:</p> Field Type Required Description <code>provider</code> string Yes Embedding service provider <code>model</code> string Yes Model name or identifier <code>vector_dim</code> integer Yes Embedding vector dimension <p>Providers:</p>"},{"location":"ingester/PARAMETER_SETS/#ollama","title":"Ollama","text":"<pre><code>embed:\n  provider: ollama\n  model: qwen3-embedding:4b\n  vector_dim: 2560\n</code></pre> <p>Environment variables: - <code>OLLAMA_BASE_URL</code> - Ollama server URL (e.g., <code>http://localhost:11434</code>)</p> <p>Popular models: - <code>nomic-embed-text</code> - 768 dimensions, excellent performance - <code>mxbai-embed-large</code> - 1024 dimensions, high quality - <code>qwen3-embedding:4b</code> - 2560 dimensions, multilingual</p>"},{"location":"ingester/PARAMETER_SETS/#openai","title":"OpenAI","text":"<pre><code>embed:\n  provider: openai\n  model: text-embedding-3-small\n  vector_dim: 1536\n</code></pre> <p>Environment variables: - <code>OPENAI_API_KEY</code> - OpenAI API key</p> <p>Models: - <code>text-embedding-3-small</code> - 1536 dimensions, cost-effective - <code>text-embedding-3-large</code> - 3072 dimensions, highest quality - <code>text-embedding-ada-002</code> - 1536 dimensions (legacy)</p> <p>Important: The <code>vector_dim</code> must match the actual dimension output by the model. Incorrect values will cause embedding errors.</p>"},{"location":"ingester/PARAMETER_SETS/#store-configuration","title":"Store Configuration","text":"<p>Controls where the vector database is stored.</p> <pre><code>store:\n  data_dir: default_db       # Directory name within LANCEDB_DIR\n</code></pre> <p>Field Details:</p> Field Type Required Description <code>data_dir</code> string Yes Subdirectory name for this database <p>Storage Location:</p> <p>The full path is: <code>{LANCEDB_DIR}/{data_dir}/</code></p> <p>Example: - <code>LANCEDB_DIR=/var/soliplex/lancedb</code> - <code>data_dir=default_db</code> - Result: <code>/var/soliplex/lancedb/default_db/</code></p> <p>Best Practices: - Use descriptive names: <code>financial_reports</code>, <code>legal_docs</code>, <code>product_manuals</code> - Separate databases by embedding model or chunk configuration - Include version in name for model upgrades: <code>reports_v2</code>, <code>docs_ada002</code></p>"},{"location":"ingester/PARAMETER_SETS/#creating-parameter-sets","title":"Creating Parameter Sets","text":""},{"location":"ingester/PARAMETER_SETS/#via-configuration-file","title":"Via Configuration File","text":"<ol> <li>Create YAML file in <code>config/params/</code>:</li> </ol> <pre><code>cd config/params\nnano my_custom_params.yaml\n</code></pre> <ol> <li>Define parameter set:</li> </ol> <pre><code>id: my_custom_params\nname: My Custom Configuration\nconfig:\n  parse:\n    do_ocr: true\n    ocr_engine: easyocr\n    table_mode: accurate\n  chunk:\n    chunker: docling-serve\n    chunk_size: 512\n    chunker_type: hybrid\n  embed:\n    provider: openai\n    model: text-embedding-3-small\n    vector_dim: 1536\n  store:\n    data_dir: custom_db\n</code></pre> <ol> <li>Validate:</li> </ol> <pre><code>si-cli validate-settings\nsi-cli list-param-sets\n</code></pre>"},{"location":"ingester/PARAMETER_SETS/#via-rest-api","title":"Via REST API","text":"<p>Create parameter set:</p> <pre><code>curl -X POST \"http://localhost:8000/api/v1/workflow/param-sets\" \\\n  --data-urlencode \"yaml_content=$(cat &lt;&lt;'EOF'\nid: api_created_params\nname: API Created Parameters\nconfig:\n  chunk:\n    chunker: docling-serve\n    chunk_size: 384\n  embed:\n    provider: ollama\n    model: nomic-embed-text\n    vector_dim: 768\n  store:\n    data_dir: api_db\nEOF\n)\"\n</code></pre> <p>Response: <pre><code>{\n  \"message\": \"Parameter set created successfully\",\n  \"id\": \"api_created_params\",\n  \"file_path\": \"/path/to/params/api_created_params.yaml\"\n}\n</code></pre></p>"},{"location":"ingester/PARAMETER_SETS/#via-python","title":"Via Python","text":"<pre><code>import httpx\nimport yaml\n\n# Define parameter set\nparams = {\n    \"id\": \"python_params\",\n    \"name\": \"Python Created Parameters\",\n    \"config\": {\n        \"chunk\": {\n            \"chunker\": \"docling-serve\",\n            \"chunk_size\": 256,\n        },\n        \"embed\": {\n            \"provider\": \"ollama\",\n            \"model\": \"mxbai-embed-large\",\n            \"vector_dim\": 1024,\n        },\n        \"store\": {\n            \"data_dir\": \"python_db\"\n        }\n    }\n}\n\n# Convert to YAML\nyaml_content = yaml.dump(params, sort_keys=False)\n\n# Upload via API\nasync with httpx.AsyncClient() as client:\n    response = await client.post(\n        \"http://localhost:8000/api/v1/workflow/param-sets\",\n        data={\"yaml_content\": yaml_content}\n    )\n    print(response.json())\n</code></pre>"},{"location":"ingester/PARAMETER_SETS/#managing-parameter-sets","title":"Managing Parameter Sets","text":""},{"location":"ingester/PARAMETER_SETS/#list-all-parameter-sets","title":"List All Parameter Sets","text":"<p>CLI: <pre><code>si-cli list-param-sets\n</code></pre></p> <p>REST API: <pre><code>curl \"http://localhost:8000/api/v1/workflow/param-sets\"\n</code></pre></p> <p>Response: <pre><code>[\n  {\n    \"id\": \"default\",\n    \"name\": \"Default Parameters\",\n    \"source\": \"app\"\n  },\n  {\n    \"id\": \"my_custom_params\",\n    \"name\": \"My Custom Configuration\",\n    \"source\": \"user\"\n  }\n]\n</code></pre></p> <p>Source Types: - <code>app</code> - Built-in parameter sets (cannot be deleted) - <code>user</code> - User-uploaded parameter sets (can be deleted)</p>"},{"location":"ingester/PARAMETER_SETS/#view-parameter-set","title":"View Parameter Set","text":"<p>CLI: <pre><code>si-cli dump-param-set default\n</code></pre></p> <p>REST API: <pre><code>curl \"http://localhost:8000/api/v1/workflow/param-sets/default\"\n</code></pre></p> <p>Returns the raw YAML content.</p>"},{"location":"ingester/PARAMETER_SETS/#delete-parameter-set","title":"Delete Parameter Set","text":"<p>Only user-uploaded parameter sets can be deleted.</p> <p>REST API: <pre><code>curl -X DELETE \"http://localhost:8000/api/v1/workflow/param-sets/my_custom_params\"\n</code></pre></p> <p>Response: <pre><code>{\n  \"message\": \"Parameter set deleted successfully\"\n}\n</code></pre></p> <p>Error if built-in: <pre><code>{\n  \"error\": \"Cannot delete built-in parameter sets\",\n  \"status_code\": 403\n}\n</code></pre></p>"},{"location":"ingester/PARAMETER_SETS/#query-by-target-database","title":"Query by Target Database","text":"<p>Find parameter sets that use a specific LanceDB directory:</p> <pre><code>curl \"http://localhost:8000/api/v1/workflow/param_sets/target/default_db\"\n</code></pre>"},{"location":"ingester/PARAMETER_SETS/#examples","title":"Examples","text":""},{"location":"ingester/PARAMETER_SETS/#high-quality-processing","title":"High-Quality Processing","text":"<p>For important documents where quality matters more than speed:</p> <pre><code>id: high_quality\nname: High Quality Processing\nconfig:\n  parse:\n    do_ocr: true\n    force_ocr: false\n    ocr_engine: easyocr\n    pdf_backend: pypdfium2\n    table_mode: accurate\n  chunk:\n    chunker: docling-serve\n    chunk_size: 384\n    text_context_radius: 100\n    chunker_type: hybrid\n  embed:\n    provider: openai\n    model: text-embedding-3-large\n    vector_dim: 3072\n  store:\n    data_dir: high_quality_db\n</code></pre>"},{"location":"ingester/PARAMETER_SETS/#fast-batch-processing","title":"Fast Batch Processing","text":"<p>For large volumes where speed is critical:</p> <pre><code>id: fast_batch\nname: Fast Batch Processing\nconfig:\n  parse:\n    do_ocr: false\n    pdf_backend: pypdfium2\n    table_mode: fast\n  chunk:\n    chunker: local\n    chunk_size: 512\n    text_context_radius: 0\n    chunker_type: token\n  embed:\n    provider: ollama\n    model: nomic-embed-text\n    vector_dim: 768\n  store:\n    data_dir: fast_batch_db\n</code></pre>"},{"location":"ingester/PARAMETER_SETS/#ocr-heavy-documents","title":"OCR-Heavy Documents","text":"<p>For scanned PDFs and images:</p> <pre><code>id: ocr_focused\nname: OCR-Focused Processing\nconfig:\n  parse:\n    do_ocr: true\n    force_ocr: true\n    ocr_engine: easyocr\n    ocr_lang: en\n    pdf_backend: pypdfium2\n    table_mode: accurate\n  chunk:\n    chunker: docling-serve\n    chunk_size: 256\n    text_context_radius: 50\n    chunker_type: hierarchical\n  embed:\n    provider: ollama\n    model: nomic-embed-text\n    vector_dim: 768\n  store:\n    data_dir: ocr_docs_db\n</code></pre>"},{"location":"ingester/PARAMETER_SETS/#s3-storage","title":"S3 Storage","text":"<p>For using S3-compatible storage:</p> <pre><code>id: s3_default\nname: S3 Storage Configuration\nconfig:\n  chunk:\n    chunker: docling-serve\n    chunk_size: 256\n  embed:\n    provider: ollama\n    model: qwen3-embedding:4b\n    vector_dim: 2560\n  store:\n    data_dir: s3_lancedb\n</code></pre> <p>Environment configuration: <pre><code>FILE_STORE_TARGET=s3\nS3_ENDPOINT_URL=http://seaweedfs:8333\nS3_BUCKET_NAME=soliplex-artifacts\n</code></pre></p>"},{"location":"ingester/PARAMETER_SETS/#multilingual-documents","title":"Multilingual Documents","text":"<p>For documents in multiple languages:</p> <pre><code>id: multilingual\nname: Multilingual Processing\nconfig:\n  parse:\n    do_ocr: true\n    ocr_engine: easyocr\n    ocr_lang: en+es+fr  # Multiple languages\n    table_mode: accurate\n  chunk:\n    chunker: docling-serve\n    chunk_size: 384\n    chunker_type: hybrid\n  embed:\n    provider: ollama\n    model: qwen3-embedding:4b  # Multilingual model\n    vector_dim: 2560\n  store:\n    data_dir: multilingual_db\n</code></pre>"},{"location":"ingester/PARAMETER_SETS/#best-practices","title":"Best Practices","text":""},{"location":"ingester/PARAMETER_SETS/#choosing-chunk-size","title":"Choosing Chunk Size","text":"<p>Small chunks (128-256 tokens): - \u2705 More precise search results - \u2705 Better for factual lookup - \u274c Higher storage costs - \u274c Less context per chunk</p> <p>Medium chunks (256-512 tokens): - \u2705 Balanced performance (recommended) - \u2705 Good context and precision - \u2705 Reasonable storage costs</p> <p>Large chunks (512-1024 tokens): - \u2705 More context per result - \u2705 Better for document understanding - \u274c Less precise search - \u274c May exceed embedding limits</p>"},{"location":"ingester/PARAMETER_SETS/#selecting-embedding-models","title":"Selecting Embedding Models","text":"<p>Consider: 1. Vector dimension: Higher isn't always better    - More dimensions = more storage, slower search    - Quality matters more than size</p> <ol> <li>Cost: OpenAI charges per token</li> <li>Use <code>text-embedding-3-small</code> for cost-effectiveness</li> <li> <p>Use Ollama for free local embeddings</p> </li> <li> <p>Performance: Test with your documents</p> </li> <li>Different models work better for different content</li> <li> <p>Domain-specific models may outperform general models</p> </li> <li> <p>Multilingual: If you need multiple languages</p> </li> <li><code>qwen3-embedding</code> - Excellent multilingual support</li> <li>OpenAI models - Good multilingual coverage</li> </ol>"},{"location":"ingester/PARAMETER_SETS/#parameter-set-versioning","title":"Parameter Set Versioning","text":"<p>When upgrading models or changing configurations:</p> <ol> <li> <p>Create new parameter set with version suffix: <pre><code>id: reports_v2\nstore:\n  data_dir: reports_v2_db\n</code></pre></p> </li> <li> <p>Keep old parameter sets:</p> </li> <li>Allows comparison between versions</li> <li> <p>Old databases remain accessible</p> </li> <li> <p>Document changes: <pre><code>id: reports_v2\nname: Report Processing v2 (upgraded to text-embedding-3-small)\n</code></pre></p> </li> </ol>"},{"location":"ingester/PARAMETER_SETS/#testing-parameter-sets","title":"Testing Parameter Sets","text":"<p>Before processing large batches:</p> <ol> <li> <p>Create test parameter set: <pre><code>id: test_params\nstore:\n  data_dir: test_db\n</code></pre></p> </li> <li> <p>Process small sample: <pre><code># Create test batch with 5-10 documents\ncurl -X POST \"http://localhost:8000/api/v1/batch/\" \\\n  -d \"source=test\" -d \"name=Parameter Test\"\n\n# Start workflow with test parameters\ncurl -X POST \"http://localhost:8000/api/v1/batch/start-workflows\" \\\n  -d \"batch_id=1\" -d \"param_id=test_params\"\n</code></pre></p> </li> <li> <p>Evaluate results:</p> </li> <li>Query precision</li> <li>Processing time</li> <li>Storage size</li> <li> <p>Embedding quality</p> </li> <li> <p>Iterate and deploy: <pre><code>id: production_params\n# Copy tested configuration\n</code></pre></p> </li> </ol>"},{"location":"ingester/PARAMETER_SETS/#storage-organization","title":"Storage Organization","text":"<p>Organize databases by use case:</p> <pre><code># Financial documents\nid: financial_docs\nstore:\n  data_dir: financial_db\n\n# Technical manuals\nid: tech_manuals\nstore:\n  data_dir: manuals_db\n\n# Customer support\nid: support_docs\nstore:\n  data_dir: support_db\n</code></pre> <p>Benefits: - Separate vector spaces - Independent scaling - Easier maintenance - Better search relevance</p>"},{"location":"ingester/PARAMETER_SETS/#troubleshooting","title":"Troubleshooting","text":""},{"location":"ingester/PARAMETER_SETS/#parameter-set-not-found","title":"Parameter Set Not Found","text":"<p>Error: <code>404 Not Found</code> when accessing parameter set</p> <p>Solutions: 1. List available parameter sets:    <pre><code>si-cli list-param-sets\n</code></pre></p> <ol> <li> <p>Check parameter set ID matches exactly (case-sensitive)</p> </li> <li> <p>Verify file exists in <code>config/params/</code> or user uploads</p> </li> </ol>"},{"location":"ingester/PARAMETER_SETS/#invalid-yaml-syntax","title":"Invalid YAML Syntax","text":"<p>Error: <code>400 Bad Request - Invalid YAML syntax</code></p> <p>Solutions: 1. Validate YAML syntax:    <pre><code>python -c \"import yaml; yaml.safe_load(open('params.yaml'))\"\n</code></pre></p> <ol> <li> <p>Check indentation (use spaces, not tabs)</p> </li> <li> <p>Ensure all strings with special characters are quoted</p> </li> </ol>"},{"location":"ingester/PARAMETER_SETS/#embedding-dimension-mismatch","title":"Embedding Dimension Mismatch","text":"<p>Error: <code>Embedding dimension mismatch</code></p> <p>Solutions: 1. Verify <code>vector_dim</code> matches model output:    - Query model documentation    - Test embedding generation</p> <ol> <li>Common dimensions:</li> <li><code>text-embedding-3-small</code>: 1536</li> <li><code>text-embedding-3-large</code>: 3072</li> <li><code>nomic-embed-text</code>: 768</li> <li><code>qwen3-embedding:4b</code>: 2560</li> </ol>"},{"location":"ingester/PARAMETER_SETS/#cannot-delete-parameter-set","title":"Cannot Delete Parameter Set","text":"<p>Error: <code>403 Forbidden - Cannot delete built-in parameter sets</code></p> <p>Solution: - Only parameter sets with <code>source: user</code> can be deleted - Built-in parameter sets are protected - Create a copy if you need to modify:   <pre><code># Copy built-in set\ncurl \"http://localhost:8000/api/v1/workflow/param-sets/default\" &gt; my_params.yaml\n\n# Modify and upload\n# Edit my_params.yaml, change id\ncurl -X POST \"http://localhost:8000/api/v1/workflow/param-sets\" \\\n  --data-urlencode \"yaml_content@my_params.yaml\"\n</code></pre></p>"},{"location":"ingester/PARAMETER_SETS/#related-documentation","title":"Related Documentation","text":"<ul> <li>API Reference - REST API endpoints for parameter management</li> <li>Workflows - Using parameter sets in workflows</li> <li>Configuration - Environment variables for embedding providers</li> <li>Getting Started - Quick start with parameter sets</li> </ul>"},{"location":"ingester/PARAMETER_SETS/#additional-resources","title":"Additional Resources","text":"<ul> <li>HaikuRAG Documentation: https://github.com/ggozad/haiku.rag</li> <li>Docling Documentation: https://docling-project.github.io/docling/</li> <li>Ollama Models: https://ollama.com/library</li> <li>OpenAI Embeddings: https://platform.openai.com/docs/guides/embeddings</li> </ul>"},{"location":"ingester/WORKFLOWS/","title":"Workflow System Documentation","text":""},{"location":"ingester/WORKFLOWS/#overview","title":"Overview","text":"<p>The Soliplex Ingester workflow system orchestrates multi-step document processing pipelines. Each document flows through a series of configurable steps, with automatic retry logic, status tracking, and parallel processing support.</p>"},{"location":"ingester/WORKFLOWS/#core-concepts","title":"Core Concepts","text":""},{"location":"ingester/WORKFLOWS/#workflow-definition","title":"Workflow Definition","text":"<p>A WorkflowDefinition specifies the processing pipeline for documents. It defines: - Unique ID and name - Item steps (processing stages) - Lifecycle event handlers - Retry policies</p> <p>Defined in YAML files at: <code>config/workflows/*.yaml</code></p>"},{"location":"ingester/WORKFLOWS/#workflow-run","title":"Workflow Run","text":"<p>A WorkflowRun represents a single execution of a workflow for one document. It tracks: - Status (PENDING \u2192 RUNNING \u2192 COMPLETED/FAILED) - Start and completion timestamps - Priority level - Associated document and batch</p>"},{"location":"ingester/WORKFLOWS/#run-group","title":"Run Group","text":"<p>A RunGroup aggregates multiple workflow runs that were started together (e.g., all documents in a batch). It provides: - Group-level status tracking - Aggregate statistics - Batch coordination</p>"},{"location":"ingester/WORKFLOWS/#run-step","title":"Run Step","text":"<p>A RunStep is one stage of execution within a workflow run. Each step: - Executes a specific handler method - Has its own status and retry counter - Produces artifacts stored in the file system - Updates database on completion/failure</p>"},{"location":"ingester/WORKFLOWS/#workflow-step-types","title":"Workflow Step Types","text":"<p>The system supports these predefined step types:</p>"},{"location":"ingester/WORKFLOWS/#ingest","title":"INGEST","text":"<ul> <li>Purpose: Load raw document into the system</li> <li>Input: File bytes or URI</li> <li>Output: Document stored in file system</li> <li>Artifact: <code>ArtifactType.DOC</code></li> </ul>"},{"location":"ingester/WORKFLOWS/#validate","title":"VALIDATE","text":"<ul> <li>Purpose: Check document format and readability</li> <li>Input: Raw document</li> <li>Output: Validation result</li> <li>Handler: <code>soliplex_ingester.lib.workflow.validate_document</code></li> </ul>"},{"location":"ingester/WORKFLOWS/#parse","title":"PARSE","text":"<ul> <li>Purpose: Extract text, structure, and metadata</li> <li>Input: Raw document</li> <li>Output: Markdown and JSON representations</li> <li>Artifacts: <code>ArtifactType.PARSED_MD</code>, <code>ArtifactType.PARSED_JSON</code></li> <li>Handler: <code>soliplex_ingester.lib.workflow.parse_document</code></li> <li>Service: Docling server</li> </ul>"},{"location":"ingester/WORKFLOWS/#chunk","title":"CHUNK","text":"<ul> <li>Purpose: Split document into semantic chunks</li> <li>Input: Parsed markdown</li> <li>Output: Array of text chunks</li> <li>Artifact: <code>ArtifactType.CHUNKS</code></li> <li>Handler: <code>soliplex_ingester.lib.workflow.chunk_document</code></li> </ul>"},{"location":"ingester/WORKFLOWS/#embed","title":"EMBED","text":"<ul> <li>Purpose: Generate vector embeddings for chunks</li> <li>Input: Text chunks</li> <li>Output: Embedding vectors</li> <li>Artifact: <code>ArtifactType.EMBEDDINGS</code></li> <li>Handler: <code>soliplex_ingester.lib.workflow.embed_document</code></li> </ul>"},{"location":"ingester/WORKFLOWS/#store","title":"STORE","text":"<ul> <li>Purpose: Save embeddings to RAG system</li> <li>Input: Embeddings</li> <li>Output: RAG document ID</li> <li>Artifact: <code>ArtifactType.RAG</code></li> <li>Handler: <code>soliplex_ingester.lib.workflow.save_to_rag</code></li> <li>Backend: LanceDB + HaikuRAG</li> </ul>"},{"location":"ingester/WORKFLOWS/#enrich","title":"ENRICH","text":"<ul> <li>Purpose: Add metadata or perform additional processing</li> <li>Input: Document and existing artifacts</li> <li>Output: Enhanced metadata</li> <li>Handler: Custom (user-defined)</li> </ul>"},{"location":"ingester/WORKFLOWS/#route","title":"ROUTE","text":"<ul> <li>Purpose: Conditional logic for workflow branching</li> <li>Input: Document state</li> <li>Output: Routing decision</li> <li>Handler: Custom (user-defined)</li> </ul>"},{"location":"ingester/WORKFLOWS/#workflow-configuration","title":"Workflow Configuration","text":""},{"location":"ingester/WORKFLOWS/#workflow-definition-yaml","title":"Workflow Definition YAML","text":"<p>Example: <code>config/workflows/batch.yaml</code></p> <pre><code>id: batch\nname: Batch Workflow\nmeta: {}\n\nitem_steps:\n  validate:\n    name: docling validate\n    retries: 3\n    method: soliplex_ingester.lib.workflow.validate_document\n    parameters: {}\n\n  parse:\n    name: docling parse\n    retries: 3\n    method: soliplex_ingester.lib.workflow.parse_document\n    parameters: {}\n\n  chunk:\n    name: docling chunk\n    retries: 3\n    method: soliplex_ingester.lib.workflow.chunk_document\n    parameters: {}\n\n  embed:\n    name: embeddings\n    retries: 3\n    method: soliplex_ingester.lib.workflow.embed_document\n    parameters: {}\n\n  store:\n    name: save to rag\n    retries: 3\n    method: soliplex_ingester.lib.workflow.save_to_rag\n    parameters: {}\n\nlifecycle_events:\n  group_start:\n    - name: log group start\n      method: soliplex_ingester.lib.workflow.log_event\n      retries: 1\n      parameters:\n        message: \"Starting workflow group\"\n</code></pre>"},{"location":"ingester/WORKFLOWS/#parameter-set-yaml","title":"Parameter Set YAML","text":"<p>Parameters control step behavior without changing the workflow definition.</p> <p>Example: <code>config/params/default.yaml</code></p> <pre><code>id: default\nname: Default Parameters\nmeta:\n  description: Standard processing parameters\n\nconfig:\n  parse:\n    format: markdown\n    ocr_enabled: true\n\n  chunk:\n    chunk_size: 512\n    chunk_overlap: 50\n    separator: \"\\n\\n\"\n\n  embed:\n    model: text-embedding-3-small\n    batch_size: 1000\n\n  store:\n    data_dir: lancedb\n    collection_name: documents\n</code></pre>"},{"location":"ingester/WORKFLOWS/#workflow-execution","title":"Workflow Execution","text":""},{"location":"ingester/WORKFLOWS/#creating-workflows","title":"Creating Workflows","text":"<p>For a Batch: <pre><code>curl -X POST \"http://localhost:8000/api/v1/batch/start-workflows\" \\\n  -d \"batch_id=1\" \\\n  -d \"workflow_definition_id=batch\" \\\n  -d \"param_id=default\"\n</code></pre></p> <p>For a Single Document: <pre><code>curl -X POST \"http://localhost:8000/api/v1/workflow/\" \\\n  -d \"doc_id=sha256-abc123...\" \\\n  -d \"workflow_definition_id=batch\"\n</code></pre></p>"},{"location":"ingester/WORKFLOWS/#worker-processing","title":"Worker Processing","text":"<p>Workers continuously poll for pending steps:</p> <ol> <li>Query database for PENDING steps with highest priority</li> <li>Lock step with <code>FOR UPDATE</code> to prevent duplicate processing</li> <li>Transition status: PENDING \u2192 RUNNING</li> <li>Execute handler method</li> <li>Store artifacts in file system</li> <li>Update step status: RUNNING \u2192 COMPLETED/ERROR</li> <li>Update parent run status based on step results</li> <li>Repeat</li> </ol> <p>Start a worker: <pre><code>si-cli worker\n</code></pre></p> <p>Or via server (starts worker automatically): <pre><code>si-cli serve\n</code></pre></p>"},{"location":"ingester/WORKFLOWS/#status-transitions","title":"Status Transitions","text":"<p>Valid Transitions: - PENDING \u2192 RUNNING - RUNNING \u2192 COMPLETED - RUNNING \u2192 ERROR - ERROR \u2192 RUNNING (retry) - ERROR \u2192 FAILED (after max retries)</p> <p>Invalid Transitions: - COMPLETED \u2192 RUNNING (no re-running completed steps) - FAILED \u2192 RUNNING (use retry endpoint instead)</p>"},{"location":"ingester/WORKFLOWS/#lifecycle-events","title":"Lifecycle Events","text":"<p>Lifecycle events allow custom logic at key points:</p>"},{"location":"ingester/WORKFLOWS/#event-types","title":"Event Types","text":"<ul> <li><code>GROUP_START</code> - Run group begins</li> <li><code>GROUP_END</code> - Run group completes</li> <li><code>ITEM_START</code> - Workflow run begins</li> <li><code>ITEM_END</code> - Workflow run completes</li> <li><code>ITEM_FAILED</code> - Workflow run fails</li> <li><code>STEP_START</code> - Step begins</li> <li><code>STEP_END</code> - Step completes</li> <li><code>STEP_FAILED</code> - Step fails</li> </ul>"},{"location":"ingester/WORKFLOWS/#event-handler-example","title":"Event Handler Example","text":"<pre><code>lifecycle_events:\n  item_failed:\n    - name: notify on failure\n      method: myapp.notifications.send_alert\n      retries: 3\n      parameters:\n        channel: \"#alerts\"\n        message: \"Document processing failed\"\n</code></pre>"},{"location":"ingester/WORKFLOWS/#retry-logic","title":"Retry Logic","text":""},{"location":"ingester/WORKFLOWS/#automatic-retries","title":"Automatic Retries","text":"<p>Steps automatically retry on error: - Configurable retry count per step - Exponential backoff (implementation dependent) - Status: ERROR during retries, FAILED when exhausted</p>"},{"location":"ingester/WORKFLOWS/#manual-retry","title":"Manual Retry","text":"<p>Reset failed steps for a run group: <pre><code>curl -X POST \"http://localhost:8000/api/v1/workflow/retry\" \\\n  -d \"run_group_id=5\"\n</code></pre></p> <p>This resets all FAILED steps to PENDING for re-processing.</p>"},{"location":"ingester/WORKFLOWS/#monitoring","title":"Monitoring","text":""},{"location":"ingester/WORKFLOWS/#check-run-group-status","title":"Check Run Group Status","text":"<pre><code>curl \"http://localhost:8000/api/v1/workflow/run-groups/5/stats\"\n</code></pre> <p>Returns: <pre><code>{\n  \"total_runs\": 100,\n  \"completed\": 95,\n  \"running\": 3,\n  \"pending\": 0,\n  \"failed\": 2,\n  \"average_duration\": 45.3,\n  \"group_status\": \"RUNNING\"\n}\n</code></pre></p>"},{"location":"ingester/WORKFLOWS/#check-specific-workflow-run","title":"Check Specific Workflow Run","text":"<pre><code>curl \"http://localhost:8000/api/v1/workflow/runs/42\"\n</code></pre> <p>Returns workflow run with all steps and their status.</p>"},{"location":"ingester/WORKFLOWS/#query-steps-by-status","title":"Query Steps by Status","text":"<pre><code>curl \"http://localhost:8000/api/v1/workflow/steps?status=FAILED\"\n</code></pre> <p>Lists all failed steps for investigation.</p>"},{"location":"ingester/WORKFLOWS/#custom-step-handlers","title":"Custom Step Handlers","text":""},{"location":"ingester/WORKFLOWS/#handler-signature","title":"Handler Signature","text":"<pre><code>async def custom_handler(\n    run_step: RunStep,\n    workflow_run: WorkflowRun,\n    doc: Document,\n    step_params: dict[str, Any]\n) -&gt; dict[str, Any]:\n    \"\"\"\n    Custom workflow step handler.\n\n    Args:\n        run_step: Current step being executed\n        workflow_run: Parent workflow run\n        doc: Document being processed\n        step_params: Parameters from config\n\n    Returns:\n        Dictionary with result metadata\n\n    Raises:\n        Exception: On failure (will trigger retry)\n    \"\"\"\n    # Your processing logic here\n    result_data = await process_document(doc)\n\n    # Store artifacts if needed\n    await store_artifact(\n        doc.hash,\n        ArtifactType.CUSTOM,\n        result_data\n    )\n\n    return {\"status\": \"success\", \"items_processed\": 42}\n</code></pre>"},{"location":"ingester/WORKFLOWS/#registering-custom-handler","title":"Registering Custom Handler","text":"<ol> <li>Define the handler in your Python module</li> <li>Add to workflow YAML: <pre><code>item_steps:\n  custom_step:\n    name: My Custom Step\n    retries: 2\n    method: myapp.handlers.custom_handler\n    parameters:\n      param1: value1\n</code></pre></li> <li>Ensure module is importable by the worker process</li> </ol>"},{"location":"ingester/WORKFLOWS/#worker-configuration","title":"Worker Configuration","text":""},{"location":"ingester/WORKFLOWS/#environment-variables","title":"Environment Variables","text":"<ul> <li><code>INGEST_WORKER_CONCURRENCY</code> - Max concurrent workflow steps (default: 10)</li> <li><code>INGEST_QUEUE_CONCURRENCY</code> - Max concurrent queue operations (default: 20)</li> <li><code>DOCLING_CONCURRENCY</code> - Max concurrent Docling requests (default: 3)</li> <li><code>WORKER_TASK_COUNT</code> - Steps to fetch per query (default: 5)</li> <li><code>WORKER_CHECKIN_INTERVAL</code> - Heartbeat interval in seconds (default: 120)</li> <li><code>WORKER_CHECKIN_TIMEOUT</code> - Worker timeout in seconds (default: 600)</li> </ul>"},{"location":"ingester/WORKFLOWS/#multiple-workers","title":"Multiple Workers","text":"<p>Run multiple workers for increased throughput:</p> <pre><code># Terminal 1\nsi-cli worker\n\n# Terminal 2\nsi-cli worker\n\n# Terminal 3\nsi-cli worker\n</code></pre> <p>Database locking ensures no duplicate processing.</p>"},{"location":"ingester/WORKFLOWS/#artifact-storage","title":"Artifact Storage","text":""},{"location":"ingester/WORKFLOWS/#storage-paths","title":"Storage Paths","text":"<p>Artifacts are stored under <code>FILE_STORE_DIR</code> with subdirectories:</p> <ul> <li><code>document_store_dir/</code> - Raw documents</li> <li><code>parsed_markdown_store_dir/</code> - Parsed markdown</li> <li><code>parsed_json_store_dir/</code> - Parsed JSON</li> <li><code>chunks_store_dir/</code> - Text chunks</li> <li><code>embeddings_store_dir/</code> - Embedding vectors</li> </ul>"},{"location":"ingester/WORKFLOWS/#file-naming","title":"File Naming","text":"<p>Files are named by document hash: <pre><code>{storage_dir}/{hash}\n</code></pre></p> <p>Example: <pre><code>file_store/markdown/sha256-abc123def456...\n</code></pre></p>"},{"location":"ingester/WORKFLOWS/#storage-backends","title":"Storage Backends","text":"<p>Configure via <code>FILE_STORE_TARGET</code>: - <code>fs</code> - Local filesystem (default) - <code>s3</code> - S3-compatible storage (via OpenDAL) - Other OpenDAL-supported backends</p>"},{"location":"ingester/WORKFLOWS/#best-practices","title":"Best Practices","text":""},{"location":"ingester/WORKFLOWS/#workflow-design","title":"Workflow Design","text":"<ol> <li>Keep steps atomic - Each step should do one thing well</li> <li>Make steps idempotent - Re-running a step should be safe</li> <li>Use appropriate retries - 3 retries for transient errors, 1 for validation</li> <li>Store intermediate results - Save artifacts for debugging and recovery</li> </ol>"},{"location":"ingester/WORKFLOWS/#error-handling","title":"Error Handling","text":"<ol> <li>Raise exceptions for retriable errors</li> <li>Log context before raising (worker ID, document hash, step)</li> <li>Use status_meta to store error details</li> <li>Monitor failed steps and investigate patterns</li> </ol>"},{"location":"ingester/WORKFLOWS/#performance","title":"Performance","text":"<ol> <li>Tune concurrency based on available resources</li> <li>Batch operations where possible (embeddings)</li> <li>Use priorities for urgent documents</li> <li>Monitor worker health via heartbeat table</li> </ol>"},{"location":"ingester/WORKFLOWS/#testing","title":"Testing","text":"<ol> <li>Test handlers independently with mock data</li> <li>Use small batches for integration testing</li> <li>Verify artifact storage after each step</li> <li>Test retry logic by simulating failures</li> </ol>"},{"location":"ingester/WORKFLOWS/#troubleshooting","title":"Troubleshooting","text":""},{"location":"ingester/WORKFLOWS/#stuck-workflows","title":"Stuck Workflows","text":"<p>Symptom: Workflows remain in RUNNING status indefinitely</p> <p>Solution: 1. Check worker logs for exceptions 2. Query stuck steps: <code>SELECT * FROM runstep WHERE status='RUNNING' AND start_date &lt; NOW() - INTERVAL '1 hour'</code> 3. Check worker heartbeat: <code>SELECT * FROM workercheckin</code> 4. Restart workers if stale</p>"},{"location":"ingester/WORKFLOWS/#failed-steps","title":"Failed Steps","text":"<p>Symptom: Steps transition to FAILED status</p> <p>Solution: 1. Query step details: <code>GET /api/v1/workflow/steps?status=FAILED</code> 2. Check <code>status_message</code> and <code>status_meta</code> for error info 3. Fix underlying issue (service down, invalid config, etc.) 4. Retry: <code>POST /api/v1/workflow/retry</code></p>"},{"location":"ingester/WORKFLOWS/#slow-processing","title":"Slow Processing","text":"<p>Symptom: Low throughput, long durations</p> <p>Solution: 1. Check Docling server response time 2. Increase <code>INGEST_WORKER_CONCURRENCY</code> 3. Run multiple workers 4. Verify database performance (add indexes if needed) 5. Check network latency to external services</p>"},{"location":"ingester/WORKFLOWS/#duplicate-processing","title":"Duplicate Processing","text":"<p>Symptom: Same document processed multiple times</p> <p>Solution: 1. Verify database locking is working (<code>FOR UPDATE</code>) 2. Check for unique constraint violations in logs 3. Ensure workers use distinct worker IDs 4. Verify step status transitions are atomic</p>"},{"location":"ingester-agents/","title":"Soliplex Agents","text":"<p>Agents for ingesting documents into the Soliplex Ingester system. This package provides tools to collect, validate, and ingest documents from multiple sources including local filesystems, and source code management platforms (GitHub, Gitea).</p>"},{"location":"ingester-agents/#features","title":"Features","text":"<ul> <li>Filesystem Agent (<code>fs</code>): Ingest documents from local directories</li> <li>Recursive directory scanning</li> <li>Automatic SHA256 hash calculation</li> <li>MIME type detection</li> <li>Configuration validation</li> <li> <p>Status checking to avoid re-ingesting unchanged files</p> </li> <li> <p>SCM Agent (<code>scm</code>): Ingest files and issues from Git repositories</p> </li> <li>Support for GitHub and Gitea platforms</li> <li>Automatic file type filtering</li> <li>Issue ingestion with comments (rendered as Markdown)</li> <li>Batch processing with workflow support</li> <li> <p>Status checking to avoid re-ingesting unchanged files</p> </li> <li> <p>REST API Server: Run agents as a web service</p> </li> <li>FastAPI-based HTTP endpoints for all operations</li> <li>Multiple authentication methods (API key, OAuth2 proxy)</li> <li>Interactive API documentation with Swagger UI</li> <li>Health check endpoint for monitoring</li> <li>Container-ready with Docker support</li> </ul>"},{"location":"ingester-agents/#installation","title":"Installation","text":"<p>Requirements: - Python 3.13 or higher - Soliplex Ingester running and accessible</p> <p>Before using these tools, a working version of Soliplex Ingester must be available. The URL will need to be configured in the environment variables to function.</p>"},{"location":"ingester-agents/#using-uv-recommended","title":"Using uv (Recommended)","text":"<pre><code>uv add soliplex.agents\n</code></pre>"},{"location":"ingester-agents/#using-pip","title":"Using pip","text":"<pre><code>pip install soliplex.agents\n</code></pre>"},{"location":"ingester-agents/#from-source","title":"From Source","text":"<pre><code>git clone &lt;repository-url&gt;\ncd ingester-agents\nuv sync\n</code></pre>"},{"location":"ingester-agents/#configuration","title":"Configuration","text":"<p>The agents use environment variables for configuration. Create a <code>.env</code> file or export these variables:</p>"},{"location":"ingester-agents/#required-configuration","title":"Required Configuration","text":"<pre><code># Soliplex Ingester API endpoint\nENDPOINT_URL=http://localhost:8000/api/v1\n\n# Ingester API authentication (for connecting to protected Ingester instances)\nINGESTER_API_KEY=your-ingester-api-key\n\n# GitHub Configuration - if needed\nGH_TOKEN=your_github_token_here\nGH_OWNER=your_github_username_or_org\n\n# Gitea Configuration - if needed\nGITEA_URL=https://your-gitea-instance.com\nGITEA_TOKEN=your_gitea_token_here\nGITEA_OWNER=admin\n</code></pre>"},{"location":"ingester-agents/#optional-configuration","title":"Optional Configuration","text":"<pre><code># File extensions to include (default: md,pdf,doc,docx)\nEXTENSIONS=md,pdf,doc,docx\n\n# Logging level (default: INFO)\nLOG_LEVEL=INFO\n\n# API Server Configuration\nSERVER_HOST=127.0.0.1\nSERVER_PORT=8001\n\n# Authentication (for API server)\nAPI_KEY=your-secret-key-here\nAPI_KEY_ENABLED=false\nAUTH_TRUST_PROXY_HEADERS=false\n</code></pre>"},{"location":"ingester-agents/#usage","title":"Usage","text":"<p>The CLI tool <code>si-agent</code> provides three main modes of operation: - <code>fs</code>: Filesystem agent for ingesting local documents - <code>scm</code>: SCM agent for ingesting from Git repositories - <code>serve</code>: REST API server exposing agent functionality via HTTP</p>"},{"location":"ingester-agents/#filesystem-agent","title":"Filesystem Agent","text":""},{"location":"ingester-agents/#1-build-configuration","title":"1. Build Configuration","text":"<p>Scan a directory and create an inventory file:</p> <pre><code>si-agent fs build-config /path/to/documents\n</code></pre> <p>This creates an <code>inventory.json</code> file containing metadata for all discovered files. This file can be modified with additional metadata if desired.</p>"},{"location":"ingester-agents/#2-validate-configuration","title":"2. Validate Configuration","text":"<p>Check if files in the inventory are supported:</p> <pre><code>si-agent fs validate-config /path/to/inventory.json\n</code></pre>"},{"location":"ingester-agents/#3-check-status","title":"3. Check Status","text":"<p>See which files need to be ingested:</p> <pre><code>si-agent fs check-status /path/to/inventory.json my-source-name\n</code></pre> <p>Add <code>--detail</code> flag to see the full list of files:</p> <pre><code>si-agent fs check-status /path/to/inventory.json my-source-name --detail\n</code></pre> <p>The status check compares file hashes against the Ingester database: - new: File doesn't exist in the database - mismatch: File exists but content has changed - match: File is unchanged (will be skipped during ingestion)</p>"},{"location":"ingester-agents/#4-load-inventory","title":"4. Load Inventory","text":"<p>Ingest documents from an inventory:</p> <pre><code>si-agent fs run-inventory /path/to/inventory.json my-source-name\n</code></pre> <p>Advanced options:</p> <pre><code># Process a subset of files (e.g., files 10-50)\nsi-agent fs run-inventory inventory.json my-source --start 10 --end 50\n\n# Resume a previous batch\nsi-agent fs run-inventory inventory.json my-source --resume-batch 123\n\n# Start workflows after ingestion\nsi-agent fs run-inventory inventory.json my-source \\\n  --start-workflows \\\n  --workflow-definition-id my-workflow \\\n  --param-set-id my-params \\\n  --priority 10\n</code></pre> <p>You can also pass a directory path directly (it will build the config automatically):</p> <pre><code>si-agent fs run-inventory /path/to/documents my-source-name\n</code></pre>"},{"location":"ingester-agents/#scm-agent","title":"SCM Agent","text":""},{"location":"ingester-agents/#1-list-issues","title":"1. List Issues","text":"<p>List all issues from a repository:</p> <pre><code># GitHub\nsi-agent scm list-issues github my-repo my-github-user\n\n# Gitea\nsi-agent scm list-issues gitea my-repo --owner admin\n</code></pre>"},{"location":"ingester-agents/#2-get-repository-files","title":"2. Get Repository Files","text":"<p>List files in a repository:</p> <pre><code># GitHub\nsi-agent scm get-repo github my-repo my-github-user\n\n# Gitea\nsi-agent scm get-repo gitea my-repo\n</code></pre>"},{"location":"ingester-agents/#3-load-inventory","title":"3. Load Inventory","text":"<p>Ingest both files and issues from a repository. Issues are rendered as Markdown documents with their comments.</p> <pre><code># GitHub\nsi-agent scm run-inventory github my-repo my-github-user\n\n# Gitea\nsi-agent scm run-inventory gitea my-repo admin\n</code></pre> <p>Note on Workflows: By default, <code>start_workflows=True</code>. To skip workflow triggering, explicitly set <code>--no-start-workflows</code>.</p>"},{"location":"ingester-agents/#how-it-works","title":"How It Works","text":""},{"location":"ingester-agents/#document-ingestion-flow","title":"Document Ingestion Flow","text":"<ol> <li>Discovery: Files are discovered from the source (filesystem or SCM)</li> <li>Hashing: Each file's hash is calculated</li> <li>Filesystem sources: SHA256 hash</li> <li>SCM sources: SHA3-256 hash for files, SHA256 for issues</li> <li>Status Check: The system checks which files have changed or are new against the ingester database</li> <li>Batch Management:</li> <li>The system searches for an existing batch matching the source name</li> <li>If found, new documents are added to the existing batch (incremental ingestion)</li> <li>If not found, a new batch is created</li> <li>This enables efficient re-ingestion: only new or changed files are processed</li> <li>Ingestion: Files are uploaded to the Soliplex Ingester API</li> <li>Workflow Trigger (optional): Workflows can be started to process the ingested documents. See Ingester documentation for details.</li> </ol>"},{"location":"ingester-agents/#file-filtering","title":"File Filtering","text":"<p>Both agents filter files by the <code>EXTENSIONS</code> configuration. The default extensions are: <code>md</code>, <code>pdf</code>, <code>doc</code>, <code>docx</code>.</p> <p>To add more types: <pre><code>export EXTENSIONS=md,pdf,doc,docx,txt,rst\n</code></pre></p> <p>It also validates that files have supported content types and rejects: - ZIP archives - RAR archives - 7z archives - Generic binary files without proper MIME types</p>"},{"location":"ingester-agents/#scm-agent_1","title":"SCM Agent","text":"<p>The SCM agent only includes files with extensions specified in the <code>EXTENSIONS</code> configuration (default: <code>md</code>, <code>pdf</code>, <code>doc</code>, <code>docx</code>).</p>"},{"location":"ingester-agents/#issues-as-documents","title":"Issues as Documents","text":"<p>For SCM sources, issues (including their comments) are rendered as Markdown documents and ingested alongside repository files. This enables full-text search and analysis of issue discussions.</p>"},{"location":"ingester-agents/#examples","title":"Examples","text":"<p>As an example, the soliplex documentation) can be loaded using both the filesystem and via git.</p>"},{"location":"ingester-agents/#example-1-ingest-local-documents","title":"Example 1: Ingest Local Documents","text":"<pre><code>git clone https://github.com/soliplex/soliplex.git\n\n\n# Set up environment, check ingester configuration for details\nexport ENDPOINT_URL=http://localhost:8000/api/v1\n\n# Create inventory and ingest\nuv run  si-agent fs build-config &lt;path-to-checkout&gt;soliplex/docs\n#you may see messages about ignored files\n\n#if you want to update the inventory.json file, do it here\n\nuv run  si-agent fs validate-config &lt;path-to-checkout&gt;soliplex/docs/inventory.json\n#if there are errors, fix them now\n\nuv run  si-agent fs run-inventory &lt;path-to-checkout&gt;soliplex/docs soliplex-docs\n\n#check that documents are in the ingester: (your batch id may be different)\ncurl -X 'GET' \\\n  'http://127.0.0.1:8000/api/v1/document/?batch_id=1' \\\n  -H 'accept: application/json'\n</code></pre>"},{"location":"ingester-agents/#example-2-ingest-github-repository","title":"Example 2: Ingest GitHub Repository","text":"<pre><code># Set up environment\nexport ENDPOINT_URL=http://localhost:8000/api/v1\nexport GH_TOKEN=ghp_your_token_here\nexport GH_OWNER=mycompany\n\n# Ingest repository\nsi-agent scm run-inventory github soliplex soliplex\n\n#check that documents are in the ingester: (your batch id may be different)\ncurl -X 'GET' \\\n  'http://127.0.0.1:8000/api/v1/document/?batch_id=2' \\\n  -H 'accept: application/json'\n</code></pre>"},{"location":"ingester-agents/#example-3-batch-processing-with-workflows","title":"Example 3: Batch Processing with Workflows","text":"<pre><code># Ingest and trigger processing workflows\nsi-agent fs run-inventory ./documents my-docs \\\n  --start-workflows \\\n  --workflow-definition-id document-analysis \\\n  --priority 5\n</code></pre>"},{"location":"ingester-agents/#server-api","title":"Server API","text":"<p>The agents can be run as a REST API server using FastAPI. This exposes all agent operations as HTTP endpoints with support for authentication and interactive documentation.</p>"},{"location":"ingester-agents/#starting-the-server","title":"Starting the Server","text":"<pre><code># Basic\nsi-agent serve\n\n# Custom host and port\nsi-agent serve --host 0.0.0.0 --port 8080\n\n# Development mode with auto-reload\nsi-agent serve --reload\n\n# Production with multiple workers\nsi-agent serve --workers 4\n</code></pre>"},{"location":"ingester-agents/#authentication","title":"Authentication","text":"<p>The server supports multiple authentication methods:</p>"},{"location":"ingester-agents/#1-no-authentication-default","title":"1. No Authentication (Default)","text":"<pre><code>si-agent serve\n# All requests allowed\n</code></pre>"},{"location":"ingester-agents/#2-api-key-authentication","title":"2. API Key Authentication","text":"<pre><code>export API_KEY=your-secret-key\nexport API_KEY_ENABLED=true\nsi-agent serve\n</code></pre> <p>Clients must include the API key in the <code>Authorization</code> header: <pre><code>curl -H \"Authorization: Bearer your-secret-key\" http://localhost:8001/api/fs/status\n</code></pre></p>"},{"location":"ingester-agents/#3-oauth2-proxy-headers","title":"3. OAuth2 Proxy Headers","text":"<pre><code>export AUTH_TRUST_PROXY_HEADERS=true\nsi-agent serve\n</code></pre> <p>The server will trust authentication headers from a reverse proxy (e.g., OAuth2 Proxy): - <code>X-Auth-Request-User</code> - <code>X-Forwarded-User</code> - <code>X-Forwarded-Email</code></p>"},{"location":"ingester-agents/#api-endpoints","title":"API Endpoints","text":""},{"location":"ingester-agents/#filesystem-routes-apifs","title":"Filesystem Routes (<code>/api/fs/</code>)","text":"Method Endpoint Description <code>POST</code> <code>/api/fs/build-config</code> Build inventory from directory <code>POST</code> <code>/api/fs/validate-config</code> Validate inventory file <code>POST</code> <code>/api/fs/check-status</code> Check which files need ingestion <code>POST</code> <code>/api/fs/run-inventory</code> Ingest documents from inventory <p>Example: <pre><code>curl -X POST http://localhost:8001/api/fs/build-config \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"directory_path\": \"/path/to/docs\"}'\n</code></pre></p>"},{"location":"ingester-agents/#scm-routes-apiscm","title":"SCM Routes (<code>/api/scm/</code>)","text":"Method Endpoint Description <code>GET</code> <code>/api/scm/{platform}/{repo}/issues</code> List repository issues <code>GET</code> <code>/api/scm/{platform}/{repo}/files</code> List repository files <code>POST</code> <code>/api/scm/{platform}/{repo}/ingest</code> Ingest repo files and issues <p>Example: <pre><code># List GitHub issues\ncurl http://localhost:8001/api/scm/github/my-repo/issues?owner=myuser\n\n# Ingest repository\ncurl -X POST http://localhost:8001/api/scm/github/my-repo/ingest \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"owner\": \"myuser\", \"source\": \"my-source\"}'\n</code></pre></p>"},{"location":"ingester-agents/#health-check","title":"Health Check","text":"Method Endpoint Description <code>GET</code> <code>/health</code> Server health check <p>Example: <pre><code>curl http://localhost:8001/health\n# Returns: {\"status\": \"healthy\"}\n</code></pre></p>"},{"location":"ingester-agents/#api-documentation","title":"API Documentation","text":"<p>Interactive API documentation is available at: - Swagger UI: <code>http://localhost:8001/docs</code> - ReDoc: <code>http://localhost:8001/redoc</code> - OpenAPI JSON: <code>http://localhost:8001/openapi.json</code></p>"},{"location":"ingester-agents/#docker-deployment","title":"Docker Deployment","text":"<p>The server is designed to run in containers:</p> <pre><code># Build image\ndocker build -t ingester-agents:latest .\n\n# Run with environment variables\ndocker run -d \\\n  -p 8001:8000 \\\n  -e ENDPOINT_URL=http://ingester:8000/api/v1 \\\n  -e API_KEY_ENABLED=true \\\n  -e API_KEY=your-secret-key \\\n  ingester-agents:latest\n\n# Check health\ncurl http://localhost:8001/health\n</code></pre> <p>The Docker image includes: - Non-root user for security - Health checks for orchestration - Proper signal handling - Production-ready uvicorn configuration</p> <p>See DOCKERFILE_CHANGES.md for implementation details.</p>"},{"location":"ingester-agents/#troubleshooting","title":"Troubleshooting","text":""},{"location":"ingester-agents/#authentication-errors","title":"Authentication Errors","text":"<p>Ensure your tokens have the required permissions: - GitHub: <code>repo</code> scope for private repositories, public access for public repos - Gitea: Access token with read permissions</p>"},{"location":"ingester-agents/#connection-errors","title":"Connection Errors","text":"<p>Verify the <code>ENDPOINT_URL</code> is correct and the Ingester API is running: <pre><code>curl http://localhost:8000/api/v1/batch/\n</code></pre></p>"},{"location":"ingester-agents/#file-not-found-errors","title":"File Not Found Errors","text":"<p>For SCM agents, ensure the repository name and owner are correct. Use the exact repository name, not the URL.</p>"},{"location":"ingester-agents/#development","title":"Development","text":""},{"location":"ingester-agents/#setup","title":"Setup","text":"<pre><code># Clone repository\ngit clone &lt;repository-url&gt;\ncd ingester-agents\n\n# Install dependencies with dev tools\nuv sync\n\n# Run tests\nuv run pytest\n\n# Run linter\nuv run ruff check\n</code></pre>"},{"location":"ingester-agents/#testing","title":"Testing","text":"<p>The project uses pytest with 100% code coverage requirements:</p> <pre><code># Run unit tests with coverage\nuv run pytest\n\n# Run specific tests\nuv run pytest tests/unit/test_client.py\n\n# Generate coverage report\nuv run pytest --cov-report=html\n</code></pre>"},{"location":"ingester-agents/#code-quality","title":"Code Quality","text":"<p>The project uses Ruff for linting and code formatting:</p> <pre><code># Check code\nuv run ruff check\n\n# Auto-fix issues\nuv run ruff check --fix\n\n# Format code\nuv run ruff format\n</code></pre>"},{"location":"ingester-agents/#architecture","title":"Architecture","text":"<pre><code>soliplex.agents/\n\u251c\u2500\u2500 src/soliplex/agents/\n\u2502   \u251c\u2500\u2500 cli.py              # Main CLI entry point (includes 'serve' command)\n\u2502   \u251c\u2500\u2500 client.py           # Soliplex Ingester API client\n\u2502   \u251c\u2500\u2500 config.py           # Configuration and settings\n\u2502   \u251c\u2500\u2500 server/             # FastAPI server\n\u2502   \u2502   \u251c\u2500\u2500 __init__.py     # FastAPI app initialization\n\u2502   \u2502   \u251c\u2500\u2500 auth.py         # Authentication (API key &amp; OAuth2 proxy)\n\u2502   \u2502   \u2514\u2500\u2500 routes/\n\u2502   \u2502       \u251c\u2500\u2500 __init__.py\n\u2502   \u2502       \u251c\u2500\u2500 fs.py       # Filesystem API endpoints\n\u2502   \u2502       \u2514\u2500\u2500 scm.py      # SCM API endpoints\n\u2502   \u251c\u2500\u2500 fs/                 # Filesystem agent\n\u2502   \u2502   \u251c\u2500\u2500 app.py          # Core filesystem logic\n\u2502   \u2502   \u2514\u2500\u2500 cli.py          # Filesystem CLI commands\n\u2502   \u2514\u2500\u2500 scm/                # SCM agent\n\u2502       \u251c\u2500\u2500 app.py          # Core SCM logic\n\u2502       \u251c\u2500\u2500 cli.py          # SCM CLI commands\n\u2502       \u251c\u2500\u2500 base.py         # Base SCM provider interface\n\u2502       \u251c\u2500\u2500 github/         # GitHub implementation\n\u2502       \u251c\u2500\u2500 gitea/          # Gitea implementation\n\u2502       \u2514\u2500\u2500 lib/\n\u2502           \u251c\u2500\u2500 templates/  # Issue rendering templates\n\u2502           \u2514\u2500\u2500 utils.py    # Utility functions\n\u251c\u2500\u2500 tests/                  # Test suite\n\u2502   \u2514\u2500\u2500 unit/\n\u2502       \u251c\u2500\u2500 test_server_*.py  # Server API tests\n\u2502       \u2514\u2500\u2500 ...\n\u251c\u2500\u2500 Dockerfile              # Production container\n\u251c\u2500\u2500 .dockerignore           # Build context exclusions\n\u2514\u2500\u2500 DOCKERFILE_CHANGES.md   # Docker implementation documentation\n</code></pre>"},{"location":"ingester-agents/#key-components","title":"Key Components","text":"<p>CLI Layer: - <code>cli.py</code> - Main entry point with <code>fs</code>, <code>scm</code>, and <code>serve</code> commands - Agent-specific CLI commands in <code>fs/cli.py</code> and <code>scm/cli.py</code></p> <p>Server Layer: - <code>server/</code> - FastAPI application - <code>server/auth.py</code> - Flexible authentication (none, API key, OAuth2 proxy) - <code>server/routes/</code> - REST API endpoints mirroring CLI functionality</p> <p>Agent Layer: - <code>fs/app.py</code> - Filesystem operations (shared by CLI and API) - <code>scm/app.py</code> - SCM operations (shared by CLI and API) - <code>client.py</code> - HTTP client for Soliplex Ingester API</p> <p>Configuration: - <code>config.py</code> - Pydantic settings for all components - Environment variables or <code>.env</code> file for configuration</p>"},{"location":"ingester-agents/#license","title":"License","text":"<p>See LICENSE file for details.</p>"},{"location":"ingester-agents/#support","title":"Support","text":"<p>For issues and questions, please open an issue on the repository.</p>"},{"location":"pdf-splitter/","title":"PDF Splitter","text":"<p>Split-Process-Merge pipeline for converting large PDFs to Docling documents. This pipeline is useful for projects like soliplex that might need to break large PDF files apart before processing.</p>"},{"location":"pdf-splitter/#installation","title":"Installation","text":"<p>With pip: <pre><code>pip install pdf-splitter            # core only\npip install pdf-splitter[dev]       # with test/lint tools\n</code></pre></p> <p>With uv: <pre><code>uv add pdf-splitter                 # core only\nuv add pdf-splitter --group dev     # with test/lint tools\n</code></pre></p> <p>From source: <pre><code>git clone https://github.com/soliplex/pdf-splitter.git\ncd pdf-splitter\n\n# pip\npip install -e .                    # core only\npip install -e \".[dev]\"             # with dev tools\n\n# uv\nuv sync                             # core only\nuv sync --group dev                 # with dev tools\n</code></pre></p> <p>Requires Python 3.12+.</p>"},{"location":"pdf-splitter/#usage","title":"Usage","text":"<pre><code>pdf-splitter analyze doc.pdf              # analyze structure\npdf-splitter chunk doc.pdf -o ./chunks    # split into chunks\npdf-splitter convert ./chunks -o out.json # process &amp; merge\npdf-splitter validate out.json ./chunks   # validate output\n</code></pre>"},{"location":"pdf-splitter/#options","title":"Options","text":"Option Description <code>-v</code> Verbose logging <code>-s &lt;strategy&gt;</code> Force: <code>fixed</code>, <code>hybrid</code>, <code>enhanced</code> <code>--max-pages N</code> Max pages per chunk (default: 100) <code>-w N</code> Worker processes <code>--keep-parts</code> Output individual chunks"},{"location":"pdf-splitter/#python-api","title":"Python API","text":"<pre><code>from pdf_splitter.segmentation_enhanced import smart_split_to_files\nfrom pdf_splitter.processor import BatchProcessor\nfrom pdf_splitter.reassembly import merge_from_results\n\nchunks, _ = smart_split_to_files(\"doc.pdf\", output_dir=\"./chunks\")\nresults = BatchProcessor(max_workers=4).execute_parallel(chunks)\nmerged = merge_from_results(results)\nmerged.export_to_json(\"output.json\")\n</code></pre>"},{"location":"pdf-splitter/#development","title":"Development","text":"<pre><code>uv run pytest       # run tests\nuv run ruff check   # run ruff\nuv run mypy src/    # run mypy\n</code></pre>"},{"location":"soliplex/","title":"Soliplex Documentation","text":"<p>Welcome to the Soliplex documentation. This system provides AI-powered retrieval-augmented generation capabilities for intelligent document search and question answering.</p>"},{"location":"soliplex/#quick-start","title":"Quick Start","text":"<ol> <li>Prerequisites - Complete installation checklist and setup guide</li> <li>Overview - Learn about the system architecture and features</li> <li>RAG Database Setup - Set up the RAG search database</li> <li>Server Setup - Set up the FastAPI backend server</li> <li>Client Setup - Configure the Flutter web client</li> <li>Docker Deployment - Run Soliplex with Docker and Docker Compose</li> <li>Usage Guide - Start using the system</li> </ol>"},{"location":"soliplex/#what-is-soliplex","title":"What is Soliplex?","text":"<p>Soliplex combines the power of retrieval systems with generative AI to provide accurate, contextual responses based on your document collections. The system indexes your documents and uses them to enhance AI responses with relevant, up-to-date information.</p>"},{"location":"soliplex/client/","title":"Client Setup","text":"<p>The Soliplex client is a Flutter web application that provides the user interface for interacting with the RAG system.</p>"},{"location":"soliplex/client/#prerequisites","title":"Prerequisites","text":"<ul> <li>Dart SDK</li> <li>Flutter SDK</li> <li>Google Chrome (for web development)</li> </ul>"},{"location":"soliplex/client/#installation","title":"Installation","text":"<ol> <li> <p>Clone the client repository:    <pre><code>git clone git@github.com:soliplex/soliplex.git\ncd soliplex/src/flutter\n</code></pre></p> </li> <li> <p>Install Flutter dependencies:    <pre><code>flutter pub get\n</code></pre></p> </li> </ol>"},{"location":"soliplex/client/#running-the-client","title":"Running the Client","text":"<p>Start the Flutter web application:</p> <pre><code>flutter run -d chrome\n</code></pre> <p>This will launch the application in Chrome and provide a development server with hot reload capabilities.</p>"},{"location":"soliplex/client/#development","title":"Development","text":"<p>The client uses: - Flutter 3.35+ with Material Design - Riverpod for state management - <code>go_router</code> for navigation - WebSocket connections for real-time chat</p>"},{"location":"soliplex/docker/","title":"Docker Deployment","text":"<p>This guide covers running Soliplex using Docker and Docker Compose.</p>"},{"location":"soliplex/docker/#prerequisites","title":"Prerequisites","text":"<ul> <li>Docker 20.10+</li> <li>Docker Compose 2.0+</li> <li>Access to an LLM provider (Ollama or OpenAI)</li> </ul>"},{"location":"soliplex/docker/#docker-compose-setup","title":"Docker Compose Setup","text":"<p>The project includes a <code>docker-compose.yaml</code> file that orchestrates both the backend server and frontend web client.</p>"},{"location":"soliplex/docker/#services","title":"Services","text":"<p>The compose configuration defines two services:</p>"},{"location":"soliplex/docker/#1-soliplex_backend-python-backend","title":"1. <code>soliplex_backend</code> (Python Backend)","text":"<ul> <li>Port: 8000</li> <li>Technology: Python 3.13 with FastAPI</li> <li>Purpose: API server, RAG processing, AI integration</li> <li>Volumes:</li> <li><code>./example:/app/installation</code> - Configuration files</li> <li><code>./db:/app/db</code> - Database storage (RAG, threads, etc.)</li> </ul>"},{"location":"soliplex/docker/#2-soliplex_web-flutter-frontend","title":"2. <code>soliplex_web</code> (Flutter Frontend)","text":"<ul> <li>Port: 9000</li> <li>Technology: Flutter web application</li> <li>Purpose: User interface for chat and document interaction</li> </ul>"},{"location":"soliplex/docker/#configuration","title":"Configuration","text":"<ol> <li>Create environment file</li> </ol> <p>Copy the example environment file and configure your secrets:    <pre><code>cp .env.example .env\n</code></pre></p> <p>Edit <code>.env</code> to set required variables (see Environment Variables section below).</p> <ol> <li>Configure installation path</li> </ol> <p>The backend expects configuration at <code>/app/installation</code> inside the container.    By default, the <code>./example</code> directory is mounted there.</p> <p>To use a custom configuration:    <pre><code>volumes:\n  - ./path/to/your/config:/app/installation\n  - ./db:/app/db\n</code></pre></p> <ol> <li>Database persistence</li> </ol> <p>The <code>./db</code> directory is mounted to persist:    - RAG vector database (<code>db/rag/</code>)    - Thread persistence database    - Room authorization database</p>"},{"location":"soliplex/docker/#running-with-docker-compose","title":"Running with Docker Compose","text":""},{"location":"soliplex/docker/#start-all-services","title":"Start all services","text":"<pre><code>docker-compose up\n</code></pre> <p>Add <code>-d</code> flag to run in detached mode: <pre><code>docker-compose up -d\n</code></pre></p>"},{"location":"soliplex/docker/#start-specific-service","title":"Start specific service","text":"<pre><code>docker-compose up soliplex_backend\n</code></pre>"},{"location":"soliplex/docker/#view-logs","title":"View logs","text":"<pre><code># All services\ndocker-compose logs -f\n\n# Specific service\ndocker-compose logs -f soliplex_backend\n</code></pre>"},{"location":"soliplex/docker/#stop-services","title":"Stop services","text":"<pre><code>docker-compose down\n</code></pre>"},{"location":"soliplex/docker/#rebuild-after-code-changes","title":"Rebuild after code changes","text":"<pre><code>docker-compose up --build\n</code></pre>"},{"location":"soliplex/docker/#accessing-the-application","title":"Accessing the Application","text":"<ul> <li>Backend API: http://localhost:8000</li> <li>API Documentation: http://localhost:8000/docs</li> <li>Frontend Web UI: http://localhost:9000</li> </ul>"},{"location":"soliplex/docker/#building-custom-docker-images","title":"Building Custom Docker Images","text":""},{"location":"soliplex/docker/#backend-dockerfile","title":"Backend Dockerfile","text":"<p>The backend Dockerfile uses Python 3.13 and installs Soliplex in editable mode.</p> <p>Build manually: <pre><code>docker build -t soliplex-backend .\n</code></pre></p> <p>Run manually: <pre><code>docker run -p 8000:8000 \\\n  --env-file .env \\\n  -v $(pwd)/example:/app/installation \\\n  -v $(pwd)/db:/app/db \\\n  soliplex-backend\n</code></pre></p>"},{"location":"soliplex/docker/#frontend-dockerfile","title":"Frontend Dockerfile","text":"<p>Build the Flutter web client: <pre><code>cd src/flutter\ndocker build -t soliplex-web .\n</code></pre></p> <p>Run manually: <pre><code>docker run -p 9000:9000 soliplex-web\n</code></pre></p>"},{"location":"soliplex/docker/#environment-variables","title":"Environment Variables","text":"<p>The backend container reads environment variables from: 1. <code>.env</code> file (specified with <code>env_file</code> in docker-compose.yaml) 2. Environment variables set in docker-compose.yaml 3. Shell environment (if using <code>docker run</code>)</p>"},{"location":"soliplex/docker/#required-variables","title":"Required Variables","text":"<p>See .env.example for a complete list.</p> <p>For Ollama: <pre><code>OLLAMA_BASE_URL=http://host.docker.internal:11434\n</code></pre></p> <p>For OpenAI: <pre><code>OPENAI_API_KEY=sk-...\n</code></pre></p>"},{"location":"soliplex/docker/#accessing-host-services","title":"Accessing Host Services","text":"<p>When running Ollama or other services on your host machine, use <code>host.docker.internal</code>:</p> <pre><code># In .env file\nOLLAMA_BASE_URL=http://host.docker.internal:11434\n</code></pre> <p>On Linux, you may need to add this to docker-compose.yaml (already included): <pre><code>extra_hosts:\n  - \"host.docker.internal:host-gateway\"\n</code></pre></p>"},{"location":"soliplex/docker/#volume-mounts","title":"Volume Mounts","text":""},{"location":"soliplex/docker/#configuration-files-exampleappinstallation","title":"Configuration Files (<code>./example:/app/installation</code>)","text":"<p>Mounts your configuration directory into the container. Contents: - <code>installation.yaml</code> or <code>minimal.yaml</code> - Main installation config - <code>haiku.rag.yaml</code> - RAG configuration - <code>rooms/</code> - Room configurations - <code>completions/</code> - Completion endpoint configurations - <code>oidc/</code> - OIDC provider configurations - <code>quizzes/</code> - Quiz question files</p>"},{"location":"soliplex/docker/#database-files-dbappdb","title":"Database Files (<code>./db:/app/db</code>)","text":"<p>Persists application data: - <code>db/rag/rag.lancedb/</code> - RAG vector database - SQLite databases for threads and authorization (if using defaults)</p> <p>Important: Initialize the RAG database before first run (see RAG Setup below).</p>"},{"location":"soliplex/docker/#rag-database-setup-in-docker","title":"RAG Database Setup in Docker","text":"<p>The RAG database must be initialized before starting the backend server.</p>"},{"location":"soliplex/docker/#option-1-initialize-on-host-recommended","title":"Option 1: Initialize on Host (Recommended)","text":"<p>Initialize the database on your host machine before running Docker:</p> <pre><code># Create Python virtual environment\npython3.13 -m venv venv\nsource venv/bin/activate  # On Windows: venv\\Scripts\\activate\n\n# Install haiku-rag (full version for ingestion)\npip install haiku-rag\n\n# Set Ollama URL\nexport OLLAMA_BASE_URL=http://localhost:11434\n\n# Initialize and populate RAG database\nhaiku-rag --config example/haiku.rag.yaml init --db db/rag/rag.lancedb\nhaiku-rag --config example/haiku.rag.yaml add-src --db db/rag/rag.lancedb docs/\n</code></pre> <p>The <code>./db</code> directory will be mounted into the container with the initialized database.</p>"},{"location":"soliplex/docker/#option-2-initialize-in-container","title":"Option 2: Initialize in Container","text":"<p>Run initialization inside the backend container:</p> <pre><code># Start container with shell\ndocker-compose run --rm soliplex_backend /bin/bash\n\n# Inside container\nexport OLLAMA_BASE_URL=http://host.docker.internal:11434\npip install haiku-rag  # Install full version\nhaiku-rag --config /app/installation/haiku.rag.yaml init --db /app/db/rag/rag.lancedb\nhaiku-rag --config /app/installation/haiku.rag.yaml add-src --db /app/db/rag/rag.lancedb /app/docs/\nexit\n</code></pre>"},{"location":"soliplex/docker/#common-issues","title":"Common Issues","text":""},{"location":"soliplex/docker/#port-already-in-use","title":"Port Already in Use","text":"<p>If ports 8000 or 9000 are already allocated:</p> <p>Edit <code>docker-compose.yaml</code>: <pre><code>ports:\n  - \"8001:8000\"  # Map host port 8001 to container port 8000\n</code></pre></p>"},{"location":"soliplex/docker/#cannot-connect-to-ollama","title":"Cannot Connect to Ollama","text":"<p>Ensure <code>OLLAMA_BASE_URL</code> uses <code>host.docker.internal</code>: <pre><code>OLLAMA_BASE_URL=http://host.docker.internal:11434\n</code></pre></p> <p>Verify Ollama is running on host: <pre><code>ollama list\n</code></pre></p>"},{"location":"soliplex/docker/#rag-database-not-found","title":"RAG Database Not Found","text":"<p>The backend will fail if the RAG database hasn't been initialized.</p> <p>Check for database files: <pre><code>ls -la db/rag/\n</code></pre></p> <p>If missing, initialize as described in RAG Database Setup section.</p>"},{"location":"soliplex/docker/#permission-issues","title":"Permission Issues","text":"<p>If you encounter permission errors with mounted volumes:</p> <pre><code># Ensure directories exist and are writable\nmkdir -p db/rag\nchmod -R 755 db/\n</code></pre>"},{"location":"soliplex/docker/#development-workflow","title":"Development Workflow","text":""},{"location":"soliplex/docker/#hot-reload","title":"Hot Reload","text":"<p>The backend supports hot reload for development:</p> <pre><code># In docker-compose.yaml, add to backend service\ncommand: [\n  \"soliplex-cli\", \"serve\",\n  \"--host=0.0.0.0\",\n  \"--reload\", \"both\",\n  \"/app/installation\"\n]\nvolumes:\n  - ./src/soliplex:/app/src/soliplex  # Mount source code\n  - ./example:/app/installation\n  - ./db:/app/db\n</code></pre> <p>Changes to Python code or YAML configs will automatically reload the server.</p>"},{"location":"soliplex/docker/#running-tests","title":"Running Tests","text":"<pre><code># Run tests in container\ndocker-compose run --rm soliplex_backend pytest\n\n# With coverage\ndocker-compose run --rm soliplex_backend pytest --cov=soliplex\n</code></pre>"},{"location":"soliplex/docker/#production-considerations","title":"Production Considerations","text":"<ol> <li>Authentication: Never use <code>--no-auth-mode</code> in production</li> <li>Secrets: Use Docker secrets or environment variable injection from secrets managers</li> <li>Database: Consider PostgreSQL instead of SQLite for production</li> <li>Reverse Proxy: Place behind nginx or traefik with HTTPS</li> <li>Health Checks: Add health check endpoints to docker-compose</li> <li>Resource Limits: Set memory and CPU limits</li> </ol> <p>Example production docker-compose additions: <pre><code>services:\n  soliplex_backend:\n    deploy:\n      resources:\n        limits:\n          memory: 4G\n          cpus: '2'\n    healthcheck:\n      test: [\"CMD\", \"curl\", \"-f\", \"http://localhost:8000/health\"]\n      interval: 30s\n      timeout: 10s\n      retries: 3\n</code></pre></p>"},{"location":"soliplex/docker/#next-steps","title":"Next Steps","text":"<ul> <li>Configure OIDC authentication: OIDC Providers</li> <li>Set up rooms: Room Configuration</li> <li>Configure agents: Agent Configuration</li> <li>Review server documentation: Server Setup</li> </ul>"},{"location":"soliplex/overview/","title":"Soliplex Overview","text":"<p>Soliplex is an AI-powered Retrieval-Augmented Generation (RAG) system designed to provide intelligent document search and question-answering capabilities.</p>"},{"location":"soliplex/overview/#architecture","title":"Architecture","text":"<p>The system consists of three main components:</p>"},{"location":"soliplex/overview/#1-backend-server-soliplex","title":"1. Backend Server (<code>soliplex/</code>)","text":"<ul> <li>Technology: FastAPI with Python 3.13</li> <li>Purpose: Handles API requests, RAG processing, and AI model integration</li> <li>Features: </li> <li>OpenAI API integration</li> <li>Document indexing and retrieval</li> <li>Authentication and authorization</li> <li>Real-time WebSocket communication</li> </ul>"},{"location":"soliplex/overview/#2-frontend-client-gen_ai_client","title":"2. Frontend Client (<code>gen_ai_client/</code>)","text":"<ul> <li>Technology: Flutter web application</li> <li>Purpose: Provides user interface for chat and document interaction</li> <li>Features:</li> <li>Material Design UI</li> <li>Real-time chat interface</li> <li>State management with Riverpod</li> <li>Responsive web design</li> </ul>"},{"location":"soliplex/overview/#3-configuration-system","title":"3. Configuration System","text":"<ul> <li>OIDC Authentication: Keycloak integration for secure access</li> <li>Room Configuration: Chat environments and settings</li> <li>Model Configuration: LLM provider and model settings</li> </ul>"},{"location":"soliplex/overview/#key-features","title":"Key Features","text":"<ul> <li>RAG Capabilities: Combines document retrieval with AI generation</li> <li>Multiple AI Models: Support for OpenAI and local models</li> <li>Secure Authentication: OIDC-based user management  </li> <li>Real-time Chat: WebSocket-powered interactive communication</li> <li>Document Management: Upload, index, and search through documents</li> </ul>"},{"location":"soliplex/prerequisites/","title":"Prerequisites and Installation Checklist","text":"<p>This guide provides a complete checklist for setting up Soliplex from scratch.</p>"},{"location":"soliplex/prerequisites/#system-requirements","title":"System Requirements","text":""},{"location":"soliplex/prerequisites/#software-prerequisites","title":"Software Prerequisites","text":"<ul> <li>[ ] Python 3.13+ - Required for backend server</li> <li>[ ] pip - Python package installer (usually included with Python)</li> <li>[ ] Git - For cloning the repository</li> <li>[ ] Docker &amp; Docker Compose (Optional) - For containerized deployment</li> </ul>"},{"location":"soliplex/prerequisites/#llm-provider-choose-one","title":"LLM Provider (Choose One)","text":"<ul> <li>[ ] Ollama (Recommended for local development)</li> <li>Install from: https://ollama.com/</li> <li>Verify: <code>ollama --version</code></li> </ul> <p>OR</p> <ul> <li>[ ] OpenAI API Access</li> <li>Create account at: https://platform.openai.com/</li> <li>Generate API key at: https://platform.openai.com/api-keys</li> </ul>"},{"location":"soliplex/prerequisites/#optional-components","title":"Optional Components","text":"<ul> <li>[ ] Flutter SDK (For frontend development)</li> <li>Version: 3.35+</li> <li>Install from: https://flutter.dev/docs/get-started/install</li> <li> <p>Verify: <code>flutter --version</code></p> </li> <li> <p>[ ] Dart SDK (Usually included with Flutter)</p> </li> <li>Version: 3.10.0+</li> <li> <p>Verify: <code>dart --version</code></p> </li> <li> <p>[ ] PostgreSQL (Optional, for production databases)</p> </li> <li>For development, SQLite (included) is sufficient</li> </ul>"},{"location":"soliplex/prerequisites/#installation-steps","title":"Installation Steps","text":"<p>Follow these steps in order for a successful setup.</p>"},{"location":"soliplex/prerequisites/#step-1-install-python-313","title":"Step 1: Install Python 3.13","text":""},{"location":"soliplex/prerequisites/#windows","title":"Windows","text":"<pre><code># Download from python.org\n# Or use winget\nwinget install Python.Python.3.13\n</code></pre>"},{"location":"soliplex/prerequisites/#macos","title":"macOS","text":"<pre><code># Using Homebrew\nbrew install python@3.13\n</code></pre>"},{"location":"soliplex/prerequisites/#linux","title":"Linux","text":"<pre><code># Ubuntu/Debian\nsudo apt update\nsudo apt install python3.13 python3.13-venv python3.13-dev\n\n# Fedora\nsudo dnf install python3.13\n</code></pre> <p>Verify installation: <pre><code>python3.13 --version\n</code></pre></p>"},{"location":"soliplex/prerequisites/#step-2-install-and-configure-ollama-if-using-ollama","title":"Step 2: Install and Configure Ollama (if using Ollama)","text":"<ol> <li> <p>Install Ollama <pre><code># Linux\ncurl -fsSL https://ollama.com/install.sh | sh\n\n# macOS\nbrew install ollama\n\n# Windows: Download from https://ollama.com/download\n</code></pre></p> </li> <li> <p>Start Ollama service <pre><code># Linux/macOS\nollama serve\n\n# Windows: Ollama runs as a service automatically\n</code></pre></p> </li> <li> <p>Pull required models <pre><code># Chat model (choose one)\nollama pull qwen2.5:latest\n# OR\nollama pull llama3.2:latest\n# OR\nollama pull mistral:latest\n\n# Embedding model (required for RAG)\nollama pull qwen3-embedding:4b\n</code></pre></p> </li> <li> <p>Verify models <pre><code>ollama list\n</code></pre></p> </li> <li> <p>Note your Ollama URL</p> </li> <li>Local installation: <code>http://localhost:11434</code></li> <li>Remote installation: <code>http://your-server:11434</code></li> <li>Docker accessing host: <code>http://host.docker.internal:11434</code></li> </ol>"},{"location":"soliplex/prerequisites/#step-3-clone-soliplex-repository","title":"Step 3: Clone Soliplex Repository","text":"<pre><code>git clone https://github.com/soliplex/soliplex.git\ncd soliplex\n</code></pre>"},{"location":"soliplex/prerequisites/#step-4-set-up-python-virtual-environment","title":"Step 4: Set Up Python Virtual Environment","text":"<pre><code># Create virtual environment\npython3.13 -m venv venv\n\n# Activate virtual environment\n# Linux/macOS:\nsource venv/bin/activate\n\n# Windows:\nvenv\\Scripts\\activate\n</code></pre> <p>Your prompt should now show <code>(venv)</code> prefix.</p>"},{"location":"soliplex/prerequisites/#step-5-install-python-dependencies","title":"Step 5: Install Python Dependencies","text":"<pre><code># Upgrade pip\npip install --upgrade pip setuptools\n\n# Install Soliplex in editable mode\npip install -e .\n\n# Verify installation\nsoliplex-cli --help\n</code></pre>"},{"location":"soliplex/prerequisites/#step-6-install-rag-indexing-dependencies","title":"Step 6: Install RAG Indexing Dependencies","text":"<p>Soliplex requires <code>haiku.rag</code> (full version) for document ingestion:</p>"},{"location":"soliplex/prerequisites/#option-1-install-haiku-rag-locally","title":"Option 1: Install haiku-rag locally","text":"<pre><code>pip install haiku-rag\n</code></pre>"},{"location":"soliplex/prerequisites/#option-2-use-docling-serve-docker-container","title":"Option 2: Use docling-serve Docker container","text":"<pre><code>docker run -p 5001:5001 -d \\\n  -e DOCLING_SERVE_ENABLE_UI=1 \\\n  quay.io/docling-project/docling-serve\n</code></pre> <p>If using Option 2, configure <code>example/haiku.rag.yaml</code> to use remote processing.</p>"},{"location":"soliplex/prerequisites/#step-7-configure-environment-variables","title":"Step 7: Configure Environment Variables","text":"<ol> <li> <p>Copy example environment file <pre><code>cp .env.example .env\n</code></pre></p> </li> <li> <p>Edit .env file <pre><code># Linux/macOS\nnano .env\n\n# Windows\nnotepad .env\n</code></pre></p> </li> <li> <p>Set required variables</p> </li> </ol> <p>For Ollama: <pre><code>OLLAMA_BASE_URL=http://localhost:11434\nSOLIPLEX_URL_SAFE_TOKEN_SECRET=generate-a-random-secret-here\n</code></pre></p> <p>For OpenAI: <pre><code>OPENAI_API_KEY=sk-proj-your-key-here\nSOLIPLEX_URL_SAFE_TOKEN_SECRET=generate-a-random-secret-here\n</code></pre></p> <p>Generate a secure token secret:    <pre><code>python -c \"import secrets; print(secrets.token_urlsafe(32))\"\n</code></pre></p> <ol> <li>Load environment variables <pre><code># Linux/macOS\nsource .env\n\n# Windows (PowerShell)\nGet-Content .env | ForEach-Object {\n  if ($_ -match '^([^=]+)=(.*)$') {\n    [Environment]::SetEnvironmentVariable($matches[1], $matches[2])\n  }\n}\n</code></pre></li> </ol>"},{"location":"soliplex/prerequisites/#step-8-choose-configuration-profile","title":"Step 8: Choose Configuration Profile","text":"<p>Soliplex provides several example configurations:</p> Configuration LLM Provider Features Best For <code>example/minimal.yaml</code> Ollama Basic rooms, no external APIs Local development <code>example/minimal-openai.yaml</code> OpenAI Basic rooms, no external APIs OpenAI users <code>example/installation.yaml</code> Ollama Full features + MCP tools Advanced features <code>example/installation-openai.yaml</code> OpenAI Full features + MCP tools Production with OpenAI <p>Recommendation for first-time users: Start with <code>minimal.yaml</code> or <code>minimal-openai.yaml</code>.</p>"},{"location":"soliplex/prerequisites/#step-9-initialize-rag-database","title":"Step 9: Initialize RAG Database","text":"<p>The RAG database MUST be initialized before starting the server.</p> <ol> <li> <p>Create database directory <pre><code>mkdir -p db/rag\n</code></pre></p> </li> <li> <p>Initialize database <pre><code>haiku-rag --config example/haiku.rag.yaml init --db db/rag/rag.lancedb\n</code></pre></p> </li> <li> <p>Index documentation <pre><code># Index all documentation\nhaiku-rag --config example/haiku.rag.yaml \\\n  add-src --db db/rag/rag.lancedb docs/\n\n# You should see:\n# 17 documents added successfully.\n</code></pre></p> </li> <li> <p>Verify database <pre><code>ls -la db/rag/rag.lancedb/\n</code></pre></p> </li> </ol>"},{"location":"soliplex/prerequisites/#step-10-validate-configuration","title":"Step 10: Validate Configuration","text":"<p>Check for any missing requirements:</p> <pre><code>soliplex-cli check-config example/minimal.yaml\n</code></pre> <p>This command will report: - Missing secrets - Missing environment variables - Configuration errors</p> <p>Fix any reported issues before proceeding.</p>"},{"location":"soliplex/prerequisites/#step-11-list-available-rooms","title":"Step 11: List Available Rooms","text":"<p>Verify your room configuration:</p> <pre><code>soliplex-cli list-rooms example/minimal.yaml\n</code></pre> <p>You should see rooms like: - <code>ask_soliplex</code> - RAG-powered Soliplex documentation assistant - <code>haiku</code> - General purpose chat - <code>joker</code> - Entertainment/joke generation - <code>faux</code> - Test room</p>"},{"location":"soliplex/prerequisites/#step-12-start-backend-server","title":"Step 12: Start Backend Server","text":"<pre><code>soliplex-cli serve example/minimal.yaml --no-auth-mode\n</code></pre> <p>Expected output: <pre><code>INFO:     Started server process [xxxxx]\nINFO:     Waiting for application startup.\nINFO:     Application startup complete.\nINFO:     Uvicorn running on http://127.0.0.1:8000 (Press CTRL+C to quit)\n</code></pre></p> <p>The <code>--no-auth-mode</code> flag disables authentication for development.</p>"},{"location":"soliplex/prerequisites/#step-13-verify-backend-api","title":"Step 13: Verify Backend API","text":"<p>In a new terminal, test the API:</p> <pre><code># Test health endpoint\ncurl http://localhost:8000/health\n\n# List rooms\ncurl http://localhost:8000/api/v1/rooms\n\n# View OpenAPI docs\n# Open browser: http://localhost:8000/docs\n</code></pre>"},{"location":"soliplex/prerequisites/#step-14-install-frontend-optional","title":"Step 14: Install Frontend (Optional)","text":"<p>If you want to use the web UI:</p> <ol> <li> <p>Install Flutter <pre><code># Follow instructions at https://flutter.dev/docs/get-started/install\n</code></pre></p> </li> <li> <p>Navigate to Flutter directory <pre><code>cd src/flutter\n</code></pre></p> </li> <li> <p>Install dependencies <pre><code>flutter pub get\n</code></pre></p> </li> <li> <p>Run web application <pre><code>flutter run -d chrome --web-port 59001\n</code></pre></p> </li> <li> <p>Access frontend</p> </li> <li>Open browser: http://localhost:59001</li> <li>Select \"localhost\" from dropdown</li> <li>Start chatting!</li> </ol>"},{"location":"soliplex/prerequisites/#step-15-try-tui-optional","title":"Step 15: Try TUI (Optional)","text":"<p>For a terminal-based interface:</p> <pre><code># Make sure backend is running with --no-auth-mode\nsoliplex-tui\n\n# Or specify custom URL\nsoliplex-tui --url http://localhost:8000\n</code></pre>"},{"location":"soliplex/prerequisites/#quick-start-commands-summary","title":"Quick Start Commands Summary","text":"<p>For reference, here's the complete command sequence:</p> <pre><code># Setup\ngit clone https://github.com/soliplex/soliplex.git\ncd soliplex\npython3.13 -m venv venv\nsource venv/bin/activate  # or venv\\Scripts\\activate on Windows\npip install --upgrade pip setuptools\npip install -e .\npip install haiku-rag\n\n# Configure\ncp .env.example .env\n# Edit .env with your settings\nsource .env\n\n# Initialize RAG\nmkdir -p db/rag\nhaiku-rag --config example/haiku.rag.yaml init --db db/rag/rag.lancedb\nhaiku-rag --config example/haiku.rag.yaml add-src --db db/rag/rag.lancedb docs/\n\n# Verify\nsoliplex-cli check-config example/minimal.yaml\nsoliplex-cli list-rooms example/minimal.yaml\n\n# Run\nsoliplex-cli serve example/minimal.yaml --no-auth-mode\n</code></pre>"},{"location":"soliplex/prerequisites/#docker-quick-start","title":"Docker Quick Start","text":"<p>If you prefer Docker:</p> <pre><code># Setup\ngit clone https://github.com/soliplex/soliplex.git\ncd soliplex\ncp .env.example .env\n# Edit .env with your settings\n\n# Initialize RAG database (on host)\npython3.13 -m venv venv\nsource venv/bin/activate\npip install haiku-rag\nexport OLLAMA_BASE_URL=http://localhost:11434\nmkdir -p db/rag\nhaiku-rag --config example/haiku.rag.yaml init --db db/rag/rag.lancedb\nhaiku-rag --config example/haiku.rag.yaml add-src --db db/rag/rag.lancedb docs/\ndeactivate\n\n# Run with Docker\ndocker-compose up\n</code></pre>"},{"location":"soliplex/prerequisites/#troubleshooting","title":"Troubleshooting","text":""},{"location":"soliplex/prerequisites/#python-313-not-found","title":"Python 3.13 not found","text":"<ul> <li>Ensure Python 3.13 is installed and in your PATH</li> <li>Try <code>python3.13 --version</code> to verify</li> </ul>"},{"location":"soliplex/prerequisites/#ollama-connection-refused","title":"Ollama connection refused","text":"<ul> <li>Ensure Ollama service is running: <code>ollama serve</code></li> <li>Verify URL is correct in .env file</li> <li>Check firewall settings</li> </ul>"},{"location":"soliplex/prerequisites/#rag-database-errors","title":"RAG database errors","text":"<ul> <li>Ensure database is initialized before starting server</li> <li>Check file permissions on db/ directory</li> <li>Verify OLLAMA_BASE_URL is accessible</li> </ul>"},{"location":"soliplex/prerequisites/#module-not-found-errors","title":"Module not found errors","text":"<ul> <li>Ensure virtual environment is activated</li> <li>Reinstall dependencies: <code>pip install -e .</code></li> <li>Check Python version: <code>python --version</code></li> </ul>"},{"location":"soliplex/prerequisites/#port-already-in-use","title":"Port already in use","text":"<ul> <li>Backend (8000): Change with <code>--port</code> flag</li> <li>Frontend (59001): Change with <code>--web-port</code> flag</li> <li>Check for other processes: <code>lsof -i :8000</code> (Linux/macOS)</li> </ul>"},{"location":"soliplex/prerequisites/#next-steps","title":"Next Steps","text":"<p>After successful installation:</p> <ol> <li>Explore Configuration: Review installation.md</li> <li>Set Up Rooms: Configure custom rooms in rooms.md</li> <li>Configure Agents: Set up AI agents in agents.md</li> <li>Enable Authentication: Configure OIDC in oidc_providers.md</li> <li>Deploy with Docker: Follow docker.md</li> </ol>"},{"location":"soliplex/prerequisites/#getting-help","title":"Getting Help","text":"<ul> <li>Documentation: https://soliplex.github.io/</li> <li>Issues: https://github.com/soliplex/soliplex/issues</li> <li>API Docs: http://localhost:8000/docs (when server is running)</li> </ul>"},{"location":"soliplex/rag/","title":"Retrieval-Augmented Generation (RAG) Database","text":"<p>Soliplex depends on the <code>haiku-rag</code> library to manage its retrieval-augmented generation (RAG) searches.  That library stores its extracted documents / chunks / embeddings in LanceDB databases.</p> <p>The example installation of Soliplex uses the Soliplex documentation as its RAG corpus, and expects that database to be created at <code>db/rag/rag.lancedb</code>.</p>"},{"location":"soliplex/rag/#note-on-haiku-rag-versions","title":"Note on <code>haiku-rag</code> Versions","text":"<p>The <code>soliplex</code> code itself requires only the <code>haiku-rag-slim</code> project (https://pypi.org/project/haiku.rag-slim/), which allows for queries aganst an existing LanceDB database.</p> <p>However, this dependency is not sufficient to perform the ingestion / indexing of documents.  For that purpose, either:</p> <ul> <li> <p>Install the main <code>haiku-rag</code> project   https://pypi.org/project/haiku.rag/   wihch will pull in all the dependencies required to ingest and index   documents.</p> </li> <li> <p>Pull the <code>docling-serve</code> Docker image, and run its server, with   your <code>haiku.rag.yaml</code> file configured to use it.</p> </li> </ul> <p>See the <code>haiku.rag</code> documentation to determine:</p> <ul> <li> <p>Which installation do you need?</p> </li> <li> <p>What are the tradeoffs of local vs. remote processing?</p> </li> <li> <p>How to configure <code>haiku-rag</code> to run in \"remote processing\" mode?</p> </li> </ul>"},{"location":"soliplex/rag/#adding-a-single-document","title":"Adding a single document","text":"<pre><code>export OLLAMA_BASE_URL=&lt;your Ollama server / port&gt;\nhaiku-rag --config example/haiku.rag.yaml \\\n  add-src --db db/rag/rag.lancedb docs/index.md\n...\nDocument &lt;UUID&gt; added successfully.\n</code></pre>"},{"location":"soliplex/rag/#adding-all-documents-in-a-directory","title":"Adding all documents in a directory","text":"<pre><code>export OLLAMA_BASE_URL=&lt;your Ollama server / port&gt;\nhaiku-rag --config example/haiku.rag.yaml \\\n  add-src --db db/rag/rag.lancedb docs/\n...\n17 documents added successfully.\n</code></pre>"},{"location":"soliplex/rag/#configuration-of-haiku-rag-clients-within-soliplex","title":"Configuration of <code>haiku-rag</code> clients within Soliplex","text":"<p>Please see this page for notes on configuring the various <code>haiku-rag</code> clients used in a Soliplex installation.</p>"},{"location":"soliplex/server/","title":"Server Setup","text":"<p>The Soliplex server is a FastAPI-based backend that forwards requests to OpenAI and provides RAG functionality.</p>"},{"location":"soliplex/server/#prerequisites","title":"Prerequisites","text":"<ul> <li> <p>Python 3.13+</p> </li> <li> <p>Access to LLM:</p> </li> <li> <p>OpenAI - an API key is required to use OpenAI</p> </li> <li> <p>Ollama  ([https://ollama.com/] https://ollama.com/)</p> </li> <li> <p>Logfire (optional):</p> </li> </ul> <p>A token from logfire (login here)   allows for visibility into the application. See:</p> <ul> <li> <p>Soliplex Logfire configuration</p> </li> <li> <p>Logfire docs on FastAPI integration</p> </li> </ul>"},{"location":"soliplex/server/#installation","title":"Installation","text":"<ol> <li> <p>Clone the repository:    <pre><code>git clone git@github.com:soliplex/soliplex.git\ncd soliplex/\n</code></pre></p> </li> <li> <p>Set up a Python3 virtual environment:    <pre><code>python -m venv venv\nsource venv/bin/activate\npip install --upgrade setuptools pip\n</code></pre></p> </li> <li> <p>Install <code>soliplex</code> and its dependencies:    <pre><code>pip install -e .\n</code></pre></p> </li> <li> <p>Set up environment variables:</p> </li> </ol> <p>An environment file (<code>.env</code>) can be used to configure secrets, e.g.:</p> <pre><code>SOME_API_TOKEN=&lt;your_token_here&gt;\n</code></pre>"},{"location":"soliplex/server/#running-the-example","title":"Running the example","text":"<p>The example configuration provides an overview of how a soliplex application is assembled.  It contains four top-level installation configurations:</p> <ul> <li> <p><code>example/minimal.yaml</code> is a minimal example using Ollama:  it requires   no secrets.</p> </li> <li> <p><code>example/installation.yaml</code> is a more fleshed-out example using Ollama:   it requires secrets for the exernal Model-Control Protocol (MCP) client   toosets for the room <code>mcptest</code>.</p> </li> <li> <p><code>example/minimal-openai.yaml</code> is a minimal example using OpenAI:    it requires no secrets beyond the <code>OPENAI_API_KEY</code>.</p> </li> <li> <p><code>example/installation.yaml</code> is a more fleshed-out example using OpenAI:   in addition tothe <code>OPENAI_API_KEY</code> secret, it requires secrets for the   exernal Model-Control Protocol (MCP) client toosets for the room <code>mcptest</code>.</p> </li> </ul> <p>Each installation configuration includes a number of rooms that </p> <ol> <li>Configure resources:</li> </ol> <p>The example needs access to a model server using either openapi    or ollama as well as access to example MCP services.</p> <p>The example uses https://smithery.ai/ but others    can be configured.</p> <p>a. OIDC configuration:    TODO</p> <ol> <li> <p>Configure the LLM (Ollama / OpenAI):</p> </li> <li> <p>For the Ollama veriants, export the URL of your model server as      <code>OLLAMA_BASE_URL</code>.  This url should not contain the <code>/v1</code> suffix.      E.g. if you are running Ollama on your own machine:</p> <pre><code>export OLLAMA_BASE_URL=http://localhost:11434\n</code></pre> </li> <li> <p>The example configuration uses the <code>gpt-oss</code> model.  If using either      Ollama variant, install that model via:      <pre><code>ollama pull gpt-oss:latest\n</code></pre></p> </li> <li> <p>Check for missing secrets / environment variables:</p> </li> </ol> <p>This command will check the server for any missing variables or    invalid configuration files.    <pre><code>soliplex-cli check-config example/&lt;installation config&gt;.yaml\n</code></pre></p> <p>The secrets used in the your chosen configuration should be exported as    environment variables, e.g.:    <pre><code>SMITHERY_AI_API_KEY=&lt;your key&gt;\nSMITHERY_AI_PROFILE=&lt;your profile&gt;\n</code></pre></p> <p>Note that the alternate installation configurations, <code>example/minimal.yaml</code>    and <code>example/minimal-openai.yaml</code>, requires no additional secrets    The <code>example/minimal.yaml</code> configuration still expects    the <code>OLLAMA_BASE_URL</code> environment variable to be set (or present in    an <code>.env</code> file):    <pre><code>soliplex-cli check-config example/minimal.yaml\n</code></pre></p> <ol> <li> <p>Configure any missing secrets, e.g. by sourcing a <code>.env</code> file, or    by exporting them directly.</p> </li> <li> <p>Configure any missing environment variables, e.g. by editing    the installation YAML file, adding them to a <code>.env</code> file in the    installation path, or exporting them directly.    <pre><code>export OLLAMA_BASE_URL=http://&lt;your-ollama-host&gt;:11434\nsoliplex-cli check-config example/\n</code></pre></p> </li> </ol>"},{"location":"soliplex/server/#running-the-server","title":"Running the Server","text":"<p>Start the FastAPI server:</p> <pre><code>soliplex-cli serve example/installation.yaml\n</code></pre> <p>The server will be available at <code>http://localhost:8000</code> by default.</p>"},{"location":"soliplex/server/#server-command-options","title":"Server Command Options","text":"<pre><code>soliplex-cli serve [OPTIONS] INSTALLATION_CONFIG_PATH\n</code></pre> <p>Basic Options:</p> <ul> <li><code>INSTALLATION_CONFIG_PATH</code> - Path to installation YAML file (required)</li> <li><code>--help</code> - Show help message</li> </ul> <p>Network Options:</p> <ul> <li><code>--host HOST</code> - Bind to specific host (default: <code>127.0.0.1</code>)</li> <li>Use <code>0.0.0.0</code> to accept connections from any network interface</li> <li> <p>Example: <code>--host 0.0.0.0</code></p> </li> <li> <p><code>--port PORT</code> - Listen on specific port (default: <code>8000</code>)</p> </li> <li>Example: <code>--port 8080</code></li> </ul> <p>Authentication Options:</p> <ul> <li><code>--no-auth-mode</code> - Disable authentication (development/testing only)</li> <li>WARNING: Never use in production</li> <li>Example: <code>--no-auth-mode</code></li> </ul> <p>Hot Reload Options:</p> <ul> <li><code>--reload {code,config,both}</code> / <code>-r {code,config,both}</code> - Enable hot reload</li> <li><code>code</code> - Watch Python source files for changes</li> <li><code>config</code> - Watch YAML configuration files for changes</li> <li><code>both</code> - Watch both code and config files</li> <li> <p>Example: <code>--reload both</code> or <code>-r both</code></p> </li> <li> <p><code>--reload-dirs DIRS</code> - Additional directories to watch (repeatable)</p> </li> <li> <p>Example: <code>--reload-dirs ./custom_modules --reload-dirs ./plugins</code></p> </li> <li> <p><code>--reload-includes PATTERNS</code> - File patterns to include in watch (repeatable)</p> </li> <li>Example: <code>--reload-includes \"*.yaml\" --reload-includes \"*.json\"</code></li> </ul> <p>Proxy Options:</p> <ul> <li><code>--proxy-headers</code> - Enable parsing of X-Forwarded-* headers</li> <li>Use when running behind a reverse proxy (nginx, traefik, etc.)</li> <li> <p>Example: <code>--proxy-headers</code></p> </li> <li> <p><code>--forwarded-allow-ips IPS</code> - Trusted IP addresses for proxy headers (comma-separated)</p> </li> <li>Default: <code>127.0.0.1</code></li> <li>Example: <code>--forwarded-allow-ips \"127.0.0.1,10.0.0.0/8\"</code></li> </ul>"},{"location":"soliplex/server/#common-usage-examples","title":"Common Usage Examples","text":"<p>Development with hot reload: <pre><code>soliplex-cli serve example/installation.yaml \\\n  --reload both \\\n  --no-auth-mode\n</code></pre></p> <p>Production (behind nginx): <pre><code>soliplex-cli serve example/installation.yaml \\\n  --host 127.0.0.1 \\\n  --port 8000 \\\n  --proxy-headers \\\n  --forwarded-allow-ips \"127.0.0.1\"\n</code></pre></p> <p>Docker container (all network interfaces): <pre><code>soliplex-cli serve example/installation.yaml \\\n  --host 0.0.0.0 \\\n  --port 8000\n</code></pre></p> <p>Custom port for testing: <pre><code>soliplex-cli serve example/minimal.yaml \\\n  --port 8080 \\\n  --no-auth-mode\n</code></pre></p>"},{"location":"soliplex/server/#verifying-the-server","title":"Verifying the Server","text":"<p>To confirm your room configuration: <pre><code>curl -X 'GET' \\\n  'http://127.0.0.1:8000/api/v1/rooms' \\\n  -H 'accept: application/json'\n</code></pre></p> <p>To check server health: <pre><code>curl http://127.0.0.1:8000/health\n</code></pre></p>"},{"location":"soliplex/server/#api-endpoints","title":"API Endpoints","text":"<p>If the <code>soliplex-cli</code> server is running, you can browse the live OpenAPI documentation.</p>"},{"location":"soliplex/usage/","title":"Using Soliplex","text":"<p>Once both the server and client are running, you can start using the Soliplex system.</p>"},{"location":"soliplex/usage/#getting-started","title":"Getting Started","text":"<ol> <li>Open your web browser and navigate to the client application</li> <li>In the dropdown menu, select the localhost option</li> <li>Start typing your questions or prompts</li> </ol>"},{"location":"soliplex/usage/#features","title":"Features","text":"<p>The Soliplex system provides: - Chat Interface: Interactive chat with AI models - Document Retrieval: RAG-powered document search and question answering - Multiple Models: Support for various AI models through OpenAI API - Real-time Responses: WebSocket-based real-time communication</p>"},{"location":"soliplex/usage/#tips","title":"Tips","text":"<ul> <li>Use clear, specific questions for better RAG results</li> <li>The system can access and search through indexed documents</li> <li>Responses are generated using retrieval-augmented generation for   more accurate and contextual answers</li> </ul>"},{"location":"soliplex/config/agents/","title":"Agent Configurations","text":"<p>The agent configuration mapping is used to configure the Pydantic AI agent used to make the calls to the LLM.</p> <pre><code>agent:\n    model_name: \"gpt-oss:20b\"\n    system_prompt: |\n      You are an expert AI assistant specializing in information retrieval.\n\n      Your answers should be clear, concise, and ready for production use.\n\n      Always provide code or examples in Markdown blocks.\n</code></pre>"},{"location":"soliplex/config/agents/#required-agent-elements","title":"Required Agent Elements","text":"<ul> <li><code>model_name</code>: a string, should be the identifier of an LLM model for the   agent.</li> </ul> <p>NOTE: this value was previously optional, defaulting to the value             of the now-removed <code>DEFAULT_AGENT_MODEL</code> key in the             installation environment.</p> <ul> <li><code>system_prompt</code> is the \"instructions\" for the LLM serving the room.   If it starts with a <code>./</code>, it will be treated as a filename in the   same directory, whose contents will be read in its place.</li> </ul> <p>A minimal configuration, without an external prompt file:</p> <pre><code>agent:\n    model_name: \"gpt-oss:latest\"\n    system_prompt: |\n        You are a knowledgeable assistant that helps users find information from a document knowledge base.\n\n        Your process:\n        1. When a user asks a question, use the search_documents tool to find relevant information\n        ...\n</code></pre> <p>A minimal configuration, but with the prompt stored in external file:</p> <pre><code>agent:\n    model_name: \"gpt-oss:latest\"\n    system_prompt: \"./prompt.txt\"\n</code></pre>"},{"location":"soliplex/config/agents/#optional-agent-elements","title":"Optional Agent Elements","text":"<ul> <li> <p><code>provider_type</code>: a string, must be one of <code>\"ollama\"</code> (the default),   <code>\"openai\"</code>, or <code>\"google\"</code>.</p> </li> <li> <p><code>provider_base_url</code>: a string, is the base API URL for the agent's LLM   provider.</p> </li> </ul> <p>If not provided, and <code>provider_type</code> is set to <code>\"ollama\"</code>, defaults to   the value configured in the installation environment as <code>OLLAMA_BASE_URL</code></p> <p>If not provided, and <code>provider_type</code> is set to <code>\"openai\"</code>, defaults to   the default OpenAI service URL.</p> <p>Must not be set if <code>provider_type</code> is set to <code>\"google\"</code>.</p> <p>Must be specified without the <code>/v1</code> suffix. E.g.:</p> <pre><code>provider_base_url: \"https://provider.example.com/api\"\n</code></pre> <ul> <li><code>provider_key</code> (a string, default None) should be the name of the secret   holding the LLM provider's API key (not the value of the API key),   prefixed with <code>secret:</code></li> </ul> <pre><code>provider_key: \"secret:FOO_PROVIDER_API_KEY\"\n</code></pre> <p><code>provider_model_settings</code>: a mapping, whose keys are determined by   the <code>provider_type</code> above (see below).</p>"},{"location":"soliplex/config/agents/#example-ollama-configuration","title":"Example Ollama Configuration","text":"<p>NOTE: the values below show types, but should not be used without           testing.</p> <pre><code>model_name: \"gpt-oss:latest\"\nprovider_type: \"ollama\"\nprovider_model_settings:\n  temperature: 0.90\n  top_k: 100\n  top_p: 0.75\n  min_p: 0.25\n  stop: \"STOP\"\n  num_ctx: 2048\n  num_predict: 2000\n</code></pre>"},{"location":"soliplex/config/agents/#example-openai-configuration","title":"Example OpenAI Configuration","text":"<p>NOTE: the values below show types, but should not be used without           testing.</p> <pre><code>model_name: \"mistral:7b\"\nprovider_type: \"openai\"\nprovider_model_settings:\n  temperature: 0.90\n  top_p: 0.70\n  frequency_penalty: 0.25\n  presence_penalty: 0.50\n  parallel_tool_calls: false\n  truncation: \"disabled\"\n  max_tokens: 2048\n  verbosity: \"high\"\n</code></pre>"},{"location":"soliplex/config/agents/#example-google-configuration","title":"Example Google Configuration","text":"<p>NOTE: the values below show types, but should not be used without           testing.</p> <pre><code>model_name: \"gemini-2.5-flash\"\nprovider_type: \"google\"\nprovider_model_settings:\n  temperature: 0.90\n  top_p: 0.70\n  frequency_penalty: 0.25\n  presence_penalty: 0.50\n  parallel_tool_calls: false\n  truncation: \"disabled\"\n  max_tokens: 2048\n  verbosity: \"high\"\n</code></pre>"},{"location":"soliplex/config/completions/","title":"Completion Configuration Filesystem Layout","text":"<p>A completion is configured via a directory, whose name is the completion ID.</p> <p>NOTE: directories whose names start with '.' are ignored.</p> <p>Within that directory should be one or two files:</p> <ul> <li> <p><code>completion_config.yaml</code> holds metadata about the completion (see below)</p> </li> <li> <p><code>prompt.txt</code> (if present) holds the system prompt for conversations   which are initiated from the room.</p> </li> </ul> <p>Example layout without external prompt: <pre><code>simple/\n    room_config.yaml\n</code></pre></p> <p>Example layout with external prompt: <pre><code>chat/\n    prompt.txt\n    room_config.yaml\n</code></pre></p>"},{"location":"soliplex/config/completions/#completions-endpoint-configuration-file-schema","title":"Completions Endpoint Configuration File Schema","text":""},{"location":"soliplex/config/completions/#required-endpoint-elements","title":"Required endpoint elements","text":"<p>The <code>completion_config.yaml</code>  file should be a mapping, with at least the following required elements:</p> <ul> <li> <p><code>id</code> (a string) should match the name of the endpoint's directory.</p> </li> <li> <p><code>agent</code> (a mapping)</p> </li> </ul> <p>A minimal completion endpoint configuration must include the above elements, e.g.:</p> <pre><code>id: \"chat\"\nagent:\n  system_prompt: |\n      You are an..... #\n</code></pre> <p>Please see this page which documents the <code>agent</code> element schema.</p>"},{"location":"soliplex/config/environment/","title":"Installation Environment","text":"<p>The <code>environment</code> section configures non-secret values used by various portions of the Soliplex application.  Application code should use the <code>Installation.get_environment</code> API to fetch configured values, rather than using <code>os.environ</code>.</p>"},{"location":"soliplex/config/environment/#environment-entries","title":"Environment Entries","text":"<p>The section consists of a list of mappings, each with keys <code>name</code> and <code>value</code>.</p> <pre><code>environment:\n  - name: \"ENV_VAR_NAME\"\n    value: \"ENV_VAR_VALUE\"\n</code></pre>"},{"location":"soliplex/config/environment/#unconfigured-environment-entries","title":"Unconfigured Environment Entries","text":"<p>If the <code>value</code> key is missing, the Soliplex application will attempt to resolve it using <code>os.environ</code> during startup.</p>"},{"location":"soliplex/config/environment/#bare-string-environment-entries","title":"Bare-String Environment Entries","text":"<p>As an alternative, an item in the list can be a bare string:  such an entry corresponds exactly to a mapping with <code>name: \"&lt;bare string</code> and no <code>value</code>.</p> <p>This configuration: <pre><code>environment:\n  - \"ENV_VAR_NAME\"\n</code></pre> is exactly equivalent to this one: <pre><code>environment:\n  - name: \"ENV_VAR_NAME\"\n</code></pre></p>"},{"location":"soliplex/config/environment/#checking-configured-environment-values","title":"Checking Configured Environment Values","text":"<p>The <code>soliplex-cli</code> application has a sub-command, <code>list-environment</code>. It loads the configuration, attempts to resolve any values not found, and reports them.  For example:</p> <pre><code>$ soliplex-cli list-environment example/installation.yaml \n\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 Configured environment variables \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n- OLLAMA_BASE_URL          : MISSING\n- INSTALLATION_PATH        : file:.\n- RAG_LANCE_DB_PATH        : file:../db/rag\n- LOGFIRE_ENVIRONMENT      : container\n- LOGFIRE_SERVICE_NAME     : soliplex\n</code></pre>"},{"location":"soliplex/config/filesystem_layout/","title":"Installation Filesystem Layout","text":"<p>An \"installation\" is a set of filesystem-based configuration files, organized as a directory tree.</p> <p>At the root of an installation directory is a file, <code>installation.yaml</code>, which is used to configure environment variables and secrets used by the installation.  There may be alternative configurations available, e.g. to configure how the installation runs inside a container.</p> <p>See this page for documentation on the schema of one of these configurations.</p> <p>An installation directory typically contains subdirectories, each holding configurations for a given type of entity.</p> <p>Example layout:</p> <pre><code>/\n  installation.yaml\n  completions/\n    chat-bot/\n      completion_config.yaml\n      prompt.txt\n    ...\n  oidc/\n    cacert.pem\n    config.yaml\n  quizzes/\n    quiz_name.json\n    ...\n  rooms/\n    quiztest/\n      prompt.txt\n      room_config.yaml\n    ...\n</code></pre>"},{"location":"soliplex/config/filesystem_layout/#room-configuration","title":"Room Configuration","text":"<p>Within a \"rooms\" directory, each room is represented by a subdirectory, whose name is the room ID.</p> <p>Within that subdirectory should be one or two files:</p> <ul> <li> <p><code>room_config.yaml</code> holds metadata about the room (see below)</p> </li> <li> <p><code>prompt.txt</code> (if present) holds the system prompt for conversations   which are initiated from the room.</p> </li> <li> <p>A logo image file (optional)</p> </li> </ul> <p>See this page for documentation on the contents and schema of these files.</p>"},{"location":"soliplex/config/filesystem_layout/#completions-endpoint-configuration","title":"Completions Endpoint Configuration","text":"<p>Within a \"completions\" directory, each endpoint is represented by a subdirectory, whose name is the endpoint ID.</p> <p>Within that subdirectory should be one or two files:</p> <ul> <li> <p><code>completion_config.yaml</code> holds metadata about the endpoint (see below)</p> </li> <li> <p><code>prompt.txt</code> (if present) holds the system prompt for conversations   which are initiated from the endpoint.</p> </li> </ul> <p>See this page for documentation on the contents and schema of these files.</p>"},{"location":"soliplex/config/filesystem_layout/#quiz-configuration","title":"Quiz Configuration","text":"<p>This directory contains question sets as individual JSON files, derived from the evaluation dataset entries.</p> <p>See this page for documentation on the contents and schema of these files.</p>"},{"location":"soliplex/config/filesystem_layout/#oidc-provider-configuration","title":"OIDC Provider Configuration","text":"<p>This directory contains configuration files defining the OIDC identity providers configured for use in this installation.</p> <p>See this page for documentation on the contents and schema of these files.</p>"},{"location":"soliplex/config/installation/","title":"Installation Configuration","text":""},{"location":"soliplex/config/installation/#installation-id","title":"Installation ID","text":"<p>A required field, to allow quick disambiguation between alternative configurations.</p> <pre><code>id: \"soliplex-example\"\n</code></pre>"},{"location":"soliplex/config/installation/#installation-metaconfiguration","title":"Installation Metaconfiguration","text":"<p>The <code>meta</code> section allows you to register custom \"kinds\" of entities (tool configurations, MCP client toolset configurations, etc.), such that you can use them within your own configurations (e.g., to register a configuration class for use with a custom tool in a given room).</p> <pre><code>meta:\n</code></pre> <p>See this page for documentation on the meta-configuration schema.</p>"},{"location":"soliplex/config/installation/#secrets","title":"Secrets","text":"<pre><code>secrets:\n</code></pre> <p>Secrets are values used to authenticate access to different resources or APIs.</p> <p>The may be kept in an external store, such as:</p> <ul> <li>ASW secret store</li> <li>GitHub secrets</li> <li>Docker Compose secrets files</li> <li>The user keyring</li> </ul> <p>See this page for documentation on configuring installation secrets.</p>"},{"location":"soliplex/config/installation/#environment","title":"Environment","text":"<p>The <code>environment</code> section configures non-secret values used by various portions of the Soliplex application.  Application code should use the <code>Installation.get_environment</code> API to fetch configured values, rather than using <code>os.environ</code>.</p> <pre><code>environment:\n</code></pre> <p>See this page for documentation on configuring the installation environment.</p>"},{"location":"soliplex/config/installation/#haikurag-configuration-file","title":"<code>haiku.rag</code> Configuration File","text":"<p>The <code>haiku_rag_config_file</code> entry points to a YAML file containing configuration values for the <code>haiku.rag</code> client</p> <p>If not configured explicitly, the installation configuration expects to find this file in the same directory, with the default name <code>haiku.rag.yaml</code>.</p> <p>Pleas see the <code>haiku.rag</code> configuration docs for details on how to configure the <code>haiku.rag</code> client used by Soliplex.</p>"},{"location":"soliplex/config/installation/#agent-configurations","title":"Agent Configurations","text":"<p>An installation can declare agent configurations (which are normally bound to rooms / completions) at the top-level, such that they can be looked up by ID from Python code using <code>the_installation.get_agent_by_id</code>.</p> <p><pre><code>agent_configs:\n\n  - id: \"ollama_gpt_oss\"\n    model_name: \"gpt-oss:20b\"\n    system_prompt: |\n      You are an expert AI assistant specializing in information retrieval.\n      ...\n</code></pre> Please see this page for details on configuring agents. In addition to the values described there, note that the <code>id</code> element is required here.</p>"},{"location":"soliplex/config/installation/#thread-persistence-dburi","title":"Thread Persistence DBURI","text":"<p>An installation can define two DBURIs for the database used to store AG-UI threads, runs, events, etc.</p>"},{"location":"soliplex/config/installation/#synchronous-dburi","title":"Synchronous DBURI","text":"<p>One DBURI is for sync usage, e.g.  within console scripts.  Examples:</p> <ul> <li><code>sqlite://</code></li> <li><code>postgresql+psycopg2://user:&lt;password&gt;@dbhost/dbname</code></li> </ul>"},{"location":"soliplex/config/installation/#asynchronous-dburi","title":"Asynchronous DBURI","text":"<p>The other DBURI is for async usage, e.g. within the Soliplex server process.  Examples:</p> <ul> <li><code>sqlite+aiosqlite://</code></li> <li><code>postgresql+asyncpg://user:&lt;password&gt;@dbhost/dbname</code></li> </ul> <p>This DBURI must be compatible with SQLAlchemy's asyncio extension. Dialects known to work include:</p> <ul> <li><code>aiosqlite</code></li> <li><code>asyncpg</code></li> </ul>"},{"location":"soliplex/config/installation/#default-configuration","title":"Default configuration","text":"<p>By default, Soliplex configures thread persistence using in-memory DBURIS:</p> <ul> <li>For sync use, <code>sqlite</code> (DBURI <code>sqlite://</code>)</li> <li>For async use, <code>aiosqlite</code> (DBURI <code>sqlite+aiosqlite://</code>)</li> </ul> <p>The default configuration is equivalent to this explicit YAML:</p> <pre><code>thread_persistence_dburi:\n  sync: \"sqlite://\"\n  async: \"sqlite+aiosqlite://\"\n</code></pre>"},{"location":"soliplex/config/installation/#database-passwords-as-secrets","title":"Database passwords as secrets","text":"<p>For DBURIs requiring authentication, we would rather not expose the password in plain-text configuration.  In this case, we can define a Soliplex secret (read here), and use that secret in the DBURI.</p> <pre><code>secrets:\n    - secret_name: MY_DBURI_SECRET\n      # Configure sources here\n...\n\nthread_persistence_dburi:\n  sync: \"postgresql+psycopg2://user:secret:MY_DBURI_SECRET@dbhost/dbname\"\n  async: \"postgresql+asyncpg://user:secret:MY_DBURI_SECRET@dbhost/dbname\"\n</code></pre>"},{"location":"soliplex/config/installation/#oidc-auth-provider-paths","title":"OIDC Auth Provider Paths","text":"<p>The <code>oidc_paths</code> element specifies one or more filesystem paths to be searched for OIDC provider configs.</p> <p>Please see this page for details on how to configure these providers.</p> <pre><code>oidc_paths:\n  - \"/path/to/oidc/config/dir\"\n</code></pre> <p>Non-absolute paths will be evaluated relative to the installation directory.</p> <p>By default, Soliplex loads provider configurations found under the path './oicd', just as though we had configured:</p> <pre><code>oidc_paths:\n  - \"./oidc\"\n</code></pre> <p>To disable authentication, list a single, \"null\" path, e.g.: <pre><code>oidc_paths:\n  -\n</code></pre> Or else run 'soliplex-cli serve --no-auth-mode'</p>"},{"location":"soliplex/config/installation/#room-configuration-paths","title":"Room Configuration Paths","text":"<p>The <code>room_paths</code> element specify one or more filesystem paths to search for room configs.</p> <p>Please see this page for details on how to configure these providers.</p> <p>Each path can be either:</p> <ul> <li> <p>a directory containing its own <code>room_config.yaml</code> file:  this directory   will be mapped as a single room.</p> </li> <li> <p>a directory whose immediate subdirectories will be treated as rooms   IFF they contain a <code>room_config.yaml</code> file.</p> </li> </ul> <p>Non-absolute paths are evaluated relative to the installation directory.</p> <p>The order of <code>room_paths</code> in this list controls which room configuration is used for any conflict on room ID:  rooms found earlier in the list \"win\" over later ones with the same ID.</p> <p>By default, Soliplex loads room configurations found under the path './rooms', just as though we had configured:</p> <p><pre><code>room_paths:\n  - \"./rooms\"\n</code></pre> To disable all rooms, list a single, \"null\" path, e.g.:</p> <pre><code>room_paths:\n   -\n</code></pre>"},{"location":"soliplex/config/installation/#completion-configuration-paths","title":"Completion Configuration Paths","text":"<p>The <code>completion_paths</code> entry specifies one or more filesystem paths to search for completion configs.</p> <p>Please see this page for details on how to configure these providers.</p> <p>Each path can be either:</p> <ul> <li> <p>a directory containing its own <code>completion_config.yaml</code> file:  this   directory will be mapped as a single completion.</p> </li> <li> <p>a directory whose immediate subdirectories will be treated as rooms   IFF they contain a <code>room_config.yaml</code> file.</p> </li> </ul> <p>Non-absolute paths will be evaluated relative to the installation directory.</p> <p>The order of entries in the <code>completion_paths</code> list controls which completion configuration is used for any conflict on completion ID:  completions found earlier in the list \"win\" over later ones with the same ID.</p> <p>By default, Soliplex loads completion configurations found under the path './completions', just as though we had configured:</p> <pre><code>completion_paths:\n  - \"./completions\"\n</code></pre> <p>To disable all completions, list a single, \"null\" path, e.g.: <pre><code>completion_paths:\n  -\n</code></pre></p>"},{"location":"soliplex/config/installation/#logfire-configuration","title":"Logfire Configuration","text":"<p>See the Solipex logfire configuration page.</p>"},{"location":"soliplex/config/logfire/","title":"Soliplex Logfire Configuration","text":"<p>The <code>logfire_config</code> attribute of the Soliplex installation configuration allows defining policies for how Logfire is configured at server startup.</p>"},{"location":"soliplex/config/logfire/#required-attributes","title":"Required attributes","text":"<ul> <li><code>token</code> should name the secret which contains the   token issued by Logfire.  E.g.:</li> </ul> <pre><code>logfire_config:\n    token: \"secret:LOGFIRE_TOKEN\"\n</code></pre>"},{"location":"soliplex/config/logfire/#optional-attributes","title":"Optional attributes","text":"<ul> <li><code>service_name</code> defines the service name reported to Logfire   for the appliction.  See   this page   for details</li> </ul> <p>It can be a literal, or else use a configured installation   environment value.  E.g.:</p> <pre><code>logfire_config:\n    ...\n    service_name: \"env:LOGFIRE_SERVICE_NAME\"\n</code></pre> <ul> <li><code>service_version</code> defines the service version reported to Logfire   for the appliction.  See   this page   for details</li> </ul> <p>It can be a literal, or else use a configured installation   environment value.  E.g.:</p> <pre><code>logfire_config:\n    ...\n    service_version: \"env:LOGFIRE_SERVICE_VERSION\"\n</code></pre> <ul> <li><code>environment</code> defines the environment reported to Logfire   for the appliction.  See   this page   for details</li> </ul> <p>It can be a literal, or else use a configured installation   environment value.  E.g.:</p> <pre><code>logfire_config:\n    ...\n    environment: \"env:LOGFIRE_ENVIRONMENT\"\n</code></pre> <ul> <li><code>data_dir</code> defines the path to local data recorded by Logfire.  See   this page   for details</li> </ul> <p>It can be a literal, or else use a configured installation environment   value.  E.g.:</p> <pre><code>logfire_config:\n    ...\n    data_dir:ib.Path | str = \"env:LOGFIRE_DATA_DIR\"\n</code></pre> <ul> <li><code>min_level</code> defines the minimum log level reported to Logfire.  See   this page for details.</li> </ul> <p>It can be a literal, or else use a configured installation   environment value.  E.g.:</p> <pre><code>logfire_config:\n    ...\n    min_level: logfire.LevelName = \"env:LOGFIRE_MIN_LEVEL\"\n</code></pre> <ul> <li><code>base_url</code> (string or None, None by default) is the URL of the   Logfire server.  This value would ordinarily only be used when self-hosting   Logfire, as the library will discover the cloud-hosted URL from the token.</li> </ul> <p>It can be a literal, or else use a configured installation   environment value.  E.g.:</p> <pre><code>logfire_config:\n    ...\n    base_url: \"env:LOGFIRE_BASE_URL\"\n</code></pre> <ul> <li><code>inspect_arguments</code> (boolean or None, None by default)  See   this page for details.</li> </ul> <pre><code>logfire_config:\n    ...\n    inspect_arguments: true\n</code></pre> <ul> <li><code>add_baggage_to_attributes</code> (boolean, True by default)  See   this page for details.</li> </ul> <pre><code>logfire_config:\n    ...\n    add_baggage_to_attributes: false\n</code></pre> <ul> <li><code>distributed_tracing</code> (boolean or None, None by default).  See   this page for details.</li> </ul> <pre><code>logfire_config:\n    ...\n    distributed_tracing: false\n</code></pre>"},{"location":"soliplex/config/meta/","title":"Installation Metaconfiguration","text":"<p>The <code>meta</code> section of an installation configuration enables registration of custom \"kinds\" of entities (tool configurations, MCP client toolset configurations, etc.), so that they can be used within the rest of the installation.</p> <p>E.g., registering a new tool configuration class in the <code>meta.tool_configs</code> section allows use of that class when configuring a custom tool in a given room.</p>"},{"location":"soliplex/config/meta/#registering-ag-ui-feature-classes","title":"Registering AG-UI Feature Classes","text":"<p>The <code>meta.agui_features</code> section registers AG-UI feature types so that they can be referenced by their <code>name</code>.  Each feature is a contract between the client application and the server, defining the schema for a named field in the AG-UI state, and which parties are expected to write to that field.</p> <p>The section contains a list of mappings, each of which include:</p> <ul> <li> <p><code>name</code>, a string identifying the field in the AG-UI state.</p> </li> <li> <p><code>model_klass</code>, a Python \"dotted name\" which can be used to import the    model class which defines the field's schema.</p> </li> <li> <p><code>source</code> (optional), a  key indicating which party is allowed to set   the feature's field in the AG-UI state. Allowed values are \"client\",   \"server\", and \"either\";  the default is \"either\".</p> </li> </ul> <p>By default, Soliplex registers its own AG-UI feature classes, just as though we configured explicitly:</p> <pre><code>meta:\n  agui_features:\n\n  - name: \"filter_documents\"\n    model_klass: \"soliplex.agui.features.FilterDocuments\"\n    source: \"client\"\n\n  - name: \"ask_history\"\n    model_klass: \"soliplex.agui.features.AskedAndAnswered\"\n    source: \"server\"\n</code></pre>"},{"location":"soliplex/config/meta/#registering-tool-configuration-classes","title":"Registering Tool Configuration Classes","text":"<p>The <code>meta.tool_configs</code> section enumerates tool configuration types so that they can be referenced by their <code>tool_name</code>.</p> <p>The section contains a list of Python \"dotted names\", i.e. strings which can be used to import the configuration class.</p> <p>By default, Soliplex registers its own tool config classes, just as though we configured explicitly:</p> <pre><code>meta:\n  tool_configs:\n  - \"soliplex.config.SearchDocumentsToolConfig\"\n</code></pre>"},{"location":"soliplex/config/meta/#registering-mcp-client-toolset-configuration-classes","title":"Registering MCP Client Toolset Configuration Classes","text":"<p>The <code>meta.mcp_toolset_configs</code> section enumerates MCP client toolset configuration types so that they can be referenced by their 'kind'.</p> <p>The section contains a list of Python \"dotted names\", i.e. strings which can be used to import the configuration class.</p> <p>By default, Soliplex registers its own tool config classes, just as though we configured explicitly:</p> <pre><code>meta:\n  mcp_toolset_configs:\n  - \"soliplex.config.Stdio_MCP_ClientToolsetConfig\"\n  - \"soliplex.config.HTTP_MCP_ClientToolsetConfig\"\n</code></pre>"},{"location":"soliplex/config/meta/#registering-mcp-server-tool-wrapper-types","title":"Registering MCP Server Tool Wrapper Types","text":"<p>The <code>meta.mcp_server_tool_wrappers</code> section maps tool configuration classes to the equivalent wrapper class, used then offering the tool to external MCP clients.</p> <p>The section contains a list of mappings with keys <code>config_klass</code> and <code>wrapper_klass</code>.  Values for both keys Python \"dotted names\", i.e. strings which can be used to import the corresponding class.</p> <p>By default, Soliplex configures its 'soliplex.config.WithQueryMCPWrapper' as the wrapper for 'soliplex.config.SearchDocumentsToolConfig', just as if we configured here:</p> <pre><code>meta:\n  mcp_server_tool_wrappers:\n  - config_klass: \"soliplex.config.SearchDocumentsToolConfig\"\n    wrapper_klass: \"soliplex.config.WithQueryMCPWrapper\"\n</code></pre>"},{"location":"soliplex/config/meta/#registering-agent-configuration-classes","title":"Registering Agent Configuration Classes","text":"<p>The <code>meta.agent_configs</code> section enumerates agent configuration types so that they can be referenced by their <code>kind</code>.</p> <p>The section contains a list of Python \"dotted names\", i.e. strings which can be used to import the configuration class.</p> <p>By default, Soliplex registers its own agent config class, just as though we configured explicitly:</p> <pre><code>meta:\n  tool_configs:\n  - \"soliplex.config.AgentConfig\"\n</code></pre>"},{"location":"soliplex/config/meta/#registering-secret-source-configurations","title":"Registering Secret Source Configurations","text":"<p>Each installation secret can be configured with multiple \"sources\" of different kinds. Each source configuration kind corresponds to a Python function which is used to retrieve the secret value.</p> <p>The <code>meta.secret_sources</code> section allows configuring new secret source configurations and their corresponding functions.</p> <p>By default, these classes are configured to use the corresponding functions in 'soliplex.secrets', just as if we configured here:</p> <pre><code>meta:\n  secret_sources:\n  - config_klass: \"soliplex.config.EnvVarSecretSource\"\n    registered_func: \"soliplex.secrets.get_env_var_secret\"\n  - config_klass: \"soliplex.config.FilePathSecretSource\"\n    registered_func: \"soliplex.secrets.get_file_path_secret\"\n  - config_klass: \"soliplex.config.SubprocessSecretSource\"\n    registered_func: \"soliplex.secrets.get_subprocess_secret\"\n  - config_klass: \"soliplex.config.RandomCharsSecretSource\"\n    registered_func: \"soliplex.secrets.get_random_chars_secret\"\n</code></pre>"},{"location":"soliplex/config/oidc_providers/","title":"OIDC Provider Configuration","text":"<p>The <code>config.yaml</code> file in an OIDC provider configuration directory specifies one or more authentication systems, sharing a common CA certificate store:</p> <pre><code>oidc_client_pem_path: \"./cacert.pem\"\n\nauth_systems:\n\n  - id: \"myprovder\"\n    title: \"Authenticate with MyProovider\"\n    server_url: \"https://oidc.excample.com/\"\n    client_id: \"myprovider-token-service\"\n    client_secret: \"\"  # \"secret:{MYPROVIDER_CLIENT_SECRET}\"\n    scope: \"openid email profile\"\n    token_validation_pem: |\n        -----BEGIN PUBLIC KEY-----\n        MII..AQAB\n        -----END PUBLIC KEY-----\n</code></pre>"},{"location":"soliplex/config/oidc_providers/#required-configuration-elements","title":"Required Configuration Elements","text":"<ul> <li><code>authsystems</code> is a list of one or more OIDC provider configurations   (see below).</li> </ul>"},{"location":"soliplex/config/oidc_providers/#optional-configuration-elements","title":"Optional Configuration Elements","text":"<ul> <li><code>oidc_client_pem_path</code> points to a file on the filesystem containing   the shared CA certificate store.  If not configured, the Soliplex   application will use systemwide default CA certificates.</li> </ul>"},{"location":"soliplex/config/oidc_providers/#required-oidc-provider-elements","title":"Required OIDC Provider Elements","text":"<ul> <li> <p><code>id</code>: a string, should be unique across all configured providers</p> </li> <li> <p><code>title</code>: a string, might be displayed by a client</p> </li> <li> <p><code>server_url</code>: URL for initiating the token auth flow.</p> </li> <li> <p><code>token_validation_pem</code>: a string, the public key used to verify    the providers tokens.</p> </li> <li> <p><code>client_id</code>: a string identifying the client to the provider.</p> </li> </ul>"},{"location":"soliplex/config/oidc_providers/#optional-oidc-provider-elements","title":"Optional OIDC Provider Elements","text":"<ul> <li> <p><code>client_secret</code>: a string;  if not empty, should be in the form   <code>\"secret:MYPROVIDER_CLIENT_SECRET\"</code>, where the name following the   <code>secret:</code> prefix is the name of a configured installation secret   (see this page for details).</p> </li> <li> <p><code>scope</code>: string, an OAuth scope specifier.</p> </li> </ul>"},{"location":"soliplex/config/quizzes/","title":"Quiz Datasets","text":"<p>Quizzes use the evaluation dataset entries (see the schema).</p>"},{"location":"soliplex/config/quizzes/#room-configuration","title":"Room Configuration","text":"<ul> <li>Room configurations get a new key, <code>quizzes</code>, with a value which   is a mapping defining quizzes which can be run in the room   (see <code>rooms/README.md</code>).</li> </ul>"},{"location":"soliplex/config/quizzes/#api","title":"API","text":""},{"location":"soliplex/config/quizzes/#get-apiv1rooms","title":"<code>GET /api/v1/rooms</code>","text":"<p>Room config entries in the response include the value of <code>quizzes</code> (a list of mappings).</p>"},{"location":"soliplex/config/quizzes/#get-apiv1roomsroom_id","title":"<code>GET /api/v1/rooms/{room_id}</code>","text":"<p>Response includes  the value of <code>quizzes</code> (a list of mappings).</p>"},{"location":"soliplex/config/quizzes/#get-apiv1roomsroom_idquizquiz_id","title":"<code>GET /api/v1/rooms/{room_id}/quiz/{quiz_id}</code>","text":"<p>Fetch the quiz.  Returns a mapping for the quiz with a list of questions:</p> <pre><code>{\n    \"id\": \"&lt;quiz_id&gt;\",\n    \"questions\": [\n        {\n            \"uuid\": \"&lt;question_uuid&gt;\",\n            \"inputs\": \"What color is the sky? (QA)\",\n            \"metadata\": {\n                \"type\": \"qa\"\n            }\n        },\n        {\n            \"uuid\": \"&lt;question_uuid&gt;\",\n            \"inputs\": \"The color of the sky is _____\",\n            \"metadata\": {\n                \"type\": \"fill-blank\"\n            }\n        },\n        {\n            \"uuid\": \"&lt;question_uuid&gt;\",\n            \"inputs\": \"Is the sky blue?\",\n            \"metadata\": {\n                \"type\": \"multiple-choice\",\n                \"options\": {\n                    \"true\",\n                    \"false\"\n                }\n            }\n        },\n        {\n            \"uuid\": \"&lt;question_uuid&gt;\",\n            \"inputs\": \"What color is the sky? (MC)\",\n            \"metadata\": {\n                \"type\": \"multiple-choice\",\n                \"options\": {\n                    \"red\",\n                    \"green\",\n                    \"blue\"\n                }\n            }\n        },\n    ...\n    ]\n}\n</code></pre> <ul> <li> <p><code>question-type</code> is one of <code>\"qa\"</code>, <code>\"fill-blank\"</code>, or <code>\"multiple-choice\"</code></p> </li> <li> <p>Questions of type <code>\"multiple-choice\"</code> contain an additional entry,   <code>\"options\"</code> in their metadata, whose value is a list of strings.</p> </li> </ul>"},{"location":"soliplex/config/quizzes/#post-apiv1roomsroom_idquizquiz_idquestion_uuid","title":"<code>POST /api/v1/rooms/{room_id}/quiz/{quiz_id}/{question_uuid}</code>","text":"<p>Check an answer.  Client should send the answer entered / selected by the user as a <code>text/plain</code> body.  For a correct answer, returns:</p> <pre><code>{\n    \"correct\": \"true\"\n}\n</code></pre> <p>For an incorrect answer, returns: <pre><code>{\n    \"correct\": \"false\"\n    \"expected_output\": \"&lt;expected_output&gt;\"\n}\n</code></pre></p> <p>(Later, this response might include more information, such as a citation).</p>"},{"location":"soliplex/config/rag/","title":"<code>haiku-rag</code> Client Configuration","text":"<p>In order to use its RAG database(s) (see this page for how to create them), Soliplex installation uses <code>haiku.rag</code> as a library, creating instances of <code>haiku.rag.client.HaikuRag</code> client class as needed.</p> <p>NOTE:  the <code>embeddings</code> configuration used to create the RAG database            must match the client configuration used to read the database.</p> <p>The configuration used to create these client instances can be defined in two places:</p>"},{"location":"soliplex/config/rag/#global-configuration","title":"Global Configuration","text":"<p>The default <code>haiku-rag</code> configuration for an installation lives in a seprate file, <code>haiku.rag.yaml</code>, which is located by default in the installation directory (next to the main installation config file).</p> <p>See the <code>haiku-rag</code> docs for the format and semantics of this file.</p>"},{"location":"soliplex/config/rag/#room-level-and-completion-level-configuration","title":"Room-level and Completion-level Configuration","text":"<p>Rooms and completions which use the <code>soliplex.tools.search_documents</code> tool can also define a <code>haiku.rag.yaml</code> file, next to their own config files.  Soliplex overlays any configuration defined in such files on top of the global configuration when using the tool.</p> <p>E.g., to override only the reranking used by <code>haiku-rag</code> in a given room:</p> <pre><code>reranking:\n  model:\n    name: \"gpt-oss:20b\"\n    provider: \"ollama\"\n</code></pre>"},{"location":"soliplex/config/rooms/","title":"Room Configuration Filesystem Layout","text":"<p>A room is configured via a directory, whose name is the room ID.</p> <p>NOTE: directories whose names start with '.' are ignored.</p> <p>Within that directory should be one or two files:</p> <ul> <li> <p><code>room_config.yaml</code> holds metadata about the room (see below)</p> </li> <li> <p><code>prompt.txt</code> (if present) holds the system prompt for conversations   which are initiated from the room.</p> </li> </ul> <p>Example layout without external prompt file: <pre><code>simple/\n    room_config.yaml\n</code></pre></p> <pre><code>chat/\n    prompt.txt\n    room_config.yaml\n</code></pre>"},{"location":"soliplex/config/rooms/#room-configuration-file-schema","title":"Room Configuration File Schema","text":""},{"location":"soliplex/config/rooms/#required-room-elements","title":"Required room elements","text":"<p>The <code>room_config.yaml</code>  file should be a mapping, with at least the following required elements:</p> <ul> <li> <p><code>id</code> (a string) should match the name of the room's directory.</p> </li> <li> <p><code>name</code> (a string) is the \"title\" of the room, as would be shown in a list.</p> </li> <li> <p><code>description</code> (a string) tells the purpose of the room:  it might show up   as the \"lede\" graph (below the <code>name</code>) in a list of rooms.</p> </li> <li> <p><code>agent</code> (a mapping, see next section)</p> </li> </ul> <p>A minimal room configuration must include the above elements, e.g.:</p> <pre><code>id: \"chat\"\nname: \"Chatting Darkly\"\ndescription: \"Scanning for conversations\"\nagent:\n  system_prompt: |\n      You are an..... #\n</code></pre>"},{"location":"soliplex/config/rooms/#optional-room-elements-ui-related","title":"Optional room elements (UI-related):","text":"<ul> <li><code>welcome_message</code> (a string), for the UI to display when the user   enters a room.  E.g.:</li> </ul> <pre><code>welcome_message: &gt;\n    Welcome to the room.  We hope you find it useful\n\n    Please review the suggestions below for ideas on the kinds\n    of questions for which this room is intended.\n</code></pre> <ul> <li><code>suggestions</code> (a list of strings) contains possible \"starter questions\"   for the room, which the UI might display as shortcuts when the user   enters the room.  E.g.:</li> </ul> <pre><code>suggestions:\n  - \"How high is up?\"\n  - \"Why is the sky blue?\"\n</code></pre> <ul> <li><code>enable_attachments</code> (a boolean, default <code>False</code>), which, if true,    tells the UI to allow the user to attach files to a prompt. E.g.:</li> </ul> <pre><code>enable_attachments: true\n</code></pre>"},{"location":"soliplex/config/rooms/#agent-configuration","title":"Agent configuration","text":"<p>The <code>agent</code> mapping is used to configure the Pydantic AI agent used to make the room's calls to the LLM.</p> <pre><code>agent:\n    model_name: \"gpt-oss:latest\"\n    system_prompt: \"./prompt.txt\"\n</code></pre> <p>Please see this page for a full description of the options for configuring an agent.</p>"},{"location":"soliplex/config/rooms/#tool-configurations","title":"Tool Configurations","text":"<ul> <li><code>tools</code> should be a list of mappings, with at least the key   <code>tool_name</code>, whose value is a dotted name identifying a Python function    (or callable) which can serve as a \"tool\" for the LLM.  E.g.:</li> </ul> <p><pre><code>tools:\n    - tool_name: \"soliplex.tools.get_current_datetime\"\n    - tool_name: \"soliplex.tools.get_current_user\"\n</code></pre>   Each tool mapping can contain additional elements, which are used to    configure the tool's behavior.</p>"},{"location":"soliplex/config/rooms/#rag-search-related","title":"RAG / search-related","text":"<p>The <code>soliplex.tools.search_documents</code> tool takes a number of configuration values.  Exactly one of the following two elements is required:</p> <ul> <li><code>rag_lancedb_stem</code> is a string:  it should be the \"base name\" (without   path or <code>.lancedb</code> suffix) of the LanceDB file containing the RAG document   data for the tool. This file must exist in the \"standard\" location   (typically under the <code>db/rag/</code> directory;  see below).</li> </ul> <pre><code>rag_lancedb_stem: \"&lt;room_id&gt;\"\n</code></pre> <ul> <li><code>rag_lancedb_override_path</code> is a string:  it should be a fully-qualified   pathname, including the suffix, of the LanceDB directory containing the RAG   document data for the tool. </li> </ul> <pre><code>rag_lancedb_override_path: \"/&lt;path-to-rag-databases&gt;/&lt;room_id&gt;.&lt;extension&gt;\"\n</code></pre> <p>Other, optional elements for the <code>search_documents</code> tool:</p> <ul> <li><code>search_documents_limit</code> is a positive integer (default <code>5</code>), used to   control the number of results returned by the <code>search_documents</code> tool. E.g.:</li> </ul> <pre><code>search_documents_limit: 8\n</code></pre> <p>Minimal <code>search_documents</code> configuration, with RAG database file found in the standard location:</p> <pre><code>agent:\n  tools:\n    - tool_name: \"soliplex.tools.search_documents\"\n      rag_lancedb_stem: \"chat\"\n</code></pre> <p>Minimal <code>search_documents</code> configuration, with RAG database file found in an overridden location:</p> <pre><code>agent:\n  tools:\n    - tool_name: \"soliplex.tools.search_documents\"\n      rag_lancedb_override_path: \"/path/to/rag/db/filename.lancedb\"\n</code></pre> <p>Maximal <code>search_documents</code> configuration</p> <pre><code>agent:\n  tools:\n    - tool_name: \"soliplex.tools.search_documents\"\n      rag_lancedb_stem: \"chat\"\n      search_documents_limit: 8\n</code></pre>"},{"location":"soliplex/config/rooms/#quiz-related-elements","title":"Quiz-related elements","text":"<ul> <li><code>quizzes</code> is a list of mappings (default <code>()</code>):  each mapping defines a   quiz which can be run in the room (see this page for   details of the quiz dataset).</li> </ul> <pre><code>quizzes:\n  - id: \"test_quiz\"\n    title: \"Test Quiz\"\n    question_file: \"/path/to/questions.json\"\n    randomize: false\n    max_questions: 100\n</code></pre>"},{"location":"soliplex/config/rooms/#location-of-rag-database-files","title":"Location of RAG database files","text":"<p>Rooms using the <code>search_documents</code> tool need to be able to find the LanceDB database containing the chunks and embeddings extracted by Haiku-RAG.  At present, there should be a single database per room, named by convention <code>&lt;stem&gt;.lancedb</code>, and stored in the <code>db/rag/</code> subdirectory of the project root.</p>"},{"location":"soliplex/config/secrets/","title":"Configuring Installation Secrets","text":"<p>The <code>secrets</code> section of an installation configuration contains a list of secret names, and optionally their configured sources.</p> <p>The default configuration knows of four types of sources:</p> <ul> <li>Environment variables</li> <li>File paths</li> <li>Subprocess commands</li> <li>Randomly-generated strings</li> </ul>"},{"location":"soliplex/config/secrets/#secret-source-environment-variable","title":"Secret Source: Environment Variable","text":"<p>A secret source which uses an environment variable can be configured so:</p> <pre><code>secrets:\n   - secret_name: MY_SECRET\n     sources:\n     - kind: \"env_var\"\n       env_var_name: \"MY_SECRET_ENV_VAR_NAME\"\n</code></pre>"},{"location":"soliplex/config/secrets/#secret-source-filesystem-path","title":"Secret Source: Filesystem Path","text":"<p>A secret source which uses a file system path can be configured so:</p> <pre><code>secrets:\n   - secret_name: MY_SECRET\n     sources:\n     - kind: \"file_path\"\n       file_path: \"/run/secret/my_secret\"\n</code></pre>"},{"location":"soliplex/config/secrets/#secret-source-subprocess-command","title":"Secret Source: Subprocess Command","text":"<p>A secret source which uses a subprocess command can be configured so:</p> <pre><code>secrets:\n   - secret_name: MY_SECRET\n     sources:\n     - kind: \"subprocess\"\n       command: \"/usr/bin/fetch_secret\"\n       args:\n       - \"--secret-name=MY_SECRET\"\n</code></pre>"},{"location":"soliplex/config/secrets/#secret-source-randomly-generated-string","title":"Secret Source: Randomly-Generated String","text":"<p>A secret source which uses generates a random string at process startup can be configured so:</p> <pre><code>secrets:\n   - secret_name: MY_SECRET\n     sources:\n     - kind: \"random_chars\"\n       n_chars: 32\n</code></pre>"},{"location":"soliplex/config/secrets/#layering-secret-sources","title":"Layering Secret Sources","text":"<p>Sources are resolved in the order they are listed, with the first one returning a value winning.  This example layers an environment variable source with a random string source:</p> <pre><code>secrets:\n   - secret_name: MY_SECRET\n     sources:\n     - kind: \"env_var\"\n       env_var_name: \"MY_SECRET_ENV_VAR_NAME\"\n     - kind: \"random_chars\"\n       n_chars: 32\n</code></pre>"},{"location":"soliplex/config/secrets/#secrets-without-sources","title":"Secrets without Sources","text":"<p>Secrets which list no sources are treated as though they were configured using an environment variable source with the same name.</p> <p>This configuration:</p> <pre><code>secrets:\n    - secret_name: MY_SECRET\n</code></pre> <p>is equivalent to:</p> <pre><code>secrets:\n   - secret_name: MY_SECRET\n     sources:\n     - kind: \"env_var\"\n       env_var_name: \"MY_SECRET\"\n</code></pre>"},{"location":"soliplex/config/secrets/#secrets-as-bare-strings","title":"Secrets as Bare Strings","text":"<p>An even shorter way to spell the previous configuration:</p> <pre><code>secrets:\n   - \"MY_SECRET\"\n</code></pre>"},{"location":"soliplex/config/secrets/#checking-configured-secrets","title":"Checking Configured Secrets","text":"<p>The <code>soliplex-cli</code> application has a sub-command, <code>list-secrets</code>. It loads the configuration, attempts to resolve all the secrets, and reports those not found.  E.g.:</p> <pre><code>$ soliplex-cli list-secrets example/installation.yaml \n\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 Configured secrets \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n- LOGFIRE_TOKEN             MISSING\n- SMITHERY_AI_API_KEY       MISSING\n- SMITHERY_AI_PROFILE       MISSING\n- URL_SAFE_TOKEN_SECRET     OK\n</code></pre>"}]}