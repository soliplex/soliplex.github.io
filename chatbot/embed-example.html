<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Soliplex Chat Widget - Embed Example</title>
  <style>
    body {
      font-family: system-ui, -apple-system, sans-serif;
      max-width: 800px;
      margin: 0 auto;
      padding: 2rem;
      line-height: 1.6;
    }
    h1 { color: #1e40af; }
    code {
      background: #f3f4f6;
      padding: 0.2em 0.4em;
      border-radius: 0.25rem;
      font-size: 0.9em;
    }
    pre {
      background: #1e293b;
      color: #e2e8f0;
      padding: 1rem;
      border-radius: 0.5rem;
      overflow-x: auto;
    }
    pre code {
      background: none;
      padding: 0;
    }
    .demo-section {
      margin-top: 2rem;
      padding: 1rem;
      background: #f8fafc;
      border-radius: 0.5rem;
      border: 1px solid #e2e8f0;
    }
    button {
      background: #2563eb;
      color: white;
      border: none;
      padding: 0.5rem 1rem;
      border-radius: 0.25rem;
      cursor: pointer;
      margin-right: 0.5rem;
    }
    button:hover { background: #1d4ed8; }
  </style>
</head>
<body>
  <h1>Soliplex Chat Widget</h1>
  <p>This page demonstrates how to embed the Soliplex Chat widget into any website.</p>

  <h2>Basic Usage</h2>
  <pre><code>&lt;!-- Include the widget script --&gt;
&lt;script src="https://raw.githubusercontent.com/soliplex/chatbot/refs/heads/main/public/soliplex-chat.js"&gt;&lt;/script&gt;

&lt;!-- Initialize the widget --&gt;
&lt;script&gt;
  SoliplexChat.init({
    baseUrl: "http://localhost:8000",
    // roomIds: [],  // Empty or omit to show all rooms
    // roomIds: ["room1", "room2"],  // Or specify rooms to show
    autoHideSeconds: 0,  // 0 = never hide
    position: "bottom-right",
    bubbleColor: "#2563eb",
    title: "Chat with us"
  });
&lt;/script&gt;</code></pre>

  <h2>Configuration Options</h2>
  <table style="width: 100%; border-collapse: collapse; margin: 1rem 0;">
    <thead>
      <tr style="background: #f1f5f9;">
        <th style="text-align: left; padding: 0.5rem; border: 1px solid #e2e8f0;">Option</th>
        <th style="text-align: left; padding: 0.5rem; border: 1px solid #e2e8f0;">Type</th>
        <th style="text-align: left; padding: 0.5rem; border: 1px solid #e2e8f0;">Default</th>
        <th style="text-align: left; padding: 0.5rem; border: 1px solid #e2e8f0;">Description</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td style="padding: 0.5rem; border: 1px solid #e2e8f0;"><code>baseUrl</code></td>
        <td style="padding: 0.5rem; border: 1px solid #e2e8f0;">string</td>
        <td style="padding: 0.5rem; border: 1px solid #e2e8f0;"><em>http://localhost:8000</em></td>
        <td style="padding: 0.5rem; border: 1px solid #e2e8f0;">Backend API URL</td>
      </tr>
      <tr>
        <td style="padding: 0.5rem; border: 1px solid #e2e8f0;"><code>roomIds</code></td>
        <td style="padding: 0.5rem; border: 1px solid #e2e8f0;">string[]</td>
        <td style="padding: 0.5rem; border: 1px solid #e2e8f0;"><em>[] (all rooms)</em></td>
        <td style="padding: 0.5rem; border: 1px solid #e2e8f0;">Room IDs to show; empty or omit to show all available rooms</td>
      </tr>
      <tr>
        <td style="padding: 0.5rem; border: 1px solid #e2e8f0;"><code>autoHideSeconds</code></td>
        <td style="padding: 0.5rem; border: 1px solid #e2e8f0;">number</td>
        <td style="padding: 0.5rem; border: 1px solid #e2e8f0;">0</td>
        <td style="padding: 0.5rem; border: 1px solid #e2e8f0;">Seconds until bubble auto-hides (0 = never)</td>
      </tr>
      <tr>
        <td style="padding: 0.5rem; border: 1px solid #e2e8f0;"><code>position</code></td>
        <td style="padding: 0.5rem; border: 1px solid #e2e8f0;">string</td>
        <td style="padding: 0.5rem; border: 1px solid #e2e8f0;">"bottom-right"</td>
        <td style="padding: 0.5rem; border: 1px solid #e2e8f0;">"bottom-right" or "bottom-left"</td>
      </tr>
      <tr>
        <td style="padding: 0.5rem; border: 1px solid #e2e8f0;"><code>bubbleColor</code></td>
        <td style="padding: 0.5rem; border: 1px solid #e2e8f0;">string</td>
        <td style="padding: 0.5rem; border: 1px solid #e2e8f0;">"#2563eb"</td>
        <td style="padding: 0.5rem; border: 1px solid #e2e8f0;">Color of the chat bubble</td>
      </tr>
      <tr>
        <td style="padding: 0.5rem; border: 1px solid #e2e8f0;"><code>title</code></td>
        <td style="padding: 0.5rem; border: 1px solid #e2e8f0;">string</td>
        <td style="padding: 0.5rem; border: 1px solid #e2e8f0;">"Chat with us"</td>
        <td style="padding: 0.5rem; border: 1px solid #e2e8f0;">Title shown in the chat header</td>
      </tr>
      <tr>
        <td style="padding: 0.5rem; border: 1px solid #e2e8f0;"><code>tools</code></td>
        <td style="padding: 0.5rem; border: 1px solid #e2e8f0;">array</td>
        <td style="padding: 0.5rem; border: 1px solid #e2e8f0;">[]</td>
        <td style="padding: 0.5rem; border: 1px solid #e2e8f0;">Custom client-side tools</td>
      </tr>
    </tbody>
  </table>

  <h2>Adding Custom Tools</h2>
  <p>You can define custom JavaScript functions that the AI agent can call:</p>

  <pre><code>&lt;script&gt;
// Define your tool functions on the window object
window.myTools = {
  getWeather: async function(args) {
    // Your implementation here
    return { temperature: 72, condition: "sunny", location: args.city };
  },

  getUserInfo: async function(args) {
    return {
      name: document.getElementById('user-name')?.value || 'Guest',
      loggedIn: !!localStorage.getItem('auth_token')
    };
  }
};

// Initialize with tools
SoliplexChat.init({
  baseUrl: "http://localhost:8000",
  roomId: "default-room",
  tools: [
    {
      name: "get_weather",
      description: "Get the current weather for a city",
      parameters: {
        type: "object",
        properties: {
          city: {
            type: "string",
            description: "The city name"
          }
        },
        required: ["city"]
      },
      handler: "myTools.getWeather"  // Reference to window.myTools.getWeather
    },
    {
      name: "get_user_info",
      description: "Get information about the current user",
      parameters: { type: "object", properties: {} },
      handler: "myTools.getUserInfo"
    },
    {
      name: "add_to_cart",
      description: "Add a product to the shopping cart",
      parameters: {
        type: "object",
        properties: {
          productId: { type: "string" },
          quantity: { type: "number", default: 1 }
        },
        required: ["productId"]
      },
      // You can also use an inline function
      handler: async function(args) {
        console.log("Adding to cart:", args);
        // Your cart logic here
        return { success: true, cartTotal: 3 };
      }
    }
  ]
});
&lt;/script&gt;</code></pre>

  <h2>API Methods</h2>
  <pre><code>// Open the chat programmatically
SoliplexChat.open();

// Close the chat
SoliplexChat.close();

// Remove the widget completely
SoliplexChat.destroy();

// Re-initialize with different config
SoliplexChat.init({ ... });</code></pre>

  <div class="demo-section">
    <h3>Live Demo Controls</h3>
    <p>Try the API methods:</p>
    <button onclick="SoliplexChat.open()">Open Chat</button>
    <button onclick="SoliplexChat.close()">Close Chat</button>
    <button onclick="SoliplexChat.destroy()">Destroy Widget</button>
    <button onclick="reinitWidget()">Re-initialize</button>
  </div>

  <h2>Auto-Hide Feature</h2>
  <p>Set <code>autoHideSeconds</code> to automatically hide the bubble after a period of inactivity:</p>
  <pre><code>SoliplexChat.init({
  baseUrl: "http://localhost:8000",
  roomId: "default-room",
  autoHideSeconds: 10  // Hide after 10 seconds if user hasn't interacted
});</code></pre>
  <p>The bubble will reappear when the user moves their mouse near the corner where it was positioned.</p>

  <!-- Load the widget -->
  <script src="./soliplex-chat.js"></script>
  <script>
    // Define sample tools
    window.demoTools = {
      getPageInfo: async function() {
        return {
          title: document.title,
          url: window.location.href,
          scrollPosition: window.scrollY
        };
      },

      getMyLocation: function() {
        return new Promise((resolve, reject) => {
          if (!navigator.geolocation) {
            resolve({ error: "Geolocation is not supported by this browser" });
            return;
          }
          navigator.geolocation.getCurrentPosition(
            async (position) => {
              const lat = position.coords.latitude;
              const lon = position.coords.longitude;
              const result = {
                latitude: lat,
                longitude: lon,
                accuracy: position.coords.accuracy,
                timestamp: new Date(position.timestamp).toISOString(),
                city: null,
                country: null
              };
              // Reverse geocode to get city name
              try {
                const resp = await fetch(
                  `https://nominatim.openstreetmap.org/reverse?lat=${lat}&lon=${lon}&format=json`,
                  { headers: { 'User-Agent': 'SoliplexChatWidget/1.0' } }
                );
                if (resp.ok) {
                  const data = await resp.json();
                  result.city = data.address?.city || data.address?.town || data.address?.village || data.address?.municipality || null;
                  result.country = data.address?.country || null;
                }
              } catch (e) {
                // Geocoding failed, but we still have coordinates
              }
              resolve(result);
            },
            (error) => {
              const messages = {
                1: "User denied location access",
                2: "Location information unavailable",
                3: "Location request timed out"
              };
              resolve({ error: messages[error.code] || "Unknown error" });
            },
            { enableHighAccuracy: true, timeout: 10000 }
          );
        });
      }
    };

    // Initialize the widget
    function initWidget() {
      SoliplexChat.init({
        baseUrl: "http://localhost:8000",
        // roomIds: [], // Empty or omit to show all available rooms
        // roomIds: ["mcptest"], // Or specify specific rooms to show
        autoHideSeconds: 0,
        position: "bottom-right",
        bubbleColor: "#2563eb",
        title: "Select a Chat",
        tools: [
          {
            name: "get_page_info",
            description: "Get information about the current page",
            parameters: { type: "object", properties: {} },
            handler: "demoTools.getPageInfo"
          },
          {
            name: "get_my_location",
            description: "Get the user's current geographic location. Use this when 'my location' is mentioned.",
            parameters: { type: "object", properties: {} },
            handler: "demoTools.getMyLocation"
          }
        ]
      });
    }

    function reinitWidget() {
      SoliplexChat.destroy();
      initWidget();
    }

    // Initialize on load
    initWidget();
  </script>
</body>
</html>
